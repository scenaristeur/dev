(self["webpackChunkdev"]=self["webpackChunkdev"]||[]).push([[370],{9370:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Wo}});var r={};n.r(r),n.d(r,{AsyncCompress:function(){return ht},AsyncDecompress:function(){return Pt},AsyncDeflate:function(){return rt},AsyncGunzip:function(){return vt},AsyncGzip:function(){return ht},AsyncInflate:function(){return st},AsyncUnzipInflate:function(){return en},AsyncUnzlib:function(){return At},AsyncZipDeflate:function(){return qt},AsyncZlib:function(){return xt},Compress:function(){return ct},DecodeUTF8:function(){return Nt},Decompress:function(){return Tt},Deflate:function(){return nt},EncodeUTF8:function(){return Ot},Gunzip:function(){return pt},Gzip:function(){return ct},Inflate:function(){return at},Unzip:function(){return tn},UnzipInflate:function(){return $t},UnzipPassThrough:function(){return Jt},Unzlib:function(){return kt},Zip:function(){return Kt},ZipDeflate:function(){return Xt},ZipPassThrough:function(){return Wt},Zlib:function(){return gt},compress:function(){return dt},compressSync:function(){return ft},decompress:function(){return Ct},decompressSync:function(){return Et},deflate:function(){return it},deflateSync:function(){return ot},gunzip:function(){return mt},gunzipSync:function(){return yt},gzip:function(){return dt},gzipSync:function(){return ft},inflate:function(){return lt},inflateSync:function(){return ut},strFromU8:function(){return Dt},strToU8:function(){return Vt},unzip:function(){return nn},unzipSync:function(){return rn},unzlib:function(){return St},unzlibSync:function(){return Mt},zip:function(){return Yt},zipSync:function(){return Qt},zlib:function(){return bt},zlibSync:function(){return wt}});var i=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},o=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e._v(" Physic World "),n("div",{staticClass:"home",attrs:{id:"myCanvas"}})])}],a=n(2032),s=n(6133),l=n(2751),u=(n(8975),n(1539),n(1532),n(8783),n(3948),n(9714),n(4747),n(6977),n(3226)),c=n(4175),h=n(9418),d=n(9161),f=n(9726),p=(n(1249),n(1703),n(86),n(7042),n(2222),n(8309),n(561),n(2707),n(4197),n(8675),n(2990),n(8927),n(3105),n(5035),n(4345),n(7174),n(2846),n(4731),n(7209),n(6319),n(8867),n(7789),n(3739),n(9368),n(4483),n(2056),n(3462),n(678),n(7462),n(3824),n(5021),n(2974),n(5016),new u.yGw),v=new u.Tme,m=new u.Pa4,y=function(e){(0,h.Z)(n,e);var t=(0,d.Z)(n);function n(){var e;return(0,s.Z)(this,n),e=t.call(this),e.uuid=u.M8C.generateUUID(),e.name="",e.type="Geometry",e.vertices=[],e.colors=[],e.faces=[],e.faceVertexUvs=[[]],e.morphTargets=[],e.morphNormals=[],e.skinWeights=[],e.skinIndices=[],e.lineDistances=[],e.boundingBox=null,e.boundingSphere=null,e.elementsNeedUpdate=!1,e.verticesNeedUpdate=!1,e.uvsNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.lineDistancesNeedUpdate=!1,e.groupsNeedUpdate=!1,e}return(0,l.Z)(n,[{key:"applyMatrix4",value:function(e){for(var t=(new u.Vkp).getNormalMatrix(e),n=0,r=this.vertices.length;n<r;n++){var i=this.vertices[n];i.applyMatrix4(e)}for(var o=0,a=this.faces.length;o<a;o++){var s=this.faces[o];s.normal.applyMatrix3(t).normalize();for(var l=0,c=s.vertexNormals.length;l<c;l++)s.vertexNormals[l].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}},{key:"rotateX",value:function(e){return p.makeRotationX(e),this.applyMatrix4(p),this}},{key:"rotateY",value:function(e){return p.makeRotationY(e),this.applyMatrix4(p),this}},{key:"rotateZ",value:function(e){return p.makeRotationZ(e),this.applyMatrix4(p),this}},{key:"translate",value:function(e,t,n){return p.makeTranslation(e,t,n),this.applyMatrix4(p),this}},{key:"scale",value:function(e,t,n){return p.makeScale(e,t,n),this.applyMatrix4(p),this}},{key:"lookAt",value:function(e){return v.lookAt(e),v.updateMatrix(),this.applyMatrix4(v.matrix),this}},{key:"fromBufferGeometry",value:function(e){var t=this,n=null!==e.index?e.index:void 0,r=e.attributes;if(void 0===r.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var i=r.position,o=r.normal,a=r.color,s=r.uv,l=r.uv2;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var c=0;c<i.count;c++)t.vertices.push((new u.Pa4).fromBufferAttribute(i,c)),void 0!==a&&t.colors.push((new u.Ilk).fromBufferAttribute(a,c));function h(e,n,r,i){var c=void 0===a?[]:[t.colors[e].clone(),t.colors[n].clone(),t.colors[r].clone()],h=void 0===o?[]:[(new u.Pa4).fromBufferAttribute(o,e),(new u.Pa4).fromBufferAttribute(o,n),(new u.Pa4).fromBufferAttribute(o,r)],d=new x(e,n,r,h,c,i);t.faces.push(d),void 0!==s&&t.faceVertexUvs[0].push([(new u.FM8).fromBufferAttribute(s,e),(new u.FM8).fromBufferAttribute(s,n),(new u.FM8).fromBufferAttribute(s,r)]),void 0!==l&&t.faceVertexUvs[1].push([(new u.FM8).fromBufferAttribute(l,e),(new u.FM8).fromBufferAttribute(l,n),(new u.FM8).fromBufferAttribute(l,r)])}var d=e.groups;if(d.length>0)for(var f=0;f<d.length;f++)for(var p=d[f],v=p.start,m=p.count,y=v,g=v+m;y<g;y+=3)void 0!==n?h(n.getX(y),n.getX(y+1),n.getX(y+2),p.materialIndex):h(y,y+1,y+2,p.materialIndex);else if(void 0!==n)for(var b=0;b<n.count;b+=3)h(n.getX(b),n.getX(b+1),n.getX(b+2));else for(var w=0;w<i.count;w+=3)h(w,w+1,w+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}},{key:"center",value:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(m).negate(),this.translate(m.x,m.y,m.z),this}},{key:"normalize",value:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,n=0===t?1:1/t,r=new u.yGw;return r.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix4(r),this}},{key:"computeFaceNormals",value:function(){for(var e=new u.Pa4,t=new u.Pa4,n=0,r=this.faces.length;n<r;n++){var i=this.faces[n],o=this.vertices[i.a],a=this.vertices[i.b],s=this.vertices[i.c];e.subVectors(s,a),t.subVectors(o,a),e.cross(t),e.normalize(),i.normal.copy(e)}}},{key:"computeVertexNormals",value:function(){for(var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=new Array(this.vertices.length),n=0,r=this.vertices.length;n<r;n++)t[n]=new u.Pa4;if(e)for(var i=new u.Pa4,o=new u.Pa4,a=0,s=this.faces.length;a<s;a++){var l=this.faces[a],c=this.vertices[l.a],h=this.vertices[l.b],d=this.vertices[l.c];i.subVectors(d,h),o.subVectors(c,h),i.cross(o),t[l.a].add(i),t[l.b].add(i),t[l.c].add(i)}else{this.computeFaceNormals();for(var f=0,p=this.faces.length;f<p;f++){var v=this.faces[f];t[v.a].add(v.normal),t[v.b].add(v.normal),t[v.c].add(v.normal)}}for(var m=0,y=this.vertices.length;m<y;m++)t[m].normalize();for(var g=0,x=this.faces.length;g<x;g++){var b=this.faces[g],w=b.vertexNormals;3===w.length?(w[0].copy(t[b.a]),w[1].copy(t[b.b]),w[2].copy(t[b.c])):(w[0]=t[b.a].clone(),w[1]=t[b.b].clone(),w[2]=t[b.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}},{key:"computeFlatVertexNormals",value:function(){this.computeFaceNormals();for(var e=0,t=this.faces.length;e<t;e++){var n=this.faces[e],r=n.vertexNormals;3===r.length?(r[0].copy(n.normal),r[1].copy(n.normal),r[2].copy(n.normal)):(r[0]=n.normal.clone(),r[1]=n.normal.clone(),r[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}},{key:"computeMorphNormals",value:function(){for(var e=0,t=this.faces.length;e<t;e++){var r=this.faces[e];r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]);for(var i=0,o=r.vertexNormals.length;i<o;i++)r.__originalVertexNormals[i]?r.__originalVertexNormals[i].copy(r.vertexNormals[i]):r.__originalVertexNormals[i]=r.vertexNormals[i].clone()}var a=new n;a.faces=this.faces;for(var s=0,l=this.morphTargets.length;s<l;s++){if(!this.morphNormals[s]){this.morphNormals[s]={},this.morphNormals[s].faceNormals=[],this.morphNormals[s].vertexNormals=[];for(var c=this.morphNormals[s].faceNormals,h=this.morphNormals[s].vertexNormals,d=0,f=this.faces.length;d<f;d++){var p=new u.Pa4,v={a:new u.Pa4,b:new u.Pa4,c:new u.Pa4};c.push(p),h.push(v)}}var m=this.morphNormals[s];a.vertices=this.morphTargets[s].vertices,a.computeFaceNormals(),a.computeVertexNormals();for(var y=0,g=this.faces.length;y<g;y++){var x=this.faces[y],b=m.faceNormals[y],w=m.vertexNormals[y];b.copy(x.normal),w.a.copy(x.vertexNormals[0]),w.b.copy(x.vertexNormals[1]),w.c.copy(x.vertexNormals[2])}}for(var k=0,A=this.faces.length;k<A;k++){var S=this.faces[k];S.normal=S.__originalFaceNormal,S.vertexNormals=S.__originalVertexNormals}}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new u.ZzF),this.boundingBox.setFromPoints(this.vertices)}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new u.aLr),this.boundingSphere.setFromPoints(this.vertices)}},{key:"merge",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e&&e.isGeometry){var r,i=this.vertices.length,o=this.vertices,a=e.vertices,s=this.faces,l=e.faces,c=this.colors,h=e.colors;void 0!==t&&(r=(new u.Vkp).getNormalMatrix(t));for(var d=0,f=a.length;d<f;d++){var p=a[d],v=p.clone();void 0!==t&&v.applyMatrix4(t),o.push(v)}for(var m=0,y=h.length;m<y;m++)c.push(h[m].clone());for(var g=0,b=l.length;g<b;g++){var w=l[g],k=void 0,A=void 0,S=w.vertexNormals,M=w.vertexColors,T=new x(w.a+i,w.b+i,w.c+i);T.normal.copy(w.normal),void 0!==r&&T.normal.applyMatrix3(r).normalize();for(var P=0,C=S.length;P<C;P++)k=S[P].clone(),void 0!==r&&k.applyMatrix3(r).normalize(),T.vertexNormals.push(k);T.color.copy(w.color);for(var E=0,_=M.length;E<_;E++)A=M[E],T.vertexColors.push(A.clone());T.materialIndex=w.materialIndex+n,s.push(T)}for(var I=0,R=e.faceVertexUvs.length;I<R;I++){var L=e.faceVertexUvs[I];void 0===this.faceVertexUvs[I]&&(this.faceVertexUvs[I]=[]);for(var B=0,N=L.length;B<N;B++){for(var O=L[B],V=[],D=0,F=O.length;D<F;D++)V.push(O[D].clone());this.faceVertexUvs[I].push(V)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)}},{key:"mergeMesh",value:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)}},{key:"mergeVertices",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,t={},n=[],r=[],i=Math.pow(10,e),o=0,a=this.vertices.length;o<a;o++){var s=this.vertices[o],l=Math.round(s.x*i)+"_"+Math.round(s.y*i)+"_"+Math.round(s.z*i);void 0===t[l]?(t[l]=o,n.push(this.vertices[o]),r[o]=n.length-1):r[o]=r[t[l]]}for(var u=[],c=0,h=this.faces.length;c<h;c++){var d=this.faces[c];d.a=r[d.a],d.b=r[d.b],d.c=r[d.c];for(var f=[d.a,d.b,d.c],p=0;p<3;p++)if(f[p]===f[(p+1)%3]){u.push(c);break}}for(var v=u.length-1;v>=0;v--){var m=u[v];this.faces.splice(m,1);for(var y=0,g=this.faceVertexUvs.length;y<g;y++)this.faceVertexUvs[y].splice(m,1)}var x=this.vertices.length-n.length;return this.vertices=n,x}},{key:"setFromPoints",value:function(e){this.vertices=[];for(var t=0,n=e.length;t<n;t++){var r=e[t];this.vertices.push(new u.Pa4(r.x,r.y,r.z||0))}return this}},{key:"sortFacesByMaterialIndex",value:function(){for(var e=this.faces,t=e.length,n=0;n<t;n++)e[n]._id=n;function r(e,t){return e.materialIndex-t.materialIndex}e.sort(r);var i,o,a=this.faceVertexUvs[0],s=this.faceVertexUvs[1];a&&a.length===t&&(i=[]),s&&s.length===t&&(o=[]);for(var l=0;l<t;l++){var u=e[l]._id;i&&i.push(a[u]),o&&o.push(s[u])}i&&(this.faceVertexUvs[0]=i),o&&(this.faceVertexUvs[1]=o)}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}for(var r=[],i=0;i<this.vertices.length;i++){var o=this.vertices[i];r.push(o.x,o.y,o.z)}for(var a=[],s=[],l={},u=[],c={},h=[],d={},f=0;f<this.faces.length;f++){var p=this.faces[f],v=!0,m=!1,y=void 0!==this.faceVertexUvs[0][f],g=p.normal.length()>0,x=p.vertexNormals.length>0,b=1!==p.color.r||1!==p.color.g||1!==p.color.b,w=p.vertexColors.length>0,k=0;if(k=T(k,0,0),k=T(k,1,v),k=T(k,2,m),k=T(k,3,y),k=T(k,4,g),k=T(k,5,x),k=T(k,6,b),k=T(k,7,w),a.push(k),a.push(p.a,p.b,p.c),a.push(p.materialIndex),y){var A=this.faceVertexUvs[0][f];a.push(E(A[0]),E(A[1]),E(A[2]))}if(g&&a.push(P(p.normal)),x){var S=p.vertexNormals;a.push(P(S[0]),P(S[1]),P(S[2]))}if(b&&a.push(C(p.color)),w){var M=p.vertexColors;a.push(C(M[0]),C(M[1]),C(M[2]))}}function T(e,t,n){return n?e|1<<t:e&~(1<<t)}function P(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]||(l[t]=s.length/3,s.push(e.x,e.y,e.z)),l[t]}function C(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==c[t]||(c[t]=u.length,u.push(e.getHex())),c[t]}function E(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]||(d[t]=h.length/2,h.push(e.x,e.y)),d[t]}return e.data={},e.data.vertices=r,e.data.normals=s,u.length>0&&(e.data.colors=u),h.length>0&&(e.data.uvs=[h]),e.data.faces=a,e}},{key:"clone",value:function(){return(new n).copy(this)}},{key:"copy",value:function(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;for(var t=e.vertices,n=0,r=t.length;n<r;n++)this.vertices.push(t[n].clone());for(var i=e.colors,o=0,a=i.length;o<a;o++)this.colors.push(i[o].clone());for(var s=e.faces,l=0,u=s.length;l<u;l++)this.faces.push(s[l].clone());for(var c=0,h=e.faceVertexUvs.length;c<h;c++){var d=e.faceVertexUvs[c];void 0===this.faceVertexUvs[c]&&(this.faceVertexUvs[c]=[]);for(var f=0,p=d.length;f<p;f++){for(var v=d[f],m=[],y=0,g=v.length;y<g;y++){var x=v[y];m.push(x.clone())}this.faceVertexUvs[c].push(m)}}for(var b=e.morphTargets,w=0,k=b.length;w<k;w++){var A={};if(A.name=b[w].name,void 0!==b[w].vertices){A.vertices=[];for(var S=0,M=b[w].vertices.length;S<M;S++)A.vertices.push(b[w].vertices[S].clone())}if(void 0!==b[w].normals){A.normals=[];for(var T=0,P=b[w].normals.length;T<P;T++)A.normals.push(b[w].normals[T].clone())}this.morphTargets.push(A)}for(var C=e.morphNormals,E=0,_=C.length;E<_;E++){var I={};if(void 0!==C[E].vertexNormals){I.vertexNormals=[];for(var R=0,L=C[E].vertexNormals.length;R<L;R++){var B=C[E].vertexNormals[R],N={};N.a=B.a.clone(),N.b=B.b.clone(),N.c=B.c.clone(),I.vertexNormals.push(N)}}if(void 0!==C[E].faceNormals){I.faceNormals=[];for(var O=0,V=C[E].faceNormals.length;O<V;O++)I.faceNormals.push(C[E].faceNormals[O].clone())}this.morphNormals.push(I)}for(var D=e.skinWeights,F=0,U=D.length;F<U;F++)this.skinWeights.push(D[F].clone());for(var j=e.skinIndices,z=0,H=j.length;z<H;z++)this.skinIndices.push(j[z].clone());for(var G=e.lineDistances,Z=0,W=G.length;Z<W;Z++)this.lineDistances.push(G[Z]);var X=e.boundingBox;null!==X&&(this.boundingBox=X.clone());var q=e.boundingSphere;return null!==q&&(this.boundingSphere=q.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}},{key:"toBufferGeometry",value:function(){var e=(new g).fromGeometry(this),t=new u.u9r,n=new Float32Array(3*e.vertices.length);if(t.setAttribute("position",new u.TlE(n,3).copyVector3sArray(e.vertices)),e.normals.length>0){var r=new Float32Array(3*e.normals.length);t.setAttribute("normal",new u.TlE(r,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var i=new Float32Array(3*e.colors.length);t.setAttribute("color",new u.TlE(i,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var o=new Float32Array(2*e.uvs.length);t.setAttribute("uv",new u.TlE(o,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var a=new Float32Array(2*e.uvs2.length);t.setAttribute("uv2",new u.TlE(a,2).copyVector2sArray(e.uvs2))}for(var s in t.groups=e.groups,e.morphTargets){for(var l=[],c=e.morphTargets[s],h=0,d=c.length;h<d;h++){var f=c[h],p=new u.a$l(3*f.data.length,3);p.name=f.name,l.push(p.copyVector3sArray(f.data))}t.morphAttributes[s]=l}if(e.skinIndices.length>0){var v=new u.a$l(4*e.skinIndices.length,4);t.setAttribute("skinIndex",v.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var m=new u.a$l(4*e.skinWeights.length,4);t.setAttribute("skinWeight",m.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(t.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(t.boundingBox=e.boundingBox.clone()),t}},{key:"computeTangents",value:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")}},{key:"computeLineDistances",value:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}},{key:"applyMatrix",value:function(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}],[{key:"createBufferGeometryFromObject",value:function(e){var t=new u.u9r,n=e.geometry;if(e.isPoints||e.isLine){var r=new u.a$l(3*n.vertices.length,3),i=new u.a$l(3*n.colors.length,3);if(t.setAttribute("position",r.copyVector3sArray(n.vertices)),t.setAttribute("color",i.copyColorsArray(n.colors)),n.lineDistances&&n.lineDistances.length===n.vertices.length){var o=new u.a$l(n.lineDistances.length,1);t.setAttribute("lineDistance",o.copyArray(n.lineDistances))}null!==n.boundingSphere&&(t.boundingSphere=n.boundingSphere.clone()),null!==n.boundingBox&&(t.boundingBox=n.boundingBox.clone())}else e.isMesh&&(t=n.toBufferGeometry());return t}}]),n}(u.pBf);y.prototype.isGeometry=!0;var g=function(){function e(){(0,s.Z)(this,e),this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}return(0,l.Z)(e,[{key:"computeGroups",value:function(e){var t,n,r=[],i=void 0,o=e.faces;for(n=0;n<o.length;n++){var a=o[n];a.materialIndex!==i&&(i=a.materialIndex,void 0!==t&&(t.count=3*n-t.start,r.push(t)),t={start:3*n,materialIndex:i})}void 0!==t&&(t.count=3*n-t.start,r.push(t)),this.groups=r}},{key:"fromGeometry",value:function(e){var t,n=e.faces,r=e.vertices,i=e.faceVertexUvs,o=i[0]&&i[0].length>0,a=i[1]&&i[1].length>0,s=e.morphTargets,l=s.length;if(l>0){t=[];for(var c=0;c<l;c++)t[c]={name:s[c].name,data:[]};this.morphTargets.position=t}var h,d=e.morphNormals,f=d.length;if(f>0){h=[];for(var p=0;p<f;p++)h[p]={name:d[p].name,data:[]};this.morphTargets.normal=h}var v=e.skinIndices,m=e.skinWeights,y=v.length===r.length,g=m.length===r.length;r.length>0&&0===n.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(var x=0;x<n.length;x++){var b=n[x];this.vertices.push(r[b.a],r[b.b],r[b.c]);var w=b.vertexNormals;if(3===w.length)this.normals.push(w[0],w[1],w[2]);else{var k=b.normal;this.normals.push(k,k,k)}var A=b.vertexColors;if(3===A.length)this.colors.push(A[0],A[1],A[2]);else{var S=b.color;this.colors.push(S,S,S)}if(!0===o){var M=i[0][x];void 0!==M?this.uvs.push(M[0],M[1],M[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",x),this.uvs.push(new u.FM8,new u.FM8,new u.FM8))}if(!0===a){var T=i[1][x];void 0!==T?this.uvs2.push(T[0],T[1],T[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",x),this.uvs2.push(new u.FM8,new u.FM8,new u.FM8))}for(var P=0;P<l;P++){var C=s[P].vertices;t[P].data.push(C[b.a],C[b.b],C[b.c])}for(var E=0;E<f;E++){var _=d[E].vertexNormals[x];h[E].data.push(_.a,_.b,_.c)}y&&this.skinIndices.push(v[b.a],v[b.b],v[b.c]),g&&this.skinWeights.push(m[b.a],m[b.b],m[b.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}}]),e}(),x=function(){function e(t,n,r,i,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;(0,s.Z)(this,e),this.a=t,this.b=n,this.c=r,this.normal=i&&i.isVector3?i:new u.Pa4,this.vertexNormals=Array.isArray(i)?i:[],this.color=o&&o.isColor?o:new u.Ilk,this.vertexColors=Array.isArray(o)?o:[],this.materialIndex=a}return(0,l.Z)(e,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var r=0,i=e.vertexColors.length;r<i;r++)this.vertexColors[r]=e.vertexColors[r].clone();return this}}]),e}(),b=function(){function e(t,n,r,i,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;(0,s.Z)(this,e),this.a=t,this.b=n,this.c=r,this.normal=i&&i.isVector3?i:new u.Pa4,this.vertexNormals=Array.isArray(i)?i:[],this.color=o&&o.isColor?o:new u.Ilk,this.vertexColors=Array.isArray(o)?o:[],this.materialIndex=a}return(0,l.Z)(e,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var r=0,i=e.vertexColors.length;r<i;r++)this.vertexColors[r]=e.vertexColors[r].clone();return this}}]),e}(),w=n(5200),k=(n(3290),n(4916),n(4723),n(3210),n(7327),n(3123),n(8559),n(9720),n(5306),n(6755),n(9653),n(6699),n(2023),n(7601),n(7852),n(3299),n(9826),function(e){(0,h.Z)(n,e);var t=(0,d.Z)(n);function n(e){var r;return(0,s.Z)(this,n),r=t.call(this,e),r.defaultDPI=90,r.defaultUnit="px",r}return(0,l.Z)(n,[{key:"load",value:function(e,t,n,r){var i=this,o=new u.hH6(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(n))}catch(o){r?r(o):console.error(o),i.manager.itemError(e)}}),n,r)}},{key:"parse",value:function(e){var t=this;function n(e,t){if(1===e.nodeType){var o=k(e),a=!0,u=null;switch(e.nodeName){case"svg":break;case"style":i(e);break;case"g":t=v(e,t);break;case"path":t=v(e,t),e.hasAttribute("d")&&(u=r(e));break;case"rect":t=v(e,t),u=s(e);break;case"polygon":t=v(e,t),u=l(e);break;case"polyline":t=v(e,t),u=c(e);break;case"circle":t=v(e,t),u=h(e);break;case"ellipse":t=v(e,t),u=d(e);break;case"line":t=v(e,t),u=p(e);break;case"defs":a=!1;break;case"use":t=v(e,t);var f=e.getAttributeNS("http://www.w3.org/1999/xlink","href")||"",m=f.substring(1),y=e.viewportElement.getElementById(m);y?n(y,t):console.warn("SVGLoader: 'use node' references non-existent node id: "+m);break;default:}if(u&&(void 0!==t.fill&&"none"!==t.fill&&u.color.setStyle(t.fill),S(u,V),C.push(u),u.userData={node:e,style:t}),a)for(var g=e.childNodes,x=0;x<g.length;x++)n(g[x],t);o&&(_.pop(),_.length>0?V.copy(_[_.length-1]):V.identity())}}function r(e){for(var t=new u.T_1,n=new u.FM8,r=new u.FM8,i=new u.FM8,a=!0,s=!1,l=e.getAttribute("d"),c=l.match(/[a-df-z][^a-df-z]*/gi),h=0,d=c.length;h<d;h++){var f=c[h],p=f.charAt(0),v=f.substr(1).trim();!0===a&&(s=!0,a=!1);var g=void 0;switch(p){case"M":g=y(v);for(var x=0,b=g.length;x<b;x+=2)n.x=g[x+0],n.y=g[x+1],r.x=n.x,r.y=n.y,0===x?t.moveTo(n.x,n.y):t.lineTo(n.x,n.y),0===x&&i.copy(n);break;case"H":g=y(v);for(var w=0,k=g.length;w<k;w++)n.x=g[w],r.x=n.x,r.y=n.y,t.lineTo(n.x,n.y),0===w&&!0===s&&i.copy(n);break;case"V":g=y(v);for(var A=0,S=g.length;A<S;A++)n.y=g[A],r.x=n.x,r.y=n.y,t.lineTo(n.x,n.y),0===A&&!0===s&&i.copy(n);break;case"L":g=y(v);for(var M=0,T=g.length;M<T;M+=2)n.x=g[M+0],n.y=g[M+1],r.x=n.x,r.y=n.y,t.lineTo(n.x,n.y),0===M&&!0===s&&i.copy(n);break;case"C":g=y(v);for(var P=0,C=g.length;P<C;P+=6)t.bezierCurveTo(g[P+0],g[P+1],g[P+2],g[P+3],g[P+4],g[P+5]),r.x=g[P+2],r.y=g[P+3],n.x=g[P+4],n.y=g[P+5],0===P&&!0===s&&i.copy(n);break;case"S":g=y(v);for(var E=0,_=g.length;E<_;E+=4)t.bezierCurveTo(m(n.x,r.x),m(n.y,r.y),g[E+0],g[E+1],g[E+2],g[E+3]),r.x=g[E+0],r.y=g[E+1],n.x=g[E+2],n.y=g[E+3],0===E&&!0===s&&i.copy(n);break;case"Q":g=y(v);for(var I=0,R=g.length;I<R;I+=4)t.quadraticCurveTo(g[I+0],g[I+1],g[I+2],g[I+3]),r.x=g[I+0],r.y=g[I+1],n.x=g[I+2],n.y=g[I+3],0===I&&!0===s&&i.copy(n);break;case"T":g=y(v);for(var L=0,B=g.length;L<B;L+=2){var N=m(n.x,r.x),O=m(n.y,r.y);t.quadraticCurveTo(N,O,g[L+0],g[L+1]),r.x=N,r.y=O,n.x=g[L+0],n.y=g[L+1],0===L&&!0===s&&i.copy(n)}break;case"A":g=y(v,[3,4],7);for(var V=0,D=g.length;V<D;V+=7)if(g[V+5]!=n.x||g[V+6]!=n.y){var F=n.clone();n.x=g[V+5],n.y=g[V+6],r.x=n.x,r.y=n.y,o(t,g[V],g[V+1],g[V+2],g[V+3],g[V+4],F,n),0===V&&!0===s&&i.copy(n)}break;case"m":g=y(v);for(var U=0,j=g.length;U<j;U+=2)n.x+=g[U+0],n.y+=g[U+1],r.x=n.x,r.y=n.y,0===U?t.moveTo(n.x,n.y):t.lineTo(n.x,n.y),0===U&&i.copy(n);break;case"h":g=y(v);for(var z=0,H=g.length;z<H;z++)n.x+=g[z],r.x=n.x,r.y=n.y,t.lineTo(n.x,n.y),0===z&&!0===s&&i.copy(n);break;case"v":g=y(v);for(var G=0,Z=g.length;G<Z;G++)n.y+=g[G],r.x=n.x,r.y=n.y,t.lineTo(n.x,n.y),0===G&&!0===s&&i.copy(n);break;case"l":g=y(v);for(var W=0,X=g.length;W<X;W+=2)n.x+=g[W+0],n.y+=g[W+1],r.x=n.x,r.y=n.y,t.lineTo(n.x,n.y),0===W&&!0===s&&i.copy(n);break;case"c":g=y(v);for(var q=0,K=g.length;q<K;q+=6)t.bezierCurveTo(n.x+g[q+0],n.y+g[q+1],n.x+g[q+2],n.y+g[q+3],n.x+g[q+4],n.y+g[q+5]),r.x=n.x+g[q+2],r.y=n.y+g[q+3],n.x+=g[q+4],n.y+=g[q+5],0===q&&!0===s&&i.copy(n);break;case"s":g=y(v);for(var Y=0,Q=g.length;Y<Q;Y+=4)t.bezierCurveTo(m(n.x,r.x),m(n.y,r.y),n.x+g[Y+0],n.y+g[Y+1],n.x+g[Y+2],n.y+g[Y+3]),r.x=n.x+g[Y+0],r.y=n.y+g[Y+1],n.x+=g[Y+2],n.y+=g[Y+3],0===Y&&!0===s&&i.copy(n);break;case"q":g=y(v);for(var J=0,$=g.length;J<$;J+=4)t.quadraticCurveTo(n.x+g[J+0],n.y+g[J+1],n.x+g[J+2],n.y+g[J+3]),r.x=n.x+g[J+0],r.y=n.y+g[J+1],n.x+=g[J+2],n.y+=g[J+3],0===J&&!0===s&&i.copy(n);break;case"t":g=y(v);for(var ee=0,te=g.length;ee<te;ee+=2){var ne=m(n.x,r.x),re=m(n.y,r.y);t.quadraticCurveTo(ne,re,n.x+g[ee+0],n.y+g[ee+1]),r.x=ne,r.y=re,n.x=n.x+g[ee+0],n.y=n.y+g[ee+1],0===ee&&!0===s&&i.copy(n)}break;case"a":g=y(v,[3,4],7);for(var ie=0,oe=g.length;ie<oe;ie+=7)if(0!=g[ie+5]||0!=g[ie+6]){var ae=n.clone();n.x+=g[ie+5],n.y+=g[ie+6],r.x=n.x,r.y=n.y,o(t,g[ie],g[ie+1],g[ie+2],g[ie+3],g[ie+4],ae,n),0===ie&&!0===s&&i.copy(n)}break;case"Z":case"z":t.currentPath.autoClose=!0,t.currentPath.curves.length>0&&(n.copy(i),t.currentPath.currentPoint.copy(n),a=!0);break;default:console.warn(f)}s=!1}return t}function i(e){if(e.sheet&&e.sheet.cssRules&&e.sheet.cssRules.length)for(var t=0;t<e.sheet.cssRules.length;t++){var n=e.sheet.cssRules[t];if(1===n.type)for(var r=n.selectorText.split(/,/gm).filter(Boolean).map((function(e){return e.trim()})),i=0;i<r.length;i++){var o=Object.fromEntries(Object.entries(n.style).filter((function(e){var t=(0,w.Z)(e,2),n=t[1];return""!==n})));E[r[i]]=Object.assign(E[r[i]]||{},o)}}}function o(e,t,n,r,i,o,s,l){if(0!=t&&0!=n){r=r*Math.PI/180,t=Math.abs(t),n=Math.abs(n);var u=(s.x-l.x)/2,c=(s.y-l.y)/2,h=Math.cos(r)*u+Math.sin(r)*c,d=-Math.sin(r)*u+Math.cos(r)*c,f=t*t,p=n*n,v=h*h,m=d*d,y=v/f+m/p;if(y>1){var g=Math.sqrt(y);t*=g,n*=g,f=t*t,p=n*n}var x=f*m+p*v,b=(f*p-x)/x,w=Math.sqrt(Math.max(0,b));i===o&&(w=-w);var k=w*t*d/n,A=-w*n*h/t,S=Math.cos(r)*k-Math.sin(r)*A+(s.x+l.x)/2,M=Math.sin(r)*k+Math.cos(r)*A+(s.y+l.y)/2,T=a(1,0,(h-k)/t,(d-A)/n),P=a((h-k)/t,(d-A)/n,(-h-k)/t,(-d-A)/n)%(2*Math.PI);e.currentPath.absellipse(S,M,t,n,T,T+P,0===o,r)}else e.lineTo(l.x,l.y)}function a(e,t,n,r){var i=e*n+t*r,o=Math.sqrt(e*e+t*t)*Math.sqrt(n*n+r*r),a=Math.acos(Math.max(-1,Math.min(1,i/o)));return e*r-t*n<0&&(a=-a),a}function s(e){var t=b(e.getAttribute("x")||0),n=b(e.getAttribute("y")||0),r=b(e.getAttribute("rx")||e.getAttribute("ry")||0),i=b(e.getAttribute("ry")||e.getAttribute("rx")||0),o=b(e.getAttribute("width")),a=b(e.getAttribute("height")),s=.448084975506,l=new u.T_1;return l.moveTo(t+r,n),l.lineTo(t+o-r,n),0===r&&0===i||l.bezierCurveTo(t+o-r*s,n,t+o,n+i*s,t+o,n+i),l.lineTo(t+o,n+a-i),0===r&&0===i||l.bezierCurveTo(t+o,n+a-i*s,t+o-r*s,n+a,t+o-r,n+a),l.lineTo(t+r,n+a),0===r&&0===i||l.bezierCurveTo(t+r*s,n+a,t,n+a-i*s,t,n+a-i),l.lineTo(t,n+i),0===r&&0===i||l.bezierCurveTo(t,n+i*s,t+r*s,n,t+r,n),l}function l(e){function t(e,t,n){var o=b(t),a=b(n);0===i?r.moveTo(o,a):r.lineTo(o,a),i++}var n=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,r=new u.T_1,i=0;return e.getAttribute("points").replace(n,t),r.currentPath.autoClose=!0,r}function c(e){function t(e,t,n){var o=b(t),a=b(n);0===i?r.moveTo(o,a):r.lineTo(o,a),i++}var n=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,r=new u.T_1,i=0;return e.getAttribute("points").replace(n,t),r.currentPath.autoClose=!1,r}function h(e){var t=b(e.getAttribute("cx")||0),n=b(e.getAttribute("cy")||0),r=b(e.getAttribute("r")||0),i=new u.y$t;i.absarc(t,n,r,0,2*Math.PI);var o=new u.T_1;return o.subPaths.push(i),o}function d(e){var t=b(e.getAttribute("cx")||0),n=b(e.getAttribute("cy")||0),r=b(e.getAttribute("rx")||0),i=b(e.getAttribute("ry")||0),o=new u.y$t;o.absellipse(t,n,r,i,0,2*Math.PI);var a=new u.T_1;return a.subPaths.push(o),a}function p(e){var t=b(e.getAttribute("x1")||0),n=b(e.getAttribute("y1")||0),r=b(e.getAttribute("x2")||0),i=b(e.getAttribute("y2")||0),o=new u.T_1;return o.moveTo(t,n),o.lineTo(r,i),o.currentPath.autoClose=!1,o}function v(e,t){t=Object.assign({},t);var n={};if(e.hasAttribute("class"))for(var r=e.getAttribute("class").split(/\s/).filter(Boolean).map((function(e){return e.trim()})),i=0;i<r.length;i++)n=Object.assign(n,E["."+r[i]]);function o(r,i,o){void 0===o&&(o=function(e){return e.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),e}),e.hasAttribute(r)&&(t[i]=o(e.getAttribute(r))),n[r]&&(t[i]=o(n[r])),e.style&&""!==e.style[r]&&(t[i]=o(e.style[r]))}function a(e){return Math.max(0,Math.min(1,b(e)))}function s(e){return Math.max(0,b(e))}return e.hasAttribute("id")&&(n=Object.assign(n,E["#"+e.getAttribute("id")])),o("fill","fill"),o("fill-opacity","fillOpacity",a),o("fill-rule","fillRule"),o("opacity","opacity",a),o("stroke","stroke"),o("stroke-opacity","strokeOpacity",a),o("stroke-width","strokeWidth",s),o("stroke-linejoin","strokeLineJoin"),o("stroke-linecap","strokeLineCap"),o("stroke-miterlimit","strokeMiterLimit",s),o("visibility","visibility"),t}function m(e,t){return e-(t-e)}function y(e,t,n){if("string"!==typeof e)throw new TypeError("Invalid input: "+(0,f.Z)(e));var r,i={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},o=0,a=1,s=2,l=3,u=o,c=!0,h="",d="",p=[];function v(e,t,n){var r=new SyntaxError('Unexpected character "'+e+'" at index '+t+".");throw r.partial=n,r}function m(){""!==h&&(""===d?p.push(Number(h)):p.push(Number(h)*Math.pow(10,Number(d)))),h="",d=""}for(var y=e.length,g=0;g<y;g++)if(r=e[g],Array.isArray(t)&&t.includes(p.length%n)&&i.FLAGS.test(r))u=a,h=r,m();else{if(u===o){if(i.WHITESPACE.test(r))continue;if(i.DIGIT.test(r)||i.SIGN.test(r)){u=a,h=r;continue}if(i.POINT.test(r)){u=s,h=r;continue}i.COMMA.test(r)&&(c&&v(r,g,p),c=!0)}if(u===a){if(i.DIGIT.test(r)){h+=r;continue}if(i.POINT.test(r)){h+=r,u=s;continue}if(i.EXP.test(r)){u=l;continue}i.SIGN.test(r)&&1===h.length&&i.SIGN.test(h[0])&&v(r,g,p)}if(u===s){if(i.DIGIT.test(r)){h+=r;continue}if(i.EXP.test(r)){u=l;continue}i.POINT.test(r)&&"."===h[h.length-1]&&v(r,g,p)}if(u===l){if(i.DIGIT.test(r)){d+=r;continue}if(i.SIGN.test(r)){if(""===d){d+=r;continue}1===d.length&&i.SIGN.test(d)&&v(r,g,p)}}i.WHITESPACE.test(r)?(m(),u=o,c=!1):i.COMMA.test(r)?(m(),u=o,c=!0):i.SIGN.test(r)?(m(),u=a,h=r):i.POINT.test(r)?(m(),u=s,h=r):v(r,g,p)}return m(),p}var g=["mm","cm","in","pt","pc","px"],x={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function b(e){var n="px";if("string"===typeof e||e instanceof String)for(var r=0,i=g.length;r<i;r++){var o=g[r];if(e.endsWith(o)){n=o,e=e.substring(0,e.length-o.length);break}}var a=void 0;return"px"===n&&"px"!==t.defaultUnit?a=x["in"][t.defaultUnit]/t.defaultDPI:(a=x[n][t.defaultUnit],a<0&&(a=x[n]["in"]*t.defaultDPI)),a*parseFloat(e)}function k(e){if(!(e.hasAttribute("transform")||"use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))))return null;var t=A(e);return _.length>0&&t.premultiply(_[_.length-1]),V.copy(t),_.push(t),t}function A(e){var t=new u.Vkp,n=I;if("use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))){var r=b(e.getAttribute("x")),i=b(e.getAttribute("y"));t.translate(r,i)}if(e.hasAttribute("transform"))for(var o=e.getAttribute("transform").split(")"),a=o.length-1;a>=0;a--){var s=o[a].trim();if(""!==s){var l=s.indexOf("("),c=s.length;if(l>0&&l<c){var h=s.substr(0,l),d=y(s.substr(l+1,c-l-1));switch(n.identity(),h){case"translate":if(d.length>=1){var f=d[0],p=f;d.length>=2&&(p=d[1]),n.translate(f,p)}break;case"rotate":if(d.length>=1){var v=0,m=0,g=0;v=-d[0]*Math.PI/180,d.length>=3&&(m=d[1],g=d[2]),R.identity().translate(-m,-g),L.identity().rotate(v),B.multiplyMatrices(L,R),R.identity().translate(m,g),n.multiplyMatrices(R,B)}break;case"scale":if(d.length>=1){var x=d[0],w=x;d.length>=2&&(w=d[1]),n.scale(x,w)}break;case"skewX":1===d.length&&n.set(1,Math.tan(d[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===d.length&&n.set(1,0,0,Math.tan(d[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===d.length&&n.set(d[0],d[2],d[4],d[1],d[3],d[5],0,0,1);break}}t.premultiply(n)}}return t}function S(e,t){function n(e){O.set(e.x,e.y,1).applyMatrix3(t),e.set(O.x,O.y)}for(var r=M(t),i=e.subPaths,o=0,a=i.length;o<a;o++)for(var s=i[o],l=s.curves,u=0;u<l.length;u++){var c=l[u];c.isLineCurve?(n(c.v1),n(c.v2)):c.isCubicBezierCurve?(n(c.v0),n(c.v1),n(c.v2),n(c.v3)):c.isQuadraticBezierCurve?(n(c.v0),n(c.v1),n(c.v2)):c.isEllipseCurve&&(r&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),N.set(c.aX,c.aY),n(N),c.aX=N.x,c.aY=N.y,c.xRadius*=T(t),c.yRadius*=P(t))}}function M(e){return 0!==e.elements[1]||0!==e.elements[3]}function T(e){var t=e.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function P(e){var t=e.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}var C=[],E={},_=[],I=new u.Vkp,R=new u.Vkp,L=new u.Vkp,B=new u.Vkp,N=new u.FM8,O=new u.Pa4,V=new u.Vkp,D=(new DOMParser).parseFromString(e,"image/svg+xml");n(D.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4});var F={paths:C,xml:D.documentElement};return F}}],[{key:"createShapes",value:function(e){var t=999999999,n={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},r={loc:n.ORIGIN,t:0};function i(e,t,i,a){var s=e.x,l=t.x,u=i.x,c=a.x,h=e.y,d=t.y,f=i.y,p=a.y,v=(c-u)*(h-f)-(p-f)*(s-u),m=(l-s)*(h-f)-(d-h)*(s-u),y=(p-f)*(l-s)-(c-u)*(d-h),g=v/y,x=m/y;if(0===y&&0!==v||g<=0||g>=1||x<0||x>1)return null;if(0===v&&0===y){for(var b=0;b<2;b++){if(o(0===b?i:a,e,t),r.loc==n.ORIGIN){var w=0===b?i:a;return{x:w.x,y:w.y,t:r.t}}if(r.loc==n.BETWEEN){var k=+(s+r.t*(l-s)).toPrecision(10),A=+(h+r.t*(d-h)).toPrecision(10);return{x:k,y:A,t:r.t}}}return null}for(var S=0;S<2;S++)if(o(0===S?i:a,e,t),r.loc==n.ORIGIN){var M=0===S?i:a;return{x:M.x,y:M.y,t:r.t}}var T=+(s+g*(l-s)).toPrecision(10),P=+(h+g*(d-h)).toPrecision(10);return{x:T,y:P,t:g}}function o(e,t,i){var o,a=i.x-t.x,s=i.y-t.y,l=e.x-t.x,u=e.y-t.y,c=a*u-l*s;if(e.x===t.x&&e.y===t.y)return r.loc=n.ORIGIN,void(r.t=0);if(e.x===i.x&&e.y===i.y)return r.loc=n.DESTINATION,void(r.t=1);c<-Number.EPSILON?r.loc=n.LEFT:c>Number.EPSILON?r.loc=n.RIGHT:a*l<0||s*u<0?r.loc=n.BEHIND:Math.sqrt(a*a+s*s)<Math.sqrt(l*l+u*u)?r.loc=n.BEYOND:(o=0!==a?l/a:u/s,r.loc=n.BETWEEN,r.t=o)}function a(e,t){for(var n=[],r=[],o=1;o<e.length;o++)for(var a=e[o-1],s=e[o],l=function(e){var o=t[e-1],l=t[e],c=i(a,s,o,l);null!==c&&void 0===n.find((function(e){return e.t<=c.t+Number.EPSILON&&e.t>=c.t-Number.EPSILON}))&&(n.push(c),r.push(new u.FM8(c.x,c.y)))},c=1;c<t.length;c++)l(c);return r}function s(e,t,n){var r=new u.FM8;t.getCenter(r);var i=[];return n.forEach((function(t){if(t.boundingBox.containsPoint(r)){var n=a(e,t.points);n.forEach((function(e){i.push({identifier:t.identifier,isCW:t.isCW,point:e})}))}})),i.sort((function(e,t){return e.point.x-t.point.x})),i}function l(e,t,n,r,i){null!==i&&void 0!==i&&""!==i||(i="nonzero");var o=new u.FM8;e.boundingBox.getCenter(o);var a=[new u.FM8(n,o.y),new u.FM8(r,o.y)],l=s(a,e.boundingBox,t);l.sort((function(e,t){return e.point.x-t.point.x}));var c=[],h=[];l.forEach((function(t){t.identifier===e.identifier?c.push(t):h.push(t)}));var d=c[0].point.x,f=[],p=0;while(p<h.length&&h[p].point.x<d)f.length>0&&f[f.length-1]===h[p].identifier?f.pop():f.push(h[p].identifier),p++;if(f.push(e.identifier),"evenodd"===i){var v=f.length%2===0,m=f[f.length-2];return{identifier:e.identifier,isHole:v,for:m}}if("nonzero"===i){for(var y=!0,g=null,x=null,b=0;b<f.length;b++){var w=f[b];y?(x=t[w].isCW,y=!1,g=w):x!==t[w].isCW&&(x=t[w].isCW,y=!0)}return{identifier:e.identifier,isHole:y,for:g}}console.warn('fill-rule: "'+i+'" is currently not implemented.')}var c=0,h=t,d=-t,f=e.subPaths.map((function(e){for(var n=e.getPoints(),r=-t,i=t,o=-t,a=t,s=0;s<n.length;s++){var l=n[s];l.y>r&&(r=l.y),l.y<i&&(i=l.y),l.x>o&&(o=l.x),l.x<a&&(a=l.x)}return d<=o&&(d=o+1),h>=a&&(h=a-1),{curves:e.curves,points:n,isCW:u.iDF.isClockWise(n),identifier:c++,boundingBox:new u.TUj(new u.FM8(a,i),new u.FM8(o,r))}}));f=f.filter((function(e){return e.points.length>1}));var p=f.map((function(t){return l(t,f,h,d,e.userData.style.fillRule)})),v=[];return f.forEach((function(e){var t=p[e.identifier];if(!t.isHole){var n=new u.bnF;n.curves=e.curves;var r=p.filter((function(t){return t.isHole&&t.for===e.identifier}));r.forEach((function(e){var t=f[e.identifier],r=new u.y$t;r.curves=t.curves,n.holes.push(r)})),v.push(n)}})),v}},{key:"getStrokeStyle",value:function(e,t,n,r,i){return e=void 0!==e?e:1,t=void 0!==t?t:"#000",n=void 0!==n?n:"miter",r=void 0!==r?r:"butt",i=void 0!==i?i:4,{strokeColor:t,strokeWidth:e,strokeLineJoin:n,strokeLineCap:r,strokeMiterLimit:i}}},{key:"pointsToStroke",value:function(e,t,r,i){var o=[],a=[],s=[];if(0===n.pointsToStrokeWithBuffers(e,t,r,i,o,a,s))return null;var l=new u.u9r;return l.setAttribute("position",new u.a$l(o,3)),l.setAttribute("normal",new u.a$l(a,3)),l.setAttribute("uv",new u.a$l(s,2)),l}},{key:"pointsToStrokeWithBuffers",value:function(e,t,n,r,i,o,a,s){var l=new u.FM8,c=new u.FM8,h=new u.FM8,d=new u.FM8,f=new u.FM8,p=new u.FM8,v=new u.FM8,m=new u.FM8,y=new u.FM8,g=new u.FM8,x=new u.FM8,b=new u.FM8,w=new u.FM8,k=new u.FM8,A=new u.FM8,S=new u.FM8,M=new u.FM8;n=void 0!==n?n:12,r=void 0!==r?r:.001,s=void 0!==s?s:0,e=oe(e);var T=e.length;if(T<2)return 0;var P,C,E,_,I,R,L=e[0].equals(e[T-1]),B=e[0],N=t.strokeWidth/2,O=1/(T-1),V=0,D=!1,F=0,U=3*s,j=2*s;J(e[0],e[1],l).multiplyScalar(N),m.copy(e[0]).sub(l),y.copy(e[0]).add(l),g.copy(m),x.copy(y);for(var z=1;z<T;z++){P=e[z],C=z===T-1?L?e[1]:void 0:e[z+1];var H=l;if(J(B,P,H),h.copy(H).multiplyScalar(N),b.copy(P).sub(h),w.copy(P).add(h),E=V+O,_=!1,void 0!==C){J(P,C,c),h.copy(c).multiplyScalar(N),k.copy(P).sub(h),A.copy(P).add(h),I=!0,h.subVectors(C,B),H.dot(h)<0&&(I=!1),1===z&&(D=I),h.subVectors(C,P),h.normalize();var G=Math.abs(H.dot(h));if(0!==G){var Z=N/G;h.multiplyScalar(-Z),d.subVectors(P,B),f.copy(d).setLength(Z).add(h),S.copy(f).negate();var W=f.length(),X=d.length();d.divideScalar(X),p.subVectors(C,P);var q=p.length();switch(p.divideScalar(q),d.dot(S)<X&&p.dot(S)<q&&(_=!0),M.copy(f).add(P),S.add(P),R=!1,_?I?(A.copy(S),w.copy(S)):(k.copy(S),b.copy(S)):te(),t.strokeLineJoin){case"bevel":ne(I,_,E);break;case"round":re(I,_),I?ee(P,b,k,E,0):ee(P,A,w,E,1);break;case"miter":case"miter-clip":default:var K=N*t.strokeMiterLimit/W;if(K<1){if("miter-clip"!==t.strokeLineJoin){ne(I,_,E);break}re(I,_),I?(p.subVectors(M,b).multiplyScalar(K).add(b),v.subVectors(M,k).multiplyScalar(K).add(k),$(b,E,0),$(p,E,0),$(P,E,.5),$(P,E,.5),$(p,E,0),$(v,E,0),$(P,E,.5),$(v,E,0),$(k,E,0)):(p.subVectors(M,w).multiplyScalar(K).add(w),v.subVectors(M,A).multiplyScalar(K).add(A),$(w,E,1),$(p,E,1),$(P,E,.5),$(P,E,.5),$(p,E,1),$(v,E,1),$(P,E,.5),$(v,E,1),$(A,E,1))}else _?(I?($(y,V,1),$(m,V,0),$(M,E,0),$(y,V,1),$(M,E,0),$(S,E,1)):($(y,V,1),$(m,V,0),$(M,E,1),$(m,V,0),$(S,E,0),$(M,E,1)),I?k.copy(M):A.copy(M)):I?($(b,E,0),$(M,E,0),$(P,E,.5),$(P,E,.5),$(M,E,0),$(k,E,0)):($(w,E,1),$(M,E,1),$(P,E,.5),$(P,E,.5),$(M,E,1),$(A,E,1)),R=!0;break}}else te()}else te();L||z!==T-1||ie(e[0],g,x,I,!0,V),V=E,B=P,m.copy(k),y.copy(A)}if(L){if(_&&i){var Y=M,Q=S;D!==I&&(Y=S,Q=M),I?(R||D)&&(Q.toArray(i,0),Q.toArray(i,9),R&&Y.toArray(i,3)):!R&&D||(Q.toArray(i,3),Q.toArray(i,9),R&&Y.toArray(i,0))}}else ie(P,b,w,I,!1,E);return F;function J(e,t,n){return n.subVectors(t,e),n.set(-n.y,n.x).normalize()}function $(e,t,n){i&&(i[U]=e.x,i[U+1]=e.y,i[U+2]=0,o&&(o[U]=0,o[U+1]=0,o[U+2]=1),U+=3,a&&(a[j]=t,a[j+1]=n,j+=2)),F+=3}function ee(e,t,r,i,o){l.copy(t).sub(e).normalize(),c.copy(r).sub(e).normalize();var a=Math.PI,s=l.dot(c);Math.abs(s)<1&&(a=Math.abs(Math.acos(s))),a/=n,h.copy(t);for(var u=0,f=n-1;u<f;u++)d.copy(h).rotateAround(e,a),$(h,i,o),$(d,i,o),$(e,i,.5),h.copy(d);$(d,i,o),$(r,i,o),$(e,i,.5)}function te(){$(y,V,1),$(m,V,0),$(b,E,0),$(y,V,1),$(b,E,1),$(w,E,0)}function ne(e,t,n){t?e?($(y,V,1),$(m,V,0),$(b,E,0),$(y,V,1),$(b,E,0),$(S,E,1),$(b,n,0),$(k,n,0),$(S,n,.5)):($(y,V,1),$(m,V,0),$(w,E,1),$(m,V,0),$(S,E,0),$(w,E,1),$(w,n,1),$(A,n,0),$(S,n,.5)):e?($(b,n,0),$(k,n,0),$(P,n,.5)):($(w,n,1),$(A,n,0),$(P,n,.5))}function re(e,t){t&&(e?($(y,V,1),$(m,V,0),$(b,E,0),$(y,V,1),$(b,E,0),$(S,E,1),$(b,V,0),$(P,E,.5),$(S,E,1),$(P,E,.5),$(k,V,0),$(S,E,1)):($(y,V,1),$(m,V,0),$(w,E,1),$(m,V,0),$(S,E,0),$(w,E,1),$(w,V,1),$(S,E,0),$(P,E,.5),$(P,E,.5),$(S,E,0),$(A,V,1)))}function ie(e,n,r,o,a,s){switch(t.strokeLineCap){case"round":a?ee(e,r,n,s,.5):ee(e,n,r,s,.5);break;case"square":if(a)l.subVectors(n,e),c.set(l.y,-l.x),h.addVectors(l,c).add(e),d.subVectors(c,l).add(e),o?(h.toArray(i,3),d.toArray(i,0),d.toArray(i,9)):(h.toArray(i,3),h.toArray(i,9),d.toArray(i,0));else{l.subVectors(r,e),c.set(l.y,-l.x),h.addVectors(l,c).add(e),d.subVectors(c,l).add(e);var u=i.length;o?(h.toArray(i,u-3),d.toArray(i,u-6),d.toArray(i,u-12)):(h.toArray(i,u-6),d.toArray(i,u-3),d.toArray(i,u-12))}break;case"butt":default:break}}function oe(e){for(var t=!1,n=1,i=e.length-1;n<i;n++)if(e[n].distanceTo(e[n+1])<r){t=!0;break}if(!t)return e;var o=[];o.push(e[0]);for(var a=1,s=e.length-1;a<s;a++)e[a].distanceTo(e[a+1])>=r&&o.push(e[a]);return o.push(e[e.length-1]),o}}}]),n}(u.aNw)),A=function(){function e(){(0,s.Z)(this,e),this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}return(0,l.Z)(e,[{key:"computeGroups",value:function(e){var t,n,r=[],i=void 0,o=e.faces;for(n=0;n<o.length;n++){var a=o[n];a.materialIndex!==i&&(i=a.materialIndex,void 0!==t&&(t.count=3*n-t.start,r.push(t)),t={start:3*n,materialIndex:i})}void 0!==t&&(t.count=3*n-t.start,r.push(t)),this.groups=r}},{key:"fromGeometry",value:function(e){var t,n=e.faces,r=e.vertices,i=e.faceVertexUvs,o=i[0]&&i[0].length>0,a=i[1]&&i[1].length>0,s=e.morphTargets,l=s.length;if(l>0){t=[];for(var c=0;c<l;c++)t[c]={name:s[c].name,data:[]};this.morphTargets.position=t}var h,d=e.morphNormals,f=d.length;if(f>0){h=[];for(var p=0;p<f;p++)h[p]={name:d[p].name,data:[]};this.morphTargets.normal=h}var v=e.skinIndices,m=e.skinWeights,y=v.length===r.length,g=m.length===r.length;r.length>0&&0===n.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(var x=0;x<n.length;x++){var b=n[x];this.vertices.push(r[b.a],r[b.b],r[b.c]);var w=b.vertexNormals;if(3===w.length)this.normals.push(w[0],w[1],w[2]);else{var k=b.normal;this.normals.push(k,k,k)}var A=b.vertexColors;if(3===A.length)this.colors.push(A[0],A[1],A[2]);else{var S=b.color;this.colors.push(S,S,S)}if(!0===o){var M=i[0][x];void 0!==M?this.uvs.push(M[0],M[1],M[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",x),this.uvs.push(new u.FM8,new u.FM8,new u.FM8))}if(!0===a){var T=i[1][x];void 0!==T?this.uvs2.push(T[0],T[1],T[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",x),this.uvs2.push(new u.FM8,new u.FM8,new u.FM8))}for(var P=0;P<l;P++){var C=s[P].vertices;t[P].data.push(C[b.a],C[b.b],C[b.c])}for(var E=0;E<f;E++){var _=d[E].vertexNormals[x];h[E].data.push(_.a,_.b,_.c)}y&&this.skinIndices.push(v[b.a],v[b.b],v[b.c]),g&&this.skinWeights.push(m[b.a],m[b.b],m[b.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}}]),e}(),S=function(e,t){var n=(new A).fromGeometry(t);return M(e,n)},M=function(e,t){var n,r,i=new Float32Array(3*t.vertices.length);if(e.setAttribute("position",new u.TlE(i,3).copyVector3sArray(t.vertices)),t.normals.length>0){var o=new Float32Array(3*t.normals.length);e.setAttribute("normal",new u.TlE(o,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var a=new Float32Array(3*t.colors.length);e.setAttribute("color",new u.TlE(a,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var s=new Float32Array(2*t.uvs.length);e.setAttribute("uv",new u.TlE(s,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var l=new Float32Array(2*t.uvs2.length);e.setAttribute("uv2",new u.TlE(l,2).copyVector2sArray(t.uvs2))}for(var c in e.groups=t.groups,t.morphTargets){for(var h=[],d=t.morphTargets[c],f=0,p=d.length;f<p;f++){var v=d[f],m=new u.a$l(3*v.data.length,3);m.name=v.name,h.push(m.copyVector3sArray(v.data))}e.morphAttributes[c]=h}if(t.skinIndices.length>0){var y=new u.a$l(4*t.skinIndices.length,4);e.setAttribute("skinIndex",y.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var g=new u.a$l(4*t.skinWeights.length,4);e.setAttribute("skinWeight",g.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(e.boundingSphere=null===(n=t.boundingSphere)||void 0===n?void 0:n.clone()),null!==t.boundingBox&&(e.boundingBox=null===(r=t.boundingBox)||void 0===r?void 0:r.clone()),e},T=function(){function e(t,n){(0,s.Z)(this,e),this.camera=t,this.renderer=n}return(0,l.Z)(e,[{key:"fromSVGtoShape",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;if(e){var r=new k,i=[];return r.parse(e).paths.forEach((function(e){e.toShapes(t,n).forEach((function(e){i.push(e)}))})),i}return[]}},{key:"from3dto2d",value:function(e){var t=new u.Pa4(e.x,e.y,e.z),n=this.renderer.domElement;this.camera.updateMatrixWorld(),t.project(this.camera);var r=Math.round((t.x+1)*(n.width/2)),i=Math.round((1-t.y)*(n.height/2));return new u.FM8(r,i)}},{key:"from2dto3d",value:function(e,t,n){var r,i;if(!this.tmpPlane){var o=new u.BKK(1e4,1e4),a=new u.vBJ({transparent:!0,opacity:.25});this.tmpPlane=new u.Kj0(o,a),this.tmpPlane.name="_tmp_raycast_plane"}this.tmpRaycaster||(this.tmpRaycaster=new u.iMs),this.tmpVector3||(this.tmpVector3=new u.Pa4),this.tmpPlane.setRotationFromEuler(this.camera.rotation);var s=this.camera.position;this.tmpPlane.position.set(s.x,s.y,s.z),this.camera.getWorldDirection(this.tmpVector3),this.tmpPlane.position.add(this.tmpVector3.clone().multiplyScalar(n)),this.tmpPlane.updateMatrix(),this.tmpPlane.updateMatrixWorld(!0),this.tmpRaycaster.setFromCamera({x:e,y:t},this.camera);var l=this.tmpRaycaster.intersectObjects([this.tmpPlane]);return"_tmp_raycast_plane"===(null===(r=l[0])||void 0===r?void 0:r.object.name)&&(i=l[0].point),i}}],[{key:"geometryToBufferGeometry",value:function(e){return e.isGeometry?S(new u.u9r,e):e}},{key:"bufferGeometryToGeometry",value:function(e){return e.isBufferGeometry?(new y).fromBufferGeometry(e):e}}]),e}(),P=function(){function e(){(0,s.Z)(this,e)}return(0,l.Z)(e,null,[{key:"toGeometry",value:function(e,t){e.geometry=T.bufferGeometryToGeometry(e.geometry),t.geometry=T.bufferGeometryToGeometry(t.geometry)}},{key:"toBufferGeometry",value:function(e){e.geometry=T.geometryToBufferGeometry(e.geometry)}},{key:"union",value:function(e,t){this.toGeometry(e,t);var n=this.doCSG(e,t,"union");return this.toBufferGeometry(n),n}},{key:"subtract",value:function(e,t){this.toGeometry(e,t);var n=this.doCSG(e,t,"subtract");return this.toBufferGeometry(n),n}},{key:"intersect",value:function(e,t){this.toGeometry(e,t);var n=this.doCSG(e,t,"intersect");return this.toBufferGeometry(n),n}},{key:"doCSG",value:function(e,t,n){e.updateMatrix(),t.updateMatrix();var r=C.fromMesh(e),i=C.fromMesh(t),o=r[n](i),a=C.toMesh(o,e.matrix);return a}}]),e}(),C=function(){function e(){(0,s.Z)(this,e),this.polygons=[]}return(0,l.Z)(e,[{key:"clone",value:function(){var t=new e;return t.polygons=this.polygons.map((function(e){return e.clone()})),t}},{key:"toPolygons",value:function(){return this.polygons}},{key:"union",value:function(t){var n=new L(this.clone().polygons),r=new L(t.clone().polygons);return n.clipTo(r),r.clipTo(n),r.invert(),r.clipTo(n),r.invert(),n.build(r.allPolygons()),e.fromPolygons(n.allPolygons())}},{key:"subtract",value:function(t){var n=new L(this.clone().polygons),r=new L(t.clone().polygons);return n.invert(),n.clipTo(r),r.clipTo(n),r.invert(),r.clipTo(n),r.invert(),n.build(r.allPolygons()),n.invert(),e.fromPolygons(n.allPolygons())}},{key:"intersect",value:function(t){var n=new L(this.clone().polygons),r=new L(t.clone().polygons);return n.invert(),r.clipTo(n),r.invert(),n.clipTo(r),r.clipTo(n),n.build(r.allPolygons()),n.invert(),e.fromPolygons(n.allPolygons())}},{key:"inverse",value:function(){var e=this.clone();return e.polygons.map((function(e){e.flip()})),e}}],[{key:"fromPolygons",value:function(t){var n=new e;return n.polygons=t,n}},{key:"fromGeometry",value:function(t){t.isBufferGeometry&&(t=(new y).fromBufferGeometry(t));for(var n=t.faces,r=t.vertices,i=[],o=["a","b","c"],a=0;a<n.length;a++){for(var s=n[a],l=[],u=0;u<3;u++){var c=void 0!==t.faceVertexUvs[0][a]&&void 0!==t.faceVertexUvs[0][a][u]?t.faceVertexUvs[0][a][u]:void 0;l.push(new _(r[s[o[u]]],s.vertexNormals[u],c))}i.push(new R(l))}return e.fromPolygons(i)}},{key:"fromMesh",value:function(t){var n=e.fromGeometry(t.geometry);e._tmpm3.getNormalMatrix(t.matrix);var r,i=(0,a.Z)(n.polygons);try{for(i.s();!(r=i.n()).done;){var o,s=r.value,l=(0,a.Z)(s.vertices);try{for(l.s();!(o=l.n()).done;){var u=o.value;u.pos.applyMatrix4(t.matrix),u.normal.applyMatrix3(e._tmpm3)}}catch(c){l.e(c)}finally{l.f()}}}catch(c){i.e(c)}finally{i.f()}return n}},{key:"toMesh",value:function(e,t){var n,r=new y,i=e.polygons,o=r.vertices,s=r.faceVertexUvs[0],l=(0,a.Z)(i);try{for(l.s();!(n=l.n()).done;){var c,h=n.value,d=h.vertices,f=o.length,p=d.length,v=(0,a.Z)(d);try{for(v.s();!(c=v.n()).done;){var m=c.value;o.push((new u.Pa4).copy(m.pos))}}catch(M){v.e(M)}finally{v.f()}for(var g=3;g<=p;g++){var x=new b(f,f+g-2,f+g-1),w=[];s.push(w);var k=x.vertexNormals;k.push((new u.Pa4).copy(d[0].normal)),k.push((new u.Pa4).copy(d[g-2].normal)),k.push((new u.Pa4).copy(d[g-1].normal)),d[0].uv&&d[g-2].uv&&d[g-1].uv&&(w.push((new u.Pa4).copy(d[0].uv)),w.push((new u.Pa4).copy(d[g-2].uv)),w.push((new u.Pa4).copy(d[g-1].uv))),x.normal=(new u.Pa4).copy(h.plane.normal),r.faces.push(x)}}}catch(M){l.e(M)}finally{l.f()}var A=parseInt(u.UZH)>=123?(new u.yGw).copy(t).invert():(new u.yGw).getInverse(t);r.applyMatrix4(A),r.verticesNeedUpdate=r.elementsNeedUpdate=r.normalsNeedUpdate=!0,r.computeBoundingSphere(),r.computeBoundingBox();var S=new u.Kj0(r);return S.matrix.copy(t),S.matrix.decompose(S.position,S.rotation,S.scale),S.updateMatrixWorld(),S}},{key:"iEval",value:function(t){var n;if("string"===typeof t)e.currentOp=t;else if(t instanceof Array){var r,i=(0,a.Z)(t);try{for(i.s();!(r=i.n()).done;){var o=r.value;e.iEval(o,0)}}catch(l){i.e(l)}finally{i.f()}}else if("object"===(0,f.Z)(t)){var s=e.currentOp;t.updateMatrix(),t.updateMatrixWorld(),e.sourceMesh?(e.nextPrim=e.fromMesh(t),e.currentPrim=e.currentPrim[s](e.nextPrim)):e.currentPrim=e.fromMesh(e.sourceMesh=t),e.doRemove&&(null===(n=null===t||void 0===t?void 0:t.parent)||void 0===n||n.remove(t))}}},{key:"eval",value:function(t,n){delete e.currentOp,delete e.sourceMesh,e.doRemove=n,e.iEval(t);var r=e.toMesh(e.currentPrim,e.sourceMesh.matrix);return r.material=e.sourceMesh.material,r.castShadow=r.receiveShadow=!0,r}}]),e}();C._tmpm3=new u.Vkp;var E=function(e){(0,h.Z)(n,e);var t=(0,d.Z)(n);function n(e,r,i){var o;if((0,s.Z)(this,n),3===arguments.length)o=t.call(this,e,r,i);else if(Array.isArray(e))o=t.call(this,e[0],e[1],e[2]);else{if("object"!==(0,f.Z)(e))throw new Error("Invalid constructor to vector");o.copy(e)}return(0,c.Z)(o)}return(0,l.Z)(n,[{key:"clone",value:function(){return new n(this.x,this.y,this.z)}},{key:"negated",value:function(){return this.clone().multiplyScalar(-1)}},{key:"plus",value:function(e){return this.clone().add(e)}},{key:"minus",value:function(e){return this.clone().sub(e)}},{key:"times",value:function(e){return this.clone().multiplyScalar(e)}},{key:"dividedBy",value:function(e){return this.clone().divideScalar(e)}},{key:"lerp",value:function(e,t){return this.plus(e.minus(this).times(t))}},{key:"unit",value:function(){return this.dividedBy(this.length())}},{key:"cross",value:function(e,t){return u.Pa4.prototype.cross.call(this.clone(),e)}}]),n}(u.Pa4),_=function(){function e(t,n,r){(0,s.Z)(this,e),this.pos=new E(t.x,t.y,t.z),this.normal=new E(n.x,n.y,n.z),r&&(this.uv=new E(r.x,r.y,r.z))}return(0,l.Z)(e,[{key:"clone",value:function(){return new e(this.pos.clone(),this.normal.clone(),this.uv?this.uv.clone():void 0)}},{key:"flip",value:function(){this.normal=this.normal.negated()}},{key:"interpolate",value:function(t,n){return new e(this.pos.lerp(t.pos,n),this.normal.lerp(t.normal,n),this.uv?this.uv.lerp(t.uv,n):void 0)}}]),e}(),I=function(){function e(t,n){(0,s.Z)(this,e),this.normal=t,this.w=n}return(0,l.Z)(e,[{key:"clone",value:function(){return new e(this.normal.clone(),this.w)}},{key:"flip",value:function(){this.normal=this.normal.negated(),this.w=-this.w}},{key:"splitPolygon",value:function(t,n,r,i,o){var s,l=0,u=1,c=2,h=3,d=0,f=[],p=(0,a.Z)(t.vertices);try{for(p.s();!(s=p.n()).done;){var v=s.value,m=this.normal.dot(v.pos)-this.w,y=m<-e.EPSILON?c:m>e.EPSILON?u:l;d|=y,f.push(y)}}catch(C){p.e(C)}finally{p.f()}switch(d){case l:this.normal.dot(t.plane.normal)>0?n.push(t):r.push(t);break;case u:i.push(t);break;case c:o.push(t);break;case h:for(var g=[],x=[],b=0;b<t.vertices.length;b++){var w=(b+1)%t.vertices.length,k=f[b],A=f[w],S=t.vertices[b],M=t.vertices[w];if(k!==c&&g.push(S),k!==u&&x.push(k!==c?S.clone():S),(k|A)===h){var T=(this.w-this.normal.dot(S.pos))/this.normal.dot(M.pos.minus(S.pos)),P=S.interpolate(M,T);g.push(P),x.push(P.clone())}}g.length>=3&&i.push(new R(g,t.shared)),x.length>=3&&o.push(new R(x,t.shared));break}}}],[{key:"fromPoints",value:function(t,n,r){var i=n.minus(t).cross(r.minus(t)).unit();return new e(i,i.dot(t))}}]),e}();I.EPSILON=1e-5;var R=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,s.Z)(this,e),this.vertices=t,this.shared=n,this.plane=I.fromPoints(t[0].pos,t[1].pos,t[2].pos)}return(0,l.Z)(e,[{key:"clone",value:function(){var t=this.vertices.map((function(e){return e.clone()}));return new e(t,this.shared)}},{key:"flip",value:function(){this.vertices.reverse().map((function(e){e.flip()})),this.plane.flip()}}]),e}(),L=function(){function e(t){(0,s.Z)(this,e),delete this.plane,delete this.front,delete this.back,this.polygons=[],t&&this.build(t)}return(0,l.Z)(e,[{key:"clone",value:function(){var t=new e;return t.plane=this.plane&&this.plane.clone(),t.front=this.front&&this.front.clone(),t.back=this.back&&this.back.clone(),t.polygons=this.polygons.map((function(e){return e.clone()})),t}},{key:"invert",value:function(){var e,t=(0,a.Z)(this.polygons);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.flip()}}catch(i){t.e(i)}finally{t.f()}this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();var r=this.front;this.front=this.back,this.back=r}},{key:"clipPolygons",value:function(e){if(!this.plane)return e.slice();var t,n=[],r=[],i=(0,a.Z)(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;this.plane.splitPolygon(o,n,r,n,r)}}catch(s){i.e(s)}finally{i.f()}return this.front&&(n=this.front.clipPolygons(n)),r=this.back?this.back.clipPolygons(r):[],n.concat(r)}},{key:"clipTo",value:function(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}},{key:"allPolygons",value:function(){var e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}},{key:"build",value:function(t){if(t.length){this.plane||(this.plane=t[0].plane.clone());var n,r=[],i=[],o=(0,a.Z)(t);try{for(o.s();!(n=o.n()).done;){var s=n.value;this.plane.splitPolygon(s,this.polygons,this.polygons,r,i)}}catch(l){o.e(l)}finally{o.f()}r.length&&(this.front||(this.front=new e),this.front.build(r)),i.length&&(this.back||(this.back=new e),this.back.build(i))}}}]),e}(),B=n(3796),N=(n(8264),n(2472),n(285),n(1637),n(2481),n(7941),n(8255),n(9135),{}),O=function(e){return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},V=function(e){return new Worker(e)};try{URL.revokeObjectURL(O(""))}catch(Xo){O=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},V=function(e){return new Worker(e,{type:"module"})}}var D=function(e,t,n,r,i){var o=V(N[t]||(N[t]=O(e)));return o.onerror=function(e){return i(e.error,null)},o.onmessage=function(e){return i(null,e.data)},o.postMessage(n,r),o},F=Uint8Array,U=Uint16Array,j=Uint32Array,z=new F([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),H=new F([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),G=new F([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Z=function(e,t){for(var n=new U(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var i=new j(n[30]);for(r=1;r<30;++r)for(var o=n[r];o<n[r+1];++o)i[o]=o-n[r]<<5|r;return[n,i]},W=Z(z,2),X=W[0],q=W[1];X[28]=258,q[258]=28;for(var K=Z(H,0),Y=K[0],Q=K[1],J=new U(32768),$=0;$<32768;++$){var ee=(43690&$)>>>1|(21845&$)<<1;ee=(52428&ee)>>>2|(13107&ee)<<2,ee=(61680&ee)>>>4|(3855&ee)<<4,J[$]=((65280&ee)>>>8|(255&ee)<<8)>>>1}var te=function(e,t,n){for(var r=e.length,i=0,o=new U(t);i<r;++i)++o[e[i]-1];var a,s=new U(t);for(i=0;i<t;++i)s[i]=s[i-1]+o[i-1]<<1;if(n){a=new U(1<<t);var l=15-t;for(i=0;i<r;++i)if(e[i])for(var u=i<<4|e[i],c=t-e[i],h=s[e[i]-1]++<<c,d=h|(1<<c)-1;h<=d;++h)a[J[h]>>>l]=u}else for(a=new U(r),i=0;i<r;++i)e[i]&&(a[i]=J[s[e[i]-1]++]>>>15-e[i]);return a},ne=new F(288);for($=0;$<144;++$)ne[$]=8;for($=144;$<256;++$)ne[$]=9;for($=256;$<280;++$)ne[$]=7;for($=280;$<288;++$)ne[$]=8;var re=new F(32);for($=0;$<32;++$)re[$]=5;var ie=te(ne,9,0),oe=te(ne,9,1),ae=te(re,5,0),se=te(re,5,1),le=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},ue=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},ce=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},he=function(e){return(e/8|0)+(7&e&&1)},de=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var r=new(e instanceof U?U:e instanceof j?j:F)(n-t);return r.set(e.subarray(t,n)),r},fe=function(e,t,n){var r=e.length;if(!r||n&&!n.l&&r<5)return t||new F(0);var i=!t||n,o=!n||n.i;n||(n={}),t||(t=new F(3*r));var a=function(e){var n=t.length;if(e>n){var r=new F(Math.max(2*n,e));r.set(t),t=r}},s=n.f||0,l=n.p||0,u=n.b||0,c=n.l,h=n.d,d=n.m,f=n.n,p=8*r;do{if(!c){n.f=s=ue(e,l,1);var v=ue(e,l+1,3);if(l+=3,!v){var m=he(l)+4,y=e[m-4]|e[m-3]<<8,g=m+y;if(g>r){if(o)throw"unexpected EOF";break}i&&a(u+y),t.set(e.subarray(m,g),u),n.b=u+=y,n.p=l=8*g;continue}if(1==v)c=oe,h=se,d=9,f=5;else{if(2!=v)throw"invalid block type";var x=ue(e,l,31)+257,b=ue(e,l+10,15)+4,w=x+ue(e,l+5,31)+1;l+=14;for(var k=new F(w),A=new F(19),S=0;S<b;++S)A[G[S]]=ue(e,l+3*S,7);l+=3*b;var M=le(A),T=(1<<M)-1,P=te(A,M,1);for(S=0;S<w;){var C=P[ue(e,l,T)];l+=15&C;m=C>>>4;if(m<16)k[S++]=m;else{var E=0,_=0;16==m?(_=3+ue(e,l,3),l+=2,E=k[S-1]):17==m?(_=3+ue(e,l,7),l+=3):18==m&&(_=11+ue(e,l,127),l+=7);while(_--)k[S++]=E}}var I=k.subarray(0,x),R=k.subarray(x);d=le(I),f=le(R),c=te(I,d,1),h=te(R,f,1)}if(l>p){if(o)throw"unexpected EOF";break}}i&&a(u+131072);for(var L=(1<<d)-1,B=(1<<f)-1,N=l;;N=l){E=c[ce(e,l)&L];var O=E>>>4;if(l+=15&E,l>p){if(o)throw"unexpected EOF";break}if(!E)throw"invalid length/literal";if(O<256)t[u++]=O;else{if(256==O){N=l,c=null;break}var V=O-254;if(O>264){S=O-257;var D=z[S];V=ue(e,l,(1<<D)-1)+X[S],l+=D}var U=h[ce(e,l)&B],j=U>>>4;if(!U)throw"invalid distance";l+=15&U;R=Y[j];if(j>3){D=H[j];R+=ce(e,l)&(1<<D)-1,l+=D}if(l>p){if(o)throw"unexpected EOF";break}i&&a(u+131072);for(var Z=u+V;u<Z;u+=4)t[u]=t[u-R],t[u+1]=t[u+1-R],t[u+2]=t[u+2-R],t[u+3]=t[u+3-R];u=Z}}n.l=c,n.p=N,n.b=u,c&&(s=1,n.m=d,n.d=h,n.n=f)}while(!s);return u==t.length?t:de(t,0,u)},pe=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>>8},ve=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>>8,e[r+2]|=n>>>16},me=function(e,t){for(var n=[],r=0;r<e.length;++r)e[r]&&n.push({s:r,f:e[r]});var i=n.length,o=n.slice();if(!i)return[Ae,0];if(1==i){var a=new F(n[0].s+1);return a[n[0].s]=1,[a,1]}n.sort((function(e,t){return e.f-t.f})),n.push({s:-1,f:25001});var s=n[0],l=n[1],u=0,c=1,h=2;n[0]={s:-1,f:s.f+l.f,l:s,r:l};while(c!=i-1)s=n[n[u].f<n[h].f?u++:h++],l=n[u!=c&&n[u].f<n[h].f?u++:h++],n[c++]={s:-1,f:s.f+l.f,l:s,r:l};var d=o[0].s;for(r=1;r<i;++r)o[r].s>d&&(d=o[r].s);var f=new U(d+1),p=ye(n[c-1],f,0);if(p>t){r=0;var v=0,m=p-t,y=1<<m;for(o.sort((function(e,t){return f[t.s]-f[e.s]||e.f-t.f}));r<i;++r){var g=o[r].s;if(!(f[g]>t))break;v+=y-(1<<p-f[g]),f[g]=t}v>>>=m;while(v>0){var x=o[r].s;f[x]<t?v-=1<<t-f[x]++-1:++r}for(;r>=0&&v;--r){var b=o[r].s;f[b]==t&&(--f[b],++v)}p=t}return[new F(f),p]},ye=function e(t,n,r){return-1==t.s?Math.max(e(t.l,n,r+1),e(t.r,n,r+1)):n[t.s]=r},ge=function(e){var t=e.length;while(t&&!e[--t]);for(var n=new U(++t),r=0,i=e[0],o=1,a=function(e){n[r++]=e},s=1;s<=t;++s)if(e[s]==i&&s!=t)++o;else{if(!i&&o>2){for(;o>138;o-=138)a(32754);o>2&&(a(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(a(i),--o;o>6;o-=6)a(8304);o>2&&(a(o-3<<5|8208),o=0)}while(o--)a(i);o=1,i=e[s]}return[n.subarray(0,r),t]},xe=function(e,t){for(var n=0,r=0;r<t.length;++r)n+=e[r]*t[r];return n},be=function(e,t,n){var r=n.length,i=he(t+2);e[i]=255&r,e[i+1]=r>>>8,e[i+2]=255^e[i],e[i+3]=255^e[i+1];for(var o=0;o<r;++o)e[i+o+4]=n[o];return 8*(i+4+r)},we=function(e,t,n,r,i,o,a,s,l,u,c){pe(t,c++,n),++i[256];for(var h=me(i,15),d=h[0],f=h[1],p=me(o,15),v=p[0],m=p[1],y=ge(d),g=y[0],x=y[1],b=ge(v),w=b[0],k=b[1],A=new U(19),S=0;S<g.length;++S)A[31&g[S]]++;for(S=0;S<w.length;++S)A[31&w[S]]++;for(var M=me(A,7),T=M[0],P=M[1],C=19;C>4&&!T[G[C-1]];--C);var E,_,I,R,L=u+5<<3,B=xe(i,ne)+xe(o,re)+a,N=xe(i,d)+xe(o,v)+a+14+3*C+xe(A,T)+(2*A[16]+3*A[17]+7*A[18]);if(L<=B&&L<=N)return be(t,c,e.subarray(l,l+u));if(pe(t,c,1+(N<B)),c+=2,N<B){E=te(d,f,0),_=d,I=te(v,m,0),R=v;var O=te(T,P,0);pe(t,c,x-257),pe(t,c+5,k-1),pe(t,c+10,C-4),c+=14;for(S=0;S<C;++S)pe(t,c+3*S,T[G[S]]);c+=3*C;for(var V=[g,w],D=0;D<2;++D){var F=V[D];for(S=0;S<F.length;++S){var j=31&F[S];pe(t,c,O[j]),c+=T[j],j>15&&(pe(t,c,F[S]>>>5&127),c+=F[S]>>>12)}}}else E=ie,_=ne,I=ae,R=re;for(S=0;S<s;++S)if(r[S]>255){j=r[S]>>>18&31;ve(t,c,E[j+257]),c+=_[j+257],j>7&&(pe(t,c,r[S]>>>23&31),c+=z[j]);var Z=31&r[S];ve(t,c,I[Z]),c+=R[Z],Z>3&&(ve(t,c,r[S]>>>5&8191),c+=H[Z])}else ve(t,c,E[r[S]]),c+=_[r[S]];return ve(t,c,E[256]),c+_[256]},ke=new j([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Ae=new F(0),Se=function(e,t,n,r,i,o){var a=e.length,s=new F(r+a+5*(1+Math.ceil(a/7e3))+i),l=s.subarray(r,s.length-i),u=0;if(!t||a<8)for(var c=0;c<=a;c+=65535){var h=c+65535;h<a?u=be(l,u,e.subarray(c,h)):(l[c]=o,u=be(l,u,e.subarray(c,a)))}else{for(var d=ke[t-1],f=d>>>13,p=8191&d,v=(1<<n)-1,m=new U(32768),y=new U(v+1),g=Math.ceil(n/3),x=2*g,b=function(t){return(e[t]^e[t+1]<<g^e[t+2]<<x)&v},w=new j(25e3),k=new U(288),A=new U(32),S=0,M=0,T=(c=0,0),P=0,C=0;c<a;++c){var E=b(c),_=32767&c,I=y[E];if(m[_]=I,y[E]=_,P<=c){var R=a-c;if((S>7e3||T>24576)&&R>423){u=we(e,l,0,w,k,A,M,T,C,c-C,u),T=S=M=0,C=c;for(var L=0;L<286;++L)k[L]=0;for(L=0;L<30;++L)A[L]=0}var B=2,N=0,O=p,V=_-I&32767;if(R>2&&E==b(c-V)){var D=Math.min(f,R)-1,G=Math.min(32767,c),Z=Math.min(258,R);while(V<=G&&--O&&_!=I){if(e[c+B]==e[c+B-V]){for(var W=0;W<Z&&e[c+W]==e[c+W-V];++W);if(W>B){if(B=W,N=V,W>D)break;var X=Math.min(V,W-2),K=0;for(L=0;L<X;++L){var Y=c-V+L+32768&32767,J=m[Y],$=Y-J+32768&32767;$>K&&(K=$,I=Y)}}}_=I,I=m[_],V+=_-I+32768&32767}}if(N){w[T++]=268435456|q[B]<<18|Q[N];var ee=31&q[B],te=31&Q[N];M+=z[ee]+H[te],++k[257+ee],++A[te],P=c+B,++S}else w[T++]=e[c],++k[e[c]]}}u=we(e,l,o,w,k,A,M,T,C,c-C,u),!o&&7&u&&(u=be(l,u+1,Ae))}return de(s,0,r+he(u)+i)},Me=function(){for(var e=new j(256),t=0;t<256;++t){var n=t,r=9;while(--r)n=(1&n&&3988292384)^n>>>1;e[t]=n}return e}(),Te=function(){var e=-1;return{p:function(t){for(var n=e,r=0;r<t.length;++r)n=Me[255&n^t[r]]^n>>>8;e=n},d:function(){return~e}}},Pe=function(){var e=1,t=0;return{p:function(n){for(var r=e,i=t,o=n.length,a=0;a!=o;){for(var s=Math.min(a+2655,o);a<s;++a)i+=r+=n[a];r=(65535&r)+15*(r>>16),i=(65535&i)+15*(i>>16)}e=r,t=i},d:function(){return e%=65521,t%=65521,(255&e)<<24|e>>>8<<16|(255&t)<<8|t>>>8}}},Ce=function(e,t,n,r,i){return Se(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,n,r,!i)},Ee=function(e,t){var n={};for(var r in e)n[r]=e[r];for(var r in t)n[r]=t[r];return n},_e=function(e,t,n){for(var r=e(),i=e.toString(),o=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/ /g,"").split(","),a=0;a<r.length;++a){var s=r[a],l=o[a];if("function"==typeof s){t+=";"+l+"=";var u=s.toString();if(s.prototype)if(-1!=u.indexOf("[native code]")){var c=u.indexOf(" ",8)+1;t+=u.slice(c,u.indexOf("(",c))}else for(var h in t+=u,s.prototype)t+=";"+l+".prototype."+h+"="+s.prototype[h].toString();else t+=u}else n[l]=s}return[t,n]},Ie=[],Re=function(e){var t=[];for(var n in e)(e[n]instanceof F||e[n]instanceof U||e[n]instanceof j)&&t.push((e[n]=new e[n].constructor(e[n])).buffer);return t},Le=function(e,t,n,r){var i;if(!Ie[n]){for(var o="",a={},s=e.length-1,l=0;l<s;++l)i=_e(e[l],o,a),o=i[0],a=i[1];Ie[n]=_e(e[s],o,a)}var u=Ee({},Ie[n][1]);return D(Ie[n][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",n,u,Re(u),r)},Be=function(){return[F,U,j,z,H,G,X,Y,oe,se,J,te,le,ue,ce,he,de,fe,ut,Ue,je]},Ne=function(){return[F,U,j,z,H,G,q,Q,ie,ne,ae,re,J,ke,Ae,te,pe,ve,me,ye,ge,xe,be,we,he,de,Se,Ce,ot,Ue]},Oe=function(){return[Ke,Je,qe,Te,Me]},Ve=function(){return[Ye,Qe]},De=function(){return[$e,qe,Pe]},Fe=function(){return[et]},Ue=function(e){return postMessage(e,[e.buffer])},je=function(e){return e&&e.size&&new F(e.size)},ze=function(e,t,n,r,i,o){var a=Le(n,r,i,(function(e,t){a.terminate(),o(e,t)}));return a.postMessage([e,t],t.consume?[e.buffer]:[]),function(){a.terminate()}},He=function(e){return e.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(t){return e.push(t.data[0],t.data[1])}},Ge=function(e,t,n,r,i){var o,a=Le(e,r,i,(function(e,n){e?(a.terminate(),t.ondata.call(t,e)):(n[1]&&a.terminate(),t.ondata.call(t,e,n[0],n[1]))}));a.postMessage(n),t.push=function(e,n){if(o)throw"stream finished";if(!t.ondata)throw"no stream handler";a.postMessage([e,o=n],[e.buffer])},t.terminate=function(){a.terminate()}},Ze=function(e,t){return e[t]|e[t+1]<<8},We=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},Xe=function(e,t){return We(e,t)+4294967296*We(e,t+4)},qe=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8},Ke=function(e,t){var n=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&qe(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),n){e[3]=8;for(var r=0;r<=n.length;++r)e[r+10]=n.charCodeAt(r)}},Ye=function(e){if(31!=e[0]||139!=e[1]||8!=e[2])throw"invalid gzip data";var t=e[3],n=10;4&t&&(n+=e[10]|2+(e[11]<<8));for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[n++]);return n+(2&t)},Qe=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},Je=function(e){return 10+(e.filename&&e.filename.length+1||0)},$e=function(e,t){var n=t.level,r=0==n?0:n<6?1:9==n?3:2;e[0]=120,e[1]=r<<6|(r?32-2*r:1)},et=function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function tt(e,t){return t||"function"!=typeof e||(t=e,e={}),this.ondata=t,e}var nt=function(){function e(e,t){t||"function"!=typeof e||(t=e,e={}),this.ondata=t,this.o=e||{}}return e.prototype.p=function(e,t){this.ondata(Ce(e,this.o,0,0,!t),t)},e.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},e}(),rt=function(){function e(e,t){Ge([Ne,function(){return[He,nt]}],this,tt.call(this,e,t),(function(e){var t=new nt(e.data);onmessage=He(t)}),6)}return e}();function it(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return ze(e,t,[Ne],(function(e){return Ue(ot(e.data[0],e.data[1]))}),0,n)}function ot(e,t){return Ce(e,t||{},0,0)}var at=function(){function e(e){this.s={},this.p=new F(0),this.ondata=e}return e.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new F(t+e.length);n.set(this.p),n.set(e,t),this.p=n},e.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=fe(this.p,this.o,this.s);this.ondata(de(n,t,this.s.b),this.d),this.o=de(n,this.s.b-32768),this.s.b=this.o.length,this.p=de(this.p,this.s.p/8|0),this.s.p&=7},e.prototype.push=function(e,t){this.e(e),this.c(t)},e}(),st=function(){function e(e){this.ondata=e,Ge([Be,function(){return[He,at]}],this,0,(function(){var e=new at;onmessage=He(e)}),7)}return e}();function lt(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return ze(e,t,[Be],(function(e){return Ue(ut(e.data[0],je(e.data[1])))}),1,n)}function ut(e,t){return fe(e,t)}var ct=function(){function e(e,t){this.c=Te(),this.l=0,this.v=1,nt.call(this,e,t)}return e.prototype.push=function(e,t){nt.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=Ce(e,this.o,this.v&&Je(this.o),t&&8,!t);this.v&&(Ke(n,this.o),this.v=0),t&&(qe(n,n.length-8,this.c.d()),qe(n,n.length-4,this.l)),this.ondata(n,t)},e}(),ht=function(){function e(e,t){Ge([Ne,Oe,function(){return[He,nt,ct]}],this,tt.call(this,e,t),(function(e){var t=new ct(e.data);onmessage=He(t)}),8)}return e}();function dt(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return ze(e,t,[Ne,Oe,function(){return[ft]}],(function(e){return Ue(ft(e.data[0],e.data[1]))}),2,n)}function ft(e,t){t||(t={});var n=Te(),r=e.length;n.p(e);var i=Ce(e,t,Je(t),8),o=i.length;return Ke(i,t),qe(i,o-8,n.d()),qe(i,o-4,r),i}var pt=function(){function e(e){this.v=1,at.call(this,e)}return e.prototype.push=function(e,t){if(at.prototype.e.call(this,e),this.v){var n=this.p.length>3?Ye(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}at.prototype.c.call(this,t)},e}(),vt=function(){function e(e){this.ondata=e,Ge([Be,Ve,function(){return[He,at,pt]}],this,0,(function(){var e=new pt;onmessage=He(e)}),9)}return e}();function mt(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return ze(e,t,[Be,Ve,function(){return[yt]}],(function(e){return Ue(yt(e.data[0]))}),3,n)}function yt(e,t){return fe(e.subarray(Ye(e),-8),t||new F(Qe(e)))}var gt=function(){function e(e,t){this.c=Pe(),this.v=1,nt.call(this,e,t)}return e.prototype.push=function(e,t){nt.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e);var n=Ce(e,this.o,this.v&&2,t&&4,!t);this.v&&($e(n,this.o),this.v=0),t&&qe(n,n.length-4,this.c.d()),this.ondata(n,t)},e}(),xt=function(){function e(e,t){Ge([Ne,De,function(){return[He,nt,gt]}],this,tt.call(this,e,t),(function(e){var t=new gt(e.data);onmessage=He(t)}),10)}return e}();function bt(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return ze(e,t,[Ne,De,function(){return[wt]}],(function(e){return Ue(wt(e.data[0],e.data[1]))}),4,n)}function wt(e,t){t||(t={});var n=Pe();n.p(e);var r=Ce(e,t,2,4);return $e(r,t),qe(r,r.length-4,n.d()),r}var kt=function(){function e(e){this.v=1,at.call(this,e)}return e.prototype.push=function(e,t){if(at.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}at.prototype.c.call(this,t)},e}(),At=function(){function e(e){this.ondata=e,Ge([Be,Fe,function(){return[He,at,kt]}],this,0,(function(){var e=new kt;onmessage=He(e)}),11)}return e}();function St(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return ze(e,t,[Be,Fe,function(){return[Mt]}],(function(e){return Ue(Mt(e.data[0],je(e.data[1])))}),5,n)}function Mt(e,t){return fe((et(e),e.subarray(2,-4)),t)}var Tt=function(){function e(e){this.G=pt,this.I=at,this.Z=kt,this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new F(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var r=this,i=function(){r.ondata.apply(r,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(i):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(i):new this.Z(i),this.s.push(this.p,t),this.p=null}}},e}(),Pt=function(){function e(e){this.G=vt,this.I=st,this.Z=At,this.ondata=e}return e.prototype.push=function(e,t){Tt.prototype.push.call(this,e,t)},e}();function Ct(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return 31==e[0]&&139==e[1]&&8==e[2]?mt(e,t,n):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?lt(e,t,n):St(e,t,n)}function Et(e,t){return 31==e[0]&&139==e[1]&&8==e[2]?yt(e,t):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?ut(e,t):Mt(e,t)}var _t=function e(t,n,r,i){for(var o in t){var a=t[o],s=n+o;a instanceof F?r[s]=[a,i]:Array.isArray(a)?r[s]=[a[0],Ee(i,a[1])]:e(a,s+"/",r,i)}},It="undefined"!=typeof TextEncoder&&new TextEncoder,Rt="undefined"!=typeof TextDecoder&&new TextDecoder,Lt=0;try{Rt.decode(Ae,{stream:!0}),Lt=1}catch(Xo){}var Bt=function(e){for(var t="",n=0;;){var r=e[n++],i=(r>127)+(r>223)+(r>239);if(n+i>e.length)return[t,de(e,n-1)];i?3==i?(r=((15&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t+=String.fromCharCode(55296|r>>10,56320|1023&r)):t+=1&i?String.fromCharCode((31&r)<<6|63&e[n++]):String.fromCharCode((15&r)<<12|(63&e[n++])<<6|63&e[n++]):t+=String.fromCharCode(r)}},Nt=function(){function e(e){this.ondata=e,Lt?this.t=new TextDecoder:this.p=Ae}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var n=new F(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var r=Bt(n),i=r[0],o=r[1];if(t){if(o.length)throw"invalid utf-8 data";this.p=null}else this.p=o;this.ondata(i,t)}},e}(),Ot=function(){function e(e){this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(Vt(e),this.d=t||!1)},e}();function Vt(e,t){if(t){for(var n=new F(e.length),r=0;r<e.length;++r)n[r]=e.charCodeAt(r);return n}if(It)return It.encode(e);var i=e.length,o=new F(e.length+(e.length>>1)),a=0,s=function(e){o[a++]=e};for(r=0;r<i;++r){if(a+5>o.length){var l=new F(a+8+(i-r<<1));l.set(o),o=l}var u=e.charCodeAt(r);u<128||t?s(u):u<2048?(s(192|u>>6),s(128|63&u)):u>55295&&u<57344?(u=65536+(1047552&u)|1023&e.charCodeAt(++r),s(240|u>>18),s(128|u>>12&63),s(128|u>>6&63),s(128|63&u)):(s(224|u>>12),s(128|u>>6&63),s(128|63&u))}return de(o,0,a)}function Dt(e,t){if(t){for(var n="",r=0;r<e.length;r+=16384)n+=String.fromCharCode.apply(null,e.subarray(r,r+16384));return n}if(Rt)return Rt.decode(e);var i=Bt(e),o=i[0],a=i[1];if(a.length)throw"invalid utf-8 data";return o}var Ft=function(e){return 1==e?3:e<6?2:9==e?1:0},Ut=function(e,t){return t+30+Ze(e,t+26)+Ze(e,t+28)},jt=function(e,t,n){var r=Ze(e,t+28),i=Dt(e.subarray(t+46,t+46+r),!(2048&Ze(e,t+8))),o=t+46+r,a=We(e,t+20),s=n&&4294967295==a?zt(e,o):[a,We(e,t+24),We(e,t+42)],l=s[0],u=s[1],c=s[2];return[Ze(e,t+10),l,u,i,o+Ze(e,t+30)+Ze(e,t+32),c]},zt=function(e,t){for(;1!=Ze(e,t);t+=4+Ze(e,t+2));return[Xe(e,t+12),Xe(e,t+4),Xe(e,t+20)]},Ht=function(e){var t=0;if(e)for(var n in e){var r=e[n].length;if(r>65535)throw"extra field too long";t+=r+4}return t},Gt=function(e,t,n,r,i,o,a,s){var l=r.length,u=n.extra,c=s&&s.length,h=Ht(u);qe(e,t,null!=a?33639248:67324752),t+=4,null!=a&&(e[t++]=20,e[t++]=n.os),e[t]=20,t+=2,e[t++]=n.flag<<1|(null==o&&8),e[t++]=i&&8,e[t++]=255&n.compression,e[t++]=n.compression>>8;var d=new Date(null==n.mtime?Date.now():n.mtime),f=d.getFullYear()-1980;if(f<0||f>119)throw"date not in range 1980-2099";if(qe(e,t,f<<25|d.getMonth()+1<<21|d.getDate()<<16|d.getHours()<<11|d.getMinutes()<<5|d.getSeconds()>>>1),t+=4,null!=o&&(qe(e,t,n.crc),qe(e,t+4,o),qe(e,t+8,n.size)),qe(e,t+12,l),qe(e,t+14,h),t+=16,null!=a&&(qe(e,t,c),qe(e,t+6,n.attrs),qe(e,t+10,a),t+=14),e.set(r,t),t+=l,h)for(var p in u){var v=u[p],m=v.length;qe(e,t,+p),qe(e,t+2,m),e.set(v,t+4),t+=4+m}return c&&(e.set(s,t),t+=c),t},Zt=function(e,t,n,r,i){qe(e,t,101010256),qe(e,t+8,n),qe(e,t+10,n),qe(e,t+12,r),qe(e,t+16,i)},Wt=function(){function e(e){this.filename=e,this.c=Te(),this.size=0,this.compression=0}return e.prototype.process=function(e,t){this.ondata(null,e,t)},e.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},e}(),Xt=function(){function e(e,t){var n=this;t||(t={}),Wt.call(this,e),this.d=new nt(t,(function(e,t){n.ondata(null,e,t)})),this.compression=8,this.flag=Ft(t.level)}return e.prototype.process=function(e,t){try{this.d.push(e,t)}catch(Xo){this.ondata(Xo,null,t)}},e.prototype.push=function(e,t){Wt.prototype.push.call(this,e,t)},e}(),qt=function(){function e(e,t){var n=this;t||(t={}),Wt.call(this,e),this.d=new rt(t,(function(e,t,r){n.ondata(e,t,r)})),this.compression=8,this.flag=Ft(t.level),this.terminate=this.d.terminate}return e.prototype.process=function(e,t){this.d.push(e,t)},e.prototype.push=function(e,t){Wt.prototype.push.call(this,e,t)},e}(),Kt=function(){function e(e){this.ondata=e,this.u=[],this.d=1}return e.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var n=Vt(e.filename),r=n.length,i=e.comment,o=i&&Vt(i),a=r!=e.filename.length||o&&i.length!=o.length,s=r+Ht(e.extra)+30;if(r>65535)throw"filename too long";var l=new F(s);Gt(l,0,e,n,a);var u=[l],c=function(){for(var e=0,n=u;e<n.length;e++){var r=n[e];t.ondata(null,r,!1)}u=[]},h=this.d;this.d=0;var d=this.u.length,f=Ee(e,{f:n,u:a,o:o,t:function(){e.terminate&&e.terminate()},r:function(){if(c(),h){var e=t.u[d+1];e?e.r():t.d=1}h=1}}),p=0;e.ondata=function(n,r,i){if(n)t.ondata(n,r,i),t.terminate();else if(p+=r.length,u.push(r),i){var o=new F(16);qe(o,0,134695760),qe(o,4,e.crc),qe(o,8,p),qe(o,12,e.size),u.push(o),f.c=p,f.b=s+p+16,f.crc=e.crc,f.size=e.size,h&&f.r(),h=1}else h&&c()},this.u.push(f)},e.prototype.end=function(){var e=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},e.prototype.e=function(){for(var e=0,t=0,n=0,r=0,i=this.u;r<i.length;r++){var o=i[r];n+=46+o.f.length+Ht(o.extra)+(o.o?o.o.length:0)}for(var a=new F(n+22),s=0,l=this.u;s<l.length;s++){o=l[s];Gt(a,e,o,o.f,o.u,o.c,t,o.o),e+=46+o.f.length+Ht(o.extra)+(o.o?o.o.length:0),t+=o.b}Zt(a,e,this.u.length,n,t),this.ondata(null,a,!0),this.d=2},e.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){var n=t[e];n.t()}this.d=2},e}();function Yt(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";var r={};_t(e,"",r,t);var i=Object.keys(r),o=i.length,a=0,s=0,l=o,u=new Array(o),c=[],h=function(){for(var e=0;e<c.length;++e)c[e]()},d=function(){var e=new F(s+22),t=a,r=s-a;s=0;for(var i=0;i<l;++i){var o=u[i];try{var c=o.c.length;Gt(e,s,o,o.f,o.u,c);var h=30+o.f.length+Ht(o.extra),d=s+h;e.set(o.c,d),Gt(e,a,o,o.f,o.u,c,s,o.m),a+=16+h+(o.m?o.m.length:0),s=d+c}catch(Xo){return n(Xo,null)}}Zt(e,a,u.length,r,t),n(null,e)};o||d();for(var f=function(e){var t=i[e],l=r[t],f=l[0],p=l[1],v=Te(),m=f.length;v.p(f);var y=Vt(t),g=y.length,x=p.comment,b=x&&Vt(x),w=b&&b.length,k=Ht(p.extra),A=0==p.level?0:8,S=function(r,i){if(r)h(),n(r,null);else{var l=i.length;u[e]=Ee(p,{size:m,crc:v.d(),c:i,f:y,m:b,u:g!=t.length||b&&x.length!=w,compression:A}),a+=30+g+k+l,s+=76+2*(g+k)+(w||0)+l,--o||d()}};if(g>65535&&S("filename too long",null),A)if(m<16e4)try{S(null,ot(f,p))}catch(Xo){S(Xo,null)}else c.push(it(f,p,S));else S(null,f)},p=0;p<l;++p)f(p);return h}function Qt(e,t){t||(t={});var n={},r=[];_t(e,"",n,t);var i=0,o=0;for(var a in n){var s=n[a],l=s[0],u=s[1],c=0==u.level?0:8,h=Vt(a),d=h.length,f=u.comment,p=f&&Vt(f),v=p&&p.length,m=Ht(u.extra);if(d>65535)throw"filename too long";var y=c?ot(l,u):l,g=y.length,x=Te();x.p(l),r.push(Ee(u,{size:l.length,crc:x.d(),c:y,f:h,m:p,u:d!=a.length||p&&f.length!=v,o:i,compression:c})),i+=30+d+m+g,o+=76+2*(d+m)+(v||0)+g}for(var b=new F(o+22),w=i,k=o-i,A=0;A<r.length;++A){h=r[A];Gt(b,h.o,h,h.f,h.u,h.c.length);var S=30+h.f.length+Ht(h.extra);b.set(h.c,h.o+S),Gt(b,i,h,h.f,h.u,h.c.length,h.o,h.m),i+=16+S+(h.m?h.m.length:0)}return Zt(b,i,r.length,k,w),b}var Jt=function(){function e(){}return e.prototype.push=function(e,t){this.ondata(null,e,t)},e.compression=0,e}(),$t=function(){function e(){var e=this;this.i=new at((function(t,n){e.ondata(null,t,n)}))}return e.prototype.push=function(e,t){try{this.i.push(e,t)}catch(Xo){this.ondata(Xo,e,t)}},e.compression=8,e}(),en=function(){function e(e,t){var n=this;t<32e4?this.i=new at((function(e,t){n.ondata(null,e,t)})):(this.i=new st((function(e,t,r){n.ondata(e,t,r)})),this.terminate=this.i.terminate)}return e.prototype.push=function(e,t){this.i.terminate&&(e=de(e,0)),this.i.push(e,t)},e.compression=8,e}(),tn=function(){function e(e){this.onfile=e,this.k=[],this.o={0:Jt},this.p=Ae}return e.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var r=Math.min(this.c,e.length),i=e.subarray(0,r);if(this.c-=r,this.d?this.d.push(i,!this.c):this.k[0].push(i),e=e.subarray(r),e.length)return this.push(e,t)}else{var o=0,a=0,s=void 0,l=void 0;this.p.length?e.length?(l=new F(this.p.length+e.length),l.set(this.p),l.set(e,this.p.length)):l=this.p:l=e;for(var u=l.length,c=this.c,h=c&&this.d,d=function(){var e,t=We(l,a);if(67324752==t){o=1,s=a,f.d=null,f.c=0;var r=Ze(l,a+6),i=Ze(l,a+8),h=2048&r,d=8&r,p=Ze(l,a+26),v=Ze(l,a+28);if(u>a+30+p+v){var m=[];f.k.unshift(m),o=2;var y,g=We(l,a+18),x=We(l,a+22),b=Dt(l.subarray(a+30,a+=30+p),!h);4294967295==g?(e=d?[-2]:zt(l,a),g=e[0],x=e[1]):d&&(g=-1),a+=v,f.c=g;var w={name:b,compression:i,start:function(){if(!w.ondata)throw"no callback";if(g){var e=n.o[i];if(!e)throw"unknown compression type "+i;y=g<0?new e(b):new e(b,g,x),y.ondata=function(e,t,n){w.ondata(e,t,n)};for(var t=0,r=m;t<r.length;t++){var o=r[t];y.push(o,!1)}n.k[0]==m&&n.c?n.d=y:y.push(Ae,!0)}else w.ondata(null,Ae,!0)},terminate:function(){y&&y.terminate&&y.terminate()}};g>=0&&(w.size=g,w.originalSize=x),f.onfile(w)}return"break"}if(c){if(134695760==t)return s=a+=12+(-2==c&&8),o=3,f.c=0,"break";if(33639248==t)return s=a-=4,o=3,f.c=0,"break"}},f=this;a<u-4;++a){var p=d();if("break"===p)break}if(this.p=Ae,c<0){var v=o?l.subarray(0,s-12-(-2==c&&8)-(134695760==We(l,s-16)&&4)):l.subarray(0,a);h?h.push(v,!!o):this.k[+(2==o)].push(v)}if(2&o)return this.push(l.subarray(a),t);this.p=l.subarray(a)}if(t){if(this.c)throw"invalid zip file";this.p=null}},e.prototype.register=function(e){this.o[e.compression]=e},e}();function nn(e,t){if("function"!=typeof t)throw"no callback";for(var n=[],r=function(){for(var e=0;e<n.length;++e)n[e]()},i={},o=e.length-22;101010256!=We(e,o);--o)if(!o||e.length-o>65558)return void t("invalid zip file",null);var a=Ze(e,o+8);a||t(null,{});var s=a,l=We(e,o+16),u=4294967295==l;if(u){if(o=We(e,o-12),101075792!=We(e,o))return void t("invalid zip file",null);s=a=We(e,o+32),l=We(e,o+48)}for(var c=function(s){var c=jt(e,l,u),h=c[0],d=c[1],f=c[2],p=c[3],v=c[4],m=c[5],y=Ut(e,m);l=v;var g=function(e,n){e?(r(),t(e,null)):(i[p]=n,--a||t(null,i))};if(h)if(8==h){var x=e.subarray(y,y+d);if(d<32e4)try{g(null,ut(x,new F(f)))}catch(o){g(o,null)}else n.push(lt(x,{size:f},g))}else g("unknown compression type "+h,null);else g(null,de(e,y,y+d))},h=0;h<s;++h)c(h);return r}function rn(e){for(var t={},n=e.length-22;101010256!=We(e,n);--n)if(!n||e.length-n>65558)throw"invalid zip file";var r=Ze(e,n+8);if(!r)return{};var i=We(e,n+16),o=4294967295==i;if(o){if(n=We(e,n-12),101075792!=We(e,n))throw"invalid zip file";r=We(e,n+32),i=We(e,n+48)}for(var a=0;a<r;++a){var s=jt(e,i,o),l=s[0],u=s[1],c=s[2],h=s[3],d=s[4],f=s[5],p=Ut(e,f);if(i=d,l){if(8!=l)throw"unknown compression type "+l;t[h]=ut(e.subarray(p,p+u),new F(c))}else t[h]=de(e,p,p+u)}return t}function on(e,t,n){var r=n.length-e-1;if(t>=n[r])return r-1;if(t<=n[e])return e;var i=e,o=r,a=Math.floor((i+o)/2);while(t<n[a]||t>=n[a+1])t<n[a]?o=a:i=a,a=Math.floor((i+o)/2);return a}function an(e,t,n,r){var i=[],o=[],a=[];i[0]=1;for(var s=1;s<=n;++s){o[s]=t-r[e+1-s],a[s]=r[e+s]-t;for(var l=0,u=0;u<s;++u){var c=a[u+1],h=o[s-u],d=i[u]/(c+h);i[u]=l+c*d,l=h*d}i[s]=l}return i}function sn(e,t,n,r){for(var i=on(e,r,t),o=an(i,r,e,t),a=new u.Ltg(0,0,0,0),s=0;s<=e;++s){var l=n[i-e+s],c=o[s],h=l.w*c;a.x+=l.x*h,a.y+=l.y*h,a.z+=l.z*h,a.w+=l.w*c}return a}function ln(e,t,n,r,i){for(var o=[],a=0;a<=n;++a)o[a]=0;for(var s=[],l=0;l<=r;++l)s[l]=o.slice(0);for(var u=[],c=0;c<=n;++c)u[c]=o.slice(0);u[0][0]=1;for(var h=o.slice(0),d=o.slice(0),f=1;f<=n;++f){h[f]=t-i[e+1-f],d[f]=i[e+f]-t;for(var p=0,v=0;v<f;++v){var m=d[v+1],y=h[f-v];u[f][v]=m+y;var g=u[v][f-1]/u[f][v];u[v][f]=p+m*g,p=y*g}u[f][f]=p}for(var x=0;x<=n;++x)s[0][x]=u[x][n];for(var b=0;b<=n;++b){for(var w=0,k=1,A=[],S=0;S<=n;++S)A[S]=o.slice(0);A[0][0]=1;for(var M=1;M<=r;++M){var T=0,P=b-M,C=n-M;b>=M&&(A[k][0]=A[w][0]/u[C+1][P],T=A[k][0]*u[P][C]);for(var E=P>=-1?1:-P,_=b-1<=C?M-1:n-b,I=E;I<=_;++I)A[k][I]=(A[w][I]-A[w][I-1])/u[C+1][P+I],T+=A[k][I]*u[P+I][C];b<=C&&(A[k][M]=-A[w][M-1]/u[C+1][b],T+=A[k][M]*u[b][C]),s[M][b]=T;var R=w;w=k,k=R}}for(var L=n,B=1;B<=r;++B){for(var N=0;N<=n;++N)s[B][N]*=L;L*=n-B}return s}function un(e,t,n,r,i){for(var o=i<e?i:e,a=[],s=on(e,r,t),l=ln(s,r,e,o,t),c=[],h=0;h<n.length;++h){var d=n[h].clone(),f=d.w;d.x*=f,d.y*=f,d.z*=f,c[h]=d}for(var p=0;p<=o;++p){for(var v=c[s-e].clone().multiplyScalar(l[p][0]),m=1;m<=e;++m)v.add(c[s-e+m].clone().multiplyScalar(l[p][m]));a[p]=v}for(var y=o+1;y<=i+1;++y)a[y]=new u.Ltg(0,0,0);return a}function cn(e,t){for(var n=1,r=2;r<=e;++r)n*=r;for(var i=1,o=2;o<=t;++o)i*=o;for(var a=2;a<=e-t;++a)i*=a;return n/i}function hn(e){for(var t=e.length,n=[],r=[],i=0;i<t;++i){var o=e[i];n[i]=new u.Pa4(o.x,o.y,o.z),r[i]=o.w}for(var a=[],s=0;s<t;++s){for(var l=n[s].clone(),c=1;c<=s;++c)l.sub(a[s-c].clone().multiplyScalar(cn(s,c)*r[c]));a[s]=l.divideScalar(r[0])}return a}function dn(e,t,n,r,i){var o=un(e,t,n,r,i);return hn(o)}var fn,pn,vn,mn=function(e){(0,h.Z)(n,e);var t=(0,d.Z)(n);function n(e,r,i,o,a){var l;(0,s.Z)(this,n),l=t.call(this),l.degree=e,l.knots=r,l.controlPoints=[],l.startKnot=o||0,l.endKnot=a||l.knots.length-1;for(var c=0;c<i.length;++c){var h=i[c];l.controlPoints[c]=new u.Ltg(h.x,h.y,h.z,h.w)}return l}return(0,l.Z)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new u.Pa4,n=t,r=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),i=sn(this.degree,this.knots,this.controlPoints,r);return 1!==i.w&&i.divideScalar(i.w),n.set(i.x,i.y,i.z)}},{key:"getTangent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new u.Pa4,n=t,r=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),i=dn(this.degree,this.knots,this.controlPoints,r,1);return n.copy(i[1]).normalize(),n}}]),n}(u.Hyl),yn=function(e){(0,h.Z)(n,e);var t=(0,d.Z)(n);function n(e){return(0,s.Z)(this,n),t.call(this,e)}return(0,l.Z)(n,[{key:"load",value:function(e,t,n,r){var i=this,o=""===i.path?u.Zp0.extractUrlBase(e):i.path,a=new u.hH6(this.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{t(i.parse(n,o))}catch(Xo){r?r(Xo):console.error(Xo),i.manager.itemError(e)}}),n,r)}},{key:"parse",value:function(e,t){if(Mn(e))fn=(new kn).parse(e);else{var n=On(e);if(!Tn(n))throw new Error("THREE.FBXLoader: Unknown format.");if(Pn(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Pn(n));fn=(new wn).parse(n)}var r=new u.dpR(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new gn(r,this.manager).parse(fn)}}]),n}(u.aNw),gn=function(){function e(t,n){(0,s.Z)(this,e),this.textureLoader=t,this.manager=n}return(0,l.Z)(e,[{key:"parse",value:function(){pn=this.parseConnections();var e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),r=this.parseDeformers(),i=(new xn).parse(r);return this.parseScene(r,i,n),vn}},{key:"parseConnections",value:function(){var e=new Map;if("Connections"in fn){var t=fn.Connections.connections;t.forEach((function(t){var n=t[0],r=t[1],i=t[2];e.has(n)||e.set(n,{parents:[],children:[]});var o={ID:r,relationship:i};e.get(n).parents.push(o),e.has(r)||e.set(r,{parents:[],children:[]});var a={ID:n,relationship:i};e.get(r).children.push(a)}))}return e}},{key:"parseImages",value:function(){var e={},t={};if("Video"in fn.Objects){var n=fn.Objects.Video;for(var r in n){var i=n[r],o=parseInt(r);if(e[o]=i.RelativeFilename||i.Filename,"Content"in i){var a=i.Content instanceof ArrayBuffer&&i.Content.byteLength>0,s="string"===typeof i.Content&&""!==i.Content;if(a||s){var l=this.parseImage(n[r]);t[i.RelativeFilename||i.Filename]=l}}}}for(var u in e){var c=e[u];void 0!==t[c]?e[u]=t[c]:e[u]=e[u].split("\\").pop()}return e}},{key:"parseImage",value:function(e){var t,n=e.Content,r=e.RelativeFilename||e.Filename,i=r.slice(r.lastIndexOf(".")+1).toLowerCase();switch(i){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",r),t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"===typeof n)return"data:"+t+";base64,"+n;var o=new Uint8Array(n);return window.URL.createObjectURL(new Blob([o],{type:t}))}},{key:"parseTextures",value:function(e){var t=new Map;if("Texture"in fn.Objects){var n=fn.Objects.Texture;for(var r in n){var i=this.parseTexture(n[r],e);t.set(parseInt(r),i)}}return t}},{key:"parseTexture",value:function(e,t){var n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;var r=e.WrapModeU,i=e.WrapModeV,o=void 0!==r?r.value:0,a=void 0!==i?i.value:0;if(n.wrapS=0===o?u.rpg:u.uWy,n.wrapT=0===a?u.rpg:u.uWy,"Scaling"in e){var s=e.Scaling.value;n.repeat.x=s[0],n.repeat.y=s[1]}return n}},{key:"loadTexture",value:function(e,t){var n,r,i=this.textureLoader.path,o=pn.get(e.id).children;void 0!==o&&o.length>0&&void 0!==t[o[0].ID]&&(n=t[o[0].ID],0!==n.indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));var a=e.FileName.slice(-3).toLowerCase();if("tga"===a){var s=this.manager.getHandler(".tga");null===s?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),r=new u.xEZ):(s.setPath(this.textureLoader.path),r=s.load(n))}else"psd"===a?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),r=new u.xEZ):r=this.textureLoader.load(n);return this.textureLoader.setPath(i),r}},{key:"parseMaterials",value:function(e){var t=new Map;if("Material"in fn.Objects){var n=fn.Objects.Material;for(var r in n){var i=this.parseMaterial(n[r],e);null!==i&&t.set(parseInt(r),i)}}return t}},{key:"parseMaterial",value:function(e,t){var n=e.id,r=e.attrName,i=e.ShadingModel;if("object"===(0,f.Z)(i)&&(i=i.value),!pn.has(n))return null;var o,a=this.parseParameters(e,t,n);switch(i.toLowerCase()){case"phong":o=new u.xoR;break;case"lambert":o=new u.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',i),o=new u.xoR;break}return o.setValues(a),o.name=r,o}},{key:"parseParameters",value:function(e,t,n){var r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=(new u.Ilk).fromArray(e.Diffuse.value):!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(r.color=(new u.Ilk).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=(new u.Ilk).fromArray(e.Emissive.value):!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(r.emissive=(new u.Ilk).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=(new u.Ilk).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(r.specular=(new u.Ilk).fromArray(e.SpecularColor.value));var i=this;return pn.get(n).children.forEach((function(e){var n=e.relationship;switch(n){case"Bump":r.bumpMap=i.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":r.aoMap=i.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=i.getTexture(t,e.ID),void 0!==r.map&&(r.map.encoding=u.knz);break;case"DisplacementColor":r.displacementMap=i.getTexture(t,e.ID);break;case"EmissiveColor":r.emissiveMap=i.getTexture(t,e.ID),void 0!==r.emissiveMap&&(r.emissiveMap.encoding=u.knz);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=i.getTexture(t,e.ID);break;case"ReflectionColor":r.envMap=i.getTexture(t,e.ID),void 0!==r.envMap&&(r.envMap.mapping=u.dSO,r.envMap.encoding=u.knz);break;case"SpecularColor":r.specularMap=i.getTexture(t,e.ID),void 0!==r.specularMap&&(r.specularMap.encoding=u.knz);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=i.getTexture(t,e.ID),r.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",n);break}})),r}},{key:"getTexture",value:function(e,t){return"LayeredTexture"in fn.Objects&&t in fn.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=pn.get(t).children[0].ID),e.get(t)}},{key:"parseDeformers",value:function(){var e={},t={};if("Deformer"in fn.Objects){var n=fn.Objects.Deformer;for(var r in n){var i=n[r],o=pn.get(parseInt(r));if("Skin"===i.attrType){var a=this.parseSkeleton(o,n);a.ID=r,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=o.parents[0].ID,e[r]=a}else if("BlendShape"===i.attrType){var s={id:r};s.rawTargets=this.parseMorphTargets(o,n),s.id=r,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[r]=s}}}return{skeletons:e,morphTargets:t}}},{key:"parseSkeleton",value:function(e,t){var n=[];return e.children.forEach((function(e){var r=t[e.ID];if("Cluster"===r.attrType){var i={ID:e.ID,indices:[],weights:[],transformLink:(new u.yGw).fromArray(r.TransformLink.a)};"Indexes"in r&&(i.indices=r.Indexes.a,i.weights=r.Weights.a),n.push(i)}})),{rawBones:n,bones:[]}}},{key:"parseMorphTargets",value:function(e,t){for(var n=[],r=0;r<e.children.length;r++){var i=e.children[r],o=t[i.ID],a={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if("BlendShapeChannel"!==o.attrType)return;a.geoID=pn.get(parseInt(i.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,n.push(a)}return n}},{key:"parseScene",value:function(e,t,n){vn=new u.ZAu;var r=this.parseModels(e.skeletons,t,n),i=fn.Objects.Model,o=this;r.forEach((function(e){var t=i[e.ID];o.setLookAtProperties(e,t);var n=pn.get(e.ID).parents;n.forEach((function(t){var n=r.get(t.ID);void 0!==n&&n.add(e)})),null===e.parent&&vn.add(e)})),this.bindSkeleton(e.skeletons,t,r),this.createAmbientLight(),vn.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);var t=Ln(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));var a=(new bn).parse();1===vn.children.length&&vn.children[0].isGroup&&(vn.children[0].animations=a,vn=vn.children[0]),vn.animations=a}},{key:"parseModels",value:function(e,t,n){var r=new Map,i=fn.Objects.Model;for(var o in i){var a=parseInt(o),s=i[o],l=pn.get(a),c=this.buildSkeleton(l,e,a,s.attrName);if(!c){switch(s.attrType){case"Camera":c=this.createCamera(l);break;case"Light":c=this.createLight(l);break;case"Mesh":c=this.createMesh(l,t,n);break;case"NurbsCurve":c=this.createCurve(l,t);break;case"LimbNode":case"Root":c=new u.N$j;break;case"Null":default:c=new u.ZAu;break}c.name=s.attrName?u.iUV.sanitizeNodeName(s.attrName):"",c.ID=a}this.getTransformData(c,s),r.set(a,c)}return r}},{key:"buildSkeleton",value:function(e,t,n,r){var i=null;return e.parents.forEach((function(e){var o=function(o){var a=t[o];a.rawBones.forEach((function(t,o){if(t.ID===e.ID){var s=i;i=new u.N$j,i.matrixWorld.copy(t.transformLink),i.name=r?u.iUV.sanitizeNodeName(r):"",i.ID=n,a.bones[o]=i,null!==s&&i.add(s)}}))};for(var a in t)o(a)})),i}},{key:"createCamera",value:function(e){var t,n;if(e.children.forEach((function(e){var t=fn.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)})),void 0===n)t=new u.Tme;else{var r=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(r=1);var i=1;void 0!==n.NearPlane&&(i=n.NearPlane.value/1e3);var o=1e3;void 0!==n.FarPlane&&(o=n.FarPlane.value/1e3);var a=window.innerWidth,s=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(a=n.AspectWidth.value,s=n.AspectHeight.value);var l=a/s,c=45;void 0!==n.FieldOfView&&(c=n.FieldOfView.value);var h=n.FocalLength?n.FocalLength.value:null;switch(r){case 0:t=new u.cPb(c,l,i,o),null!==h&&t.setFocalLength(h);break;case 1:t=new u.iKG(-a/2,a/2,s/2,-s/2,i,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+r+"."),t=new u.Tme;break}}return t}},{key:"createLight",value:function(e){var t,n;if(e.children.forEach((function(e){var t=fn.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)})),void 0===n)t=new u.Tme;else{var r;r=void 0===n.LightType?0:n.LightType.value;var i=16777215;void 0!==n.Color&&(i=(new u.Ilk).fromArray(n.Color.value));var o=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(o=0);var a=0;void 0!==n.FarAttenuationEnd&&(a=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);var s=1;switch(r){case 0:t=new u.cek(i,o,a,s);break;case 1:t=new u.Ox3(i,o);break;case 2:var l=Math.PI/3;void 0!==n.InnerAngle&&(l=u.M8C.degToRad(n.InnerAngle.value));var c=0;void 0!==n.OuterAngle&&(c=u.M8C.degToRad(n.OuterAngle.value),c=Math.max(c,1)),t=new u.PMe(i,o,a,l,c,s);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new u.cek(i,o);break}void 0!==n.CastShadows&&1===n.CastShadows.value&&(t.castShadow=!0)}return t}},{key:"createMesh",value:function(e,t,n){var r,i=null,o=null,a=[];return e.children.forEach((function(e){t.has(e.ID)&&(i=t.get(e.ID)),n.has(e.ID)&&a.push(n.get(e.ID))})),a.length>1?o=a:a.length>0?o=a[0]:(o=new u.xoR({color:13421772}),a.push(o)),"color"in i.attributes&&a.forEach((function(e){e.vertexColors=!0})),i.FBX_Deformer?(r=new u.TUv(i,o),r.normalizeSkinWeights()):r=new u.Kj0(i,o),r}},{key:"createCurve",value:function(e,t){var n=e.children.reduce((function(e,n){return t.has(n.ID)&&(e=t.get(n.ID)),e}),null),r=new u.nls({color:3342591,linewidth:1});return new u.x12(n,r)}},{key:"getTransformData",value:function(e,t){var n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?Bn(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}},{key:"setLookAtProperties",value:function(e,t){if("LookAtProperty"in t){var n=pn.get(e.ID).children;n.forEach((function(t){if("LookAtProperty"===t.relationship){var n=fn.Objects.Model[t.ID];if("Lcl_Translation"in n){var r=n.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(r),vn.add(e.target)):e.lookAt((new u.Pa4).fromArray(r))}}}))}}},{key:"bindSkeleton",value:function(e,t,n){var r=this.parsePoseNodes(),i=function(i){var o=e[i],a=pn.get(parseInt(o.ID)).parents;a.forEach((function(e){if(t.has(e.ID)){var i=e.ID,a=pn.get(i);a.parents.forEach((function(e){if(n.has(e.ID)){var t=n.get(e.ID);t.bind(new u.OdW(o.bones),r[e.ID])}}))}}))};for(var o in e)i(o)}},{key:"parsePoseNodes",value:function(){var e={};if("Pose"in fn.Objects){var t=fn.Objects.Pose;for(var n in t)if("BindPose"===t[n].attrType&&t[n].NbPoseNodes>0){var r=t[n].PoseNode;Array.isArray(r)?r.forEach((function(t){e[t.Node]=(new u.yGw).fromArray(t.Matrix.a)})):e[r.Node]=(new u.yGw).fromArray(r.Matrix.a)}}return e}},{key:"createAmbientLight",value:function(){if("GlobalSettings"in fn&&"AmbientColor"in fn.GlobalSettings){var e=fn.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],r=e[2];if(0!==t||0!==n||0!==r){var i=new u.Ilk(t,n,r);vn.add(new u.Mig(i,1))}}}}]),e}(),xn=function(){function e(){(0,s.Z)(this,e)}return(0,l.Z)(e,[{key:"parse",value:function(e){var t=new Map;if("Geometry"in fn.Objects){var n=fn.Objects.Geometry;for(var r in n){var i=pn.get(parseInt(r)),o=this.parseGeometry(i,n[r],e);t.set(parseInt(r),o)}}return t}},{key:"parseGeometry",value:function(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}},{key:"parseMeshGeometry",value:function(e,t,n){var r=n.skeletons,i=[],o=e.parents.map((function(e){return fn.Objects.Model[e.ID]}));if(0!==o.length){var a=e.children.reduce((function(e,t){return void 0!==r[t.ID]&&(e=r[t.ID]),e}),null);e.children.forEach((function(e){void 0!==n.morphTargets[e.ID]&&i.push(n.morphTargets[e.ID])}));var s=o[0],l={};"RotationOrder"in s&&(l.eulerOrder=Bn(s.RotationOrder.value)),"InheritType"in s&&(l.inheritType=parseInt(s.InheritType.value)),"GeometricTranslation"in s&&(l.translation=s.GeometricTranslation.value),"GeometricRotation"in s&&(l.rotation=s.GeometricRotation.value),"GeometricScaling"in s&&(l.scale=s.GeometricScaling.value);var u=Ln(l);return this.genGeometry(t,a,i,u)}}},{key:"genGeometry",value:function(e,t,n,r){var i=new u.u9r;e.attrName&&(i.name=e.attrName);var o=this.parseGeoNode(e,t),a=this.genBuffers(o),s=new u.a$l(a.vertex,3);if(s.applyMatrix4(r),i.setAttribute("position",s),a.colors.length>0&&i.setAttribute("color",new u.a$l(a.colors,3)),t&&(i.setAttribute("skinIndex",new u.qlB(a.weightsIndices,4)),i.setAttribute("skinWeight",new u.a$l(a.vertexWeights,4)),i.FBX_Deformer=t),a.normal.length>0){var l=(new u.Vkp).getNormalMatrix(r),c=new u.a$l(a.normal,3);c.applyNormalMatrix(l),i.setAttribute("normal",c)}if(a.uvs.forEach((function(e,t){var n="uv"+(t+1).toString();0===t&&(n="uv"),i.setAttribute(n,new u.a$l(a.uvs[t],2))})),o.material&&"AllSame"!==o.material.mappingType){var h=a.materialIndex[0],d=0;if(a.materialIndex.forEach((function(e,t){e!==h&&(i.addGroup(d,t-d,h),h=e,d=t)})),i.groups.length>0){var f=i.groups[i.groups.length-1],p=f.start+f.count;p!==a.materialIndex.length&&i.addGroup(p,a.materialIndex.length-p,h)}0===i.groups.length&&i.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(i,e,n,r),i}},{key:"parseGeoNode",value:function(e,t){var n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];var r=0;while(e.LayerElementUV[r])e.LayerElementUV[r].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[r])),r++}return n.weightTable={},null!==t&&(n.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(r,i){void 0===n.weightTable[r]&&(n.weightTable[r]=[]),n.weightTable[r].push({id:t,weight:e.weights[i]})}))}))),n}},{key:"genBuffers",value:function(e){var t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},n=0,r=0,i=!1,o=[],a=[],s=[],l=[],u=[],c=[],h=this;return e.vertexIndices.forEach((function(d,f){var p,v=!1;d<0&&(d^=-1,v=!0);var m=[],y=[];if(o.push(3*d,3*d+1,3*d+2),e.color){var g=_n(f,n,d,e.color);s.push(g[0],g[1],g[2])}if(e.skeleton){if(void 0!==e.weightTable[d]&&e.weightTable[d].forEach((function(e){y.push(e.weight),m.push(e.id)})),y.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);var x=[0,0,0,0],b=[0,0,0,0];y.forEach((function(e,t){var n=e,r=m[t];b.forEach((function(e,t,i){if(n>e){i[t]=n,n=e;var o=x[t];x[t]=r,r=o}}))})),m=x,y=b}while(y.length<4)y.push(0),m.push(0);for(var w=0;w<4;++w)u.push(y[w]),c.push(m[w])}if(e.normal){var k=_n(f,n,d,e.normal);a.push(k[0],k[1],k[2])}e.material&&"AllSame"!==e.material.mappingType&&(p=_n(f,n,d,e.material)[0]),e.uv&&e.uv.forEach((function(e,t){var r=_n(f,n,d,e);void 0===l[t]&&(l[t]=[]),l[t].push(r[0]),l[t].push(r[1])})),r++,v&&(h.genFace(t,e,o,p,a,s,l,u,c,r),n++,r=0,o=[],a=[],s=[],l=[],u=[],c=[])})),t}},{key:"genFace",value:function(e,t,n,r,i,o,a,s,l,u){for(var c=function(u){e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(u-1)]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+2]]),e.vertex.push(t.vertexPositions[n[3*u]]),e.vertex.push(t.vertexPositions[n[3*u+1]]),e.vertex.push(t.vertexPositions[n[3*u+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[4*(u-1)]),e.vertexWeights.push(s[4*(u-1)+1]),e.vertexWeights.push(s[4*(u-1)+2]),e.vertexWeights.push(s[4*(u-1)+3]),e.vertexWeights.push(s[4*u]),e.vertexWeights.push(s[4*u+1]),e.vertexWeights.push(s[4*u+2]),e.vertexWeights.push(s[4*u+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[4*(u-1)]),e.weightsIndices.push(l[4*(u-1)+1]),e.weightsIndices.push(l[4*(u-1)+2]),e.weightsIndices.push(l[4*(u-1)+3]),e.weightsIndices.push(l[4*u]),e.weightsIndices.push(l[4*u+1]),e.weightsIndices.push(l[4*u+2]),e.weightsIndices.push(l[4*u+3])),t.color&&(e.colors.push(o[0]),e.colors.push(o[1]),e.colors.push(o[2]),e.colors.push(o[3*(u-1)]),e.colors.push(o[3*(u-1)+1]),e.colors.push(o[3*(u-1)+2]),e.colors.push(o[3*u]),e.colors.push(o[3*u+1]),e.colors.push(o[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(i[0]),e.normal.push(i[1]),e.normal.push(i[2]),e.normal.push(i[3*(u-1)]),e.normal.push(i[3*(u-1)+1]),e.normal.push(i[3*(u-1)+2]),e.normal.push(i[3*u]),e.normal.push(i[3*u+1]),e.normal.push(i[3*u+2])),t.uv&&t.uv.forEach((function(t,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(a[n][0]),e.uvs[n].push(a[n][1]),e.uvs[n].push(a[n][2*(u-1)]),e.uvs[n].push(a[n][2*(u-1)+1]),e.uvs[n].push(a[n][2*u]),e.uvs[n].push(a[n][2*u+1])}))},h=2;h<u;h++)c(h)}},{key:"addMorphTargets",value:function(e,t,n,r){if(0!==n.length){e.morphTargetsRelative=!0,e.morphAttributes.position=[];var i=this;n.forEach((function(n){n.rawTargets.forEach((function(n){var o=fn.Objects.Geometry[n.geoID];void 0!==o&&i.genMorphGeometry(e,t,o,r,n.name)}))}))}}},{key:"genMorphGeometry",value:function(e,t,n,r,i){for(var o=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],a=void 0!==n.Vertices?n.Vertices.a:[],s=void 0!==n.Indexes?n.Indexes.a:[],l=3*e.attributes.position.count,c=new Float32Array(l),h=0;h<s.length;h++){var d=3*s[h];c[d]=a[3*h],c[d+1]=a[3*h+1],c[d+2]=a[3*h+2]}var f={vertexIndices:o,vertexPositions:c},p=this.genBuffers(f),v=new u.a$l(p.vertex,3);v.name=i||n.attrName,v.applyMatrix4(r),e.morphAttributes.position.push(v)}},{key:"parseNormals",value:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Normals.a,i=[];return"IndexToDirect"===n&&("NormalIndex"in e?i=e.NormalIndex.a:"NormalsIndex"in e&&(i=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:i,mappingType:t,referenceType:n}}},{key:"parseUVs",value:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.UV.a,i=[];return"IndexToDirect"===n&&(i=e.UVIndex.a),{dataSize:2,buffer:r,indices:i,mappingType:t,referenceType:n}}},{key:"parseVertexColors",value:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Colors.a,i=[];return"IndexToDirect"===n&&(i=e.ColorIndex.a),{dataSize:4,buffer:r,indices:i,mappingType:t,referenceType:n}}},{key:"parseMaterialIndices",value:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};for(var r=e.Materials.a,i=[],o=0;o<r.length;++o)i.push(o);return{dataSize:1,buffer:r,indices:i,mappingType:t,referenceType:n}}},{key:"parseNurbsGeometry",value:function(e){if(void 0===mn)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new u.u9r;var t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new u.u9r;for(var n,r,i=t-1,o=e.KnotVector.a,a=[],s=e.Points.a,l=0,c=s.length;l<c;l+=4)a.push((new u.Ltg).fromArray(s,l));if("Closed"===e.Form)a.push(a[0]);else if("Periodic"===e.Form){n=i,r=o.length-1-n;for(var h=0;h<i;++h)a.push(a[h])}var d=new mn(i,o,a,n,r),f=d.getPoints(12*a.length);return(new u.u9r).setFromPoints(f)}}]),e}(),bn=function(){function e(){(0,s.Z)(this,e)}return(0,l.Z)(e,[{key:"parse",value:function(){var e=[],t=this.parseClips();if(void 0!==t)for(var n in t){var r=t[n],i=this.addClip(r);e.push(i)}return e}},{key:"parseClips",value:function(){if(void 0!==fn.Objects.AnimationCurve){var e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);var t=this.parseAnimationLayers(e),n=this.parseAnimStacks(t);return n}}},{key:"parseAnimationCurveNodes",value:function(){var e=fn.Objects.AnimationCurveNode,t=new Map;for(var n in e){var r=e[n];if(null!==r.attrName.match(/S|R|T|DeformPercent/)){var i={id:r.id,attr:r.attrName,curves:{}};t.set(i.id,i)}}return t}},{key:"parseAnimationCurves",value:function(e){var t=fn.Objects.AnimationCurve;for(var n in t){var r={id:t[n].id,times:t[n].KeyTime.a.map(Cn),values:t[n].KeyValueFloat.a},i=pn.get(r.id);if(void 0!==i){var o=i.parents[0].ID,a=i.parents[0].relationship;a.match(/X/)?e.get(o).curves["x"]=r:a.match(/Y/)?e.get(o).curves["y"]=r:a.match(/Z/)?e.get(o).curves["z"]=r:a.match(/d|DeformPercent/)&&e.has(o)&&(e.get(o).curves["morph"]=r)}}}},{key:"parseAnimationLayers",value:function(e){var t=fn.Objects.AnimationLayer,n=new Map,r=function(t){var r=[],i=pn.get(parseInt(t));if(void 0!==i){var o=i.children;o.forEach((function(t,n){if(e.has(t.ID)){var i=e.get(t.ID);if(void 0!==i.curves.x||void 0!==i.curves.y||void 0!==i.curves.z){if(void 0===r[n]){var o=pn.get(t.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==o){var a=fn.Objects.Model[o.toString()];if(void 0===a)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",t);var s={modelName:a.attrName?u.iUV.sanitizeNodeName(a.attrName):"",ID:a.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};vn.traverse((function(e){e.ID===a.id&&(s.transform=e.matrix,e.userData.transformData&&(s.eulerOrder=e.userData.transformData.eulerOrder))})),s.transform||(s.transform=new u.yGw),"PreRotation"in a&&(s.preRotation=a.PreRotation.value),"PostRotation"in a&&(s.postRotation=a.PostRotation.value),r[n]=s}}r[n]&&(r[n][i.attr]=i)}else if(void 0!==i.curves.morph){if(void 0===r[n]){var l=pn.get(t.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,c=pn.get(l).parents[0].ID,h=pn.get(c).parents[0].ID,d=pn.get(h).parents[0].ID,f=fn.Objects.Model[d],p={modelName:f.attrName?u.iUV.sanitizeNodeName(f.attrName):"",morphName:fn.Objects.Deformer[l].attrName};r[n]=p}r[n][i.attr]=i}}})),n.set(parseInt(t),r)}};for(var i in t)r(i);return n}},{key:"parseAnimStacks",value:function(e){var t=fn.Objects.AnimationStack,n={};for(var r in t){var i=pn.get(parseInt(r)).children;i.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var o=e.get(i[0].ID);n[r]={name:t[r].attrName,layer:o}}return n}},{key:"addClip",value:function(e){var t=[],n=this;return e.layer.forEach((function(e){t=t.concat(n.generateTracks(e))})),new u.m7l(e.name,-1,t)}},{key:"generateTracks",value:function(e){var t=[],n=new u.Pa4,r=new u._fP,i=new u.Pa4;if(e.transform&&e.transform.decompose(n,r,i),n=n.toArray(),r=(new u.USm).setFromQuaternion(r,e.eulerOrder).toArray(),i=i.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){var o=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");void 0!==o&&t.push(o)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var a=this.generateRotationTrack(e.modelName,e.R.curves,r,e.preRotation,e.postRotation,e.eulerOrder);void 0!==a&&t.push(a)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var s=this.generateVectorTrack(e.modelName,e.S.curves,i,"scale");void 0!==s&&t.push(s)}if(void 0!==e.DeformPercent){var l=this.generateMorphTrack(e);void 0!==l&&t.push(l)}return t}},{key:"generateVectorTrack",value:function(e,t,n,r){var i=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(i,t,n);return new u.yC1(e+"."+r,i,o)}},{key:"generateRotationTrack",value:function(e,t,n,r,i,o){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(u.M8C.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(u.M8C.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(u.M8C.degToRad));var a=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(a,t,n);void 0!==r&&(r=r.map(u.M8C.degToRad),r.push(o),r=(new u.USm).fromArray(r),r=(new u._fP).setFromEuler(r)),void 0!==i&&(i=i.map(u.M8C.degToRad),i.push(o),i=(new u.USm).fromArray(i),i=(new u._fP).setFromEuler(i).invert());for(var l=new u._fP,c=new u.USm,h=[],d=0;d<s.length;d+=3)c.set(s[d],s[d+1],s[d+2],o),l.setFromEuler(c),void 0!==r&&l.premultiply(r),void 0!==i&&l.multiply(i),l.toArray(h,d/3*4);return new u.iLg(e+".quaternion",a,h)}},{key:"generateMorphTrack",value:function(e){var t=e.DeformPercent.curves.morph,n=t.values.map((function(e){return e/100})),r=vn.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new u.dUE(e.modelName+".morphTargetInfluences["+r+"]",t.times,n)}},{key:"getTimesForAllAxes",value:function(e){var t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})),t.length>1){for(var n=1,r=t[0],i=1;i<t.length;i++){var o=t[i];o!==r&&(t[n]=o,r=o,n++)}t=t.slice(0,n)}return t}},{key:"getKeyframeTrackValues",value:function(e,t,n){var r=n,i=[],o=-1,a=-1,s=-1;return e.forEach((function(e){if(t.x&&(o=t.x.times.indexOf(e)),t.y&&(a=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==o){var n=t.x.values[o];i.push(n),r[0]=n}else i.push(r[0]);if(-1!==a){var l=t.y.values[a];i.push(l),r[1]=l}else i.push(r[1]);if(-1!==s){var u=t.z.values[s];i.push(u),r[2]=u}else i.push(r[2])})),i}},{key:"interpolateRotations",value:function(e){for(var t=1;t<e.values.length;t++){var n=e.values[t-1],r=e.values[t]-n,i=Math.abs(r);if(i>=180){var o=i/180,a=r/o,s=n+a,l=e.times[t-1],u=e.times[t]-l,c=u/o,h=l+c,d=[],f=[];while(h<e.times[t])d.push(h),h+=c,f.push(s),s+=a;e.times=Fn(e.times,t,d),e.values=Fn(e.values,t,f)}}}}]),e}(),wn=function(){function e(){(0,s.Z)(this,e)}return(0,l.Z)(e,[{key:"getPrevNode",value:function(){return this.nodeStack[this.currentIndent-2]}},{key:"getCurrentNode",value:function(){return this.nodeStack[this.currentIndent-1]}},{key:"getCurrentProp",value:function(){return this.currentProp}},{key:"pushStack",value:function(e){this.nodeStack.push(e),this.currentIndent+=1}},{key:"popStack",value:function(){this.nodeStack.pop(),this.currentIndent-=1}},{key:"setCurrentProp",value:function(e,t){this.currentProp=e,this.currentPropName=t}},{key:"parse",value:function(e){this.currentIndent=0,this.allNodes=new Sn,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,n=e.split(/[\r\n]+/);return n.forEach((function(e,r){var i=e.match(/^[\s\t]*;/),o=e.match(/^[\s\t]*$/);if(!i&&!o){var a=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");a?t.parseNodeBegin(e,a):s?t.parseNodeProperty(e,s,n[++r]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}})),this.allNodes}},{key:"parseNodeBegin",value:function(e,t){var n=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),i={name:n},o=this.parseNodeAttr(r),a=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,i):n in a?("PoseNode"===n?a.PoseNode.push(i):void 0!==a[n].id&&(a[n]={},a[n][a[n].id]=a[n]),""!==o.id&&(a[n][o.id]=i)):"number"===typeof o.id?(a[n]={},a[n][o.id]=i):"Properties70"!==n&&(a[n]="PoseNode"===n?[i]:i),"number"===typeof o.id&&(i.id=o.id),""!==o.name&&(i.attrName=o.name),""!==o.type&&(i.attrType=o.type),this.pushStack(i)}},{key:"parseNodeAttr",value:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var n="",r="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:n,type:r}}},{key:"parseNodeProperty",value:function(e,t,n){var r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),i=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===i&&(i=n.replace(/"/g,"").replace(/,$/,"").trim());var o=this.getCurrentNode(),a=o.name;if("Properties70"!==a){if("C"===r){var s=i.split(",").slice(1),l=parseInt(s[0]),u=parseInt(s[1]),c=i.split(",").slice(3);c=c.map((function(e){return e.trim().replace(/^"/,"")})),r="connections",i=[l,u],Vn(i,c),void 0===o[r]&&(o[r]=[])}"Node"===r&&(o.id=i),r in o&&Array.isArray(o[r])?o[r].push(i):"a"!==r?o[r]=i:o.a=i,this.setCurrentProp(o,r),"a"===r&&","!==i.slice(-1)&&(o.a=Nn(i))}else this.parseNodeSpecialProperty(e,r,i)}},{key:"parseNodePropertyContinued",value:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=Nn(t.a))}},{key:"parseNodeSpecialProperty",value:function(e,t,n){var r=n.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),i=r[0],o=r[1],a=r[2],s=r[3],l=r[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=Nn(l);break}this.getPrevNode()[i]={type:o,type2:a,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),i)}}]),e}(),kn=function(){function e(){(0,s.Z)(this,e)}return(0,l.Z)(e,[{key:"parse",value:function(e){var t=new An(e);t.skip(23);var n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);var r=new Sn;while(!this.endOfContent(t)){var i=this.parseNode(t,n);null!==i&&r.add(i.name,i)}return r}},{key:"endOfContent",value:function(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}},{key:"parseNode",value:function(e,t){var n={},r=t>=7500?e.getUint64():e.getUint32(),i=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();var o=e.getUint8(),a=e.getString(o);if(0===r)return null;for(var s=[],l=0;l<i;l++)s.push(this.parseProperty(e));var u=s.length>0?s[0]:"",c=s.length>1?s[1]:"",h=s.length>2?s[2]:"";n.singleProperty=1===i&&e.getOffset()===r;while(r>e.getOffset()){var d=this.parseNode(e,t);null!==d&&this.parseSubNode(a,n,d)}return n.propertyList=s,"number"===typeof u&&(n.id=u),""!==c&&(n.attrName=c),""!==h&&(n.attrType=h),""!==a&&(n.name=a),n}},{key:"parseSubNode",value:function(e,t,n){if(!0===n.singleProperty){var r=n.propertyList[0];Array.isArray(r)?(t[n.name]=n,n.a=r):t[n.name]=r}else if("Connections"===e&&"C"===n.name){var i=[];n.propertyList.forEach((function(e,t){0!==t&&i.push(e)})),void 0===t.connections&&(t.connections=[]),t.connections.push(i)}else if("Properties70"===n.name){var o=Object.keys(n);o.forEach((function(e){t[e]=n[e]}))}else if("Properties70"===e&&"P"===n.name){var a,s=n.propertyList[0],l=n.propertyList[1],u=n.propertyList[2],c=n.propertyList[3];0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),0===l.indexOf("Lcl ")&&(l=l.replace("Lcl ","Lcl_")),a="Color"===l||"ColorRGB"===l||"Vector"===l||"Vector3D"===l||0===l.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[s]={type:l,type2:u,flag:c,value:a}}else void 0===t[n.name]?"number"===typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)}},{key:"parseProperty",value:function(e){var t,n=e.getString(1);switch(n){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return t=e.getUint32(),e.getArrayBuffer(t);case"S":return t=e.getUint32(),e.getString(t);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var i=e.getUint32(),o=e.getUint32(),a=e.getUint32();if(0===o)switch(n){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}"undefined"===typeof r&&console.error("THREE.FBXLoader: External library fflate.min.js required.");var s=Mt(new Uint8Array(e.getArrayBuffer(a))),l=new An(s.buffer);switch(n){case"b":case"c":return l.getBooleanArray(i);case"d":return l.getFloat64Array(i);case"f":return l.getFloat32Array(i);case"i":return l.getInt32Array(i);case"l":return l.getInt64Array(i)}default:throw new Error("THREE.FBXLoader: Unknown property type "+n)}}}]),e}(),An=function(){function e(t,n){(0,s.Z)(this,e),this.dv=new DataView(t),this.offset=0,this.littleEndian=void 0===n||n}return(0,l.Z)(e,[{key:"getOffset",value:function(){return this.offset}},{key:"size",value:function(){return this.dv.buffer.byteLength}},{key:"skip",value:function(e){this.offset+=e}},{key:"getBoolean",value:function(){return 1===(1&this.getUint8())}},{key:"getBooleanArray",value:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getBoolean());return t}},{key:"getUint8",value:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e}},{key:"getInt16",value:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}},{key:"getInt32",value:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}},{key:"getInt32Array",value:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getInt32());return t}},{key:"getUint32",value:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}},{key:"getInt64",value:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}},{key:"getInt64Array",value:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getInt64());return t}},{key:"getUint64",value:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}},{key:"getFloat32",value:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}},{key:"getFloat32Array",value:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getFloat32());return t}},{key:"getFloat64",value:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}},{key:"getFloat64Array",value:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getFloat64());return t}},{key:"getArrayBuffer",value:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}},{key:"getString",value:function(e){for(var t=[],n=0;n<e;n++)t[n]=this.getUint8();var r=t.indexOf(0);return r>=0&&(t=t.slice(0,r)),u.Zp0.decodeText(new Uint8Array(t))}}]),e}(),Sn=function(){function e(){(0,s.Z)(this,e)}return(0,l.Z)(e,[{key:"add",value:function(e,t){this[e]=t}}]),e}();function Mn(e){var t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===On(e,0,t.length)}function Tn(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],n=0;function r(t){var r=e[t-1];return e=e.slice(n+t),n++,r}for(var i=0;i<t.length;++i){var o=r(1);if(o===t[i])return!1}return!0}function Pn(e){var t=/FBXVersion: (\d+)/,n=e.match(t);if(n){var r=parseInt(n[1]);return r}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Cn(e){return e/46186158e3}var En=[];function _n(e,t,n,r){var i;switch(r.mappingType){case"ByPolygonVertex":i=e;break;case"ByPolygon":i=t;break;case"ByVertice":i=n;break;case"AllSame":i=r.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+r.mappingType)}"IndexToDirect"===r.referenceType&&(i=r.indices[i]);var o=i*r.dataSize,a=o+r.dataSize;return Dn(En,r.buffer,o,a)}var In=new u.USm,Rn=new u.Pa4;function Ln(e){var t=new u.yGw,n=new u.yGw,r=new u.yGw,i=new u.yGw,o=new u.yGw,a=new u.yGw,s=new u.yGw,l=new u.yGw,c=new u.yGw,h=new u.yGw,d=new u.yGw,f=new u.yGw,p=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(Rn.fromArray(e.translation)),e.preRotation){var v=e.preRotation.map(u.M8C.degToRad);v.push(e.eulerOrder),n.makeRotationFromEuler(In.fromArray(v))}if(e.rotation){var m=e.rotation.map(u.M8C.degToRad);m.push(e.eulerOrder),r.makeRotationFromEuler(In.fromArray(m))}if(e.postRotation){var y=e.postRotation.map(u.M8C.degToRad);y.push(e.eulerOrder),i.makeRotationFromEuler(In.fromArray(y)),i.invert()}e.scale&&o.scale(Rn.fromArray(e.scale)),e.scalingOffset&&s.setPosition(Rn.fromArray(e.scalingOffset)),e.scalingPivot&&a.setPosition(Rn.fromArray(e.scalingPivot)),e.rotationOffset&&l.setPosition(Rn.fromArray(e.rotationOffset)),e.rotationPivot&&c.setPosition(Rn.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(d.copy(e.parentMatrix),h.copy(e.parentMatrixWorld));var g=n.clone().multiply(r).multiply(i),x=new u.yGw;x.extractRotation(h);var b=new u.yGw;b.copyPosition(h);var w=b.clone().invert().multiply(h),k=x.clone().invert().multiply(w),A=o,S=new u.yGw;if(0===p)S.copy(x).multiply(g).multiply(k).multiply(A);else if(1===p)S.copy(x).multiply(k).multiply(g).multiply(A);else{var M=(new u.yGw).scale((new u.Pa4).setFromMatrixScale(d)),T=M.clone().invert(),P=k.clone().multiply(T);S.copy(x).multiply(g).multiply(P).multiply(A)}var C=c.clone().invert(),E=a.clone().invert(),_=t.clone().multiply(l).multiply(c).multiply(n).multiply(r).multiply(i).multiply(C).multiply(s).multiply(a).multiply(o).multiply(E),I=(new u.yGw).copyPosition(_),R=h.clone().multiply(I);return f.copyPosition(R),_=f.clone().multiply(S),_.premultiply(h.invert()),_}function Bn(e){e=e||0;var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===e?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function Nn(e){var t=e.split(",").map((function(e){return parseFloat(e)}));return t}function On(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),u.Zp0.decodeText(new Uint8Array(e,t,n))}function Vn(e,t){for(var n=0,r=e.length,i=t.length;n<i;n++,r++)e[r]=t[n]}function Dn(e,t,n,r){for(var i=n,o=0;i<r;i++,o++)e[o]=t[i];return e}function Fn(e,t,n){return e.slice(0,t).concat(n).concat(e.slice(t))}var Un=n(3263),jn=n(460),zn=n(7349),Hn=(n(9600),n(7145),n(5109),n(2479),function(e){(0,h.Z)(n,e);var t=(0,d.Z)(n);function n(e){var r;return(0,s.Z)(this,n),r=t.call(this,e),r.dracoLoader=null,r.ktx2Loader=null,r.meshoptDecoder=null,r.pluginCallbacks=[],r.register((function(e){return new qn(e)})),r.register((function(e){return new er(e)})),r.register((function(e){return new tr(e)})),r.register((function(e){return new Kn(e)})),r.register((function(e){return new Yn(e)})),r.register((function(e){return new Qn(e)})),r.register((function(e){return new Jn(e)})),r.register((function(e){return new $n(e)})),r.register((function(e){return new Wn(e)})),r.register((function(e){return new nr(e)})),r}return(0,l.Z)(n,[{key:"load",value:function(e,t,n,r){var i,o=this;i=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:u.Zp0.extractUrlBase(e),this.manager.itemStart(e);var a=function(t){r?r(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},s=new u.hH6(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){try{o.parse(n,i,(function(n){t(n),o.manager.itemEnd(e)}),a)}catch(Xo){a(Xo)}}),n,a)}},{key:"setDRACOLoader",value:function(e){return this.dracoLoader=e,this}},{key:"setDDSLoader",value:function(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}},{key:"setKTX2Loader",value:function(e){return this.ktx2Loader=e,this}},{key:"setMeshoptDecoder",value:function(e){return this.meshoptDecoder=e,this}},{key:"register",value:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}},{key:"unregister",value:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}},{key:"parse",value:function(e,t,n,r){var i,o={},a={};if("string"===typeof e)i=e;else{var s=u.Zp0.decodeText(new Uint8Array(e,0,4));if(s===rr){try{o[Zn.KHR_BINARY_GLTF]=new ar(e)}catch(m){return void(r&&r(m))}i=o[Zn.KHR_BINARY_GLTF].content}else i=u.Zp0.decodeText(new Uint8Array(e))}var l=JSON.parse(i);if(void 0===l.asset||l.asset.version[0]<2)r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var c=new Rr(l,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(var h=0;h<this.pluginCallbacks.length;h++){var d=this.pluginCallbacks[h](c);a[d.name]=d,o[d.name]=!0}if(l.extensionsUsed)for(var f=0;f<l.extensionsUsed.length;++f){var p=l.extensionsUsed[f],v=l.extensionsRequired||[];switch(p){case Zn.KHR_MATERIALS_UNLIT:o[p]=new Xn;break;case Zn.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[p]=new cr;break;case Zn.KHR_DRACO_MESH_COMPRESSION:o[p]=new sr(l,this.dracoLoader);break;case Zn.KHR_TEXTURE_TRANSFORM:o[p]=new lr;break;case Zn.KHR_MESH_QUANTIZATION:o[p]=new hr;break;default:v.indexOf(p)>=0&&void 0===a[p]&&console.warn('THREE.GLTFLoader: Unknown extension "'+p+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(n,r)}}},{key:"parseAsync",value:function(e,t){var n=this;return new Promise((function(r,i){n.parse(e,t,r,i)}))}}]),n}(u.aNw));function Gn(){var e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}var Zn={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"},Wn=function(){function e(t){(0,s.Z)(this,e),this.parser=t,this.name=Zn.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}return(0,l.Z)(e,[{key:"_markDefs",value:function(){for(var e=this.parser,t=this.parser.json.nodes||[],n=0,r=t.length;n<r;n++){var i=t[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}},{key:"_loadLight",value:function(e){var t=this.parser,n="light:"+e,r=t.cache.get(n);if(r)return r;var i,o=t.json,a=o.extensions&&o.extensions[this.name]||{},s=a.lights||[],l=s[e],c=new u.Ilk(16777215);void 0!==l.color&&c.fromArray(l.color);var h=void 0!==l.range?l.range:0;switch(l.type){case"directional":i=new u.Ox3(c),i.target.position.set(0,0,-1),i.add(i.target);break;case"point":i=new u.cek(c),i.distance=h;break;case"spot":i=new u.PMe(c),i.distance=h,l.spot=l.spot||{},l.spot.innerConeAngle=void 0!==l.spot.innerConeAngle?l.spot.innerConeAngle:0,l.spot.outerConeAngle=void 0!==l.spot.outerConeAngle?l.spot.outerConeAngle:Math.PI/4,i.angle=l.spot.outerConeAngle,i.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return i.position.set(0,0,0),i.decay=2,void 0!==l.intensity&&(i.intensity=l.intensity),i.name=t.createUniqueName(l.name||"light_"+e),r=Promise.resolve(i),t.cache.add(n,r),r}},{key:"createNodeAttachment",value:function(e){var t=this,n=this.parser,r=n.json,i=r.nodes[e],o=i.extensions&&i.extensions[this.name]||{},a=o.light;return void 0===a?null:this._loadLight(a).then((function(e){return n._getNodeRef(t.cache,a,e)}))}}]),e}(),Xn=function(){function e(){(0,s.Z)(this,e),this.name=Zn.KHR_MATERIALS_UNLIT}return(0,l.Z)(e,[{key:"getMaterialType",value:function(){return u.vBJ}},{key:"extendParams",value:function(e,t,n){var r=[];e.color=new u.Ilk(1,1,1),e.opacity=1;var i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){var o=i.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==i.baseColorTexture&&r.push(n.assignTexture(e,"map",i.baseColorTexture))}return Promise.all(r)}}]),e}(),qn=function(){function e(t){(0,s.Z)(this,e),this.parser=t,this.name=Zn.KHR_MATERIALS_CLEARCOAT}return(0,l.Z)(e,[{key:"getMaterialType",value:function(e){var t=this.parser,n=t.json.materials[e];return n.extensions&&n.extensions[this.name]?u.EJi:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],o=r.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&i.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&i.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(i.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){var a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new u.FM8(a,a)}return Promise.all(i)}}]),e}(),Kn=function(){function e(t){(0,s.Z)(this,e),this.parser=t,this.name=Zn.KHR_MATERIALS_SHEEN}return(0,l.Z)(e,[{key:"getMaterialType",value:function(e){var t=this.parser,n=t.json.materials[e];return n.extensions&&n.extensions[this.name]?u.EJi:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[];t.sheenColor=new u.Ilk(0,0,0),t.sheenRoughness=0,t.sheen=1;var o=r.extensions[this.name];return void 0!==o.sheenColorFactor&&t.sheenColor.fromArray(o.sheenColorFactor),void 0!==o.sheenRoughnessFactor&&(t.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&i.push(n.assignTexture(t,"sheenColorMap",o.sheenColorTexture)),void 0!==o.sheenRoughnessTexture&&i.push(n.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(i)}}]),e}(),Yn=function(){function e(t){(0,s.Z)(this,e),this.parser=t,this.name=Zn.KHR_MATERIALS_TRANSMISSION}return(0,l.Z)(e,[{key:"getMaterialType",value:function(e){var t=this.parser,n=t.json.materials[e];return n.extensions&&n.extensions[this.name]?u.EJi:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],o=r.extensions[this.name];return void 0!==o.transmissionFactor&&(t.transmission=o.transmissionFactor),void 0!==o.transmissionTexture&&i.push(n.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(i)}}]),e}(),Qn=function(){function e(t){(0,s.Z)(this,e),this.parser=t,this.name=Zn.KHR_MATERIALS_VOLUME}return(0,l.Z)(e,[{key:"getMaterialType",value:function(e){var t=this.parser,n=t.json.materials[e];return n.extensions&&n.extensions[this.name]?u.EJi:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],o=r.extensions[this.name];t.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&i.push(n.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||0;var a=o.attenuationColor||[1,1,1];return t.attenuationColor=new u.Ilk(a[0],a[1],a[2]),Promise.all(i)}}]),e}(),Jn=function(){function e(t){(0,s.Z)(this,e),this.parser=t,this.name=Zn.KHR_MATERIALS_IOR}return(0,l.Z)(e,[{key:"getMaterialType",value:function(e){var t=this.parser,n=t.json.materials[e];return n.extensions&&n.extensions[this.name]?u.EJi:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=r.extensions[this.name];return t.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}}]),e}(),$n=function(){function e(t){(0,s.Z)(this,e),this.parser=t,this.name=Zn.KHR_MATERIALS_SPECULAR}return(0,l.Z)(e,[{key:"getMaterialType",value:function(e){var t=this.parser,n=t.json.materials[e];return n.extensions&&n.extensions[this.name]?u.EJi:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],o=r.extensions[this.name];t.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&i.push(n.assignTexture(t,"specularIntensityMap",o.specularTexture));var a=o.specularColorFactor||[1,1,1];return t.specularColor=new u.Ilk(a[0],a[1],a[2]),void 0!==o.specularColorTexture&&i.push(n.assignTexture(t,"specularColorMap",o.specularColorTexture).then((function(e){e.encoding=u.knz}))),Promise.all(i)}}]),e}(),er=function(){function e(t){(0,s.Z)(this,e),this.parser=t,this.name=Zn.KHR_TEXTURE_BASISU}return(0,l.Z)(e,[{key:"loadTexture",value:function(e){var t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;var i=r.extensions[this.name],o=n.images[i.source],a=t.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o,a)}}]),e}(),tr=function(){function e(t){(0,s.Z)(this,e),this.parser=t,this.name=Zn.EXT_TEXTURE_WEBP,this.isSupported=null}return(0,l.Z)(e,[{key:"loadTexture",value:function(e){var t=this.name,n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;var o=i.extensions[t],a=r.images[o.source],s=n.textureLoader;if(a.uri){var l=n.options.manager.getHandler(a.uri);null!==l&&(s=l)}return this.detectSupport().then((function(i){if(i)return n.loadTextureImage(e,a,s);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}},{key:"detectSupport",value:function(){return this.isSupported||(this.isSupported=new Promise((function(e){var t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}]),e}(),nr=function(){function e(t){(0,s.Z)(this,e),this.name=Zn.EXT_MESHOPT_COMPRESSION,this.parser=t}return(0,l.Z)(e,[{key:"loadBufferView",value:function(e){var t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){var r=n.extensions[this.name],i=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,o.ready]).then((function(e){var t=r.byteOffset||0,n=r.byteLength||0,i=r.count,a=r.byteStride,s=new ArrayBuffer(i*a),l=new Uint8Array(e[0],t,n);return o.decodeGltfBuffer(new Uint8Array(s),i,a,l,r.mode,r.filter),s}))}return null}}]),e}(),rr="glTF",ir=12,or={JSON:1313821514,BIN:5130562},ar=(0,l.Z)((function e(t){(0,s.Z)(this,e),this.name=Zn.KHR_BINARY_GLTF,this.content=null,this.body=null;var n=new DataView(t,0,ir);if(this.header={magic:u.Zp0.decodeText(new Uint8Array(t.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==rr)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");var r=this.header.length-ir,i=new DataView(t,ir),o=0;while(o<r){var a=i.getUint32(o,!0);o+=4;var l=i.getUint32(o,!0);if(o+=4,l===or.JSON){var c=new Uint8Array(t,ir+o,a);this.content=u.Zp0.decodeText(c)}else if(l===or.BIN){var h=ir+o;this.body=t.slice(h,h+a)}o+=a}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")})),sr=function(){function e(t,n){if((0,s.Z)(this,e),!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Zn.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=n,this.dracoLoader.preload()}return(0,l.Z)(e,[{key:"decodePrimitive",value:function(e,t){var n=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},s={},l={};for(var u in o){var c=br[u]||u.toLowerCase();a[c]=o[u]}for(var h in e.attributes){var d=br[h]||h.toLowerCase();if(void 0!==o[h]){var f=n.accessors[e.attributes[h]],p=mr[f.componentType];l[d]=p,s[d]=!0===f.normalized}}return t.getDependency("bufferView",i).then((function(e){return new Promise((function(t){r.decodeDracoFile(e,(function(e){for(var n in e.attributes){var r=e.attributes[n],i=s[n];void 0!==i&&(r.normalized=i)}t(e)}),a,l)}))}))}}]),e}(),lr=function(){function e(){(0,s.Z)(this,e),this.name=Zn.KHR_TEXTURE_TRANSFORM}return(0,l.Z)(e,[{key:"extendTexture",value:function(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}]),e}(),ur=function(e){(0,h.Z)(n,e);var t=(0,d.Z)(n);function n(e){var r;(0,s.Z)(this,n),r=t.call(this),r.isGLTFSpecularGlossinessMaterial=!0;var i=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),o=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),a=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),l=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),c=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),h={specular:{value:(new u.Ilk).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};return r._extraUniforms=h,r.onBeforeCompile=function(e){for(var t in h)e.uniforms[t]=h[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",i).replace("#include <metalnessmap_pars_fragment>",o).replace("#include <roughnessmap_fragment>",a).replace("#include <metalnessmap_fragment>",l).replace("#include <lights_physical_fragment>",c)},Object.defineProperties((0,Un.Z)(r),{specular:{get:function(){return h.specular.value},set:function(e){h.specular.value=e}},specularMap:{get:function(){return h.specularMap.value},set:function(e){h.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return h.glossiness.value},set:function(e){h.glossiness.value=e}},glossinessMap:{get:function(){return h.glossinessMap.value},set:function(e){h.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete r.metalness,delete r.roughness,delete r.metalnessMap,delete r.roughnessMap,r.setValues(e),r}return(0,l.Z)(n,[{key:"copy",value:function(e){return(0,jn.Z)((0,zn.Z)(n.prototype),"copy",this).call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}]),n}(u.Wid),cr=function(){function e(){(0,s.Z)(this,e),this.name=Zn.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}return(0,l.Z)(e,[{key:"getMaterialType",value:function(){return ur}},{key:"extendParams",value:function(e,t,n){var r=t.extensions[this.name];e.color=new u.Ilk(1,1,1),e.opacity=1;var i=[];if(Array.isArray(r.diffuseFactor)){var o=r.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(void 0!==r.diffuseTexture&&i.push(n.assignTexture(e,"map",r.diffuseTexture)),e.emissive=new u.Ilk(0,0,0),e.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,e.specular=new u.Ilk(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){var a=r.specularGlossinessTexture;i.push(n.assignTexture(e,"glossinessMap",a)),i.push(n.assignTexture(e,"specularMap",a))}return Promise.all(i)}},{key:"createMaterial",value:function(e){var t=new ur(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=u.IOt,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}]),e}(),hr=(0,l.Z)((function e(){(0,s.Z)(this,e),this.name=Zn.KHR_MESH_QUANTIZATION})),dr=function(e){(0,h.Z)(n,e);var t=(0,d.Z)(n);function n(e,r,i,o){return(0,s.Z)(this,n),t.call(this,e,r,i,o)}return(0,l.Z)(n,[{key:"copySampleValue_",value:function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r*3+r,o=0;o!==r;o++)t[o]=n[i+o];return t}}]),n}(u._C8);dr.prototype.beforeStart_=dr.prototype.copySampleValue_,dr.prototype.afterEnd_=dr.prototype.copySampleValue_,dr.prototype.interpolate_=function(e,t,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=2*a,l=3*a,u=r-t,c=(n-t)/u,h=c*c,d=h*c,f=e*l,p=f-l,v=-2*d+3*h,m=d-h,y=1-v,g=m-h+c,x=0;x!==a;x++){var b=o[p+x+a],w=o[p+x+s]*u,k=o[f+x+a],A=o[f+x]*u;i[x]=y*b+g*w+v*k+m*A}return i};var fr=new u._fP,pr=function(e){(0,h.Z)(n,e);var t=(0,d.Z)(n);function n(){return(0,s.Z)(this,n),t.apply(this,arguments)}return(0,l.Z)(n,[{key:"interpolate_",value:function(e,t,r,i){var o=(0,jn.Z)((0,zn.Z)(n.prototype),"interpolate_",this).call(this,e,t,r,i);return fr.fromArray(o).normalize().toArray(o),o}}]),n}(dr),vr={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},mr={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},yr={9728:u.TyD,9729:u.wem,9984:u.YLQ,9985:u.qyh,9986:u.aH4,9987:u.D1R},gr={33071:u.uWy,33648:u.OoA,10497:u.rpg},xr={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},br={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},wr={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},kr={CUBICSPLINE:void 0,LINEAR:u.NMF,STEP:u.Syv},Ar={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Sr(e){return void 0===e["DefaultMaterial"]&&(e["DefaultMaterial"]=new u.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:u.Wl3})),e["DefaultMaterial"]}function Mr(e,t,n){for(var r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function Tr(e,t){void 0!==t.extras&&("object"===(0,f.Z)(t.extras)?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function Pr(e,t,n){for(var r=!1,i=!1,o=0,a=t.length;o<a;o++){var s=t[o];if(void 0!==s.POSITION&&(r=!0),void 0!==s.NORMAL&&(i=!0),r&&i)break}if(!r&&!i)return Promise.resolve(e);for(var l=[],u=[],c=0,h=t.length;c<h;c++){var d=t[c];if(r){var f=void 0!==d.POSITION?n.getDependency("accessor",d.POSITION):e.attributes.position;l.push(f)}if(i){var p=void 0!==d.NORMAL?n.getDependency("accessor",d.NORMAL):e.attributes.normal;u.push(p)}}return Promise.all([Promise.all(l),Promise.all(u)]).then((function(t){var n=t[0],o=t[1];return r&&(e.morphAttributes.position=n),i&&(e.morphAttributes.normal=o),e.morphTargetsRelative=!0,e}))}function Cr(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){var i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(var o=0,a=i.length;o<a;o++)e.morphTargetDictionary[i[o]]=o}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Er(e){var t,n=e.extensions&&e.extensions[Zn.KHR_DRACO_MESH_COMPRESSION];return t=n?"draco:"+n.bufferView+":"+n.indices+":"+_r(n.attributes):e.indices+":"+_r(e.attributes)+":"+e.mode,t}function _r(e){for(var t="",n=Object.keys(e).sort(),r=0,i=n.length;r<i;r++)t+=n[r]+":"+e[n[r]]+";";return t}function Ir(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}var Rr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,s.Z)(this,e),this.json=t,this.extensions={},this.plugins={},this.options=n,this.cache=new Gn,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},"undefined"!==typeof createImageBitmap&&!1===/Firefox|^((?!chrome|android).)*safari/i.test(navigator.userAgent)?this.textureLoader=new u.QRU(this.options.manager):this.textureLoader=new u.dpR(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new u.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}return(0,l.Z)(e,[{key:"setExtensions",value:function(e){this.extensions=e}},{key:"setPlugins",value:function(e){this.plugins=e}},{key:"parse",value:function(e,t){var n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){var o={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};Mr(i,o,r),Tr(o,r),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(o)}))).then((function(){e(o)}))})).catch(t)}},{key:"_markDefs",value:function(){for(var e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[],r=0,i=t.length;r<i;r++)for(var o=t[r].joints,a=0,s=o.length;a<s;a++)e[o[a]].isBone=!0;for(var l=0,u=e.length;l<u;l++){var c=e[l];void 0!==c.mesh&&(this._addNodeRef(this.meshCache,c.mesh),void 0!==c.skin&&(n[c.mesh].isSkinnedMesh=!0)),void 0!==c.camera&&this._addNodeRef(this.cameraCache,c.camera)}}},{key:"_addNodeRef",value:function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}},{key:"_getNodeRef",value:function(e,t,n){var r=this;if(e.refs[t]<=1)return n;var i=n.clone(),o=function e(t,n){var i=r.associations.get(t);null!=i&&r.associations.set(n,i);var o,s=(0,a.Z)(t.children.entries());try{for(s.s();!(o=s.n()).done;){var l=(0,w.Z)(o.value,2),u=l[0],c=l[1];e(c,n.children[u])}}catch(h){s.e(h)}finally{s.f()}};return o(n,i),i.name+="_instance_"+e.uses[t]++,i}},{key:"_invokeOne",value:function(e){var t=Object.values(this.plugins);t.push(this);for(var n=0;n<t.length;n++){var r=e(t[n]);if(r)return r}return null}},{key:"_invokeAll",value:function(e){var t=Object.values(this.plugins);t.unshift(this);for(var n=[],r=0;r<t.length;r++){var i=e(t[r]);i&&n.push(i)}return n}},{key:"getDependency",value:function(e,t){var n=e+":"+t,r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":r=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r}},{key:"getDependencies",value:function(e){var t=this.cache.get(e);if(!t){var n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map((function(t,r){return n.getDependency(e,r)}))),this.cache.add(e,t)}return t}},{key:"loadBuffer",value:function(e){var t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[Zn.KHR_BINARY_GLTF].body);var r=this.options;return new Promise((function(e,i){n.load(u.Zp0.resolveURL(t.uri,r.path),e,void 0,(function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}},{key:"loadBufferView",value:function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)}))}},{key:"loadAccessor",value:function(e){var t=this,n=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);var i=[];return void 0!==r.bufferView?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),void 0!==r.sparse&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then((function(e){var i,o,a=e[0],s=xr[r.type],l=mr[r.componentType],c=l.BYTES_PER_ELEMENT,h=c*s,d=r.byteOffset||0,f=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,p=!0===r.normalized;if(f&&f!==h){var v=Math.floor(d/f),m="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+v+":"+r.count,y=t.cache.get(m);y||(i=new l(a,v*f,r.count*f/c),y=new u.vpT(i,f/c),t.cache.add(m,y)),o=new u.kB5(y,s,d%f/c,p)}else i=null===a?new l(r.count*s):new l(a,d,r.count*s),o=new u.TlE(i,s,p);if(void 0!==r.sparse){var g=xr.SCALAR,x=mr[r.sparse.indices.componentType],b=r.sparse.indices.byteOffset||0,w=r.sparse.values.byteOffset||0,k=new x(e[1],b,r.sparse.count*g),A=new l(e[2],w,r.sparse.count*s);null!==a&&(o=new u.TlE(o.array.slice(),o.itemSize,o.normalized));for(var S=0,M=k.length;S<M;S++){var T=k[S];if(o.setX(T,A[S*s]),s>=2&&o.setY(T,A[S*s+1]),s>=3&&o.setZ(T,A[S*s+2]),s>=4&&o.setW(T,A[S*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o}))}},{key:"loadTexture",value:function(e){var t=this.json,n=this.options,r=t.textures[e],i=t.images[r.source],o=this.textureLoader;if(i.uri){var a=n.manager.getHandler(i.uri);null!==a&&(o=a)}return this.loadTextureImage(e,i,o)}},{key:"loadTextureImage",value:function(e,t,n){var r=this,i=this.json,o=this.options,a=i.textures[e],s=(t.uri||t.bufferView)+":"+a.sampler;if(this.textureCache[s])return this.textureCache[s];var l=self.URL||self.webkitURL,c=t.uri||"",h=!1;if(void 0!==t.bufferView)c=r.getDependency("bufferView",t.bufferView).then((function(e){h=!0;var n=new Blob([e],{type:t.mimeType});return c=l.createObjectURL(n),c}));else if(void 0===t.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");var d=Promise.resolve(c).then((function(e){return new Promise((function(t,r){var i=t;!0===n.isImageBitmapLoader&&(i=function(e){var n=new u.xEZ(e);n.needsUpdate=!0,t(n)}),n.load(u.Zp0.resolveURL(e,o.path),i,void 0,r)}))})).then((function(t){!0===h&&l.revokeObjectURL(c),t.flipY=!1,a.name&&(t.name=a.name);var n=i.samplers||{},o=n[a.sampler]||{};return t.magFilter=yr[o.magFilter]||u.wem,t.minFilter=yr[o.minFilter]||u.D1R,t.wrapS=gr[o.wrapS]||u.rpg,t.wrapT=gr[o.wrapT]||u.rpg,r.associations.set(t,{textures:e}),t})).catch((function(){return console.error("THREE.GLTFLoader: Couldn't load texture",c),null}));return this.textureCache[s]=d,d}},{key:"assignTexture",value:function(e,t,n){var r=this;return this.getDependency("texture",n.index).then((function(i){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),r.extensions[Zn.KHR_TEXTURE_TRANSFORM]){var o=void 0!==n.extensions?n.extensions[Zn.KHR_TEXTURE_TRANSFORM]:void 0;if(o){var a=r.associations.get(i);i=r.extensions[Zn.KHR_TEXTURE_TRANSFORM].extendTexture(i,o),r.associations.set(i,a)}}return e[t]=i,i}))}},{key:"assignFinalMaterial",value:function(e){var t=e.geometry,n=e.material,r=void 0===t.attributes.tangent,i=void 0!==t.attributes.color,o=void 0===t.attributes.normal;if(e.isPoints){var a="PointsMaterial:"+n.uuid,s=this.cache.get(a);s||(s=new u.UY4,u.F5T.prototype.copy.call(s,n),s.color.copy(n.color),s.map=n.map,s.sizeAttenuation=!1,this.cache.add(a,s)),n=s}else if(e.isLine){var l="LineBasicMaterial:"+n.uuid,c=this.cache.get(l);c||(c=new u.nls,u.F5T.prototype.copy.call(c,n),c.color.copy(n.color),this.cache.add(l,c)),n=c}if(r||i||o){var h="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(h+="specular-glossiness:"),r&&(h+="derivative-tangents:"),i&&(h+="vertex-colors:"),o&&(h+="flat-shading:");var d=this.cache.get(h);d||(d=n.clone(),i&&(d.vertexColors=!0),o&&(d.flatShading=!0),r&&(d.normalScale&&(d.normalScale.y*=-1),d.clearcoatNormalScale&&(d.clearcoatNormalScale.y*=-1)),this.cache.add(h,d),this.associations.set(d,this.associations.get(n))),n=d}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=n}},{key:"getMaterialType",value:function(){return u.Wid}},{key:"loadMaterial",value:function(e){var t,n=this,r=this.json,i=this.extensions,o=r.materials[e],a={},s=o.extensions||{},l=[];if(s[Zn.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var c=i[Zn.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=c.getMaterialType(),l.push(c.extendParams(a,o,n))}else if(s[Zn.KHR_MATERIALS_UNLIT]){var h=i[Zn.KHR_MATERIALS_UNLIT];t=h.getMaterialType(),l.push(h.extendParams(a,o,n))}else{var d=o.pbrMetallicRoughness||{};if(a.color=new u.Ilk(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){var f=d.baseColorFactor;a.color.fromArray(f),a.opacity=f[3]}void 0!==d.baseColorTexture&&l.push(n.assignTexture(a,"map",d.baseColorTexture)),a.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,a.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(l.push(n.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),l.push(n.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),t=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),l.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,a)}))))}!0===o.doubleSided&&(a.side=u.ehD);var p=o.alphaMode||Ar.OPAQUE;if(p===Ar.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,p===Ar.MASK&&(a.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&t!==u.vBJ&&(l.push(n.assignTexture(a,"normalMap",o.normalTexture)),a.normalScale=new u.FM8(1,1),void 0!==o.normalTexture.scale)){var v=o.normalTexture.scale;a.normalScale.set(v,v)}return void 0!==o.occlusionTexture&&t!==u.vBJ&&(l.push(n.assignTexture(a,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(a.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&t!==u.vBJ&&(a.emissive=(new u.Ilk).fromArray(o.emissiveFactor)),void 0!==o.emissiveTexture&&t!==u.vBJ&&l.push(n.assignTexture(a,"emissiveMap",o.emissiveTexture)),Promise.all(l).then((function(){var r;return r=t===ur?i[Zn.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):new t(a),o.name&&(r.name=o.name),r.map&&(r.map.encoding=u.knz),r.emissiveMap&&(r.emissiveMap.encoding=u.knz),Tr(r,o),n.associations.set(r,{materials:e}),o.extensions&&Mr(i,r,o),r}))}},{key:"createUniqueName",value:function(e){for(var t=u.iUV.sanitizeNodeName(e||""),n=t,r=1;this.nodeNamesUsed[n];++r)n=t+"_"+r;return this.nodeNamesUsed[n]=!0,n}},{key:"loadGeometries",value:function(e){var t=this,n=this.extensions,r=this.primitiveCache;function i(e){return n[Zn.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return Nr(n,e,t)}))}for(var o=[],a=0,s=e.length;a<s;a++){var l=e[a],c=Er(l),h=r[c];if(h)o.push(h.promise);else{var d=void 0;d=l.extensions&&l.extensions[Zn.KHR_DRACO_MESH_COMPRESSION]?i(l):Nr(new u.u9r,l,t),r[c]={primitive:l,promise:d},o.push(d)}}return Promise.all(o)}},{key:"loadMesh",value:function(e){for(var t=this,n=this.json,r=this.extensions,i=n.meshes[e],o=i.primitives,a=[],s=0,l=o.length;s<l;s++){var c=void 0===o[s].material?Sr(this.cache):this.getDependency("material",o[s].material);a.push(c)}return a.push(t.loadGeometries(o)),Promise.all(a).then((function(n){for(var a=n.slice(0,n.length-1),s=n[n.length-1],l=[],c=0,h=s.length;c<h;c++){var d=s[c],f=o[c],p=void 0,v=a[c];if(f.mode===vr.TRIANGLES||f.mode===vr.TRIANGLE_STRIP||f.mode===vr.TRIANGLE_FAN||void 0===f.mode)p=!0===i.isSkinnedMesh?new u.TUv(d,v):new u.Kj0(d,v),!0!==p.isSkinnedMesh||p.geometry.attributes.skinWeight.normalized||p.normalizeSkinWeights(),f.mode===vr.TRIANGLE_STRIP?p.geometry=Or(p.geometry,u.UlW):f.mode===vr.TRIANGLE_FAN&&(p.geometry=Or(p.geometry,u.z$h));else if(f.mode===vr.LINES)p=new u.ejS(d,v);else if(f.mode===vr.LINE_STRIP)p=new u.x12(d,v);else if(f.mode===vr.LINE_LOOP)p=new u.blk(d,v);else{if(f.mode!==vr.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+f.mode);p=new u.woe(d,v)}Object.keys(p.geometry.morphAttributes).length>0&&Cr(p,i),p.name=t.createUniqueName(i.name||"mesh_"+e),Tr(p,i),f.extensions&&Mr(r,p,f),t.assignFinalMaterial(p),l.push(p)}for(var m=0,y=l.length;m<y;m++)t.associations.set(l[m],{meshes:e,primitives:m});if(1===l.length)return l[0];var g=new u.ZAu;t.associations.set(g,{meshes:e});for(var x=0,b=l.length;x<b;x++)g.add(l[x]);return g}))}},{key:"loadCamera",value:function(e){var t,n=this.json.cameras[e],r=n[n.type];if(r)return"perspective"===n.type?t=new u.cPb(u.M8C.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(t=new u.iKG(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Tr(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}},{key:"loadSkin",value:function(e){var t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))}},{key:"loadAnimation",value:function(e){for(var t=this.json,n=t.animations[e],r=[],i=[],o=[],a=[],s=[],l=0,c=n.channels.length;l<c;l++){var h=n.channels[l],d=n.samplers[h.sampler],f=h.target,p=void 0!==f.node?f.node:f.id,v=void 0!==n.parameters?n.parameters[d.input]:d.input,m=void 0!==n.parameters?n.parameters[d.output]:d.output;r.push(this.getDependency("node",p)),i.push(this.getDependency("accessor",v)),o.push(this.getDependency("accessor",m)),a.push(d),s.push(f)}return Promise.all([Promise.all(r),Promise.all(i),Promise.all(o),Promise.all(a),Promise.all(s)]).then((function(t){for(var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=[],c=function(e,t){var n=r[e],c=i[e],h=o[e],d=a[e],f=s[e];if(void 0===n)return"continue";n.updateMatrix(),n.matrixAutoUpdate=!0;var p=void 0;switch(wr[f.path]){case wr.weights:p=u.dUE;break;case wr.rotation:p=u.iLg;break;case wr.position:case wr.scale:default:p=u.yC1;break}var v=n.name?n.name:n.uuid,m=void 0!==d.interpolation?kr[d.interpolation]:u.NMF,y=[];wr[f.path]===wr.weights?n.traverse((function(e){e.morphTargetInfluences&&y.push(e.name?e.name:e.uuid)})):y.push(v);var g=h.array;if(h.normalized){for(var x=Ir(g.constructor),b=new Float32Array(g.length),w=0,k=g.length;w<k;w++)b[w]=g[w]*x;g=b}for(var A=0,S=y.length;A<S;A++){var M=new p(y[A]+"."+wr[f.path],c.array,g,m);"CUBICSPLINE"===d.interpolation&&(M.createInterpolant=function(e){var t=this instanceof u.iLg?pr:dr;return new t(this.times,this.values,this.getValueSize()/3,e)},M.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(M)}},h=0,d=r.length;h<d;h++)c(h,d);var f=n.name?n.name:"animation_"+e;return new u.m7l(f,void 0,l)}))}},{key:"createNodeMesh",value:function(e){var t=this.json,n=this,r=t.nodes[e];return void 0===r.mesh?null:n.getDependency("mesh",r.mesh).then((function(e){var t=n._getNodeRef(n.meshCache,r.mesh,e);return void 0!==r.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,n=r.weights.length;t<n;t++)e.morphTargetInfluences[t]=r.weights[t]})),t}))}},{key:"loadNode",value:function(e){var t=this.json,n=this.extensions,r=this,i=t.nodes[e],o=i.name?r.createUniqueName(i.name):"";return function(){var t=[],n=r._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return n&&t.push(n),void 0!==i.camera&&t.push(r.getDependency("camera",i.camera).then((function(e){return r._getNodeRef(r.cameraCache,i.camera,e)}))),r._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(t){var a;if(a=!0===i.isBone?new u.N$j:t.length>1?new u.ZAu:1===t.length?t[0]:new u.Tme,a!==t[0])for(var s=0,l=t.length;s<l;s++)a.add(t[s]);if(i.name&&(a.userData.name=i.name,a.name=o),Tr(a,i),i.extensions&&Mr(n,a,i),void 0!==i.matrix){var c=new u.yGw;c.fromArray(i.matrix),a.applyMatrix4(c)}else void 0!==i.translation&&a.position.fromArray(i.translation),void 0!==i.rotation&&a.quaternion.fromArray(i.rotation),void 0!==i.scale&&a.scale.fromArray(i.scale);return r.associations.has(a)||r.associations.set(a,{}),r.associations.get(a).nodes=e,a}))}},{key:"loadScene",value:function(e){var t=this.json,n=this.extensions,r=this.json.scenes[e],i=this,o=new u.ZAu;r.name&&(o.name=i.createUniqueName(r.name)),Tr(o,r),r.extensions&&Mr(n,o,r);for(var s=r.nodes||[],l=[],c=0,h=s.length;c<h;c++)l.push(Lr(s[c],o,t,i));return Promise.all(l).then((function(){var e=function(e){var t,n=new Map,r=(0,a.Z)(i.associations);try{for(r.s();!(t=r.n()).done;){var o=(0,w.Z)(t.value,2),s=o[0],l=o[1];(s instanceof u.F5T||s instanceof u.xEZ)&&n.set(s,l)}}catch(c){r.e(c)}finally{r.f()}return e.traverse((function(e){var t=i.associations.get(e);null!=t&&n.set(e,t)})),n};return i.associations=e(o),o}))}}]),e}();function Lr(e,t,n,r){var i=n.nodes[e];return r.getDependency("node",e).then((function(e){return void 0===i.skin?e:r.getDependency("skin",i.skin).then((function(e){t=e;for(var n=[],i=0,o=t.joints.length;i<o;i++)n.push(r.getDependency("node",t.joints[i]));return Promise.all(n)})).then((function(n){return e.traverse((function(e){if(e.isMesh){for(var r=[],i=[],o=0,a=n.length;o<a;o++){var s=n[o];if(s){r.push(s);var l=new u.yGw;void 0!==t.inverseBindMatrices&&l.fromArray(t.inverseBindMatrices.array,16*o),i.push(l)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[o])}e.bind(new u.OdW(r,i),e.matrixWorld)}})),e}));var t})).then((function(e){t.add(e);var o=[];if(i.children)for(var a=i.children,s=0,l=a.length;s<l;s++){var u=a[s];o.push(Lr(u,e,n,r))}return Promise.all(o)}))}function Br(e,t,n){var r=t.attributes,i=new u.ZzF;if(void 0!==r.POSITION){var o=n.json.accessors[r.POSITION],a=o.min,s=o.max;if(void 0!==a&&void 0!==s){if(i.set(new u.Pa4(a[0],a[1],a[2]),new u.Pa4(s[0],s[1],s[2])),o.normalized){var l=Ir(mr[o.componentType]);i.min.multiplyScalar(l),i.max.multiplyScalar(l)}var c=t.targets;if(void 0!==c){for(var h=new u.Pa4,d=new u.Pa4,f=0,p=c.length;f<p;f++){var v=c[f];if(void 0!==v.POSITION){var m=n.json.accessors[v.POSITION],y=m.min,g=m.max;if(void 0!==y&&void 0!==g){if(d.setX(Math.max(Math.abs(y[0]),Math.abs(g[0]))),d.setY(Math.max(Math.abs(y[1]),Math.abs(g[1]))),d.setZ(Math.max(Math.abs(y[2]),Math.abs(g[2]))),m.normalized){var x=Ir(mr[m.componentType]);d.multiplyScalar(x)}h.max(d)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(h)}e.boundingBox=i;var b=new u.aLr;i.getCenter(b.center),b.radius=i.min.distanceTo(i.max)/2,e.boundingSphere=b}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}function Nr(e,t,n){var r=t.attributes,i=[];function o(t,r){return n.getDependency("accessor",t).then((function(t){e.setAttribute(r,t)}))}for(var a in r){var s=br[a]||a.toLowerCase();s in e.attributes||i.push(o(r[a],s))}if(void 0!==t.indices&&!e.index){var l=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));i.push(l)}return Tr(e,t),Br(e,t,n),Promise.all(i).then((function(){return void 0!==t.targets?Pr(e,t.targets,n):e}))}function Or(e,t){var n=e.getIndex();if(null===n){var r=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var o=0;o<i.count;o++)r.push(o);e.setIndex(r),n=e.getIndex()}var a=n.count-2,s=[];if(t===u.z$h)for(var l=1;l<=a;l++)s.push(n.getX(0)),s.push(n.getX(l)),s.push(n.getX(l+1));else for(var c=0;c<a;c++)c%2===0?(s.push(n.getX(c)),s.push(n.getX(c+1)),s.push(n.getX(c+2))):(s.push(n.getX(c+2)),s.push(n.getX(c+1)),s.push(n.getX(c)));s.length/3!==a&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var h=e.clone();return h.setIndex(s),h}
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
var Vr=function(e,t,n,r){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function a(e){try{l(r.next(e))}catch(Xo){o(Xo)}}function s(e){try{l(r["throw"](e))}catch(Xo){o(Xo)}}function l(e){e.done?n(e.value):i(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))},Dr=function(){function e(t,n){(0,s.Z)(this,e),this.cache=t,this.textureAnisotropy=n}return(0,l.Z)(e,[{key:"fileLoader",get:function(){return this._fileLoader||(this._fileLoader=new u.hH6),this._fileLoader}},{key:"imageLoader",get:function(){return this._imgLoader||(this._imgLoader=new u.S3k),this._imgLoader}},{key:"svgLoader",get:function(){return this._svgLoader||(this._svgLoader=new k),this._svgLoader}},{key:"textureLoader",get:function(){return this._textureLoader||(this._textureLoader=new u.dpR),this._textureLoader}},{key:"objectLoader",get:function(){return this._objectLoader||(this._objectLoader=new u.Gql),this._objectLoader}},{key:"gltfLoader",get:function(){return this._gltfLoader||(this._gltfLoader=new Hn),this._gltfLoader}},{key:"fbxLoader",get:function(){return this._fbxLoader||(this._fbxLoader=new yn),this._fbxLoader}},{key:"preload",value:function(e,t){return Vr(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r=this;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return this.cache.add(e,t),n.abrupt("return",new Promise((function(e){var n=/\.fbx$|\.glb$|\.gltf$/.test(t),i=/\.jpe?g$|\.png$/.test(t);i?r.textureLoader.load(t,(function(t){return e(t)})):(n&&r.fileLoader.setResponseType("arraybuffer"),r.fileLoader.load(t,(function(t){return e(t)})))})));case 2:case"end":return n.stop()}}),n,this)})))}},{key:"textureAtlas",value:function(e,t){return Vr(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,i,o,a,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.t0=JSON,n.next=3,this.file(t);case 3:return n.t1=n.sent,r=n.t0.parse.call(n.t0,n.t1),i=r.textures,i&&(o=r.textures[0].frames,a={frames:{}},o.forEach((function(e){a=Object.assign(Object.assign({},a),{frames:Object.assign(Object.assign({},a.frames),(0,B.Z)({},e.filename,{frame:e.frame,rotated:e.rotated,sourceSize:e.sourceSize,spriteSourceSize:e.spriteSourceSize,trimmed:e.trimmed}))})})),r=a),n.next=9,this.texture(e);case 9:return n.t2=n.sent,n.t3=r,s={texture:n.t2,json:n.t3},n.abrupt("return",s);case 13:case"end":return n.stop()}}),n,this)})))}},{key:"file",value:function(e){var t=this,n=this.cache.get(e);return e=n||e,new Promise((function(n){t.fileLoader.load(e,(function(e){return n(e)}))}))}},{key:"svg",value:function(e){var t=this,n=this.cache.get(e);return e=n||e,new Promise((function(n){t.svgLoader.load(e,(function(e){return n(e)}))}))}},{key:"texture",value:function(e){var t=this,n=/^data:image\/[\S]+;base64,/gm.test(e);if(!n){var r=this.cache.get(e);e=r||e}return new Promise((function(n){t.textureLoader.load(e,(function(e){e.anisotropy=t.textureAnisotropy,e.needsUpdate=!0,n(e)}))}))}},{key:"object",value:function(e){var t=this,n=this.cache.get(e);return e=n||e,new Promise((function(n){t.objectLoader.load(e,(function(e){n(e)}))}))}},{key:"gltf",value:function(e){var t=this,n=this.cache.get(e);return e=n||e,new Promise((function(n){t.gltfLoader.load(e,(function(e){n(e)}))}))}},{key:"fbx",value:function(e){var t=this,n=this.cache.get(e);return e=n||e,new Promise((function(n){t.fbxLoader.load(e,(function(e){n(e)}))}))}}]),e}(),Fr=function(e){(0,h.Z)(n,e);var t=(0,d.Z)(n);function n(e,r,i,o){var a;return(0,s.Z)(this,n),a=t.call(this),a.scene=e,a.light=r,a.size=i,a.color=o,a.geo=new u.Aip(i||.2,16,8),a.mat=new u.vBJ({color:o||r.color}),a.mesh=new u.Kj0(a.geo,a.mat),a.add(a.mesh),r.add((0,Un.Z)(a)),a}return(0,l.Z)(n,[{key:"dispose",value:function(){this.mesh.geometry.dispose(),Array.isArray(this.mesh.material)?this.mesh.material.forEach((function(e){return e.dispose()})):this.mesh.material.dispose(),this.remove(this.mesh)}},{key:"update",value:function(){}}]),n}(u.Tme),Ur=function(){function e(t){(0,s.Z)(this,e),this.scene=t}return(0,l.Z)(e,[{key:"helper",get:function(){var e=this;return{directionalLightHelper:function(t,n,r){var i=new u.cBI(t,n,r);return e.scene.add(i),i},spotLightHelper:function(t,n){var r=new u.FvO(t,n);return e.scene.add(r),r},pointLightHelper:function(t,n,r){return new Fr(e.scene,t,n,r)}}}},{key:"directionalLight",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.color,n=void 0===t?16777215:t,r=e.intensity,i=void 0===r?1:r,o=new u.Ox3(n,i);return o.castShadow=!0,this.scene.add(o),o}},{key:"hemisphereLight",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.skyColor,n=void 0===t?16777215:t,r=e.groundColor,i=void 0===r?16777215:r,o=e.intensity,a=void 0===o?1:o,s=new u.vmT(n,i,a);return this.scene.add(s),s}},{key:"ambientLight",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.color,n=void 0===t?16777215:t,r=e.intensity,i=void 0===r?1:r,o=new u.Mig(n,i);return this.scene.add(o),o}},{key:"pointLight",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.color,n=void 0===t?16777215:t,r=e.intensity,i=void 0===r?1:r,o=e.distance,a=void 0===o?0:o,s=e.decay,l=void 0===s?1:s,c=new u.cek(n,i,a,l);return c.castShadow=!0,this.scene.add(c),c}},{key:"spotLight",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.color,n=void 0===t?16777215:t,r=e.intensity,i=void 0===r?1:r,o=e.distance,a=void 0===o?0:o,s=e.angle,l=void 0===s?Math.PI/8:s,c=e.penumbra,h=void 0===c?0:c,d=e.decay,f=void 0===d?1:d,p=new u.PMe(n,i,a,l,h,f);return p.castShadow=!0,this.scene.add(p),p}},{key:"rectAreaLight",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.color,n=void 0===t?16777215:t,r=e.intensity,i=void 0===r?1:r,o=e.width,a=void 0===o?10:o,s=e.height,l=void 0===s?10:s,c=new u.T_f(n,i,a,l);return this.scene.add(c),c}}]),e}(),jr=(n(2526),function(e){(0,h.Z)(n,e);var t=(0,d.Z)(n);function n(e,r){var i;return(0,s.Z)(this,n),i=t.call(this,e,r),i.isExtendedMesh=!0,i.isGroup=!1,i.vector3=new u.Pa4,i.hasBody=!1,i.fragmentDepth=0,i.breakable=!1,i.fractureImpulse=1,i.name="object-".concat(i.id),i}return(0,l.Z)(n,[{key:"world",get:function(){return{theta:this.worldTheta,phi:this.worldPhi}}},{key:"worldTheta",get:function(){return this.getWorldDirection(this.vector3),Math.atan2(this.vector3.x,this.vector3.z)}},{key:"worldPhi",get:function(){return this.getWorldDirection(this.vector3),Math.acos(this.vector3.y)}}]),n}(u.Kj0)),zr=new Map,Hr=5,Gr=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(zr.has(e)){var n=zr.get(e);if("undefined"===typeof n)return;if(n>=Hr)return;zr.set(e,n+1)}else zr.set(e,1);t?console.error("%c [enable3d] ".concat(e," "),"background: #222; color: #bada55"):console.warn("%c [enable3d] ".concat(e," "),"background: #222; color: #bada55")},Zr=function(){function e(){(0,s.Z)(this,e),this._defaultMaterial=new u.YBo({color:13421772})}return(0,l.Z)(e,[{key:"get",value:function(){return this._defaultMaterial}}]),e}(),Wr=Zr,Xr=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},qr=function(){function e(t){(0,s.Z)(this,e),this.scene=t,this.isHeadless="headless"===t,this.defaultMaterial=new Wr}return(0,l.Z)(e,[{key:"make",get:function(){var e=this;return{plane:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.makePlane(t,n)},box:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.makeBox(t,n)},sphere:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.makeSphere(t,n)},cylinder:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.makeCylinder(t,n)},cone:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.makeCone(t,n)},torus:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.makeTorus(t,n)},extrude:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.makeExtrude(t,n)}}}},{key:"add",get:function(){var e=this;return{mesh:function(t){return e.addMesh(t)},existing:function(t){return e.addExisting(t)},plane:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.addPlane(t,n)},box:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.addBox(t,n)},ground:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.addGround(t,n)},sphere:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.addSphere(t,n)},cylinder:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.addCylinder(t,n)},cone:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.addCone(t,n)},torus:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.addTorus(t,n)},extrude:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.addExtrude(t,n)},material:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.addMaterial(t)}}}},{key:"addExisting",value:function(){var e;"headless"!==this.scene&&(e=this.scene).add.apply(e,arguments)}},{key:"addMesh",value:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.addExisting(e[t]);else this.addExisting(e);return this}},{key:"createMesh",value:function(e,t,n){var r,i=n.x,o=void 0===i?0:i,a=n.y,s=void 0===a?0:a,l=n.z,c=void 0===l?0:l;switch(!Array.isArray(t)&&t.type){case"LineBasicMaterial":r=new u.x12(e,t);break;case"PointsMaterial":r=new u.woe(e,t);break;default:r=new jr(e,t);break}return r.position.set(o,s,c),r.castShadow=r.receiveShadow=!0,r}},{key:"makeExtrude",value:function(e,t){var n=e.x,r=e.y,i=e.z,o=e.name,a=e.shape,s=e.autoCenter,l=void 0===s||s,c=(e.breakable,Xr(e,["x","y","z","name","shape","autoCenter","breakable"])),h=c.depth,d=void 0===h?1:h,f=c.bevelEnabled,p=void 0!==f&&f,v=new u.$Vf(a,Object.assign({depth:d,bevelEnabled:p},c)),m=this.addMaterial(t),y=this.createMesh(v,m,{x:n,y:r,z:i});return l&&y.geometry.center(),y.name=o||"body_id_".concat(y.id),y.shape="extrude",y}},{key:"addExtrude",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.makeExtrude(e,t);return this.addExisting(n),n}},{key:"makePlane",value:function(e,t){var n=e.x,r=e.y,i=e.z,o=e.name,a=(e.breakable,Xr(e,["x","y","z","name","breakable"])),s=new u.BKK(a.width||1,a.height||1,a.widthSegments||1,a.heightSegments||1),l=this.addMaterial(t);l.side=u.ehD;var c=this.createMesh(s,l,{x:n,y:r,z:i});return c.name=o||"body_id_".concat(c.id),c.shape="plane",c}},{key:"addPlane",value:function(e,t){var n=this.makePlane(e,t);return this.addExisting(n),n}},{key:"makeSphere",value:function(e,t){var n=e.x,r=e.y,i=e.z,o=e.name,a=(e.breakable,Xr(e,["x","y","z","name","breakable"])),s=new u.Aip(a.radius||1,a.widthSegments||16,a.heightSegments||12,a.phiStart||void 0,a.phiLength||void 0,a.thetaStart||void 0,a.thetaLength||void 0),l=this.addMaterial(t),c=this.createMesh(s,l,{x:n,y:r,z:i});return c.name=o||"body_id_".concat(c.id),c.shape="sphere",c}},{key:"addSphere",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.makeSphere(e,t);return this.addExisting(n),n}},{key:"makeBox",value:function(e,t){var n=e.x,r=e.y,i=e.z,o=e.name,a=(e.breakable,Xr(e,["x","y","z","name","breakable"])),s=new u.nvb(a.width||1,a.height||1,a.depth||1,a.widthSegments||void 0,a.heightSegments||void 0,a.depthSegments||void 0),l=this.addMaterial(t),c=this.createMesh(s,l,{x:n,y:r,z:i});return c.name=o||"body_id_".concat(c.id),c.shape="box",c}},{key:"addBox",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.makeBox(e,t);return this.addExisting(n),n}},{key:"addGround",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.makeBox(e,t);return n.rotateX(u.M8C.degToRad(90)),this.addExisting(n),n}},{key:"makeCylinder",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.x,r=e.y,i=e.z,o=e.name,a=(e.breakable,Xr(e,["x","y","z","name","breakable"])),s=new u.m_w(a.radiusTop||1,a.radiusBottom||1,a.height||1,a.radiusSegments||void 0,a.heightSegments||void 0,a.openEnded||void 0,a.thetaStart||void 0,a.thetaLength||void 0),l=this.addMaterial(t),c=this.createMesh(s,l,{x:n,y:r,z:i});return c.name=o||"body_id_".concat(c.id),c.shape="cylinder",c}},{key:"addCylinder",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.makeCylinder(e,t);return this.addExisting(n),n}},{key:"makeCone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.x,r=e.y,i=e.z,o=e.name,a=(e.breakable,Xr(e,["x","y","z","name","breakable"])),s=new u._3(a.radius||1,a.height||1,a.radiusSegments||8,a.heightSegments||1,a.openEnded||!1,a.thetaStart||0,a.thetaLength||2*Math.PI),l=this.addMaterial(t),c=this.createMesh(s,l,{x:n,y:r,z:i});return c.name=o||"body_id_".concat(c.id),c.shape="cone",c}},{key:"addCone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.makeCone(e,t);return this.addExisting(n),n}},{key:"makeTorus",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.x,r=e.y,i=e.z,o=e.name,a=(e.breakable,Xr(e,["x","y","z","name","breakable"])),s=new u.Cne(a.radius||void 0,a.tube||void 0,a.radialSegments||void 0,a.tubularSegments||void 0,a.arc||void 0),l=this.addMaterial(t),c=this.createMesh(s,l,{x:n,y:r,z:i});return c.name=o||"body_id_".concat(c.id),c.shape="torus",c}},{key:"addTorus",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.makeTorus(e,t);return this.addExisting(n),n}},{key:"addMaterial",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.keys(t)[0];if("headless"===this.scene)return this.defaultMaterial.get();switch(n){case"basic":e=new u.vBJ(t.basic);break;case"normal":e=new u.RSm(t.normal);break;case"standard":e=new u.Wid(t.standard);break;case"lambert":e=new u.YBo(t.lambert);break;case"phong":e=new u.xoR(t.phong);break;case"physical":"undefined"!==typeof t.physical?e=new u.EJi(t.physical):(Gr("You need to pass parameters to the physical material. (Fallback to default material)"),e=this.defaultMaterial.get());break;case"toon":e=new u.IKL(t.toon);break;case"line":e=new u.nls(t.line);break;case"points":e=new u.UY4(t.points);break;case"custom":e=t.custom||this.defaultMaterial.get();break;default:e=this.defaultMaterial.get();break}return e}}]),e}(),Kr=function(){function e(t){(0,s.Z)(this,e),this.scene=t}return(0,l.Z)(e,[{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.make(e,t);return n?this.scene.add(n):console.warn("Could not make heightmap"),n}},{key:"make",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.image,r=n.width,i=n.height,o=t.colorScale,a=document.createElement("canvas");a.width=r,a.height=i;var s=a.getContext("2d");if(s){s.drawImage(e.image,0,0);var l=s.getImageData(0,0,r,i),c=(new y).fromBufferGeometry(new u.BKK(10,10,r-1,i-1)),h={color:13421772,side:u.ehD};o&&(h=Object.assign(Object.assign({},h),{vertexColors:!0}));var d=new u.xoR(h),f=new jr(c,d);f.receiveShadow=f.castShadow=!0,f.shape="concave";for(var p=f.geometry,v=0;v<p.vertices.length;v++)p.vertices[v].z=l.data[4*v]/120;var m=function(e,t){var n=e.vertices[t.a].z,r=e.vertices[t.b].z,i=e.vertices[t.c].z;return Math.max(n,r,i)};return o&&p.faces.forEach((function(e){return e.color=new u.Ilk(o(m(p,e)).hex())})),f.rotateX(-Math.PI/2),f.updateMatrix(),c.computeFaceNormals(),c.computeVertexNormals(),f.name="heightmap",f.geometry=S(new u.u9r,f.geometry),f}}}]),e}(),Yr=n(3448),Qr=function(e,t,n,r){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function a(e){try{l(r.next(e))}catch(Xo){o(Xo)}}function s(e){try{l(r["throw"](e))}catch(Xo){o(Xo)}}function l(e){e.done?n(e.value):i(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))},Jr=function(){function e(t,n,r,i,o,a,l){(0,s.Z)(this,e),this.scene=t,this.renderer=n,this.camera=r,this.lights=i,this.physics=o,this.load=a,this.factories=l}return(0,l.Z)(e,[{key:"warpSpeed",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Qr(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,r,i,o,a,s,l,c,h,d,f,p,v,m,y,g,x,b,w,k,A,S,M;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n={},r=t.filter((function(e){return/^-\w+/.test(e)})),i=r.length>0,(0===t.length||i)&&(t=["light","camera","lookAtCenter","ground","grid","orbitControls","fog","sky"]),i&&(o=r.map((function(e){return e.substr(1)})),o.forEach((function(e){var n=t.indexOf(e);t.splice(n,1)}))),t.includes("sky")&&(a=["varying vec3 vWorldPosition;","","void main() {","","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","","}"].join("\n"),s=["uniform vec3 topColor;","uniform vec3 bottomColor;","uniform float offset;","uniform float exponent;","","varying vec3 vWorldPosition;","","void main() {","","float h = normalize( vWorldPosition + offset ).y;","gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h , 0.0), exponent ), 0.0 ) ), 1.0 );","","}"].join("\n"),l={topColor:{value:new u.Ilk(30719)},bottomColor:{value:new u.Ilk(15595007)},offset:{value:33},exponent:{value:.6}},c=new u.Aip(500,32,15),h=new u.jyz({uniforms:l,vertexShader:a,fragmentShader:s,side:u._Li}),d=new u.Kj0(c,h),this.scene.add(d)),t.includes("camera")&&(this.camera.position.set(0,6,12),n=Object.assign({camera:this.camera},n)),t.includes("light")&&(f=.4,p=this.lights.hemisphereLight({skyColor:16777215,groundColor:0,intensity:f}),v=this.lights.ambientLight({color:16777215,intensity:f}),m=this.lights.directionalLight({color:16777215,intensity:f}),m.position.set(100,200,50),y=20,m.shadow.camera.top=y,m.shadow.camera.bottom=-y,m.shadow.camera.left=-y,m.shadow.camera.right=y,m.shadow.mapSize.set(1024,1024),g={ambientLight:v,directionalLight:m,hemisphereLight:p},n=Object.assign({lights:g},n)),t.includes("lookAtCenter")&&this.camera.lookAt(this.scene.position),!t.includes("ground")){e.next=22;break}return x=t.includes("grid"),b="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOnAAADusBZ+q87AAAAJtJREFUeJzt0EENwDAAxLDbNP6UOxh+NEYQ5dl2drFv286598GrA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAu37AD8eaBH5JQdVbAAAAAElFTkSuQmCC",e.next=14,this.load.texture(b);case 14:w=e.sent,w.wrapS=w.wrapT=u.rpg,w.repeat.set(21,21),k={name:"ground",width:21,height:21,depth:1,y:-.5},A={phong:{map:x?w:null,color:16777215}},window.__loadPhysics?(S=this.physics.add.ground(k,A),S.body.setRestitution(1)):S=this.factories.add.ground(k,A),S.receiveShadow=!0,n=Object.assign({ground:S},n);case 22:return t.includes("orbitControls")&&(M=new Yr.z(this.camera,document.getElementById("enable3d-phaser-canvas")||this.renderer.domElement),n=Object.assign({orbitControls:M},n)),e.abrupt("return",n);case 24:case"end":return e.stop()}}),e,this)})))}}]),e}(),$r=function(){function e(){(0,s.Z)(this,e),this._mixers=[]}return(0,l.Z)(e,[{key:"animationMixer",value:function(e){var t=new u.Xcj(e);return this.mixers.add(t),t}},{key:"mixers",get:function(){var e=this;return{create:function(t){return e.animationMixer(t)},add:function(t){return e._mixers.push(t)},get:function(){return e._mixers},update:function(t){var n;return null===(n=e._mixers)||void 0===n?void 0:n.forEach((function(e){return e.update(t/1e3)}))}}}}]),e}(),ei=$r,ti=(n(2420),function(e){(0,h.Z)(n,e);var t=(0,d.Z)(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,s.Z)(this,n),r=t.call(this,e),r.type="Reflector";var o=(0,Un.Z)(r),a=void 0!==i.color?new u.Ilk(i.color):new u.Ilk(8355711),l=i.textureWidth||512,c=i.textureHeight||512,h=i.clipBias||0,d=i.shader||n.ReflectorShader,f=new u.JOQ,p=new u.Pa4,v=new u.Pa4,m=new u.Pa4,y=new u.yGw,g=new u.Pa4(0,0,-1),x=new u.Ltg,b=new u.Pa4,w=new u.Pa4,k=new u.Ltg,A=new u.yGw,S=new u.cPb,M=new u.dd2(l,c),T=new u.jyz({uniforms:u.rDY.clone(d.uniforms),fragmentShader:d.fragmentShader,vertexShader:d.vertexShader});return T.uniforms["tDiffuse"].value=M.texture,T.uniforms["color"].value=a,T.uniforms["textureMatrix"].value=A,r.material=T,r.onBeforeRender=function(e,t,n){if(v.setFromMatrixPosition(o.matrixWorld),m.setFromMatrixPosition(n.matrixWorld),y.extractRotation(o.matrixWorld),p.set(0,0,1),p.applyMatrix4(y),b.subVectors(v,m),!(b.dot(p)>0)){b.reflect(p).negate(),b.add(v),y.extractRotation(n.matrixWorld),g.set(0,0,-1),g.applyMatrix4(y),g.add(m),w.subVectors(v,g),w.reflect(p).negate(),w.add(v),S.position.copy(b),S.up.set(0,1,0),S.up.applyMatrix4(y),S.up.reflect(p),S.lookAt(w),S.far=n.far,S.updateMatrixWorld(),S.projectionMatrix.copy(n.projectionMatrix),A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),A.multiply(S.projectionMatrix),A.multiply(S.matrixWorldInverse),A.multiply(o.matrixWorld),f.setFromNormalAndCoplanarPoint(p,v),f.applyMatrix4(S.matrixWorldInverse),x.set(f.normal.x,f.normal.y,f.normal.z,f.constant);var r=S.projectionMatrix;k.x=(Math.sign(x.x)+r.elements[8])/r.elements[0],k.y=(Math.sign(x.y)+r.elements[9])/r.elements[5],k.z=-1,k.w=(1+r.elements[10])/r.elements[14],x.multiplyScalar(2/x.dot(k)),r.elements[2]=x.x,r.elements[6]=x.y,r.elements[10]=x.z+1-h,r.elements[14]=x.w,M.texture.encoding=e.outputEncoding,o.visible=!1;var i=e.getRenderTarget(),a=e.xr.enabled,s=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(M),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,S),e.xr.enabled=a,e.shadowMap.autoUpdate=s,e.setRenderTarget(i);var l=n.viewport;void 0!==l&&e.state.viewport(l),o.visible=!0}},r.getRenderTarget=function(){return M},r.dispose=function(){M.dispose(),o.material.dispose()},r}return(0,l.Z)(n)}(u.Kj0));ti.prototype.isReflector=!0,ti.ReflectorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:"\n\t\tuniform mat4 textureMatrix;\n\t\tvarying vec4 vUv;\n\n\t\t#include <common>\n\t\t#include <logdepthbuf_pars_vertex>\n\n\t\tvoid main() {\n\n\t\t\tvUv = textureMatrix * vec4( position, 1.0 );\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t\t#include <logdepthbuf_vertex>\n\n\t\t}",fragmentShader:"\n\t\tuniform vec3 color;\n\t\tuniform sampler2D tDiffuse;\n\t\tvarying vec4 vUv;\n\n\t\t#include <logdepthbuf_pars_fragment>\n\n\t\tfloat blendOverlay( float base, float blend ) {\n\n\t\t\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n\n\t\t}\n\n\t\tvec3 blendOverlay( vec3 base, vec3 blend ) {\n\n\t\t\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#include <logdepthbuf_fragment>\n\n\t\t\tvec4 base = texture2DProj( tDiffuse, vUv );\n\t\t\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );\n\n\t\t}"};var ni=function(e){(0,h.Z)(n,e);var t=(0,d.Z)(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,s.Z)(this,n),r=t.call(this,e),r.type="Refractor";var o=(0,Un.Z)(r),a=void 0!==i.color?new u.Ilk(i.color):new u.Ilk(8355711),l=i.textureWidth||512,c=i.textureHeight||512,h=i.clipBias||0,d=i.shader||n.RefractorShader,f=new u.cPb;f.matrixAutoUpdate=!1,f.userData.refractor=!0;var p=new u.JOQ,v=new u.yGw,m=new u.dd2(l,c);r.material=new u.jyz({uniforms:u.rDY.clone(d.uniforms),vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,transparent:!0}),r.material.uniforms["color"].value=a,r.material.uniforms["tDiffuse"].value=m.texture,r.material.uniforms["textureMatrix"].value=v;var y=function(){var e=new u.Pa4,t=new u.Pa4,n=new u.yGw,r=new u.Pa4,i=new u.Pa4;return function(a){return e.setFromMatrixPosition(o.matrixWorld),t.setFromMatrixPosition(a.matrixWorld),r.subVectors(e,t),n.extractRotation(o.matrixWorld),i.set(0,0,1),i.applyMatrix4(n),r.dot(i)<0}}(),g=function(){var e=new u.Pa4,t=new u.Pa4,n=new u._fP,r=new u.Pa4;return function(){o.matrixWorld.decompose(t,n,r),e.set(0,0,1).applyQuaternion(n).normalize(),e.negate(),p.setFromNormalAndCoplanarPoint(e,t)}}(),x=function(){var e=new u.JOQ,t=new u.Ltg,n=new u.Ltg;return function(r){f.matrixWorld.copy(r.matrixWorld),f.matrixWorldInverse.copy(f.matrixWorld).invert(),f.projectionMatrix.copy(r.projectionMatrix),f.far=r.far,e.copy(p),e.applyMatrix4(f.matrixWorldInverse),t.set(e.normal.x,e.normal.y,e.normal.z,e.constant);var i=f.projectionMatrix;n.x=(Math.sign(t.x)+i.elements[8])/i.elements[0],n.y=(Math.sign(t.y)+i.elements[9])/i.elements[5],n.z=-1,n.w=(1+i.elements[10])/i.elements[14],t.multiplyScalar(2/t.dot(n)),i.elements[2]=t.x,i.elements[6]=t.y,i.elements[10]=t.z+1-h,i.elements[14]=t.w}}();function b(e){v.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),v.multiply(e.projectionMatrix),v.multiply(e.matrixWorldInverse),v.multiply(o.matrixWorld)}function w(e,t,n){o.visible=!1;var r=e.getRenderTarget(),i=e.xr.enabled,a=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(m),!1===e.autoClear&&e.clear(),e.render(t,f),e.xr.enabled=i,e.shadowMap.autoUpdate=a,e.setRenderTarget(r);var s=n.viewport;void 0!==s&&e.state.viewport(s),o.visible=!0}return r.onBeforeRender=function(e,t,n){m.texture.encoding=e.outputEncoding,!0!==n.userData.refractor&&!0!==!y(n)&&(g(),b(n),x(n),w(e,t,n))},r.getRenderTarget=function(){return m},r.dispose=function(){m.dispose(),o.material.dispose()},r}return(0,l.Z)(n)}(u.Kj0);ni.prototype.isRefractor=!0,ni.RefractorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:"\n\n\t\tuniform mat4 textureMatrix;\n\n\t\tvarying vec4 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = textureMatrix * vec4( position, 1.0 );\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform vec3 color;\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec4 vUv;\n\n\t\tfloat blendOverlay( float base, float blend ) {\n\n\t\t\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n\n\t\t}\n\n\t\tvec3 blendOverlay( vec3 base, vec3 blend ) {\n\n\t\t\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvec4 base = texture2DProj( tDiffuse, vUv );\n\t\t\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );\n\n\t\t}"};var ri=function(e){(0,h.Z)(n,e);var t=(0,d.Z)(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,s.Z)(this,n),r=t.call(this,e),r.type="Water";var o=(0,Un.Z)(r),a=void 0!==i.color?new u.Ilk(i.color):new u.Ilk(16777215),l=i.textureWidth||512,h=i.textureHeight||512,d=i.clipBias||0,f=i.flowDirection||new u.FM8(1,0),p=i.flowSpeed||.03,v=i.reflectivity||.02,m=i.scale||1,y=i.shader||n.WaterShader,g=new u.dpR,x=i.flowMap||void 0,b=i.normalMap0||g.load("textures/water/Water_1_M_Normal.jpg"),w=i.normalMap1||g.load("textures/water/Water_2_M_Normal.jpg"),k=.15,A=.5*k,S=new u.yGw,M=new u.SUY;if(void 0===ti)return console.error("THREE.Water: Required component Reflector not found."),(0,c.Z)(r);if(void 0===ni)return console.error("THREE.Water: Required component Refractor not found."),(0,c.Z)(r);var T=new ti(e,{textureWidth:l,textureHeight:h,clipBias:d}),P=new ni(e,{textureWidth:l,textureHeight:h,clipBias:d});function C(e){S.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),S.multiply(e.projectionMatrix),S.multiply(e.matrixWorldInverse),S.multiply(o.matrixWorld)}function E(){var e=M.getDelta(),t=o.material.uniforms["config"];t.value.x+=p*e,t.value.y=t.value.x+A,t.value.x>=k?(t.value.x=0,t.value.y=A):t.value.y>=k&&(t.value.y=t.value.y-k)}return T.matrixAutoUpdate=!1,P.matrixAutoUpdate=!1,r.material=new u.jyz({uniforms:u.rDY.merge([u.rBU.fog,y.uniforms]),vertexShader:y.vertexShader,fragmentShader:y.fragmentShader,transparent:!0,fog:!0}),void 0!==x?(r.material.defines.USE_FLOWMAP="",r.material.uniforms["tFlowMap"]={type:"t",value:x}):r.material.uniforms["flowDirection"]={type:"v2",value:f},b.wrapS=b.wrapT=u.rpg,w.wrapS=w.wrapT=u.rpg,r.material.uniforms["tReflectionMap"].value=T.getRenderTarget().texture,r.material.uniforms["tRefractionMap"].value=P.getRenderTarget().texture,r.material.uniforms["tNormalMap0"].value=b,r.material.uniforms["tNormalMap1"].value=w,r.material.uniforms["color"].value=a,r.material.uniforms["reflectivity"].value=v,r.material.uniforms["textureMatrix"].value=S,r.material.uniforms["config"].value.x=0,r.material.uniforms["config"].value.y=A,r.material.uniforms["config"].value.z=A,r.material.uniforms["config"].value.w=m,r.onBeforeRender=function(e,t,n){C(n),E(),o.visible=!1,T.matrixWorld.copy(o.matrixWorld),P.matrixWorld.copy(o.matrixWorld),T.onBeforeRender(e,t,n),P.onBeforeRender(e,t,n),o.visible=!0},r}return(0,l.Z)(n)}(u.Kj0);ri.prototype.isWater=!0,ri.WaterShader={uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},textureMatrix:{type:"m4",value:null},config:{type:"v4",value:new u.Ltg}},vertexShader:"\n\n\t\t#include <common>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\n\t\tuniform mat4 textureMatrix;\n\n\t\tvarying vec4 vCoord;\n\t\tvarying vec2 vUv;\n\t\tvarying vec3 vToEye;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tvCoord = textureMatrix * vec4( position, 1.0 );\n\n\t\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\t\t\tvToEye = cameraPosition - worldPosition.xyz;\n\n\t\t\tvec4 mvPosition =  viewMatrix * worldPosition; // used in fog_vertex\n\t\t\tgl_Position = projectionMatrix * mvPosition;\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}",fragmentShader:"\n\n\t\t#include <common>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\n\t\tuniform sampler2D tReflectionMap;\n\t\tuniform sampler2D tRefractionMap;\n\t\tuniform sampler2D tNormalMap0;\n\t\tuniform sampler2D tNormalMap1;\n\n\t\t#ifdef USE_FLOWMAP\n\t\t\tuniform sampler2D tFlowMap;\n\t\t#else\n\t\t\tuniform vec2 flowDirection;\n\t\t#endif\n\n\t\tuniform vec3 color;\n\t\tuniform float reflectivity;\n\t\tuniform vec4 config;\n\n\t\tvarying vec4 vCoord;\n\t\tvarying vec2 vUv;\n\t\tvarying vec3 vToEye;\n\n\t\tvoid main() {\n\n\t\t\t#include <logdepthbuf_fragment>\n\n\t\t\tfloat flowMapOffset0 = config.x;\n\t\t\tfloat flowMapOffset1 = config.y;\n\t\t\tfloat halfCycle = config.z;\n\t\t\tfloat scale = config.w;\n\n\t\t\tvec3 toEye = normalize( vToEye );\n\n\t\t\t// determine flow direction\n\t\t\tvec2 flow;\n\t\t\t#ifdef USE_FLOWMAP\n\t\t\t\tflow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;\n\t\t\t#else\n\t\t\t\tflow = flowDirection;\n\t\t\t#endif\n\t\t\tflow.x *= - 1.0;\n\n\t\t\t// sample normal maps (distort uvs with flowdata)\n\t\t\tvec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );\n\t\t\tvec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );\n\n\t\t\t// linear interpolate to get the final normal color\n\t\t\tfloat flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;\n\t\t\tvec4 normalColor = mix( normalColor0, normalColor1, flowLerp );\n\n\t\t\t// calculate normal vector\n\t\t\tvec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );\n\n\t\t\t// calculate the fresnel term to blend reflection and refraction maps\n\t\t\tfloat theta = max( dot( toEye, normal ), 0.0 );\n\t\t\tfloat reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );\n\n\t\t\t// calculate final uv coords\n\t\t\tvec3 coord = vCoord.xyz / vCoord.w;\n\t\t\tvec2 uv = coord.xy + coord.z * normal.xz * 0.05;\n\n\t\t\tvec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );\n\t\t\tvec4 refractColor = texture2D( tRefractionMap, uv );\n\n\t\t\t// multiply water color with the mix of both textures\n\t\t\tgl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\n\t\t}"};var ii=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.width,i=void 0===r?20:r,o=n.height,a=void 0===o?20:o,s=n.x,l=void 0===s?0:s,c=n.y,h=void 0===c?0:c,d=n.z,f=void 0===d?0:d,p=n.color,v=void 0===p?"#ffffff":p,m=n.scale,y=void 0===m?4:m,g=n.flowX,x=void 0===g?1:g,b=n.flowY,w=void 0===b?1:b,k=n.normalMap0,A=void 0===k?void 0:k,S=n.normalMap1,M=void 0===S?void 0:S,T=new u.BKK(i,a),P=new u.Wid({color:30654,transparent:!0,opacity:.8}),C=new u.Kj0(T,P);C.position.set(l,h,f),C.rotation.x=-.5*Math.PI,e.add(C);var E=new u.BKK(i,a),_=new ri(E,{color:v,scale:y,flowDirection:new u.FM8(x,w),textureWidth:1024,textureHeight:1024,normalMap0:A,normalMap1:M,encoding:t.outputEncoding});return _.position.set(l,h+.1,f),_.rotation.x=-.5*Math.PI,e.add(_),{ground:C,water:_}},oi=function(){function e(t,n,r){(0,s.Z)(this,e),this.scene=t,this.renderer=n,this.factories=r}return(0,l.Z)(e,[{key:"water",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ii(this.scene,this.renderer,e)}},{key:"textureCube",value:function(e){var t=this;6!==e.length&&Gr("You need to pass 6 urls to textureCube()");var n=new ai;return e.forEach((function(e,r){e.wrapS=e.wrapT=u.rpg;var i=t.factories.add.material({phong:{map:e}});n.materials[r]=i})),n}}]),e}(),ai=function(){function e(){(0,s.Z)(this,e),this.materials=new Array(6)}return(0,l.Z)(e,[{key:"texture",get:function(){return{left:this.getTexture(0),right:this.getTexture(1),up:this.getTexture(2),down:this.getTexture(3),front:this.getTexture(4),back:this.getTexture(5)}}},{key:"getTexture",value:function(e){return this.materials[e].map}}]),e}(),si=n(6198),li=function(){function e(){(0,s.Z)(this,e)}return(0,l.Z)(e,null,[{key:"createButton",value:function(t,n){n&&console.error('THREE.VRButton: The "options" parameter has been removed. Please set the reference space type via renderer.xr.setReferenceSpaceType() instead.');var r=document.createElement("button");function i(){var e=null;function n(e){return i.apply(this,arguments)}function i(){return i=(0,si.Z)(regeneratorRuntime.mark((function n(i){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i.addEventListener("end",o),n.next=3,t.xr.setSession(i);case 3:r.textContent="EXIT VR",e=i;case 5:case"end":return n.stop()}}),n)}))),i.apply(this,arguments)}function o(){e.removeEventListener("end",o),r.textContent="ENTER VR",e=null}r.style.display="",r.style.cursor="pointer",r.style.left="calc(50% - 50px)",r.style.width="100px",r.textContent="ENTER VR",r.onmouseenter=function(){r.style.opacity="1.0"},r.onmouseleave=function(){r.style.opacity="0.5"},r.onclick=function(){if(null===e){var t={optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]};navigator.xr.requestSession("immersive-vr",t).then(n)}else e.end()}}function o(){r.style.display="",r.style.cursor="auto",r.style.left="calc(50% - 75px)",r.style.width="150px",r.onmouseenter=null,r.onmouseleave=null,r.onclick=null}function a(){o(),r.textContent="VR NOT SUPPORTED"}function s(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator)return r.id="VRButton",r.style.display="none",s(r),navigator.xr.isSessionSupported("immersive-vr").then((function(t){t?i():a(),t&&e.xrSessionIsGranted&&r.click()})),r;var l=document.createElement("a");return!1===window.isSecureContext?(l.href=document.location.href.replace(/^http:/,"https:"),l.innerHTML="WEBXR NEEDS HTTPS"):(l.href="https://immersiveweb.dev/",l.innerHTML="WEBXR NOT AVAILABLE"),l.style.left="calc(50% - 90px)",l.style.width="180px",l.style.textDecoration="none",s(l),l}},{key:"registerSessionGrantedListener",value:function(){"xr"in navigator&&navigator.xr.addEventListener("sessiongranted",(function(){e.xrSessionIsGranted=!0}))}}]),e}();(0,B.Z)(li,"xrSessionIsGranted",!1),li.registerSessionGrantedListener();n(5003),n(9337);function ui(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ci(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ui(Object(n),!0).forEach((function(t){(0,B.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ui(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}n(3371);var hi={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};function di(e){return fi.apply(this,arguments)}function fi(){return fi=(0,si.Z)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:if(n=e.sent,n.ok){e.next=7;break}throw new Error(n.statusText);case 7:return e.abrupt("return",n.json());case 8:case"end":return e.stop()}}),e)}))),fi.apply(this,arguments)}function pi(e){return vi.apply(this,arguments)}function vi(){return vi=(0,si.Z)(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No basePath supplied");case 2:return n="profilesList.json",e.next=5,di("".concat(t,"/").concat(n));case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)}))),vi.apply(this,arguments)}function mi(e,t){return yi.apply(this,arguments)}function yi(){return yi=(0,si.Z)(regeneratorRuntime.mark((function e(t,n){var r,i,o,a,s,l,u,c,h=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=h.length>2&&void 0!==h[2]?h[2]:null,i=!(h.length>3&&void 0!==h[3])||h[3],t){e.next=4;break}throw new Error("No xrInputSource supplied");case 4:if(n){e.next=6;break}throw new Error("No basePath supplied");case 6:return e.next=8,pi(n);case 8:if(o=e.sent,t.profiles.some((function(e){var t=o[e];return t&&(a={profileId:e,profilePath:"".concat(n,"/").concat(t.path),deprecated:!!t.deprecated}),!!a})),a){e.next=17;break}if(r){e.next=13;break}throw new Error("No matching profile name found");case 13:if(s=o[r],s){e.next=16;break}throw new Error('No matching profile name found and default profile "'.concat(r,'" missing.'));case 16:a={profileId:r,profilePath:"".concat(n,"/").concat(s.path),deprecated:!!s.deprecated};case 17:return e.next=19,di(a.profilePath);case 19:if(l=e.sent,!i){e.next=25;break}if(c="any"===t.handedness?l.layouts[Object.keys(l.layouts)[0]]:l.layouts[t.handedness],c){e.next=24;break}throw new Error("No matching handedness, ".concat(t.handedness,", in profile ").concat(a.profileId));case 24:c.assetPath&&(u=a.profilePath.replace("profile.json",c.assetPath));case 25:return e.abrupt("return",{profile:l,assetPath:u});case 26:case"end":return e.stop()}}),e)}))),yi.apply(this,arguments)}var gi={xAxis:0,yAxis:0,button:0,state:hi.ComponentState.DEFAULT};function xi(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e,r=t,i=Math.sqrt(e*e+t*t);if(i>1){var o=Math.atan2(t,e);n=Math.cos(o),r=Math.sin(o)}var a={normalizedXAxis:.5*n+.5,normalizedYAxis:.5*r+.5};return a}var bi=function(){function e(t){(0,s.Z)(this,e),this.componentProperty=t.componentProperty,this.states=t.states,this.valueNodeName=t.valueNodeName,this.valueNodeProperty=t.valueNodeProperty,this.valueNodeProperty===hi.VisualResponseProperty.TRANSFORM&&(this.minNodeName=t.minNodeName,this.maxNodeName=t.maxNodeName),this.value=0,this.updateFromComponent(gi)}return(0,l.Z)(e,[{key:"updateFromComponent",value:function(e){var t=e.xAxis,n=e.yAxis,r=e.button,i=e.state,o=xi(t,n),a=o.normalizedXAxis,s=o.normalizedYAxis;switch(this.componentProperty){case hi.ComponentProperty.X_AXIS:this.value=this.states.includes(i)?a:.5;break;case hi.ComponentProperty.Y_AXIS:this.value=this.states.includes(i)?s:.5;break;case hi.ComponentProperty.BUTTON:this.value=this.states.includes(i)?r:0;break;case hi.ComponentProperty.STATE:this.valueNodeProperty===hi.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(i):this.value=this.states.includes(i)?1:0;break;default:throw new Error("Unexpected visualResponse componentProperty ".concat(this.componentProperty))}}}]),e}(),wi=function(){function e(t,n){var r=this;if((0,s.Z)(this,e),!t||!n||!n.visualResponses||!n.gamepadIndices||0===Object.keys(n.gamepadIndices).length)throw new Error("Invalid arguments supplied");this.id=t,this.type=n.type,this.rootNodeName=n.rootNodeName,this.touchPointNodeName=n.touchPointNodeName,this.visualResponses={},Object.keys(n.visualResponses).forEach((function(e){var t=new bi(n.visualResponses[e]);r.visualResponses[e]=t})),this.gamepadIndices=Object.assign({},n.gamepadIndices),this.values={state:hi.ComponentState.DEFAULT,button:void 0!==this.gamepadIndices.button?0:void 0,xAxis:void 0!==this.gamepadIndices.xAxis?0:void 0,yAxis:void 0!==this.gamepadIndices.yAxis?0:void 0}}return(0,l.Z)(e,[{key:"data",get:function(){var e=ci({id:this.id},this.values);return e}},{key:"updateFromGamepad",value:function(e){var t=this;if(this.values.state=hi.ComponentState.DEFAULT,void 0!==this.gamepadIndices.button&&e.buttons.length>this.gamepadIndices.button){var n=e.buttons[this.gamepadIndices.button];this.values.button=n.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,n.pressed||1===this.values.button?this.values.state=hi.ComponentState.PRESSED:(n.touched||this.values.button>hi.ButtonTouchThreshold)&&(this.values.state=hi.ComponentState.TOUCHED)}void 0!==this.gamepadIndices.xAxis&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===hi.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>hi.AxisTouchThreshold&&(this.values.state=hi.ComponentState.TOUCHED)),void 0!==this.gamepadIndices.yAxis&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===hi.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>hi.AxisTouchThreshold&&(this.values.state=hi.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach((function(e){e.updateFromComponent(t.values)}))}}]),e}(),ki=function(){function e(t,n,r){var i=this;if((0,s.Z)(this,e),!t)throw new Error("No xrInputSource supplied");if(!n)throw new Error("No profile supplied");this.xrInputSource=t,this.assetUrl=r,this.id=n.profileId,this.layoutDescription=n.layouts[t.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach((function(e){var t=i.layoutDescription.components[e];i.components[e]=new wi(e,t)})),this.updateFromGamepad()}return(0,l.Z)(e,[{key:"gripSpace",get:function(){return this.xrInputSource.gripSpace}},{key:"targetRaySpace",get:function(){return this.xrInputSource.targetRaySpace}},{key:"data",get:function(){var e=[];return Object.values(this.components).forEach((function(t){e.push(t.data)})),e}},{key:"updateFromGamepad",value:function(){var e=this;Object.values(this.components).forEach((function(t){t.updateFromGamepad(e.xrInputSource.gamepad)}))}}]),e}(),Ai="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",Si="generic-trigger",Mi=function(e){(0,h.Z)(n,e);var t=(0,d.Z)(n);function n(){var e;return(0,s.Z)(this,n),e=t.call(this),e.motionController=null,e.envMap=null,e}return(0,l.Z)(n,[{key:"setEnvironmentMap",value:function(e){var t=this;return this.envMap==e||(this.envMap=e,this.traverse((function(e){e.isMesh&&(e.material.envMap=t.envMap,e.material.needsUpdate=!0)}))),this}},{key:"updateMatrixWorld",value:function(e){(0,jn.Z)((0,zn.Z)(n.prototype),"updateMatrixWorld",this).call(this,e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach((function(e){Object.values(e.visualResponses).forEach((function(e){var t=e.valueNode,n=e.minNode,r=e.maxNode,i=e.value,o=e.valueNodeProperty;t&&(o===hi.VisualResponseProperty.VISIBILITY?t.visible=i:o===hi.VisualResponseProperty.TRANSFORM&&(t.quaternion.slerpQuaternions(n.quaternion,r.quaternion,i),t.position.lerpVectors(n.position,r.position,i)))}))})))}}]),n}(u.Tme);function Ti(e,t){Object.values(e.components).forEach((function(e){var n=e.type,r=e.touchPointNodeName,i=e.visualResponses;if(n===hi.ComponentType.TOUCHPAD)if(e.touchPointNode=t.getObjectByName(r),e.touchPointNode){var o=new u.xo$(.001),a=new u.vBJ({color:255}),s=new u.Kj0(o,a);e.touchPointNode.add(s)}else console.warn("Could not find touch dot, ".concat(e.touchPointNodeName,", in touchpad component ").concat(e.id));Object.values(i).forEach((function(e){var n=e.valueNodeName,r=e.minNodeName,i=e.maxNodeName,o=e.valueNodeProperty;if(o===hi.VisualResponseProperty.TRANSFORM){if(e.minNode=t.getObjectByName(r),e.maxNode=t.getObjectByName(i),!e.minNode)return void console.warn("Could not find ".concat(r," in the model"));if(!e.maxNode)return void console.warn("Could not find ".concat(i," in the model"))}e.valueNode=t.getObjectByName(n),e.valueNode||console.warn("Could not find ".concat(n," in the model"))}))}))}function Pi(e,t){Ti(e.motionController,t),e.envMap&&t.traverse((function(t){t.isMesh&&(t.material.envMap=e.envMap,t.material.needsUpdate=!0)})),e.add(t)}var Ci=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;(0,s.Z)(this,e),this.gltfLoader=t,this.path=Ai,this._assetCache={},this.gltfLoader||(this.gltfLoader=new Hn)}return(0,l.Z)(e,[{key:"createControllerModel",value:function(e){var t=this,n=new Mi,r=null;return e.addEventListener("connected",(function(e){var i=e.data;"tracked-pointer"===i.targetRayMode&&i.gamepad&&mi(i,t.path,Si).then((function(e){var o=e.profile,a=e.assetPath;n.motionController=new ki(i,o,a);var s=t._assetCache[n.motionController.assetUrl];if(s)r=s.scene.clone(),Pi(n,r);else{if(!t.gltfLoader)throw new Error("GLTFLoader not set.");t.gltfLoader.setPath(""),t.gltfLoader.load(n.motionController.assetUrl,(function(e){t._assetCache[n.motionController.assetUrl]=e,r=e.scene.clone(),Pi(n,r)}),null,(function(){throw new Error("Asset ".concat(n.motionController.assetUrl," missing or malformed."))}))}})).catch((function(e){console.warn(e)}))})),e.addEventListener("disconnected",(function(){n.motionController=null,n.remove(r),r=null})),n}}]),e}(),Ei=function(){function e(t,n,r){(0,s.Z)(this,e),this._renderer=t,this._scene=n,this._camera=r,this.controllerModelFactory=new Ci,this.cameraGroup=new u.ZAu,this.cameraGroup.add(r),n.add(this.cameraGroup),t.xr.enabled=!0;var i=li.createButton(t);i.style.cssText+="background: rgba(0, 0, 0, 0.8); ",document.body.appendChild(i)}return(0,l.Z)(e,[{key:"isPresenting",get:function(){var e,t;return!!(null===(t=null===(e=this._renderer)||void 0===e?void 0:e.xr)||void 0===t?void 0:t.isPresenting)}},{key:"getController",value:function(e){var t=this._renderer.xr.getController(e);return this.cameraGroup.add(t),t}},{key:"getControllerGrip",value:function(e){var t=this._renderer.xr.getControllerGrip(e),n=this.controllerModelFactory.createControllerModel(t);return t.add(n),this.cameraGroup.add(t),t}},{key:"getControllerRay",value:function(e){var t=e.targetRayMode;if("tracked-pointer"===t){var n=new u.u9r;n.setAttribute("position",new u.a$l([0,0,0,0,0,-1],3)),n.setAttribute("color",new u.a$l([1,0,0,1,1,1],3));var r=new u.nls({vertexColors:!0});return new u.x12(n,r)}if("gaze"===t){var i=new u.V4E(.02,.04,32).translate(0,0,-1),o=new u.vBJ({color:"red",opacity:.5,transparent:!0});return new u.Kj0(i,o)}}},{key:"camera",get:function(){return this.WebXRCamera}},{key:"WebXRCamera",get:function(){var e,t=this;return{group:this.cameraGroup,position:null===(e=this.cameraGroup)||void 0===e?void 0:e.position,rotation:this.isPresenting?this._renderer.xr.getCamera(this._camera).rotation:void 0,getWorldDirection:function(e){return t.isPresenting?t._renderer.xr.getCamera(t._camera).getWorldDirection(e):void 0}}}}]),e}(),_i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,t=arguments.length>1?arguments[1]:void 0;if(window.__loadPhysics)for(var n=0;n<e;n++){var r=["standard","basic","normal","phong","line","points"],i=function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},o=function(e){return e[Math.floor(Math.random()*e.length)]};Math.random()>.5?t.add.box({x:i(-10,10),y:i(10,20),z:i(-10,10),width:i(1,2)/10,height:i(1,2)/10,depth:i(1,2)/10,mass:1},(0,B.Z)({},o(r),{color:Math.floor(16777215*Math.random())})).body.setRestitution(Math.floor(10*Math.random())/20):t.add.sphere({x:i(-10,10),y:i(10,20),z:i(-10,10),radius:i(1,2)/10,mass:1},(0,B.Z)({},o(r),{color:Math.floor(16777215*Math.random())})).body.setRestitution(Math.floor(10*Math.random())/20)}else console.log("There is not much fun without physics enabled!")},Ii=_i,Ri=function(){function e(){(0,s.Z)(this,e)}return(0,l.Z)(e,[{key:"perspectiveCamera",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.Perspective(t)}},{key:"orthographicCamera",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.Orthographic(t)}}],[{key:"Perspective",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.fov,n=void 0===t?50:t,r=e.aspect,i=void 0===r?window.innerWidth/window.innerHeight:r,o=e.near,a=void 0===o?.1:o,s=e.far,l=void 0===s?2e3:s,c=e.x,h=void 0===c?0:c,d=e.y,f=void 0===d?5:d,p=e.z,v=void 0===p?25:p,m=new u.cPb(n,i,a,l);return m.position.set(h,f,v),m}},{key:"Orthographic",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=window.innerWidth,n=window.innerHeight,r=e.left,i=void 0===r?t/-2:r,o=e.right,a=void 0===o?t/2:o,s=e.top,l=void 0===s?n/2:s,c=e.bottom,h=void 0===c?n/-2:c,d=e.near,f=void 0===d?1:d,p=e.far,v=void 0===p?1e3:p,m=e.x,y=void 0===m?0:m,g=e.y,x=void 0===g?0:g,b=e.z,w=void 0===b?10:b,k=new u.iKG(i,a,l,h,f,v);return k.position.set(y,x,w),k}}]),e}(),Li=function(e,t,n,r){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function a(e){try{l(r.next(e))}catch(Xo){o(Xo)}}function s(e){try{l(r["throw"](e))}catch(Xo){o(Xo)}}function l(e){e.done?n(e.value):i(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))},Bi=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,s.Z)(this,e),this.sceneConfig=t,this.scenes=new Map,this.__config={},this._isRunning=!1,this._deconstructor=[];var n=t.key,r=void 0===n?Math.random().toString():n,i=t.enableXR,o=void 0!==i&&i;this.__config.sceneKey=r,this.__config.enableXR=o}return(0,l.Z)(e,[{key:"deconstructor",get:function(){var e=this;return{add:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach((function(t){e._deconstructor.push(t)}))}}}},{key:"initializeScene",value:function(e){var t=e.renderer,n=e.parent,r=e.canvas,i=e.scene,o=e.scenes,a=e.camera,s=e.cache,l=e.physics,c=e.sceneConfig;this.scene=i,this.scenes=o,this.camera=a,this.cache=s,this.physics=l,this.renderer=t,this.parent=n,this.canvas=r;var h=c.autoStart,d=c.textureAnisotropy;this.load=new Dr(this.cache,d),this.lights=new Ur(this.scene),this.transform=new T(this.camera,this.renderer),this.csg=P,this.heightMap=new Kr(this.scene),this.factories=new qr(this.scene),this.misc=new oi(this.scene,this.renderer,this.factories),this.ws=new Jr(i,t,a,this.lights,this.physics,this.load,this.factories),this.mixers=new ei,this.cameras=new Ri,this.clock=new u.SUY,this.__config.enableXR&&(this.webXR=new Ei(this.renderer,this.scene,this.camera)),h&&this.start(this.__config.sceneKey)}},{key:"sceneKey",get:function(){return this.__config.sceneKey}},{key:"destroy",value:function(e){var t;null===(t=this.physics)||void 0===t||t.destroy(e.body),this.scene.remove(e),e=null}},{key:"warpSpeed",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Li(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(n=this.ws).warpSpeed.apply(n,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"animationMixers",get:function(){return this.mixers.mixers}},{key:"make",get:function(){return this.factories.make}},{key:"add",get:function(){return this.factories.add}},{key:"haveSomeFun",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;Ii(e,this.physics)}},{key:"isRunning",value:function(){return this._isRunning}},{key:"start",value:function(e,t){var n;return Li(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:e&&e!==this.__config.sceneKey?(this.stop(),null===(n=this.scenes.get(e))||void 0===n||n._start(t)):this._start(t);case 1:case"end":return r.stop()}}),r,this)})))}},{key:"_start",value:function(e){var t;return Li(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r=this;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,null===(t=this.init)||void 0===t?void 0:t.call(this,e);case 2:return n.next=4,this._preload();case 4:return n.next=6,this._create();case 6:this.renderer.setAnimationLoop((function(){r._update()})),this._isRunning=!0;case 8:case"end":return n.stop()}}),n,this)})))}},{key:"restart",value:function(e){return Li(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.stop();case 2:return t.next=4,this.start(this.__config.sceneKey,e);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"stop",value:function(){var e,t,n;return Li(this,void 0,void 0,regeneratorRuntime.mark((function r(){var i,o,s,l,u;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:this._isRunning=!1,this.renderer.setAnimationLoop(null),this.clock.start(),i=(0,a.Z)(this._deconstructor),r.prev=4,i.s();case 6:if((o=i.n()).done){r.next=18;break}return s=o.value,r.next=10,null===(e=s.dispose)||void 0===e?void 0:e.call(s);case 10:return r.next=12,null===(t=s.destroy)||void 0===t?void 0:t.call(s);case 12:if("function"!==typeof s){r.next=15;break}return r.next=15,null===s||void 0===s?void 0:s();case 15:s=null;case 16:r.next=6;break;case 18:r.next=23;break;case 20:r.prev=20,r.t0=r["catch"](4),i.e(r.t0);case 23:return r.prev=23,i.f(),r.finish(23);case 26:if(this._deconstructor=[],null===(n=this.physics)||void 0===n?void 0:n.rigidBodies)for(l=this.physics.rigidBodies.length-1;l>=0;l--)this.physics.destroy(this.physics.rigidBodies[l]);for(u=this.scene.children.length-1;u>=0;u--)this.scene.remove(this.scene.children[u]);case 29:case"end":return r.stop()}}),r,this,[[4,20,23,26]])})))}},{key:"setSize",value:function(e,t){this.renderer.setSize(e,t),"undefined"!==typeof this.camera.aspect&&(this.camera.aspect=e/t),this.camera.updateProjectionMatrix()}},{key:"setPixelRatio",value:function(e){this.renderer.setPixelRatio(e)}},{key:"init",value:function(){}},{key:"preload",value:function(){}},{key:"create",value:function(){}},{key:"update",value:function(e,t){}},{key:"preRender",value:function(){}},{key:"postRender",value:function(){}},{key:"_preload",value:function(){var e;return Li(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,null===(e=this.preload)||void 0===e?void 0:e.call(this);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"_create",value:function(){var e;return Li(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,null===(e=this.create)||void 0===e?void 0:e.call(this);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"_update",value:function(){var e,t,n,r=1e3*this.clock.getDelta(),i=this.clock.getElapsedTime();null===(e=this.update)||void 0===e||e.call(this,parseFloat(i.toFixed(3)),parseInt(r.toString())),null===(t=this.physics)||void 0===t||t.update(r),null===(n=this.physics)||void 0===n||n.updateDebugger(),this.animationMixers.update(r),this.preRender(),this.composer?this.composer.render():this.renderer.render(this.scene,this.camera),this.postRender()}}]),e}(),Ni=n(4893),Oi=function(){function e(t,n){(0,s.Z)(this,e),this.physics=t,this.ammo=n,this.ignoreScale=!1,this.isSoftBody=!1,this.offset={x:0,y:0,z:0},this.errors=[],this.checkCollisions=!1,this.breakable=!1,this.fractureImpulse=1,this.didUpdate=!1,this.skipUpdate=!1,this._emitUpdateEvents=!1,this._needUpdate=!1,this.tmpEuler=new u.USm,this.tmpQuaternion=new u._fP,this.tmpBtVector3=new Ammo.btVector3,this.tmpBtVector3_1=new Ammo.btVector3,this.tmpBtQuaternion=new Ammo.btQuaternion(0,0,0,1),this.eventEmitter=new Ni.Events,this.name=n.name}return(0,l.Z)(e,[{key:"destructor",value:function(){this.eventEmitter&&this.eventEmitter.removeAllListeners(),Ammo.destroy(this.tmpBtVector3),Ammo.destroy(this.tmpBtVector3_1),Ammo.destroy(this.tmpBtQuaternion),Ammo.destroy(this.ammo.getCollisionShape()),Ammo.destroy(this.ammo)}},{key:"setupEventEmitter",value:function(){"undefined"===typeof this.eventEmitter&&(this.eventEmitter=new Ni.Events)}},{key:"needUpdate",get:function(){return this._needUpdate},set:function(e){!e&&this._needUpdate&&(this.didUpdate=!0),this._needUpdate=e}},{key:"onUpdateEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.setupEventEmitter(),this._emitUpdateEvents=!0,t?this.eventEmitter.once("update",(function(){e()})):this.eventEmitter.on("update",(function(){e()}))}},{key:"on",get:function(){var e=this;return{update:function(t){return e.onUpdateEvent(t)},collision:function(t){return e.onCollision(t)}}}},{key:"once",get:function(){var e=this;return{update:function(t){return e.onUpdateEvent(t,!0)}}}},{key:"onCollision",value:function(e){var t=this;this.checkCollisions=!0,this.physics.collisionEvents.on("collision",(function(n){var r=n.bodies,i=n.event;r[0].name===t.name?e(r[1],i):r[1].name===t.name&&e(r[0],i)}))}},{key:"transform",value:function(){var e=this.physics.worldTransform;this.ammo.getMotionState().getWorldTransform(e)}},{key:"refresh",value:function(){var e=this.physics.worldTransform;this.ammo.getMotionState().setWorldTransform(e)}},{key:"setRotation",value:function(e,t,n){var r=this.tmpEuler.set(e,t,n),i=this.tmpQuaternion.set(0,0,0,1);i.setFromEuler(r),this.tmpBtQuaternion.setValue(0,0,0,1);var o=this.tmpBtQuaternion;o.setValue(i.x,i.y,i.z,i.w);var a=this.physics.worldTransform;a.setRotation(o)}},{key:"rotation",get:function(){var e,t,n,r=this.physics.worldTransform,i=r.getRotation(),o=this.tmpQuaternion.set(i.x(),i.y(),i.z(),i.w());o.w>1&&(o=o.normalize());var a=2*Math.acos(o.w),s=Math.sqrt(1-o.w*o.w);return s<.001?(e=o.x,t=o.y,n=o.z):(e=o.x/s,t=o.y/s,n=o.z/s),{x:e*a,y:t*a,z:n*a}}},{key:"quaternion",get:function(){var e=this.physics.worldTransform,t=e.getRotation();return{x:t.x(),y:t.y(),z:t.z(),w:t.w()}}},{key:"setPosition",value:function(e,t,n){var r=this.physics.worldTransform;r.getOrigin().setValue(e,t,n)}},{key:"position",get:function(){var e=this.physics.worldTransform;return{x:e.getOrigin().x(),y:e.getOrigin().y(),z:e.getOrigin().z()}}},{key:"velocity",get:function(){return{x:this.ammo.getLinearVelocity().x(),y:this.ammo.getLinearVelocity().y(),z:this.ammo.getLinearVelocity().z()}}},{key:"angularVelocity",get:function(){return{x:this.ammo.getAngularVelocity().x(),y:this.ammo.getAngularVelocity().y(),z:this.ammo.getAngularVelocity().z()}}},{key:"setVelocity",value:function(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.setLinearVelocity(this.tmpBtVector3)}},{key:"setVelocityX",value:function(e){this.tmpBtVector3.setValue(e,this.velocity.y,this.velocity.z),this.ammo.setLinearVelocity(this.tmpBtVector3)}},{key:"setVelocityY",value:function(e){this.tmpBtVector3.setValue(this.velocity.x,e,this.velocity.z),this.ammo.setLinearVelocity(this.tmpBtVector3)}},{key:"setVelocityZ",value:function(e){this.tmpBtVector3.setValue(this.velocity.x,this.velocity.y,e),this.ammo.setLinearVelocity(this.tmpBtVector3)}},{key:"setAngularVelocity",value:function(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.setAngularVelocity(this.tmpBtVector3)}},{key:"setAngularVelocityX",value:function(e){this.tmpBtVector3.setValue(e,this.angularVelocity.y,this.angularVelocity.z),this.ammo.setAngularVelocity(this.tmpBtVector3)}},{key:"setAngularVelocityY",value:function(e){this.tmpBtVector3.setValue(this.angularVelocity.x,e,this.angularVelocity.z),this.ammo.setAngularVelocity(this.tmpBtVector3)}},{key:"setAngularVelocityZ",value:function(e){this.tmpBtVector3.setValue(this.angularVelocity.x,this.angularVelocity.y,e),this.ammo.setAngularVelocity(this.tmpBtVector3)}},{key:"applyForce",value:function(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyCentralImpulse(this.tmpBtVector3)}},{key:"applyForceX",value:function(e){this.tmpBtVector3.setValue(e,0,0),this.ammo.applyCentralImpulse(this.tmpBtVector3)}},{key:"applyForceY",value:function(e){this.tmpBtVector3.setValue(0,e,0),this.ammo.applyCentralImpulse(this.tmpBtVector3)}},{key:"applyForceZ",value:function(e){this.tmpBtVector3.setValue(0,0,e),this.ammo.applyCentralImpulse(this.tmpBtVector3)}},{key:"applyCentralForce",value:function(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyCentralForce(this.tmpBtVector3)}},{key:"applyCentralImpulse",value:function(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyCentralImpulse(this.tmpBtVector3)}},{key:"applyCentralLocalForce",value:function(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyCentralLocalForce(this.tmpBtVector3)}},{key:"applyImpulse",value:function(e,t){this.tmpBtVector3.setValue(e.x||0,e.y||0,e.z||0),this.tmpBtVector3_1.setValue(t.x||0,t.y||0,t.z||0),this.ammo.applyImpulse(this.tmpBtVector3,this.tmpBtVector3_1)}},{key:"applyLocalTorque",value:function(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyLocalTorque(this.tmpBtVector3)}},{key:"applyTorque",value:function(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyTorque(this.tmpBtVector3)}},{key:"applyTorqueImpulse",value:function(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyTorqueImpulse(this.tmpBtVector3)}},{key:"setCollisionFlags",value:function(e){this.ammo.setCollisionFlags(e)}},{key:"getCollisionFlags",value:function(){return this.ammo.getCollisionFlags()}},{key:"setRestitution",value:function(e){this.ammo.setRestitution(e)}},{key:"setBounciness",value:function(e){this.setRestitution(e)}},{key:"setFriction",value:function(e){this.ammo.setFriction(e)}},{key:"setDamping",value:function(e,t){this.ammo.setDamping(e,t)}},{key:"setGravity",value:function(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.setGravity(this.tmpBtVector3)}},{key:"setLinearFactor",value:function(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.setLinearFactor(this.tmpBtVector3)}},{key:"setAngularFactor",value:function(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.setAngularFactor(this.tmpBtVector3)}},{key:"setCcdMotionThreshold",value:function(e){this.ammo.setCcdMotionThreshold(e)}},{key:"setCcdSweptSphereRadius",value:function(e){this.ammo.setCcdSweptSphereRadius(e)}}]),e}(),Vi=Oi,Di=function(){function e(t,n){(0,s.Z)(this,e),this.factory=t,this.addExisting=n}return(0,l.Z)(e,[{key:"addPlane",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.factory.add.plane(e,t);return this.addExisting(n,e),n}},{key:"addSphere",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.factory.add.sphere(e,t);return this.addExisting(n,e),n}},{key:"addBox",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.factory.add.box(e,t);return this.addExisting(n,e),n}},{key:"addGround",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.factory.add.ground(e,t),r=Object.assign(Object.assign({},e),{mass:0,collisionFlags:1});return this.addExisting(n,r),n}},{key:"addCylinder",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.factory.add.cylinder(e,t);return this.addExisting(n,e),n}},{key:"addCone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.factory.add.cone(e,t);return this.addExisting(n,e),n}},{key:"addTorus",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.factory.add.torus(e,t);return this.addExisting(n,e),n}},{key:"addExtrude",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.factory.add.extrude(e,t);return n.translateX(1),this.addExisting(n),n}}]),e}(),Fi=Di,Ui=(n(9253),function(){function e(t,n){(0,s.Z)(this,e),this.worldTransform=t,this.physicsWorld=n,this.tmpBtVector3=new Ammo.btVector3}return(0,l.Z)(e,[{key:"toAmmoV3",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Ammo.btVector3("undefined"!==typeof(null===e||void 0===e?void 0:e.x)?e.x:t,"undefined"!==typeof(null===e||void 0===e?void 0:e.y)?e.y:t,"undefined"!==typeof(null===e||void 0===e?void 0:e.z)?e.z:t)}},{key:"addConstraints",get:function(){var e=this;return{lock:function(t,n,r){return e.lock(t,n,r)},fixed:function(t,n,r){return e.fixed(t,n,r)},pointToPoint:function(t,n,r,i){return e.pointToPoint(t,n,r,i)},hinge:function(t,n,r,i){return e.hinge(t,n,r,i)},slider:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;return e.slider(t,n,r,i)},spring:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;return e.spring(t,n,r,i)},coneTwist:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{frameA:{},frameB:{}},i=arguments.length>3?arguments[3]:void 0;return e.coneTwist(t,n,r,i)},dof:function(t,n,r,i){return e.dof(t,n,r,i)}}}},{key:"getTransform",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0,z:0},r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];n=Object.assign({x:0,y:0,z:0},n);var i=function(e,t){var r=(e.x()-t.x())/2+n.x,i=(e.y()-t.y())/2+n.y,o=(e.z()-t.z())/2+n.z;return new Ammo.btVector3(r,i,o)},o=new Ammo.btTransform;if(o.setIdentity(),r){var a=i(e.getWorldTransform().getOrigin(),t.getWorldTransform().getOrigin()),s=new Ammo.btTransform;s.setIdentity(),s.setOrigin(a);var l=e.getCenterOfMassTransform().inverse().op_mul(t.getWorldTransform());return l.op_mul(s),{transformA:l,transformB:s}}o.setOrigin(new Ammo.btVector3(n.x,n.y,n.z));var u=e.getCenterOfMassTransform().inverse().op_mul(t.getWorldTransform()).op_mul(o);return{transformA:u,transformB:o}}},{key:"lock",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r={x:0,y:0,z:0};return this.dof(e,t,{angularLowerLimit:r,angularUpperLimit:r},n)}},{key:"fixed",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.getTransform(e.ammo,t.ammo);r.transformA.setRotation(e.ammo.getWorldTransform().getRotation()),r.transformB.setRotation(t.ammo.getWorldTransform().getRotation());var i=new Ammo.btFixedConstraint(e.ammo,t.ammo,r.transformA,r.transformB);return this.physicsWorld.addConstraint(i,n),i}},{key:"pointToPoint",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=n.pivotA,o=n.pivotB,a=new Ammo.btVector3((null===i||void 0===i?void 0:i.x)||0,(null===i||void 0===i?void 0:i.y)||0,(null===i||void 0===i?void 0:i.z)||0),s=new Ammo.btVector3((null===o||void 0===o?void 0:o.x)||0,(null===o||void 0===o?void 0:o.y)||0,(null===o||void 0===o?void 0:o.z)||0),l=new Ammo.btPoint2PointConstraint(e.ammo,t.ammo,a,s);return this.physicsWorld.addConstraint(l,r),l}},{key:"hinge",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=n.pivotA,o=n.pivotB,a=n.axisA,s=n.axisB,l=new Ammo.btVector3((null===i||void 0===i?void 0:i.x)||0,(null===i||void 0===i?void 0:i.y)||0,(null===i||void 0===i?void 0:i.z)||0),u=new Ammo.btVector3((null===o||void 0===o?void 0:o.x)||0,(null===o||void 0===o?void 0:o.y)||0,(null===o||void 0===o?void 0:o.z)||0),c=new Ammo.btVector3((null===a||void 0===a?void 0:a.x)||0,(null===a||void 0===a?void 0:a.y)||0,(null===a||void 0===a?void 0:a.z)||0),h=new Ammo.btVector3((null===s||void 0===s?void 0:s.x)||0,(null===s||void 0===s?void 0:s.y)||0,(null===s||void 0===s?void 0:s.z)||0),d=new Ammo.btHingeConstraint(e.ammo,t.ammo,l,u,c,h,!0);return this.physicsWorld.addConstraint(d,r),d}},{key:"slider",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=this.getTransform(e.ammo,t.ammo),o=n.frameA,a=void 0===o?{}:o,s=n.frameB,l=void 0===s?{}:s,u=n.linearLowerLimit,c=void 0===u?0:u,h=n.linearUpperLimit,d=void 0===h?0:h,f=n.angularLowerLimit,p=void 0===f?0:f,v=n.angularUpperLimit,m=void 0===v?0:v,y=i.transformA.getRotation();y.setEulerZYX(a.x||0,a.y||0,a.z||0),i.transformA.setRotation(y);var g=i.transformB.getRotation();g.setEulerZYX(l.x||0,l.y||0,l.z||0),i.transformB.setRotation(g);var x=new Ammo.btSliderConstraint(e.ammo,t.ammo,i.transformA,i.transformB,!0);return x.setLowerLinLimit(c),x.setUpperLinLimit(d),x.setLowerAngLimit(p),x.setUpperAngLimit(m),this.physicsWorld.addConstraint(x,r),x}},{key:"spring",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=n.stiffness,o=void 0===i?50:i,a=n.damping,s=void 0===a?.01:a,l=n.angularLock,u=void 0!==l&&l,c=n.linearLowerLimit,h=void 0===c?{}:c,d=n.linearUpperLimit,f=void 0===d?{}:d,p=n.angularLowerLimit,v=void 0===p?{}:p,m=n.angularUpperLimit,y=void 0===m?{}:m,g=n.offset,x=void 0===g?{}:g,b=n.center,w=void 0!==b&&b,k=n.enableSpring,A=void 0===k||k,S=Object.assign({x:0,y:0,z:0},x),M=this.getTransform(e.ammo,t.ammo,S,w),T=new Ammo.btGeneric6DofSpringConstraint(e.ammo,t.ammo,M.transformA,M.transformB,!0);this.tmpBtVector3.setValue(h.x||0,h.y||0,h.z||0),T.setLinearLowerLimit(this.tmpBtVector3),this.tmpBtVector3.setValue(f.x||0,f.y||0,f.z||0),T.setLinearUpperLimit(this.tmpBtVector3),u?(this.tmpBtVector3.setValue(0,0,0),T.setAngularLowerLimit(this.tmpBtVector3),T.setAngularUpperLimit(this.tmpBtVector3)):(console.log(v,y),T.setAngularLowerLimit(this.toAmmoV3(v,-Math.PI)),T.setAngularUpperLimit(this.toAmmoV3(y,Math.PI)));for(var P=0;P<3;P++)T.enableSpring(P,A),T.setStiffness(P,o),T.setDamping(P,s);return this.physicsWorld.addConstraint(T,r),T}},{key:"coneTwist",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=n.frameA,o=n.frameB,a=new Ammo.btTransform;a.setIdentity(),a.getOrigin().setValue((null===i||void 0===i?void 0:i.x)||0,(null===i||void 0===i?void 0:i.y)||0,(null===i||void 0===i?void 0:i.z)||0);var s=new Ammo.btTransform;s.setIdentity(),s.getOrigin().setValue((null===o||void 0===o?void 0:o.x)||0,(null===o||void 0===o?void 0:o.y)||0,(null===o||void 0===o?void 0:o.z)||0);this.getTransform(e.ammo,t.ammo);var l=new Ammo.btConeTwistConstraint(t.ammo,e.ammo,a,s);return l.setAngularOnly(!0),this.physicsWorld.addConstraint(l,r),l}},{key:"dof",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=n.offset,o=n.center,a=void 0!==o&&o,s=Object.assign({x:0,y:0,z:0},i),l=this.getTransform(e.ammo,t.ammo,s,a),u=new Ammo.btGeneric6DofConstraint(e.ammo,t.ammo,l.transformA,l.transformB,!0),c=n.linearLowerLimit,h=n.linearUpperLimit,d=n.angularLowerLimit,f=n.angularUpperLimit,p=this.toAmmoV3(c),v=this.toAmmoV3(h),m=this.toAmmoV3(d,-Math.PI),y=this.toAmmoV3(f,Math.PI);return u.setLinearLowerLimit(p),u.setLinearUpperLimit(v),u.setAngularLowerLimit(m),u.setAngularUpperLimit(y),Ammo.destroy(p),Ammo.destroy(v),Ammo.destroy(m),Ammo.destroy(y),this.physicsWorld.addConstraint(u,r),u}}]),e}()),ji=function(e,t){var n=e.radius,r=void 0===n?1:n,i=e.tube,o=void 0===i?.4:i,a=e.tubularSegments,s=void 0===a?8:a,l=Math.PI,u=s,c=Math.sqrt(2*o*o-2*o*o*Math.cos(2*l/u)),h=new Ammo.btVector3(o,l/u+.5*c,o),d=new Ammo.btCylinderShape(h);d.setMargin(.05);for(var f=new Ammo.btCompoundShape,p=new Ammo.btVector3(0,0,1),v=new Ammo.btVector3(0,r,0),m=new Ammo.btQuaternion(t.x,t.y,t.z,t.w),y=0;y<u;y++){var g=2*y*l/u,x=v.rotate(p,g),b=new Ammo.btTransform;m.setRotation(p,g+Math.PI/2),b.setIdentity(),b.setOrigin(x),b.setRotation(m),f.addChildShape(b,d)}return f},zi=function(e){(0,h.Z)(n,e);var t=(0,d.Z)(n);function n(){return(0,s.Z)(this,n),t.apply(this,arguments)}return(0,l.Z)(n,[{key:"addCollider",value:function(e,t,n){e.body&&t.body&&(e.body.checkCollisions=!0,t.body.checkCollisions=!0,this.on("collision",(function(r){var i,o,a=r.bodies,s=r.event;(null===(i=a[0])||void 0===i?void 0:i.name)&&(null===(o=a[1])||void 0===o?void 0:o.name)&&(null===e||void 0===e?void 0:e.name)&&(null===t||void 0===t?void 0:t.name)&&(a[0].name===e.name&&a[1].name===t.name||a[1].name===e.name&&a[0].name===t.name)&&n(s)})))}}]),n}(Ni.Events),Hi={NoDebug:0,DrawWireframe:1,DrawAabb:2,DrawFeaturesText:4,DrawContactPoints:8,NoDeactivation:16,NoHelpText:32,DrawText:64,ProfileTimings:128,EnableSatComparison:256,DisableBulletLCP:512,EnableCCD:1024,DrawConstraints:2048,DrawConstraintLimits:4096,FastWireframe:8192,DrawNormals:16384,DrawOnTop:32768,MAX_DEBUG_DRAW_MODE:4294967295},Gi=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,s.Z)(this,e),this.scene=t,this.world=n,this.options=r,this.debugDrawMode=r.debugDrawMode||Hi.DrawWireframe;var i=this.debugDrawMode&Hi.DrawOnTop||!1,o=r.maxBufferSize||1e6;this.geometry=new u.u9r;var a=new Float32Array(3*o),l=new Float32Array(3*o);this.geometry.setAttribute("position",new u.TlE(a,3).setUsage(u.W2J)),this.geometry.setAttribute("color",new u.TlE(l,3).setUsage(u.W2J)),this.index=0;var c=new u.nls({vertexColors:!0,depthTest:!i});this.mesh=new u.ejS(this.geometry,c),i&&(this.mesh.renderOrder=999),this.mesh.frustumCulled=!1,this.enabled=!1,this.debugDrawer=new Ammo.DebugDrawer,this.debugDrawer.drawLine=this.drawLine.bind(this),this.debugDrawer.drawContactPoint=this.drawContactPoint.bind(this),this.debugDrawer.reportErrorWarning=this.reportErrorWarning.bind(this),this.debugDrawer.draw3dText=this.draw3dText.bind(this),this.debugDrawer.setDebugMode=this.setDebugMode.bind(this),this.debugDrawer.getDebugMode=this.getDebugMode.bind(this),this.world.setDebugDrawer(this.debugDrawer)}return(0,l.Z)(e,[{key:"enable",value:function(){this.enabled=!0,this.scene.add(this.mesh)}},{key:"disable",value:function(){this.enabled=!1,this.scene.remove(this.mesh)}},{key:"update",value:function(){this.enabled&&(0!=this.index&&(this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0),this.index=0,this.world.debugDrawWorld(),this.geometry.setDrawRange(0,this.index))}},{key:"drawLine",value:function(e,t,n){var r=Ammo.HEAPF32,i=r[(n+0)/4],o=r[(n+4)/4],a=r[(n+8)/4],s=r[(e+0)/4],l=r[(e+4)/4],u=r[(e+8)/4];this.geometry.attributes.position.setXYZ(this.index,s,l,u),this.geometry.attributes.color.setXYZ(this.index++,i,o,a);var c=r[(t+0)/4],h=r[(t+4)/4],d=r[(t+8)/4];this.geometry.attributes.position.setXYZ(this.index,c,h,d),this.geometry.attributes.color.setXYZ(this.index++,i,o,a)}},{key:"drawContactPoint",value:function(e,t,n,r,i){var o=Ammo.HEAPF32,a=o[(i+0)/4],s=o[(i+4)/4],l=o[(i+8)/4],u=o[(e+0)/4],c=o[(e+4)/4],h=o[(e+8)/4];this.geometry.attributes.position.setXYZ(this.index,u,c,h),this.geometry.attributes.color.setXYZ(this.index++,a,s,l);var d=o[(t+0)/4]*n,f=o[(t+4)/4]*n,p=o[(t+8)/4]*n;this.geometry.attributes.position.setXYZ(this.index,u+d,c+f,h+p),this.geometry.attributes.color.setXYZ(this.index++,a,s,l)}},{key:"reportErrorWarning",value:function(e){Ammo.hasOwnProperty("Pointer_stringify")?console.warn(Ammo.Pointer_stringify(e)):this.warnedOnce||(this.warnedOnce=!0,console.warn("Cannot print warningString, please rebuild Ammo.js using 'debug' flag"))}},{key:"draw3dText",value:function(e,t){console.warn("TODO: draw3dText")}},{key:"setDebugMode",value:function(e){this.debugDrawMode=e}},{key:"getDebugMode",value:function(){return this.debugDrawMode}}]),e}(),Zi=Gi,Wi=(n(2262),n(4506),0),Xi=1,qi=new u.Pa4,Ki=new u.Zzh,Yi=new u.JOQ,Qi=new u.Pa4,Ji=new u.CJI,$i=function(){function e(){(0,s.Z)(this,e),this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new ro,this.unassigned=new ro,this.vertices=[]}return(0,l.Z)(e,[{key:"setFromPoints",value:function(e){if(e.length>=4){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.vertices.push(new no(e[t]));this.compute()}return this}},{key:"setFromObject",value:function(e){var t=[];return e.updateMatrixWorld(!0),e.traverse((function(e){var n=e.geometry;if(void 0!==n){if(n.isGeometry)return void console.error("THREE.ConvexHull no longer supports Geometry. Use THREE.BufferGeometry instead.");if(n.isBufferGeometry){var r=n.attributes.position;if(void 0!==r)for(var i=0,o=r.count;i<o;i++){var a=new u.Pa4;a.fromBufferAttribute(r,i).applyMatrix4(e.matrixWorld),t.push(a)}}}})),this.setFromPoints(t)}},{key:"containsPoint",value:function(e){for(var t=this.faces,n=0,r=t.length;n<r;n++){var i=t[n];if(i.distanceToPoint(e)>this.tolerance)return!1}return!0}},{key:"intersectRay",value:function(e,t){for(var n=this.faces,r=-1/0,i=1/0,o=0,a=n.length;o<a;o++){var s=n[o],l=s.distanceToPoint(e.origin),u=s.normal.dot(e.direction);if(l>0&&u>=0)return null;var c=0!==u?-l/u:0;if(!(c<=0)&&(u>0?i=Math.min(c,i):r=Math.max(c,r),r>i))return null}return r!==-1/0?e.at(r,t):e.at(i,t),t}},{key:"intersectsRay",value:function(e){return null!==this.intersectRay(e,qi)}},{key:"makeEmpty",value:function(){return this.faces=[],this.vertices=[],this}},{key:"addVertexToFace",value:function(e,t){return e.face=t,null===t.outside?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this}},{key:"removeVertexFromFace",value:function(e,t){return e===t.outside&&(null!==e.next&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this}},{key:"removeAllVerticesFromFace",value:function(e){if(null!==e.outside){var t=e.outside,n=e.outside;while(null!==n.next&&n.next.face===e)n=n.next;return this.assigned.removeSubList(t,n),t.prev=n.next=null,e.outside=null,t}}},{key:"deleteFaceVertices",value:function(e,t){var n=this.removeAllVerticesFromFace(e);if(void 0!==n)if(void 0===t)this.unassigned.appendChain(n);else{var r=n;do{var i=r.next,o=t.distanceToPoint(r.point);o>this.tolerance?this.addVertexToFace(r,t):this.unassigned.append(r),r=i}while(null!==r)}return this}},{key:"resolveUnassignedPoints",value:function(e){if(!1===this.unassigned.isEmpty()){var t=this.unassigned.first();do{for(var n=t.next,r=this.tolerance,i=null,o=0;o<e.length;o++){var a=e[o];if(a.mark===Wi){var s=a.distanceToPoint(t.point);if(s>r&&(r=s,i=a),r>1e3*this.tolerance)break}}null!==i&&this.addVertexToFace(t,i),t=n}while(null!==t)}return this}},{key:"computeExtremes",value:function(){for(var e=new u.Pa4,t=new u.Pa4,n=[],r=[],i=0;i<3;i++)n[i]=r[i]=this.vertices[0];e.copy(this.vertices[0].point),t.copy(this.vertices[0].point);for(var o=0,a=this.vertices.length;o<a;o++){for(var s=this.vertices[o],l=s.point,c=0;c<3;c++)l.getComponent(c)<e.getComponent(c)&&(e.setComponent(c,l.getComponent(c)),n[c]=s);for(var h=0;h<3;h++)l.getComponent(h)>t.getComponent(h)&&(t.setComponent(h,l.getComponent(h)),r[h]=s)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e.x),Math.abs(t.x))+Math.max(Math.abs(e.y),Math.abs(t.y))+Math.max(Math.abs(e.z),Math.abs(t.z))),{min:n,max:r}}},{key:"computeInitialHull",value:function(){for(var e=this.vertices,t=this.computeExtremes(),n=t.min,r=t.max,i=0,o=0,a=0;a<3;a++){var s=r[a].point.getComponent(a)-n[a].point.getComponent(a);s>i&&(i=s,o=a)}var l,u,c=n[o],h=r[o];i=0,Ki.set(c.point,h.point);for(var d=0,f=this.vertices.length;d<f;d++){var p=e[d];if(p!==c&&p!==h){Ki.closestPointToPoint(p.point,!0,Qi);var v=Qi.distanceToSquared(p.point);v>i&&(i=v,l=p)}}i=-1,Yi.setFromCoplanarPoints(c.point,h.point,l.point);for(var m=0,y=this.vertices.length;m<y;m++){var g=e[m];if(g!==c&&g!==h&&g!==l){var x=Math.abs(Yi.distanceToPoint(g.point));x>i&&(i=x,u=g)}}var b=[];if(Yi.distanceToPoint(u.point)<0){b.push(eo.create(c,h,l),eo.create(u,h,c),eo.create(u,l,h),eo.create(u,c,l));for(var w=0;w<3;w++){var k=(w+1)%3;b[w+1].getEdge(2).setTwin(b[0].getEdge(k)),b[w+1].getEdge(1).setTwin(b[k+1].getEdge(0))}}else{b.push(eo.create(c,l,h),eo.create(u,c,h),eo.create(u,h,l),eo.create(u,l,c));for(var A=0;A<3;A++){var S=(A+1)%3;b[A+1].getEdge(2).setTwin(b[0].getEdge((3-A)%3)),b[A+1].getEdge(0).setTwin(b[S+1].getEdge(1))}}for(var M=0;M<4;M++)this.faces.push(b[M]);for(var T=0,P=e.length;T<P;T++){var C=e[T];if(C!==c&&C!==h&&C!==l&&C!==u){i=this.tolerance;for(var E=null,_=0;_<4;_++){var I=this.faces[_].distanceToPoint(C.point);I>i&&(i=I,E=this.faces[_])}null!==E&&this.addVertexToFace(C,E)}}return this}},{key:"reindexFaces",value:function(){for(var e=[],t=0;t<this.faces.length;t++){var n=this.faces[t];n.mark===Wi&&e.push(n)}return this.faces=e,this}},{key:"nextVertexToAdd",value:function(){if(!1===this.assigned.isEmpty()){var e,t=0,n=this.assigned.first().face,r=n.outside;do{var i=n.distanceToPoint(r.point);i>t&&(t=i,e=r),r=r.next}while(null!==r&&r.face===n);return e}}},{key:"computeHorizon",value:function(e,t,n,r){var i;this.deleteFaceVertices(n),n.mark=Xi,i=null===t?t=n.getEdge(0):t.next;do{var o=i.twin,a=o.face;a.mark===Wi&&(a.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,o,a,r):r.push(i)),i=i.next}while(i!==t);return this}},{key:"addAdjoiningFace",value:function(e,t){var n=eo.create(e,t.tail(),t.head());return this.faces.push(n),n.getEdge(-1).setTwin(t.twin),n.getEdge(0)}},{key:"addNewFaces",value:function(e,t){this.newFaces=[];for(var n=null,r=null,i=0;i<t.length;i++){var o=t[i],a=this.addAdjoiningFace(e,o);null===n?n=a:a.next.setTwin(r),this.newFaces.push(a.face),r=a}return n.next.setTwin(r),this}},{key:"addVertexToHull",value:function(e){var t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this}},{key:"cleanup",value:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}},{key:"compute",value:function(){var e;this.computeInitialHull();while(void 0!==(e=this.nextVertexToAdd()))this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}}]),e}(),eo=function(){function e(){(0,s.Z)(this,e),this.normal=new u.Pa4,this.midpoint=new u.Pa4,this.area=0,this.constant=0,this.outside=null,this.mark=Wi,this.edge=null}return(0,l.Z)(e,[{key:"getEdge",value:function(e){var t=this.edge;while(e>0)t=t.next,e--;while(e<0)t=t.prev,e++;return t}},{key:"compute",value:function(){var e=this.edge.tail(),t=this.edge.head(),n=this.edge.next.head();return Ji.set(e.point,t.point,n.point),Ji.getNormal(this.normal),Ji.getMidpoint(this.midpoint),this.area=Ji.getArea(),this.constant=this.normal.dot(this.midpoint),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)-this.constant}}],[{key:"create",value:function(t,n,r){var i=new e,o=new to(t,i),a=new to(n,i),s=new to(r,i);return o.next=s.prev=a,a.next=o.prev=s,s.next=a.prev=o,i.edge=o,i.compute()}}]),e}(),to=function(){function e(t,n){(0,s.Z)(this,e),this.vertex=t,this.prev=null,this.next=null,this.twin=null,this.face=n}return(0,l.Z)(e,[{key:"head",value:function(){return this.vertex}},{key:"tail",value:function(){return this.prev?this.prev.vertex:null}},{key:"length",value:function(){var e=this.head(),t=this.tail();return null!==t?t.point.distanceTo(e.point):-1}},{key:"lengthSquared",value:function(){var e=this.head(),t=this.tail();return null!==t?t.point.distanceToSquared(e.point):-1}},{key:"setTwin",value:function(e){return this.twin=e,e.twin=this,this}}]),e}(),no=(0,l.Z)((function e(t){(0,s.Z)(this,e),this.point=t,this.prev=null,this.next=null,this.face=null})),ro=function(){function e(){(0,s.Z)(this,e),this.head=null,this.tail=null}return(0,l.Z)(e,[{key:"first",value:function(){return this.head}},{key:"last",value:function(){return this.tail}},{key:"clear",value:function(){return this.head=this.tail=null,this}},{key:"insertBefore",value:function(e,t){return t.prev=e.prev,t.next=e,null===t.prev?this.head=t:t.prev.next=t,e.prev=t,this}},{key:"insertAfter",value:function(e,t){return t.prev=e,t.next=e.next,null===t.next?this.tail=t:t.next.prev=t,e.next=t,this}},{key:"append",value:function(e){return null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this}},{key:"appendChain",value:function(e){null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail;while(null!==e.next)e=e.next;return this.tail=e,this}},{key:"remove",value:function(e){return null===e.prev?this.head=e.next:e.prev.next=e.next,null===e.next?this.tail=e.prev:e.next.prev=e.prev,this}},{key:"removeSubList",value:function(e,t){return null===e.prev?this.head=t.next:e.prev.next=t.next,null===t.next?this.tail=e.prev:t.next.prev=e.prev,this}},{key:"isEmpty",value:function(){return null===this.head}}]),e}(),io=function(e){(0,h.Z)(n,e);var t=(0,d.Z)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];(0,s.Z)(this,n),e=t.call(this);var i=[],o=[];void 0===$i&&console.error("THREE.ConvexBufferGeometry: ConvexBufferGeometry relies on ConvexHull");for(var a=(new $i).setFromPoints(r),l=a.faces,c=0;c<l.length;c++){var h=l[c],d=h.edge;do{var f=d.head().point;i.push(f.x,f.y,f.z),o.push(h.normal.x,h.normal.y,h.normal.z),d=d.next}while(d!==h.edge)}return e.setAttribute("position",new u.a$l(i,3)),e.setAttribute("normal",new u.a$l(o,3)),e}return(0,l.Z)(n)}(u.u9r),oo=function(e){var t=window.THREE&&window.THREE.ConvexGeometry?window.THREE.ConvexGeometry:io;return new t(e)},ao=function(e,t){this.minSizeForBreak=e||1.4,this.smallDelta=t||1e-4,this.tempLine1=new u.Zzh,this.tempPlane1=new u.JOQ,this.tempPlane2=new u.JOQ,this.tempPlane_Cut=new u.JOQ,this.tempCM1=new u.Pa4,this.tempCM2=new u.Pa4,this.tempVector3=new u.Pa4,this.tempVector3_2=new u.Pa4,this.tempVector3_3=new u.Pa4,this.tempVector3_P0=new u.Pa4,this.tempVector3_P1=new u.Pa4,this.tempVector3_P2=new u.Pa4,this.tempVector3_N0=new u.Pa4,this.tempVector3_N1=new u.Pa4,this.tempVector3_AB=new u.Pa4,this.tempVector3_CB=new u.Pa4,this.tempResultObjects={object1:null,object2:null},this.segments=[];for(var n=900,r=0;r<n;r++)this.segments[r]=!1};ao.prototype={constructor:ao,prepareBreakableObject:function(e,t,n,r,i){e.geometry.isBufferGeometry||console.error("THREE.ConvexObjectBreaker.prepareBreakableObject(): Parameter object must have a BufferGeometry."),e.userData.ammoPhysicsData={};var o=e.userData.ammoPhysicsData;o.mass=t,o.velocity=n.clone(),o.angularVelocity=r.clone(),o.breakable=i},subdivideByImpact:function(e,t,n,r,i){var o=[],a=this.tempPlane1,s=this.tempPlane2;this.tempVector3.addVectors(t,n),a.setFromCoplanarPoints(t,e.position,this.tempVector3);var l=i+r,u=this;function c(i,h,d,f){if(Math.random()<.05*f||f>l)o.push(i);else{var p=Math.PI;0===f?(s.normal.copy(a.normal),s.constant=a.constant):f<=r?(p=(d-h)*(.2+.6*Math.random())+h,u.tempVector3_2.copy(e.position).sub(t).applyAxisAngle(n,p).add(t),s.setFromCoplanarPoints(t,u.tempVector3,u.tempVector3_2)):(p=(.5*(1&f)+.2*(2-Math.random()))*Math.PI,u.tempVector3_2.copy(t).sub(i.position).applyAxisAngle(n,p).add(i.position),u.tempVector3_3.copy(n).add(i.position),s.setFromCoplanarPoints(i.position,u.tempVector3_3,u.tempVector3_2)),u.cutByPlane(i,s,u.tempResultObjects);var v=u.tempResultObjects.object1,m=u.tempResultObjects.object2;v&&c(v,h,p,f+1),m&&c(m,p,d,f+1)}}return c(e,0,2*Math.PI,0),o},cutByPlane:function(e,t,n){var r=e.geometry,i=r.attributes.position.array,o=r.attributes.normal.array,a=i.length/3,s=a/3,l=r.getIndex();function c(e,t){var n=3*e+t;return l?l[n]:n}l&&(l=l.array,s=l.length/3);for(var h=[],d=[],f=this.smallDelta,p=a*a,v=0;v<p;v++)this.segments[v]=!1;var m=this.tempVector3_P0,y=this.tempVector3_P1,g=this.tempVector3_N0,x=this.tempVector3_N1;for(v=0;v<s-1;v++){var b=c(v,0),w=c(v,1),k=c(v,2);g.set(o[b],o[b]+1,o[b]+2);for(var A=v+1;A<s;A++){var S=c(A,0),M=c(A,1),T=c(A,2);x.set(o[S],o[S]+1,o[S]+2);var P=1-g.dot(x)<f;P&&(b===S||b===M||b===T?w===S||w===M||w===T?(this.segments[b*a+w]=!0,this.segments[w*a+b]=!0):(this.segments[k*a+b]=!0,this.segments[b*a+k]=!0):w!==S&&w!==M&&w!==T||(this.segments[k*a+w]=!0,this.segments[w*a+k]=!0))}}var C=this.tempPlane_Cut;e.updateMatrix(),ao.transformPlaneToLocalSpace(t,e.matrix,C);for(v=0;v<s;v++)for(var E=c(v,0),_=c(v,1),I=c(v,2),R=0;R<3;R++){var L=0===R?E:1===R?_:I,B=0===R?_:1===R?I:E,N=this.segments[L*a+B];if(!N){this.segments[L*a+B]=!0,this.segments[B*a+L]=!0,m.set(i[3*L],i[3*L+1],i[3*L+2]),y.set(i[3*B],i[3*B+1],i[3*B+2]);var O=0,V=C.distanceToPoint(m);V>f?(O=2,d.push(m.clone())):V<-f?(O=1,h.push(m.clone())):(O=3,h.push(m.clone()),d.push(m.clone()));var D=0;V=C.distanceToPoint(y);if(V>f?(D=2,d.push(y.clone())):V<-f?(D=1,h.push(y.clone())):(D=3,h.push(y.clone()),d.push(y.clone())),1===O&&2===D||2===O&&1===D){this.tempLine1.start.copy(m),this.tempLine1.end.copy(y);var F=new u.Pa4;if(F=C.intersectLine(this.tempLine1,F),void 0===F)return console.error("Internal error: segment does not intersect plane."),n.segmentedObject1=null,n.segmentedObject2=null,0;h.push(F),d.push(F.clone())}}}var U=.5*e.userData.ammoPhysicsData.mass;this.tempCM1.set(0,0,0);var j=0,z=h.length;if(z>0){for(v=0;v<z;v++)this.tempCM1.add(h[v]);this.tempCM1.divideScalar(z);for(v=0;v<z;v++){var H=h[v];H.sub(this.tempCM1),j=Math.max(j,H.x,H.y,H.z)}this.tempCM1.add(e.position)}this.tempCM2.set(0,0,0);var G=0,Z=d.length;if(Z>0){for(v=0;v<Z;v++)this.tempCM2.add(d[v]);this.tempCM2.divideScalar(Z);for(v=0;v<Z;v++){H=d[v];H.sub(this.tempCM2),G=Math.max(G,H.x,H.y,H.z)}this.tempCM2.add(e.position)}var W=null,X=null,q=0;if(z>4)try{W=new u.Kj0(oo(h),e.material),W.position.copy(this.tempCM1),W.quaternion.copy(e.quaternion),W.userData=e.userData,this.prepareBreakableObject(W,U,e.userData.ammoPhysicsData.velocity,e.userData.ammoPhysicsData.angularVelocity,2*j>this.minSizeForBreak),q++}catch(K){Gr("Error in ConvexObjectBreaker.ts",!0),Gr(K,!0)}if(Z>4)try{X=new u.Kj0(oo(d),e.material),X.position.copy(this.tempCM2),X.quaternion.copy(e.quaternion),X.userData=e.userData,this.prepareBreakableObject(X,U,e.userData.ammoPhysicsData.velocity,e.userData.ammoPhysicsData.angularVelocity,2*G>this.minSizeForBreak),q++}catch(K){Gr("Error in ConvexObjectBreaker.ts",!0),Gr(K,!0)}return n.object1=W,n.object2=X,q}},ao.transformFreeVector=function(e,t){var n=e.x,r=e.y,i=e.z,o=t.elements;return e.x=o[0]*n+o[4]*r+o[8]*i,e.y=o[1]*n+o[5]*r+o[9]*i,e.z=o[2]*n+o[6]*r+o[10]*i,e},ao.transformFreeVectorInverse=function(e,t){var n=e.x,r=e.y,i=e.z,o=t.elements;return e.x=o[0]*n+o[1]*r+o[2]*i,e.y=o[4]*n+o[5]*r+o[6]*i,e.z=o[8]*n+o[9]*r+o[10]*i,e},ao.transformTiedVectorInverse=function(e,t){var n=e.x,r=e.y,i=e.z,o=t.elements;return e.x=o[0]*n+o[1]*r+o[2]*i-o[12],e.y=o[4]*n+o[5]*r+o[6]*i-o[13],e.z=o[8]*n+o[9]*r+o[10]*i-o[14],e},ao.transformPlaneToLocalSpace=function(){var e=new u.Pa4;return function(t,n,r){r.normal.copy(t.normal),r.constant=t.constant;var i=ao.transformTiedVectorInverse(t.coplanarPoint(e),n);ao.transformFreeVectorInverse(r.normal,n),r.constant=-i.dot(r.normal)}}();n(5206);var so=function(){try{if("object"===("undefined"===typeof WebAssembly?"undefined":(0,f.Z)(WebAssembly))&&"function"===typeof WebAssembly.instantiate){var e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(e instanceof WebAssembly.Module)return new WebAssembly.Instance(e)instanceof WebAssembly.Instance}}catch(t){t instanceof Error&&console.error(t.message)}return!1}(),lo=function(e,t){var n=document.createElement("script");n.onload=function(){t()},n.onerror=function(){throw new Error("failed to load ".concat(e))},n.async=!0,n.src=e,document.head.appendChild(n)},uo=function(e,t){lo("".concat(e,so?"/ammo.wasm.js":"/ammo.js"),(function(){return t()}))},co=uo,ho=function(e,t){"undefined"!==typeof window&&(window.__loadPhysics=!0),co(e,(function(){Ammo().then((function(){t()}))}))};n(6210);function fo(e,t){t.forEach((function(t){Object.getOwnPropertyNames(t.prototype).forEach((function(n){Object.defineProperty(e.prototype,n,Object.getOwnPropertyDescriptor(t.prototype,n)||Object.create(null))}))}))}var po=fo,vo=function(){function e(t){(0,s.Z)(this,e),this.physics=t}return(0,l.Z)(e,[{key:"getHitPointWorld",value:function(){var e=this._btRayCallback.get_m_hitPointWorld(),t={x:e.x(),y:e.y(),z:e.z()};return t}},{key:"getHitNormalWorld",value:function(){var e=this._btRayCallback.get_m_hitNormalWorld(),t={x:e.x(),y:e.y(),z:e.z()};return t}},{key:"getCollisionObject",value:function(){var e=Ammo.castObject(this._btRayCallback.get_m_collisionObject(),Ammo.btRigidBody);return e.threeObject}}]),e}(),mo=function(){function e(t){(0,s.Z)(this,e),this.physics=t}return(0,l.Z)(e,[{key:"getHitPointsWorld",value:function(){for(var e=this._btRayCallback.get_m_hitPointWorld(),t=[],n=e.size()-1;n>=0;n--){var r=e.at(n);t.push({x:r.x(),y:r.y(),z:r.z()})}return t}},{key:"getHitPointWorld",value:function(){return Gr("Use getHitPointsWorld() instead of getHitPointWorld() for the AllHitsRayCaster!"),this.getHitPointsWorld()}},{key:"getHitNormalsWorld",value:function(){for(var e=this._btRayCallback.get_m_hitNormalWorld(),t=[],n=e.size()-1;n>=0;n--){var r=e.at(n);t.push({x:r.x(),y:r.y(),z:r.z()})}return t}},{key:"getCollisionObjects",value:function(){for(var e=[],t=this._btRayCallback.get_m_collisionObjects(),n=t.size()-1;n>=0;n--){var r=Ammo.castObject(t.at(n),Ammo.btRigidBody);e.push(r.threeObject)}return e}}]),e}(),yo=function(){function e(t){(0,s.Z)(this,e),this.physics=t}return(0,l.Z)(e,[{key:"setRayFromWorld",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._btRayFrom.setValue(e,t,n)}},{key:"setRayToWorld",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._btRayTo.setValue(e,t,n)}},{key:"hasHit",value:function(){return this._btRayCallback.hasHit()}},{key:"rayTest",value:function(){"undefined"!==typeof this._btRayCallback&&Ammo.destroy(this._btRayCallback),this._btRayCallback="closest"===this.type?new Ammo.ClosestRayResultCallback(this._btRayFrom,this._btRayTo):new Ammo.AllHitsRayResultCallback(this._btRayFrom,this._btRayTo),this.physics.physicsWorld.rayTest(this._btRayFrom,this._btRayTo,this._btRayCallback)}},{key:"destroy",value:function(){"undefined"!==typeof this._btRayFrom&&Ammo.destroy(this._btRayFrom),"undefined"!==typeof this._btRayTo&&Ammo.destroy(this._btRayTo),"undefined"!==typeof this._btRayCallback&&Ammo.destroy(this._btRayCallback)}}]),e}(),go=(0,l.Z)((function e(t){(0,s.Z)(this,e),this.physics=t,this.type="closest",this._btRayFrom=new Ammo.btVector3(0,0,0),this._btRayTo=new Ammo.btVector3(0,0,0)})),xo=(0,l.Z)((function e(t){(0,s.Z)(this,e),this.physics=t,this.type="allHits",this._btRayFrom=new Ammo.btVector3(0,0,0),this._btRayTo=new Ammo.btVector3(0,0,0)}));po(go,[yo,vo]),po(xo,[yo,mo]);var bo=n(8423),wo=bo.createHACDShapes,ko=bo.createHullShape,Ao=bo.createTriMeshShape,So=bo.createVHACDShapes,Mo=bo.iterateGeometries,To=function(e){(0,h.Z)(n,e);var t=(0,d.Z)(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.Z)(this,n),r=t.call(this),r.scene=e,r.config=i,r.rigidBodies=[],r.earlierDetectedCollisions=[],r.complexShapes=["plane","hull","hacd","vhacd","convexMesh","concaveMesh"],r.gravity=i.gravity||{x:0,y:-9.81,z:0},r.isHeadless="headless"===e,r.tmpEuler=new u.USm,r.tmpQuaternion=new u._fP,r.tmpVector3=new u.Pa4,r.tmpVector3a=new u.Pa4,r.tmpMatrix4=new u.yGw,r.tmpMatrix4a=new u.yGw,r.tmpBtVector3=new Ammo.btVector3,r.tmpBtQuaternion=new Ammo.btQuaternion(0,0,0,1),r.emptyV3=new u.Pa4,r.impactPoint=new u.Pa4,r.impactNormal=new u.Pa4,"headless"!==e&&(r.defaultMaterial=new Wr),r.start(),r}return(0,l.Z)(n,[{key:"tmpTrans",get:function(){return console.warn("Use worldTransform instead of tmpTrans."),this.worldTransform},set:function(e){console.warn("Use worldTransform instead of tmpTrans."),this.worldTransform=e}},{key:"destroy",value:function(e){var t,n=Object.keys(e).includes("body")?e.body:e;if("undefined"!==typeof(null===n||void 0===n?void 0:n.ammo)){var r=n.ammo.threeObject,i=r.name;if(i&&r&&(null===(t=null===r||void 0===r?void 0:r.body)||void 0===t?void 0:t.ammo)){r.body.isSoftBody?this.physicsWorld.removeSoftBody(r.body.ammo):this.physicsWorld.removeRigidBody(r.body.ammo),r.body.destructor(),r.body=void 0,r.hasBody=!1,delete n.ammo.threeObject;for(var o=0;o<this.rigidBodies.length;o++)this.rigidBodies[o].name===i&&(this.rigidBodies.splice(o,1),o--)}"headless"===this.scene&&r&&(r=null)}}},{key:"setup",value:function(){var e=this;if(this.worldTransform=new Ammo.btTransform,"function"===typeof this.config.setupPhysicsWorld?this.physicsWorld=this.config.setupPhysicsWorld():this.physicsWorld=this.setupPhysicsWorld(),"headless"!==this.scene){this.convexBreaker=new ao,this.objectsToRemove=[],this.numObjectsToRemove=0;for(var t=0;t<500;t++)this.objectsToRemove[t]=null}this.collisionEvents=new zi,this.factory=new qr(this.scene),this.shapes=new Fi(this.factory,(function(t,n){return e.addExisting(t,n)})),this.constraints=new Ui(this.worldTransform,this.physicsWorld),"headless"!==this.scene&&(this.debugDrawer=new Zi(this.scene,this.physicsWorld,{}))}},{key:"updateDebugger",value:function(){"headless"!==this.scene&&this.debugDrawer&&this.debugDrawer.enabled&&this.debugDrawer.update()}},{key:"setupPhysicsWorld",value:function(){var e,t=this.gravity,n=this.config.softBodies,r=void 0!==n&&n;if(!r){var i=new Ammo.btDefaultCollisionConfiguration,o=new Ammo.btCollisionDispatcher(i),a=new Ammo.btDbvtBroadphase,s=new Ammo.btSequentialImpulseConstraintSolver;e=new Ammo.btDiscreteDynamicsWorld(o,a,s,i)}if(r){var l=new Ammo.btSoftBodyRigidBodyCollisionConfiguration,u=new Ammo.btCollisionDispatcher(l),c=new Ammo.btDbvtBroadphase,h=new Ammo.btSequentialImpulseConstraintSolver,d=new Ammo.btDefaultSoftBodySolver;e=new Ammo.btSoftRigidDynamicsWorld(u,c,h,l,d)}return e.setGravity(new Ammo.btVector3(t.x,t.y,t.z)),e}},{key:"createDebrisFromBreakableObject",value:function(e,t){"headless"!==this.scene&&(e.material=t.material,e.shape="hull",e.fragmentDepth=t.fragmentDepth+1,e.name="".concat(t.name,"__DEBRIS_").concat(e.id),this.scene.add(e),this.addExisting(e,{autoCenter:!0}),e.body.fractureImpulse=t.body.fractureImpulse,e.body.breakable=!1,setTimeout((function(){e.body.breakable=!0}),2500))}},{key:"removeDebris",value:function(e){"headless"!==this.scene&&(this.scene.remove(e),this.destroy(e))}},{key:"update",value:function(e){this.updatePhysics(e),this.detectCollisions()}},{key:"updatePhysics",value:function(e){var t=e/1e3;this.physicsWorld.stepSimulation(t,this.config.maxSubSteps||4,this.config.fixedTimeStep||1/60);for(var n=0;n<this.rigidBodies.length;n++){var r=this.rigidBodies[n],i=r.body.ammo,o=i.getMotionState();if(o)if(o.getWorldTransform(this.worldTransform),r.body.didUpdate&&(r.body._emitUpdateEvents&&r.body.eventEmitter.emit("update"),r.body.didUpdate=!1),r.body.ammo.isKinematicObject()&&r.body.needUpdate)r.getWorldQuaternion(this.tmpQuaternion),r.getWorldPosition(this.tmpVector3),this.tmpBtVector3.setValue(this.tmpVector3.x,this.tmpVector3.y,this.tmpVector3.z),this.tmpBtQuaternion.setValue(this.tmpQuaternion.x,this.tmpQuaternion.y,this.tmpQuaternion.z,this.tmpQuaternion.w),this.worldTransform.setOrigin(this.tmpBtVector3),this.worldTransform.setRotation(this.tmpBtQuaternion),o.setWorldTransform(this.worldTransform),r.body.needUpdate=!1;else if(r.body.skipUpdate);else if(!r.body.ammo.isStaticObject()){var a=this.worldTransform.getOrigin(),s=this.worldTransform.getRotation(),l=r.body.offset;if(r.body.ignoreScale)this.tmpVector3a.set(r.scale.x,r.scale.y,r.scale.z);else{var c=r.body.ammo.getCollisionShape().getLocalScaling();this.tmpVector3a.set(c.x(),c.y(),c.z())}this.tmpVector3.set(a.x()+l.x,a.y()+l.y,a.z()+l.z),this.tmpQuaternion.set(s.x(),s.y(),s.z(),s.w()),this.tmpMatrix4.compose(this.tmpVector3,this.tmpQuaternion,this.tmpVector3a),r.parent?parseInt(u.UZH)>=123?this.tmpMatrix4a.copy(r.parent.matrixWorld).invert():this.tmpMatrix4a.getInverse(r.parent.matrixWorld):this.tmpMatrix4a.identity(),this.tmpMatrix4a.multiply(this.tmpMatrix4),this.tmpMatrix4a.decompose(r.position,r.quaternion,r.scale)}}}},{key:"detectCollisions",value:function(){var e,t,n=this,r=[];this.impactPoint.set(0,0,0),this.impactNormal.set(0,0,0);for(var i=this.physicsWorld.getDispatcher(),o=i.getNumManifolds(),a=0;a<o;a++){var s=i.getManifoldByIndexInternal(a),l=s.getNumContacts(),u=Ammo.castObject(s.getBody0(),Ammo.btRigidBody),c=Ammo.castObject(s.getBody1(),Ammo.btRigidBody),h=u.threeObject,d=c.threeObject;if(h&&d&&(""!==u.name||""!==c.name)){var f=null===(e=h.body)||void 0===e?void 0:e.checkCollisions,p=null===(t=d.body)||void 0===t?void 0:t.checkCollisions,v=h.body.breakable,m=d.body.breakable,y=h.body.fractureImpulse,g=d.body.fractureImpulse,x=f||p,b=v||m;if("undefined"===typeof h.fragmentDepth&&(h.fragmentDepth=0),"undefined"===typeof d.fragmentDepth&&(d.fragmentDepth=0),x||b){for(var w=!1,k=0,A="start",S=0;S<l;S++){var M=s.getContactPoint(S),T=M.getDistance();if(T<=0){w=!0;var P=M.getAppliedImpulse(),C=M.get_m_positionWorldOnB(),E=M.get_m_normalWorldOnB();(f||p)&&function(){var e=[h.uuid,d.uuid].sort(),t="".concat(e[0],"__").concat(e[1]);n.earlierDetectedCollisions.find((function(e){return e.combinedName===t}))&&(A="collision"),r.find((function(e){return e.combinedName===t}))||(r.push({combinedName:t,collision:!0}),n.collisionEvents.emit("collision",{bodies:[h,d],event:A}))}(),P>=k&&(k=P,(v||m)&&(this.impactPoint.set(C.x(),C.y(),C.z()),this.impactNormal.set(E.x(),E.y(),E.z())));break}}if(w&&b){var _=2;if(this.emptyV3.set(0,0,0),h.userData.ammoPhysicsData={mass:1,velocity:this.emptyV3,angularVelocity:this.emptyV3,breakable:v,physicsBody:u},d.userData.ammoPhysicsData={mass:1,velocity:this.emptyV3,angularVelocity:this.emptyV3,breakable:m,physicsBody:c},v&&k>y&&h.fragmentDepth<_){for(var I=this.convexBreaker.subdivideByImpact(h,this.impactPoint,this.impactNormal,1,2),R=I.length,L=0;L<R;L++){var B=u.getLinearVelocity(),N=u.getAngularVelocity(),O=I[L];O.userData.ammoPhysicsData.velocity.set(B.x(),B.y(),B.z()),O.userData.ammoPhysicsData.angularVelocity.set(N.x(),N.y(),N.z()),this.createDebrisFromBreakableObject(O,h)}this.objectsToRemove[this.numObjectsToRemove++]=h}if(m&&k>g&&d.fragmentDepth<_){for(var V=this.convexBreaker.subdivideByImpact(d,this.impactPoint,this.impactNormal,1,2),D=V.length,F=0;F<D;F++){var U=c.getLinearVelocity(),j=c.getAngularVelocity(),z=V[F];z.userData.ammoPhysicsData.velocity.set(U.x(),U.y(),U.z()),z.userData.ammoPhysicsData.angularVelocity.set(j.x(),j.y(),j.z()),this.createDebrisFromBreakableObject(z,d)}this.objectsToRemove[this.numObjectsToRemove++]=d}}}}}for(var H=0;H<this.numObjectsToRemove;H++)this.removeDebris(this.objectsToRemove[H]);this.numObjectsToRemove=0,this.earlierDetectedCollisions.forEach((function(e){var t=e.combinedName;if(!r.find((function(e){return e.combinedName===t}))){var i=t.split("__"),o=n.rigidBodies.find((function(e){return e.uuid===i[0]})),a=n.rigidBodies.find((function(e){return e.uuid===i[1]})),s="end";o&&a&&n.collisionEvents.emit("collision",{bodies:[o,a],event:s})}})),this.earlierDetectedCollisions=[].concat(r)}},{key:"setGravity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-9.8,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.tmpBtVector3.setValue(e,t,n),this.physicsWorld.setGravity(this.tmpBtVector3)}},{key:"debug",get:function(){var e=this;return this.isHeadless?null:{enable:function(){e.debugDrawer.enable()},mode:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;e.debugDrawer.setDebugMode(t)},disable:function(){e.debugDrawer.disable()}}}},{key:"start",value:function(){var e=this;"undefined"!==typeof Ammo?"function"===typeof Ammo?Ammo().then((function(){e.setup()})):this.setup():Gr("Are you sure you included ammo.js?")}},{key:"add",get:function(){var e=this;return{collider:function(t,n,r){return e.collisionEvents.addCollider(t,n,r)},constraints:this.constraints.addConstraints,existing:function(t,n){return e.addExisting(t,n)},plane:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.shapes.addPlane(t,n)},sphere:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.shapes.addSphere(t,n)},ground:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.shapes.addGround(t,n)},box:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.shapes.addBox(t,n)},cylinder:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.shapes.addCylinder(t,n)},cone:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.shapes.addCone(t,n)},torus:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.shapes.addTorus(t,n)},extrude:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.shapes.addExtrude(t,n)},raycaster:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"closest";return"closest"===t?new go(e):new xo(e)}}}},{key:"prepareThreeObjectForCollisionShape",value:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.autoCenter,o=void 0!==i&&i,a={width:1,height:1,depth:1,radius:1,radiusTop:1,radiusBottom:1,tube:.4,tubularSegments:6},s="unknown",l=(null===(t=e.geometry)||void 0===t?void 0:t.type)||"unknown";/box/i.test(l)?s="box":/cone/i.test(l)?s="cone":/cylinder/i.test(l)?s="cylinder":/extrude/i.test(l)?s="extrude":/plane/i.test(l)?s="plane":/sphere/i.test(l)?s="sphere":/torus/i.test(l)&&(s="torus");var u=Object.assign(Object.assign({},a),null===(n=null===e||void 0===e?void 0:e.geometry)||void 0===n?void 0:n.parameters);return r.shape?(u=Object.assign(Object.assign({},a),r),s=r.shape):e.shape&&(s=e.shape),Object.keys(u).forEach((function(e){"undefined"===typeof u[e]&&a[e]&&(u[e]=a[e])})),o&&e.geometry.center(),"cylinder"===s&&(u.radius=r.radius||u.radiusTop),"extrude"===s&&(s="hacd"),"mesh"!==s&&"convex"!==s||(s="convexMesh"),"concave"===s&&(s="concaveMesh"),"unknown"===s&&(Gr("Shape for ".concat(null===e||void 0===e?void 0:e.name," not recognized! Will fallback to box.")),s="box"),{shape:s,params:u,object:e}}},{key:"createCollisionShape",value:function(e,t,n){var r=(null===n||void 0===n?void 0:n.quaternion)?null===n||void 0===n?void 0:n.quaternion:new u._fP(0,0,0,1),i=t.axis,o=void 0===i?"y":i,a=new Ammo.btVector3,s=null===n||void 0===n?void 0:n.geometry;n&&(null===s||void 0===s?void 0:s.isGeometry)&&(n.geometry=(new u.u9r).fromGeometry(s));var l,c=function(e){var t=(new u.yGw).elements,n=[],r=[],i=[];return Mo(e,{},(function(e,t,o){n.push(e),r.push(t),i.push(o)})),{vertices:n,matrices:r,indexes:i,matrixWorld:t}},h={};switch(-1!==this.complexShapes.indexOf(e)&&(h=c(n)),e){case"box":a.setValue(t.width/2,t.height/2,t.depth/2),l=new Ammo.btBoxShape(a);break;case"sphere":l=new Ammo.btSphereShape(t.radius);break;case"cylinder":switch(o){case"y":a.setValue(t.radius,t.height/2,t.radius),l=new Ammo.btCylinderShape(a);break;case"x":a.setValue(t.height/2,t.radius,t.radius),l=new Ammo.btCylinderShapeX(a);break;case"z":a.setValue(t.radius,t.radius,t.height/2),l=new Ammo.btCylinderShapeZ(a);break}break;case"cone":switch(o){case"y":l=new Ammo.btConeShape(t.radius,t.height);break;case"x":l=new Ammo.btConeShapeX(t.radius,t.height);break;case"z":l=new Ammo.btConeShapeZ(t.radius,t.height);break}break;case"capsule":switch(o){case"y":l=new Ammo.btCapsuleShape(t.radius,t.height);break;case"x":l=new Ammo.btCapsuleShapeX(t.radius,t.height);break;case"z":l=new Ammo.btCapsuleShapeZ(t.radius,t.height);break}break;case"torus":l=ji(t,r);break;case"plane":l=Ao(h.vertices,h.matrices,h.indexes,h.matrixWorld,Object.assign(Object.assign({},t),{concave:!1}));break;case"hull":l=ko(h.vertices,h.matrices,h.matrixWorld,t);break;case"hacd":l=wo(h.vertices,h.matrices,h.indexes,h.matrixWorld,t);break;case"vhacd":l=So(h.vertices,h.matrices,h.indexes,h.matrixWorld,t);break;case"convexMesh":l=Ao(h.vertices,h.matrices,h.indexes,h.matrixWorld,Object.assign(Object.assign({},t),{concave:!1}));break;case"concaveMesh":l=Ao(h.vertices,h.matrices,h.indexes,h.matrixWorld,Object.assign(Object.assign({},t),{concave:!0}));break}Ammo.destroy(a);var d=t.x,f=t.y,p=t.z;return(d||f||p)&&(l._compoundOffset={x:d||0,y:f||0,z:p||0}),Array.isArray(l)&&(l=this.mergeCollisionShapesToCompoundShape(l)),l}},{key:"mergeCollisionShapesToCompoundShape",value:function(e){var t=this,n=new Ammo.btCompoundShape;return e.forEach((function(e){var r=e._childOffset,i=e._compoundOffset;if(r){var o=r.pos,a=r.quat,s=r.scale,l=r.margin,u=t.applyPosQuatScaleMargin(e,o,a,s,l);n.addChildShape(u,e)}else if(i){var c=new Ammo.btTransform;c.setIdentity(),c.setOrigin(new Ammo.btVector3(i.x,i.y,i.z)),n.addChildShape(c,e)}else{var h=new Ammo.btTransform;h.setIdentity(),n.addChildShape(h,e)}})),n}},{key:"addExisting",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.hasBody;if(r)Gr('Object "'.concat(e.name,'" already has a physical body!'));else{var i=new u.Pa4,o=new u._fP,a=new u.Pa4;e.getWorldPosition(i),e.getWorldQuaternion(o),e.getWorldScale(a);var s="1"===(n.collisionFlags||0).toString(2).slice(-1),l="1"===(n.collisionFlags||0).toString(2).slice(-2,-1),c=n.shape,h=void 0===c?"unknown":c,d=n.compound,f=void 0===d?[]:d,p=n.mass,v=void 0===p?s||l?0:1:p,m=n.collisionFlags,y=void 0===m?0:m,g=n.collisionGroup,x=void 0===g?1:g,b=n.collisionMask,w=void 0===b?-1:b,k=n.offset,A=void 0===k?void 0:k,S=n.breakable,M=void 0!==S&&S,T=n.addChildren,P=void 0===T||T,C=n.margin,E=void 0===C?.01:C,_=n.ignoreScale,I=void 0!==_&&_,R=n.fractureImpulse,L=void 0===R?1:R;if(I&&a.set(1,1,1),f.length>=1){var B=f.map((function(e){return t.createCollisionShape(e.shape,e)})),N=this.mergeCollisionShapesToCompoundShape(B),O=this.applyPosQuatScaleMargin(N,i,o,a,E),V=this.collisionShapeToRigidBody(N,O,v,l);return this.addRigidBodyToWorld(e,V,y,x,w,A),e.body.breakable=M,e.body.fractureImpulse=L,void(e.body.ignoreScale=I)}var D=[];if("unknown"!==h||e.isMesh){var F=this.prepareThreeObjectForCollisionShape(e,n),U=this.createCollisionShape(F.shape,F.params,F.object);D.push(U)}if("unknown"===h&&P&&e.children.length>=1&&e.children.forEach((function(e){if(e.isMesh){var n=t.prepareThreeObjectForCollisionShape(e),r=t.createCollisionShape(n.shape,n.params,n.object);r._childOffset={pos:e.position.clone(),quat:e.quaternion.clone(),scale:e.scale.clone(),margin:E},D.push(r)}})),0===D.length){var j=this.prepareThreeObjectForCollisionShape(e,n),z=this.createCollisionShape(j.shape,j.params,j.object);D.push(z)}var H=1===D.length?D[0]:this.mergeCollisionShapesToCompoundShape(D),G=this.applyPosQuatScaleMargin(H,i,o,a,E),Z=this.collisionShapeToRigidBody(H,G,v,l);this.addRigidBodyToWorld(e,Z,y,x,w,A),e.body.breakable=M,e.body.fractureImpulse=L,e.body.ignoreScale=I}}},{key:"addRigidBodyToWorld",value:function(e,t,n,r,i,o){this.rigidBodies.push(e),this.physicsWorld.addRigidBody(t,r,i);var a=Object.values(t)[0];e.name||(e.name="object-".concat(e.id)),t.name=e.name,e.body=new Vi(this,t),e.hasBody=!0,e.ptr=a,t.threeObject=e,o&&(e.body.offset=Object.assign({x:0,y:0,z:0},o)),e.body.setCollisionFlags(n)}},{key:"applyPosQuatScaleMargin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new u.Pa4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new u._fP,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new u.Pa4,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.01;e.setMargin(i);var o=new Ammo.btQuaternion(0,0,0,1);o.setValue(n.x,n.y,n.z,n.w);var a=new Ammo.btTransform;a.setIdentity(),a.getOrigin().setValue(t.x,t.y,t.z),a.setRotation(o),Ammo.destroy(o);var s=new Ammo.btVector3(r.x,r.y,r.z);return e.setLocalScaling(s),Ammo.destroy(s),a}},{key:"collisionShapeToRigidBody",value:function(e,t,n,r){var i=new Ammo.btDefaultMotionState(t),o=new Ammo.btVector3(0,0,0);n>0&&e.calculateLocalInertia(n,o);var a=new Ammo.btRigidBodyConstructionInfo(n,i,e,o),s=new Ammo.btRigidBody(a);return(n>0||r)&&s.setActivationState(4),s}}]),n}(Ni.Events),Po=(0,l.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,s.Z)(this,e),this.threeGraphicsConfig=t;var n=t.alpha,r=void 0!==n&&n,i=t.anisotropy,o=void 0===i?1:i,a=t.camera,l=void 0===a?Ri.Perspective({z:25,y:5}):a,c=t.antialias,h=void 0!==c&&c,d=t.usePhysics,f=void 0===d||d,p=t.renderer;this.textureAnisotropy=o,this.camera=l,this.scene=new u.xsS,this.renderer=p||new u.CP7({antialias:h,alpha:r}),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=u.ntZ,this.cache=u.CtF,this.cache.enabled=!0,f&&("undefined"!==typeof Ammo?this.physics=new To(this.scene,t):Gr("Are you sure you included ammo.js?"))})),Co="0.24.0",Eo="Powered by enable3d v".concat(Co);console.log("%c %c %c %c %c ".concat(Eo," %c https://enable3d.io/"),"background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none");
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
var _o=function(e){(0,h.Z)(n,e);var t=(0,d.Z)(n);function n(e){var r,i;(0,s.Z)(this,n),r=t.call(this,e),r.projectConfig=e,r.scenes=new Map,r.renderer.setSize(window.innerWidth,window.innerHeight),r.projectConfig.parent?r.parent=document.getElementById(r.projectConfig.parent):r.parent=document.body,r.parent||(Gr('Parent "'.concat(r.projectConfig.parent,'" not found! Will add it to the body.')),r.parent=document.body),r.parent.appendChild(r.renderer.domElement),r.canvas=r.renderer.domElement;var o="";return r.projectConfig.scenes.forEach((function(e,t){var n=new e;0===t&&(o=n.sceneKey);var i={sceneConfig:{textureAnisotropy:r.textureAnisotropy,autoStart:!1},renderer:r.renderer,parent:r.parent,canvas:r.canvas,scene:r.scene,scenes:r.scenes,camera:r.camera,cache:r.cache,physics:r.physics};n.initializeScene(i),0===t&&(n.setSize(r.parent.clientWidth,r.parent.clientHeight),n.setPixelRatio(Math.max(1,window.devicePixelRatio/2))),r.scenes.set(n.sceneKey,n)})),null===(i=r.scenes.get(o))||void 0===i||i.start(o),r}return(0,l.Z)(n)}(Po),Io=(n(8932),n(4553),window,"ontouchstart"in window&&window.navigator.maxTouchPoints,window,new Map,document.createElement("canvas"),new u.iMs,new u.FM8,new u.FM8,new u.FM8,n(1697),n(2089),n(8595),n(2868),n(3900)),Ro={uniforms:{tDiffuse:{value:null},tDisp:{value:null},byp:{value:0},amount:{value:.08},angle:{value:.02},seed:{value:.02},seed_x:{value:.02},seed_y:{value:.02},distortion_x:{value:.5},distortion_y:{value:.6},col_s:{value:.05}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}",fragmentShader:"\n\n\t\tuniform int byp; //should we apply the glitch ?\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D tDisp;\n\n\t\tuniform float amount;\n\t\tuniform float angle;\n\t\tuniform float seed;\n\t\tuniform float seed_x;\n\t\tuniform float seed_y;\n\t\tuniform float distortion_x;\n\t\tuniform float distortion_y;\n\t\tuniform float col_s;\n\n\t\tvarying vec2 vUv;\n\n\n\t\tfloat rand(vec2 co){\n\t\t\treturn fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n\t\t}\n\n\t\tvoid main() {\n\t\t\tif(byp<1) {\n\t\t\t\tvec2 p = vUv;\n\t\t\t\tfloat xs = floor(gl_FragCoord.x / 0.5);\n\t\t\t\tfloat ys = floor(gl_FragCoord.y / 0.5);\n\t\t\t\t//based on staffantans glitch shader for unity https://github.com/staffantan/unityglitch\n\t\t\t\tfloat disp = texture2D(tDisp, p*seed*seed).r;\n\t\t\t\tif(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {\n\t\t\t\t\tif(seed_x>0.){\n\t\t\t\t\t\tp.y = 1. - (p.y + distortion_y);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tp.y = distortion_y;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {\n\t\t\t\t\tif(seed_y>0.){\n\t\t\t\t\t\tp.x=distortion_x;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tp.x = 1. - (p.x + distortion_x);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tp.x+=disp*seed_x*(seed/5.);\n\t\t\t\tp.y+=disp*seed_y*(seed/5.);\n\t\t\t\t//base from RGB shift shader\n\t\t\t\tvec2 offset = amount * vec2( cos(angle), sin(angle));\n\t\t\t\tvec4 cr = texture2D(tDiffuse, p + offset);\n\t\t\t\tvec4 cga = texture2D(tDiffuse, p);\n\t\t\t\tvec4 cb = texture2D(tDiffuse, p - offset);\n\t\t\t\tgl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);\n\t\t\t\t//add noise\n\t\t\t\tvec4 snow = 200.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.2);\n\t\t\t\tgl_FragColor = gl_FragColor+ snow;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tgl_FragColor=texture2D (tDiffuse, vUv);\n\t\t\t}\n\t\t}"},Lo=(Io.w,new u.FM8(256,256),new u.FM8(.5,.5),function e(){var t=0,n=document.createElement("div");function r(e){return n.appendChild(e.dom),e}function i(e){for(var r=0;r<n.children.length;r++)n.children[r].style.display=r===e?"block":"none";t=e}n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",(function(e){e.preventDefault(),i(++t%n.children.length)}),!1);var o=(performance||Date).now(),a=o,s=0,l=r(new e.Panel("FPS","#0ff","#002")),u=r(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=r(new e.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:n,addPanel:r,showPanel:i,begin:function(){o=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(u.update(e-o,200),e>=a+1e3&&(l.update(1e3*s/(e-a),100),a=e,s=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){o=this.end()},domElement:n,setMode:i}});Lo.Panel=function(e,t,n){var r=1/0,i=0,o=Math.round,a=o(window.devicePixelRatio||1),s=80*a,l=48*a,u=3*a,c=2*a,h=3*a,d=15*a,f=74*a,p=30*a,v=document.createElement("canvas");v.width=s,v.height=l,v.style.cssText="width:80px;height:48px";var m=v.getContext("2d");return m.font="bold "+9*a+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=n,m.fillRect(0,0,s,l),m.fillStyle=t,m.fillText(e,u,c),m.fillRect(h,d,f,p),m.fillStyle=n,m.globalAlpha=.9,m.fillRect(h,d,f,p),{dom:v,update:function(l,y){r=Math.min(r,l),i=Math.max(i,l),m.fillStyle=n,m.globalAlpha=1,m.fillRect(0,0,s,d),m.fillStyle=t,m.fillText(o(l)+" "+e+" ("+o(r)+"-"+o(i)+")",u,c),m.drawImage(v,h+a,d,f-a,p,h,d,f-a,p),m.fillRect(h+f-a,d,a,p),m.fillStyle=n,m.globalAlpha=.9,m.fillRect(h+f-a,d,a,o((1-l/y)*p))}}};var Bo,No,Oo=Lo,Vo=!1,Do=!0,Fo=Oo(),Uo={x:0,y:0},jo=function(e){(0,h.Z)(n,e);var t=(0,d.Z)(n);function n(){return(0,s.Z)(this,n),t.call(this,"MainScene")}return(0,l.Z)(n,[{key:"init",value:function(){var e=(0,si.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log("init"),this.renderer.setPixelRatio(1),this.renderer.setSize(window.innerWidth,window.innerHeight),Do&&document.body.appendChild(Fo.dom);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"preload",value:function(){var e=(0,si.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log("preload");case 1:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"create",value:function(){var e,t=this;(console.log("create"),this.warpSpeed(),this.debug=Vo,1==Vo)&&(null===(e=this.physics.debug)||void 0===e||e.enable());this.camera.position.set(0,14,20);var n=[],r=function(){for(var e=t.add.material({lambert:{color:10502144}}),r=0;r<12;r++)r%2==0?n.push(t.physics.add.box({y:.85*r,z:-1.3,width:4,height:.65},{custom:e}),t.physics.add.box({y:.85*r,z:0,width:4,height:.65},{custom:e}),t.physics.add.box({y:.85*r,z:1.3,width:4,height:.65},{custom:e})):n.push(t.physics.add.box({y:.85*r,x:-1.3,depth:4,height:.65},{custom:e}),t.physics.add.box({y:.85*r,x:0,depth:4,height:.65},{custom:e}),t.physics.add.box({y:.85*r,x:1.3,depth:4,height:.65},{custom:e}));n.forEach((function(e){e.body.setFriction(.8)}))};r(),No=this,Bo=new u.iMs,this.renderer.domElement.addEventListener("click",this.raycast,!1)}},{key:"raycast",value:function(e){var t=No.renderer.domElement.getBoundingClientRect();Uo.x=(e.clientX-t.left)/(t.right-t.left)*2-1,Uo.y=-(e.clientY-t.top)/(t.bottom-t.top)*2+1,Bo.setFromCamera(Uo,No.camera);var n=Bo.intersectObjects(No.scene.children);if(n.length>0){var r=n[0].point;No.physics.add.box({x:r.x,y:r.y,z:r.z})}for(var i=0;i<n.length;i++){var o=n[i].object.name;o.length>0&&"ground"!=o&&console.log(o,n[i])}}},{key:"update",value:function(){Do&&Fo.update()}}]),n}(Bi),zo={name:"PhysicWorld",created:function(){console.log("/dev/"),ho("lib/ammo",(function(){return new _o({scenes:[jo]})}))}},Ho=zo,Go=n(1001),Zo=(0,Go.Z)(Ho,i,o,!1,null,null,null),Wo=Zo.exports},8559:function(e,t,n){var r=n(2109),i=n(408),o=n(6135);r({target:"Object",stat:!0},{fromEntries:function(e){var t={};return i(e,(function(e,n){o(t,e,n)}),{AS_ENTRIES:!0}),t}})},5206:function(e,t,n){"use strict";var r=n(260),i=n(3832),o=r.aTypedArrayConstructor,a=r.exportTypedArrayStaticMethod;a("of",(function(){var e=0,t=arguments.length,n=new(o(this))(t);while(t>e)n[e]=arguments[e++];return n}),i)},8423:function(e,t,n){"use strict";n.r(t),n.d(t,{FIT:function(){return o},HEIGHTFIELD_DATA_TYPE:function(){return a},TYPE:function(){return i},createBoxShape:function(){return l},createCapsuleShape:function(){return c},createCollisionShapes:function(){return s},createConeShape:function(){return h},createCylinderShape:function(){return u},createHACDShapes:function(){return p},createHeightfieldTerrainShape:function(){return y},createHullShape:function(){return f},createSphereShape:function(){return d},createTriMeshShape:function(){return m},createVHACDShapes:function(){return v},iterateGeometries:function(){return b}});n(2032),n(2222),n(86),n(9653);var r=n(3226),i={BOX:"box",CYLINDER:"cylinder",SPHERE:"sphere",CAPSULE:"capsule",CONE:"cone",HULL:"hull",HACD:"hacd",VHACD:"vhacd",MESH:"mesh",HEIGHTFIELD:"heightfield"},o={ALL:"all",MANUAL:"manual"},a={short:"short",float:"float"},s=function(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};switch(o.type){case i.BOX:return[l(e,t,r,o)];case i.CYLINDER:return[u(e,t,r,o)];case i.CAPSULE:return[c(e,t,r,o)];case i.CONE:return[h(e,t,r,o)];case i.SPHERE:return[d(e,t,r,o)];case i.HULL:return[f(e,t,r,o)];case i.HACD:return p(e,t,n,r,o);case i.VHACD:return v(e,t,n,r,o);case i.MESH:return[m(e,t,n,r,o)];case i.HEIGHTFIELD:return[y(o)];default:return console.warn(o.type+" is not currently supported"),[]}},l=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};r.type=i.BOX,g(r),r.fit===o.ALL&&(r.halfExtents=A(S(e,t),r.minHalfExtent,r.maxHalfExtent));var a=new Ammo.btVector3(r.halfExtents.x,r.halfExtents.y,r.halfExtents.z),s=new Ammo.btBoxShape(a);return Ammo.destroy(a),x(s,r,w(n,r)),s},u=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};r.type=i.CYLINDER,g(r),r.fit===o.ALL&&(r.halfExtents=A(S(e,t),r.minHalfExtent,r.maxHalfExtent));var a=new Ammo.btVector3(r.halfExtents.x,r.halfExtents.y,r.halfExtents.z),s=function(){switch(r.cylinderAxis){case"y":return new Ammo.btCylinderShape(a);case"x":return new Ammo.btCylinderShapeX(a);case"z":return new Ammo.btCylinderShapeZ(a)}return null}();return Ammo.destroy(a),x(s,r,w(n,r)),s},c=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};r.type=i.CAPSULE,g(r),r.fit===o.ALL&&(r.halfExtents=A(S(e,t),r.minHalfExtent,r.maxHalfExtent));var a=r.halfExtents,s=a.x,l=a.y,u=a.z,c=function(){switch(r.cylinderAxis){case"y":return new Ammo.btCapsuleShape(Math.max(s,u),2*l);case"x":return new Ammo.btCapsuleShapeX(Math.max(l,u),2*s);case"z":return new Ammo.btCapsuleShapeZ(Math.max(s,l),2*u)}return null}();return x(c,r,w(n,r)),c},h=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};r.type=i.CONE,g(r),r.fit===o.ALL&&(r.halfExtents=A(S(e,t),r.minHalfExtent,r.maxHalfExtent));var a=r.halfExtents,s=a.x,l=a.y,u=a.z,c=function(){switch(r.cylinderAxis){case"y":return new Ammo.btConeShape(Math.max(s,u),2*l);case"x":return new Ammo.btConeShapeX(Math.max(l,u),2*s);case"z":return new Ammo.btConeShapeZ(Math.max(s,l),2*u)}return null}();return x(c,r,w(n,r)),c},d=function(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};a.type=i.SPHERE,g(a),r=a.fit!==o.MANUAL||isNaN(a.sphereRadius)?k(e,t,S(e,t)):a.sphereRadius;var s=new Ammo.btSphereShape(r);return x(s,a,w(n,a)),s},f=function(){var e=new r.Pa4,t=new r.Pa4,n=new r.yGw;return function(r,a,s){var l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(l.type=i.HULL,g(l),l.fit===o.MANUAL)return console.warn("cannot use fit: manual with type: hull"),null;var u=S(r,a),c=new Ammo.btVector3,h=new Ammo.btConvexHullShape;h.setMargin(l.margin),t.addVectors(u.max,u.min).multiplyScalar(.5);for(var d=0,f=0;f<r.length;f++)d+=r[f].length/3;var p=l.hullMaxVertices||1e5;d>p&&console.warn("too many vertices for hull shape; sampling ~".concat(p," from ~").concat(d," vertices"));for(var v=Math.min(1,p/d),m=0;m<r.length;m++){var y=r[m];n.fromArray(a[m]);for(var b=0;b<y.length;b+=3){var k=m===r.length-1&&b===y.length-3;(Math.random()<=v||k)&&(e.set(y[b],y[b+1],y[b+2]).applyMatrix4(n).sub(t),c.setValue(e.x,e.y,e.z),h.addPoint(c,k))}}var A=h;if(h.getNumVertices()>=100){var M=new Ammo.btShapeHull(h);M.buildHull(l.margin),Ammo.destroy(h),A=new Ammo.btConvexHullShape(Ammo.getPointer(M.getVertexPointer()),M.numVertices()),Ammo.destroy(M)}return Ammo.destroy(c),x(A,l,w(s,l)),A}}(),p=function(){var e=new r.Pa4,t=new r.Pa4,n=new r.yGw;return function(r,a,s,l){var u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(u.type=i.HACD,g(u),u.fit===o.MANUAL)return console.warn("cannot use fit: manual with type: hacd"),[];if(!Ammo.hasOwnProperty("HACD"))return console.warn("HACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];var c=S(r,a),h=w(l,u),d=0,f=0;t.addVectors(c.max,c.min).multiplyScalar(.5);for(var p=0;p<r.length;p++)d+=r[p].length/3,s&&s[p]?f+=s[p].length/3:f+=r[p].length/9;var v=new Ammo.HACD;u.hasOwnProperty("compacityWeight")&&v.SetCompacityWeight(u.compacityWeight),u.hasOwnProperty("volumeWeight")&&v.SetVolumeWeight(u.volumeWeight),u.hasOwnProperty("nClusters")&&v.SetNClusters(u.nClusters),u.hasOwnProperty("nVerticesPerCH")&&v.SetNVerticesPerCH(u.nVerticesPerCH),u.hasOwnProperty("concavity")&&v.SetConcavity(u.concavity);var m=Ammo._malloc(3*d*8),y=Ammo._malloc(3*f*4);v.SetPoints(m),v.SetTriangles(y),v.SetNPoints(d),v.SetNTriangles(f);for(var b=m/8,k=y/4,A=0;A<r.length;A++){var M=r[A];n.fromArray(a[A]);for(var T=0;T<M.length;T+=3)e.set(M[T+0],M[T+1],M[T+2]).applyMatrix4(n).sub(t),Ammo.HEAPF64[b+0]=e.x,Ammo.HEAPF64[b+1]=e.y,Ammo.HEAPF64[b+2]=e.z,b+=3;if(s[A])for(var P=s[A],C=0;C<P.length;C++)Ammo.HEAP32[k]=P[C],k++;else for(var E=0;E<M.length/3;E++)Ammo.HEAP32[k]=E,k++}v.Compute(),Ammo._free(m),Ammo._free(y);for(var _=v.GetNClusters(),I=[],R=0;R<_;R++){var L=new Ammo.btConvexHullShape;L.setMargin(u.margin);var B=v.GetNPointsCH(R),N=v.GetNTrianglesCH(R),O=Ammo._malloc(3*B*8),V=Ammo._malloc(3*N*4);v.GetCH(R,O,V);for(var D=O/8,F=0;F<B;F++){var U=new Ammo.btVector3,j=Ammo.HEAPF64[D+3*F+0],z=Ammo.HEAPF64[D+3*F+1],H=Ammo.HEAPF64[D+3*F+2];U.setValue(j,z,H),L.addPoint(U,F===B-1),Ammo.destroy(U)}x(L,u,h),I.push(L)}return I}}(),v=function(){var e=new r.Pa4,t=new r.Pa4,n=new r.yGw;return function(r,a,s,l){var u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(u.type=i.VHACD,g(u),u.fit===o.MANUAL)return console.warn("cannot use fit: manual with type: vhacd"),[];if(!Ammo.hasOwnProperty("VHACD"))return console.warn("VHACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];var c=S(r,a),h=w(l,u),d=0,f=0;t.addVectors(c.max,c.min).multiplyScalar(.5);for(var p=0;p<r.length;p++)d+=r[p].length/3,s&&s[p]?f+=s[p].length/3:f+=r[p].length/9;var v=new Ammo.VHACD,m=new Ammo.Parameters;u.hasOwnProperty("resolution")&&m.set_m_resolution(u.resolution),u.hasOwnProperty("depth")&&m.set_m_depth(u.depth),u.hasOwnProperty("concavity")&&m.set_m_concavity(u.concavity),u.hasOwnProperty("planeDownsampling")&&m.set_m_planeDownsampling(u.planeDownsampling),u.hasOwnProperty("convexhullDownsampling")&&m.set_m_convexhullDownsampling(u.convexhullDownsampling),u.hasOwnProperty("alpha")&&m.set_m_alpha(u.alpha),u.hasOwnProperty("beta")&&m.set_m_beta(u.beta),u.hasOwnProperty("gamma")&&m.set_m_gamma(u.gamma),u.hasOwnProperty("pca")&&m.set_m_pca(u.pca),u.hasOwnProperty("mode")&&m.set_m_mode(u.mode),u.hasOwnProperty("maxNumVerticesPerCH")&&m.set_m_maxNumVerticesPerCH(u.maxNumVerticesPerCH),u.hasOwnProperty("minVolumePerCH")&&m.set_m_minVolumePerCH(u.minVolumePerCH),u.hasOwnProperty("convexhullApproximation")&&m.set_m_convexhullApproximation(u.convexhullApproximation),u.hasOwnProperty("oclAcceleration")&&m.set_m_oclAcceleration(u.oclAcceleration);for(var y=Ammo._malloc(3*d*8+3),b=Ammo._malloc(3*f*4),k=y/8,A=b/4,M=0;M<r.length;M++){var T=r[M];n.fromArray(a[M]);for(var P=0;P<T.length;P+=3)e.set(T[P+0],T[P+1],T[P+2]).applyMatrix4(n).sub(t),Ammo.HEAPF64[k+0]=e.x,Ammo.HEAPF64[k+1]=e.y,Ammo.HEAPF64[k+2]=e.z,k+=3;if(s[M])for(var C=s[M],E=0;E<C.length;E++)Ammo.HEAP32[A]=C[E],A++;else for(var _=0;_<T.length/3;_++)Ammo.HEAP32[A]=_,A++}v.Compute(y,3,d,b,3,f,m),Ammo._free(y),Ammo._free(b);for(var I=v.GetNConvexHulls(),R=[],L=new Ammo.ConvexHull,B=0;B<I;B++){v.GetConvexHull(B,L);var N=L.get_m_nPoints(),O=(L.get_m_points(),new Ammo.btConvexHullShape);O.setMargin(u.margin);for(var V=0;V<N;V++){var D=new Ammo.btVector3,F=L.get_m_points(3*V+0),U=L.get_m_points(3*V+1),j=L.get_m_points(3*V+2);D.setValue(F,U,j),O.addPoint(D,V===N-1),Ammo.destroy(D)}x(O,u,h),R.push(O)}return Ammo.destroy(L),Ammo.destroy(v),R}}(),m=function(){var e=new r.Pa4,t=new r.Pa4,n=new r.Pa4,a=new r.yGw;return function(r,s,l,u){var c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(c.type=i.MESH,g(c),c.fit===o.MANUAL)return console.warn("cannot use fit: manual with type: mesh"),null;for(var h=w(u,c),d=new Ammo.btVector3,f=new Ammo.btVector3,p=new Ammo.btVector3,v=new Ammo.btTriangleMesh(!0,!1),m=0;m<r.length;m++){var y=r[m],b=l[m]?l[m]:null;if(a.fromArray(s[m]),b)for(var k=0;k<b.length;k+=3){var A=3*b[k],S=3*b[k+1],M=3*b[k+2];e.set(y[A],y[A+1],y[A+2]).applyMatrix4(a),t.set(y[S],y[S+1],y[S+2]).applyMatrix4(a),n.set(y[M],y[M+1],y[M+2]).applyMatrix4(a),d.setValue(e.x,e.y,e.z),f.setValue(t.x,t.y,t.z),p.setValue(n.x,n.y,n.z),v.addTriangle(d,f,p,!1)}else for(var T=0;T<y.length;T+=9)e.set(y[T+0],y[T+1],y[T+2]).applyMatrix4(a),t.set(y[T+3],y[T+4],y[T+5]).applyMatrix4(a),n.set(y[T+6],y[T+7],y[T+8]).applyMatrix4(a),d.setValue(e.x,e.y,e.z),f.setValue(t.x,t.y,t.z),p.setValue(n.x,n.y,n.z),v.addTriangle(d,f,p,!1)}var P,C=new Ammo.btVector3(h.x,h.y,h.z);return v.setScaling(C),Ammo.destroy(C),P=c.concave?new Ammo.btBvhTriangleMeshShape(v,!0,!0):new Ammo.btConvexTriangleMeshShape(v,!0),P.resources=[v],Ammo.destroy(d),Ammo.destroy(f),Ammo.destroy(p),x(P,c),P}}(),y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(g(e),e.fit===o.ALL)return console.warn("cannot use fit: all with type: heightfield"),null;for(var t=e.heightfieldDistance||1,n=e.heightfieldData||[],r=e.heightScale||0,i=e.hasOwnProperty("upAxis")?e.upAxis:1,a=function(){switch(e.heightDataType){case"short":return Ammo.PHY_SHORT;case"float":return Ammo.PHY_FLOAT;default:return Ammo.PHY_FLOAT}}(),s=!e.hasOwnProperty("flipQuadEdges")||e.flipQuadEdges,l=n.length,u=l>0?n[0].length:0,c=Ammo._malloc(l*u*4),h=c/4,d=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,p=0,v=0;v<l;v++)for(var m=0;m<u;m++){var y=n[v][m];Ammo.HEAPF32[h+p]=y,p++,d=Math.min(d,y),f=Math.max(f,y)}var b=new Ammo.btHeightfieldTerrainShape(u,l,c,r,d,f,i,a,s),w=new Ammo.btVector3(t,1,t);return b.setLocalScaling(w),Ammo.destroy(w),b.heightfieldData=c,x(b,e),b};function g(e){e.type=e.type||i.HULL,e.margin=e.hasOwnProperty("margin")?e.margin:.01}var x=function(e,t,n){},b=function(){var e=new r.yGw;return function(t,n,i){parseInt(r.UZH)>=123?e.copy(t.matrixWorld).invert():e.getInverse(t.matrixWorld);var o=new r.Pa4;o.setFromMatrixScale(t.matrixWorld),t.traverse((function(o){var a=new r.yGw;o.isMesh&&(n.includeInvisible||o.el&&o.el.object3D.visible||o.visible)&&(o===t?a.identity():(o.updateWorldMatrix(!0),a.multiplyMatrices(e,o.matrixWorld)),i(o.geometry.isBufferGeometry?o.geometry.attributes.position.array:o.geometry.vertices,a.elements,o.geometry.index?o.geometry.index.array:null))}))}}(),w=function(){var e=new r.yGw;return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=new r.Pa4(1,1,1);return n.fit===o.ALL&&(e.fromArray(t),i.setFromMatrixScale(e)),i}}(),k=function(){var e=new r.Pa4;return function(t,n,r){var i=0,o=r.getCenter(e),a=o.x,s=o.y,l=o.z;return M(t,n,(function(e){var t=a-e.x,n=s-e.y,r=l-e.z;i=Math.max(i,t*t+n*n+r*r)})),Math.sqrt(i)}}(),A=function(e,t,n){var i=new r.Pa4;return i.subVectors(e.max,e.min).multiplyScalar(.5).clampScalar(t,n)},S=function(e,t){var n=new r.ZzF,i=1/0,o=1/0,a=1/0,s=-1/0,l=-1/0,u=-1/0;return n.min.set(0,0,0),n.max.set(0,0,0),M(e,t,(function(e){e.x<i&&(i=e.x),e.y<o&&(o=e.y),e.z<a&&(a=e.z),e.x>s&&(s=e.x),e.y>l&&(l=e.y),e.z>u&&(u=e.z)})),n.min.set(i,o,a),n.max.set(s,l,u),n},M=function(){var e=new r.Pa4,t=new r.yGw;return function(n,r,i){for(var o=0;o<n.length;o++){t.fromArray(r[o]);for(var a=0;a<n[o].length;a+=3)e.set(n[o][a],n[o][a+1],n[o][a+2]).applyMatrix4(t),i(e)}}}()},1697:function(e,t,n){var r,i,o;e=n.nmd(e);var a=n(7964)["default"];n(2526),n(1817),n(1539),n(3680),n(3706),n(2703),n(7941),n(7042),n(4916),n(3123),n(5306),n(2222),n(9600),n(1249),n(86),n(2707),n(3948),n(8309),n(561),n(7327),n(9714),n(6977),n(9653),n(7601),n(3290),
/*!
 * matter-js 0.17.1 by @liabru
 * http://brm.io/matter-js/
 * License MIT
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) Liam Brummitt and contributors.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
function(n,s){"object"===a(t)&&"object"===a(e)?e.exports=s():(i=[],r=s,o="function"===typeof r?r.apply(t,i):r,void 0===o||(e.exports=o))}(0,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===a(e)&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=22)}([function(e,t){var r={};e.exports=r,function(){r._nextId=0,r._seed=0,r._nowStartTime=+new Date,r._warnedOnce={},r._decomp=null,r.extend=function(e,t){var n,i;"boolean"===typeof t?(n=2,i=t):(n=1,i=!0);for(var o=n;o<arguments.length;o++){var a=arguments[o];if(a)for(var s in a)i&&a[s]&&a[s].constructor===Object?e[s]&&e[s].constructor!==Object?e[s]=a[s]:(e[s]=e[s]||{},r.extend(e[s],i,a[s])):e[s]=a[s]}return e},r.clone=function(e,t){return r.extend({},t,e)},r.keys=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)t.push(n);return t},r.values=function(e){var t=[];if(Object.keys){for(var n=Object.keys(e),r=0;r<n.length;r++)t.push(e[n[r]]);return t}for(var i in e)t.push(e[i]);return t},r.get=function(e,t,n,r){t=t.split(".").slice(n,r);for(var i=0;i<t.length;i+=1)e=e[t[i]];return e},r.set=function(e,t,n,i,o){var a=t.split(".").slice(i,o);return r.get(e,t,0,-1)[a[a.length-1]]=n,n},r.shuffle=function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(r.random()*(t+1)),i=e[t];e[t]=e[n],e[n]=i}return e},r.choose=function(e){return e[Math.floor(r.random()*e.length)]},r.isElement=function(e){return"undefined"!==typeof HTMLElement?e instanceof HTMLElement:!!(e&&e.nodeType&&e.nodeName)},r.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},r.isFunction=function(e){return"function"===typeof e},r.isPlainObject=function(e){return"object"===a(e)&&e.constructor===Object},r.isString=function(e){return"[object String]"===toString.call(e)},r.clamp=function(e,t,n){return e<t?t:e>n?n:e},r.sign=function(e){return e<0?-1:1},r.now=function(){if("undefined"!==typeof window&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-r._nowStartTime},r.random=function(t,n){return t="undefined"!==typeof t?t:0,n="undefined"!==typeof n?n:1,t+e()*(n-t)};var e=function(){return r._seed=(9301*r._seed+49297)%233280,r._seed/233280};r.colorToNumber=function(e){return e=e.replace("#",""),3==e.length&&(e=e.charAt(0)+e.charAt(0)+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2)),parseInt(e,16)},r.logLevel=1,r.log=function(){console&&r.logLevel>0&&r.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},r.info=function(){console&&r.logLevel>0&&r.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},r.warn=function(){console&&r.logLevel>0&&r.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},r.warnOnce=function(){var e=Array.prototype.slice.call(arguments).join(" ");r._warnedOnce[e]||(r.warn(e),r._warnedOnce[e]=!0)},r.deprecated=function(e,t,n){e[t]=r.chain((function(){r.warnOnce("🔅 deprecated 🔅",n)}),e[t])},r.nextId=function(){return r._nextId++},r.indexOf=function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1},r.map=function(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r+=1)n.push(t(e[r]));return n},r.topologicalSort=function(e){var t=[],n=[],i=[];for(var o in e)n[o]||i[o]||r._topologicalSort(o,n,i,e,t);return t},r._topologicalSort=function(e,t,n,i,o){var a=i[e]||[];n[e]=!0;for(var s=0;s<a.length;s+=1){var l=a[s];n[l]||(t[l]||r._topologicalSort(l,t,n,i,o))}n[e]=!1,t[e]=!0,o.push(e)},r.chain=function(){for(var e=[],t=0;t<arguments.length;t+=1){var n=arguments[t];n._chained?e.push.apply(e,n._chained):e.push(n)}var r=function(){for(var t,n=new Array(arguments.length),r=0,i=arguments.length;r<i;r++)n[r]=arguments[r];for(r=0;r<e.length;r+=1){var o=e[r].apply(t,n);"undefined"!==typeof o&&(t=o)}return t};return r._chained=e,r},r.chainPathBefore=function(e,t,n){return r.set(e,t,r.chain(n,r.get(e,t)))},r.chainPathAfter=function(e,t,n){return r.set(e,t,r.chain(r.get(e,t),n))},r.setDecomp=function(e){r._decomp=e},r.getDecomp=function(){var e=r._decomp;try{e||"undefined"===typeof window||(e=window.decomp),e||"undefined"===typeof n.g||(e=n.g.decomp)}catch(t){e=null}return e}}()},function(e,t){var n={};e.exports=n,function(){n.create=function(e){var t={min:{x:0,y:0},max:{x:0,y:0}};return e&&n.update(t,e),t},n.update=function(e,t,n){e.min.x=1/0,e.max.x=-1/0,e.min.y=1/0,e.max.y=-1/0;for(var r=0;r<t.length;r++){var i=t[r];i.x>e.max.x&&(e.max.x=i.x),i.x<e.min.x&&(e.min.x=i.x),i.y>e.max.y&&(e.max.y=i.y),i.y<e.min.y&&(e.min.y=i.y)}n&&(n.x>0?e.max.x+=n.x:e.min.x+=n.x,n.y>0?e.max.y+=n.y:e.min.y+=n.y)},n.contains=function(e,t){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y},n.overlaps=function(e,t){return e.min.x<=t.max.x&&e.max.x>=t.min.x&&e.max.y>=t.min.y&&e.min.y<=t.max.y},n.translate=function(e,t){e.min.x+=t.x,e.max.x+=t.x,e.min.y+=t.y,e.max.y+=t.y},n.shift=function(e,t){var n=e.max.x-e.min.x,r=e.max.y-e.min.y;e.min.x=t.x,e.max.x=t.x+n,e.min.y=t.y,e.max.y=t.y+r}}()},function(e,t){var n={};e.exports=n,function(){n.create=function(e,t){return{x:e||0,y:t||0}},n.clone=function(e){return{x:e.x,y:e.y}},n.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},n.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},n.rotate=function(e,t,n){var r=Math.cos(t),i=Math.sin(t);n||(n={});var o=e.x*r-e.y*i;return n.y=e.x*i+e.y*r,n.x=o,n},n.rotateAbout=function(e,t,n,r){var i=Math.cos(t),o=Math.sin(t);r||(r={});var a=n.x+((e.x-n.x)*i-(e.y-n.y)*o);return r.y=n.y+((e.x-n.x)*o+(e.y-n.y)*i),r.x=a,r},n.normalise=function(e){var t=n.magnitude(e);return 0===t?{x:0,y:0}:{x:e.x/t,y:e.y/t}},n.dot=function(e,t){return e.x*t.x+e.y*t.y},n.cross=function(e,t){return e.x*t.y-e.y*t.x},n.cross3=function(e,t,n){return(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)},n.add=function(e,t,n){return n||(n={}),n.x=e.x+t.x,n.y=e.y+t.y,n},n.sub=function(e,t,n){return n||(n={}),n.x=e.x-t.x,n.y=e.y-t.y,n},n.mult=function(e,t){return{x:e.x*t,y:e.y*t}},n.div=function(e,t){return{x:e.x/t,y:e.y/t}},n.perp=function(e,t){return t=!0===t?-1:1,{x:t*-e.y,y:t*e.x}},n.neg=function(e){return{x:-e.x,y:-e.y}},n.angle=function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},n._temp=[n.create(),n.create(),n.create(),n.create(),n.create(),n.create()]}()},function(e,t,n){var r={};e.exports=r;var i=n(2),o=n(0);(function(){r.create=function(e,t){for(var n=[],r=0;r<e.length;r++){var i=e[r],o={x:i.x,y:i.y,index:r,body:t,isInternal:!1};n.push(o)}return n},r.fromPath=function(e,t){var n=/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/gi,i=[];return e.replace(n,(function(e,t,n){i.push({x:parseFloat(t),y:parseFloat(n)})})),r.create(i,t)},r.centre=function(e){for(var t,n,o,a=r.area(e,!0),s={x:0,y:0},l=0;l<e.length;l++)o=(l+1)%e.length,t=i.cross(e[l],e[o]),n=i.mult(i.add(e[l],e[o]),t),s=i.add(s,n);return i.div(s,6*a)},r.mean=function(e){for(var t={x:0,y:0},n=0;n<e.length;n++)t.x+=e[n].x,t.y+=e[n].y;return i.div(t,e.length)},r.area=function(e,t){for(var n=0,r=e.length-1,i=0;i<e.length;i++)n+=(e[r].x-e[i].x)*(e[r].y+e[i].y),r=i;return t?n/2:Math.abs(n)/2},r.inertia=function(e,t){for(var n,r,o=0,a=0,s=e,l=0;l<s.length;l++)r=(l+1)%s.length,n=Math.abs(i.cross(s[r],s[l])),o+=n*(i.dot(s[r],s[r])+i.dot(s[r],s[l])+i.dot(s[l],s[l])),a+=n;return t/6*(o/a)},r.translate=function(e,t,n){var r;if(n)for(r=0;r<e.length;r++)e[r].x+=t.x*n,e[r].y+=t.y*n;else for(r=0;r<e.length;r++)e[r].x+=t.x,e[r].y+=t.y;return e},r.rotate=function(e,t,n){if(0!==t){for(var r=Math.cos(t),i=Math.sin(t),o=0;o<e.length;o++){var a=e[o],s=a.x-n.x,l=a.y-n.y;a.x=n.x+(s*r-l*i),a.y=n.y+(s*i+l*r)}return e}},r.contains=function(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=e[(n+1)%e.length];if((t.x-r.x)*(i.y-r.y)+(t.y-r.y)*(r.x-i.x)>0)return!1}return!0},r.scale=function(e,t,n,o){if(1===t&&1===n)return e;var a,s;o=o||r.centre(e);for(var l=0;l<e.length;l++)a=e[l],s=i.sub(a,o),e[l].x=o.x+s.x*t,e[l].y=o.y+s.y*n;return e},r.chamfer=function(e,t,n,r,a){t="number"===typeof t?[t]:t||[8],n="undefined"!==typeof n?n:-1,r=r||2,a=a||14;for(var s=[],l=0;l<e.length;l++){var u=e[l-1>=0?l-1:e.length-1],c=e[l],h=e[(l+1)%e.length],d=t[l<t.length?l:t.length-1];if(0!==d){var f=i.normalise({x:c.y-u.y,y:u.x-c.x}),p=i.normalise({x:h.y-c.y,y:c.x-h.x}),v=Math.sqrt(2*Math.pow(d,2)),m=i.mult(o.clone(f),d),y=i.normalise(i.mult(i.add(f,p),.5)),g=i.sub(c,i.mult(y,v)),x=n;-1===n&&(x=1.75*Math.pow(d,.32)),x=o.clamp(x,r,a),x%2===1&&(x+=1);for(var b=Math.acos(i.dot(f,p)),w=b/x,k=0;k<x;k++)s.push(i.add(i.rotate(m,w*k),g))}else s.push(c)}return s},r.clockwiseSort=function(e){var t=r.mean(e);return e.sort((function(e,n){return i.angle(t,e)-i.angle(t,n)})),e},r.isConvex=function(e){var t,n,r,i,o=0,a=e.length;if(a<3)return null;for(t=0;t<a;t++)if(n=(t+1)%a,r=(t+2)%a,i=(e[n].x-e[t].x)*(e[r].y-e[n].y),i-=(e[n].y-e[t].y)*(e[r].x-e[n].x),i<0?o|=1:i>0&&(o|=2),3===o)return!1;return 0!==o||null},r.hull=function(e){var t,n,r=[],o=[];for(e=e.slice(0),e.sort((function(e,t){var n=e.x-t.x;return 0!==n?n:e.y-t.y})),n=0;n<e.length;n+=1){t=e[n];while(o.length>=2&&i.cross3(o[o.length-2],o[o.length-1],t)<=0)o.pop();o.push(t)}for(n=e.length-1;n>=0;n-=1){t=e[n];while(r.length>=2&&i.cross3(r[r.length-2],r[r.length-1],t)<=0)r.pop();r.push(t)}return r.pop(),o.pop(),r.concat(o)}})()},function(e,t,n){var r={};e.exports=r;var i=n(0);(function(){r.on=function(e,t,n){for(var r,i=t.split(" "),o=0;o<i.length;o++)r=i[o],e.events=e.events||{},e.events[r]=e.events[r]||[],e.events[r].push(n);return n},r.off=function(e,t,n){if(t){"function"===typeof t&&(n=t,t=i.keys(e.events).join(" "));for(var r=t.split(" "),o=0;o<r.length;o++){var a=e.events[r[o]],s=[];if(n&&a)for(var l=0;l<a.length;l++)a[l]!==n&&s.push(a[l]);e.events[r[o]]=s}}else e.events={}},r.trigger=function(e,t,n){var r,o,a,s,l=e.events;if(l&&i.keys(l).length>0){n||(n={}),r=t.split(" ");for(var u=0;u<r.length;u++)if(o=r[u],a=l[o],a){s=i.clone(n,!1),s.name=o,s.source=e;for(var c=0;c<a.length;c++)a[c].apply(e,[s])}}}})()},function(e,t,n){var r={};e.exports=r;var i=n(4),o=n(0),a=n(1),s=n(6);(function(){r.create=function(e){return o.extend({id:o.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{}},e)},r.setModified=function(e,t,n,i){if(e.isModified=t,n&&e.parent&&r.setModified(e.parent,t,n,i),i)for(var o=0;o<e.composites.length;o++){var a=e.composites[o];r.setModified(a,t,n,i)}},r.add=function(e,t){var n=[].concat(t);i.trigger(e,"beforeAdd",{object:t});for(var a=0;a<n.length;a++){var s=n[a];switch(s.type){case"body":if(s.parent!==s){o.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}r.addBody(e,s);break;case"constraint":r.addConstraint(e,s);break;case"composite":r.addComposite(e,s);break;case"mouseConstraint":r.addConstraint(e,s.constraint);break}}return i.trigger(e,"afterAdd",{object:t}),e},r.remove=function(e,t,n){var o=[].concat(t);i.trigger(e,"beforeRemove",{object:t});for(var a=0;a<o.length;a++){var s=o[a];switch(s.type){case"body":r.removeBody(e,s,n);break;case"constraint":r.removeConstraint(e,s,n);break;case"composite":r.removeComposite(e,s,n);break;case"mouseConstraint":r.removeConstraint(e,s.constraint);break}}return i.trigger(e,"afterRemove",{object:t}),e},r.addComposite=function(e,t){return e.composites.push(t),t.parent=e,r.setModified(e,!0,!0,!1),e},r.removeComposite=function(e,t,n){var i=o.indexOf(e.composites,t);if(-1!==i&&(r.removeCompositeAt(e,i),r.setModified(e,!0,!0,!1)),n)for(var a=0;a<e.composites.length;a++)r.removeComposite(e.composites[a],t,!0);return e},r.removeCompositeAt=function(e,t){return e.composites.splice(t,1),r.setModified(e,!0,!0,!1),e},r.addBody=function(e,t){return e.bodies.push(t),r.setModified(e,!0,!0,!1),e},r.removeBody=function(e,t,n){var i=o.indexOf(e.bodies,t);if(-1!==i&&(r.removeBodyAt(e,i),r.setModified(e,!0,!0,!1)),n)for(var a=0;a<e.composites.length;a++)r.removeBody(e.composites[a],t,!0);return e},r.removeBodyAt=function(e,t){return e.bodies.splice(t,1),r.setModified(e,!0,!0,!1),e},r.addConstraint=function(e,t){return e.constraints.push(t),r.setModified(e,!0,!0,!1),e},r.removeConstraint=function(e,t,n){var i=o.indexOf(e.constraints,t);if(-1!==i&&r.removeConstraintAt(e,i),n)for(var a=0;a<e.composites.length;a++)r.removeConstraint(e.composites[a],t,!0);return e},r.removeConstraintAt=function(e,t){return e.constraints.splice(t,1),r.setModified(e,!0,!0,!1),e},r.clear=function(e,t,n){if(n)for(var i=0;i<e.composites.length;i++)r.clear(e.composites[i],t,!0);return t?e.bodies=e.bodies.filter((function(e){return e.isStatic})):e.bodies.length=0,e.constraints.length=0,e.composites.length=0,r.setModified(e,!0,!0,!1),e},r.allBodies=function(e){for(var t=[].concat(e.bodies),n=0;n<e.composites.length;n++)t=t.concat(r.allBodies(e.composites[n]));return t},r.allConstraints=function(e){for(var t=[].concat(e.constraints),n=0;n<e.composites.length;n++)t=t.concat(r.allConstraints(e.composites[n]));return t},r.allComposites=function(e){for(var t=[].concat(e.composites),n=0;n<e.composites.length;n++)t=t.concat(r.allComposites(e.composites[n]));return t},r.get=function(e,t,n){var i,o;switch(n){case"body":i=r.allBodies(e);break;case"constraint":i=r.allConstraints(e);break;case"composite":i=r.allComposites(e).concat(e);break}return i?(o=i.filter((function(e){return e.id.toString()===t.toString()})),0===o.length?null:o[0]):null},r.move=function(e,t,n){return r.remove(e,t),r.add(n,t),e},r.rebase=function(e){for(var t=r.allBodies(e).concat(r.allConstraints(e)).concat(r.allComposites(e)),n=0;n<t.length;n++)t[n].id=o.nextId();return r.setModified(e,!0,!0,!1),e},r.translate=function(e,t,n){for(var i=n?r.allBodies(e):e.bodies,o=0;o<i.length;o++)s.translate(i[o],t);return r.setModified(e,!0,!0,!1),e},r.rotate=function(e,t,n,i){for(var o=Math.cos(t),a=Math.sin(t),l=i?r.allBodies(e):e.bodies,u=0;u<l.length;u++){var c=l[u],h=c.position.x-n.x,d=c.position.y-n.y;s.setPosition(c,{x:n.x+(h*o-d*a),y:n.y+(h*a+d*o)}),s.rotate(c,t)}return r.setModified(e,!0,!0,!1),e},r.scale=function(e,t,n,i,o){for(var a=o?r.allBodies(e):e.bodies,l=0;l<a.length;l++){var u=a[l],c=u.position.x-i.x,h=u.position.y-i.y;s.setPosition(u,{x:i.x+c*t,y:i.y+h*n}),s.scale(u,t,n)}return r.setModified(e,!0,!0,!1),e},r.bounds=function(e){for(var t=r.allBodies(e),n=[],i=0;i<t.length;i+=1){var o=t[i];n.push(o.bounds.min,o.bounds.max)}return a.create(n)}})()},function(e,t,n){var r={};e.exports=r;var i=n(3),o=n(2),a=n(7),s=(n(16),n(0)),l=n(1),u=n(10);(function(){r._inertiaScale=4,r._nextCollidingGroupId=1,r._nextNonCollidingGroupId=-1,r._nextCategory=1,r.create=function(t){var n={id:s.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:i.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,_original:null},r=s.extend(n,t);return e(r,t),r},r.nextGroup=function(e){return e?r._nextNonCollidingGroupId--:r._nextCollidingGroupId++},r.nextCategory=function(){return r._nextCategory=r._nextCategory<<1,r._nextCategory};var e=function(e,t){t=t||{},r.set(e,{bounds:e.bounds||l.create(e.vertices),positionPrev:e.positionPrev||o.clone(e.position),anglePrev:e.anglePrev||e.angle,vertices:e.vertices,parts:e.parts||[e],isStatic:e.isStatic,isSleeping:e.isSleeping,parent:e.parent||e}),i.rotate(e.vertices,e.angle,e.position),u.rotate(e.axes,e.angle),l.update(e.bounds,e.vertices,e.velocity),r.set(e,{axes:t.axes||e.axes,area:t.area||e.area,mass:t.mass||e.mass,inertia:t.inertia||e.inertia});var n=e.isStatic?"#14151f":s.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),a=e.isStatic?"#555":"#ccc",c=e.isStatic&&null===e.render.fillStyle?1:0;e.render.fillStyle=e.render.fillStyle||n,e.render.strokeStyle=e.render.strokeStyle||a,e.render.lineWidth=e.render.lineWidth||c,e.render.sprite.xOffset+=-(e.bounds.min.x-e.position.x)/(e.bounds.max.x-e.bounds.min.x),e.render.sprite.yOffset+=-(e.bounds.min.y-e.position.y)/(e.bounds.max.y-e.bounds.min.y)};r.set=function(e,t,n){var i;for(i in"string"===typeof t&&(i=t,t={},t[i]=n),t)if(Object.prototype.hasOwnProperty.call(t,i))switch(n=t[i],i){case"isStatic":r.setStatic(e,n);break;case"isSleeping":a.set(e,n);break;case"mass":r.setMass(e,n);break;case"density":r.setDensity(e,n);break;case"inertia":r.setInertia(e,n);break;case"vertices":r.setVertices(e,n);break;case"position":r.setPosition(e,n);break;case"angle":r.setAngle(e,n);break;case"velocity":r.setVelocity(e,n);break;case"angularVelocity":r.setAngularVelocity(e,n);break;case"parts":r.setParts(e,n);break;case"centre":r.setCentre(e,n);break;default:e[i]=n}},r.setStatic=function(e,t){for(var n=0;n<e.parts.length;n++){var r=e.parts[n];r.isStatic=t,t?(r._original={restitution:r.restitution,friction:r.friction,mass:r.mass,inertia:r.inertia,density:r.density,inverseMass:r.inverseMass,inverseInertia:r.inverseInertia},r.restitution=0,r.friction=1,r.mass=r.inertia=r.density=1/0,r.inverseMass=r.inverseInertia=0,r.positionPrev.x=r.position.x,r.positionPrev.y=r.position.y,r.anglePrev=r.angle,r.angularVelocity=0,r.speed=0,r.angularSpeed=0,r.motion=0):r._original&&(r.restitution=r._original.restitution,r.friction=r._original.friction,r.mass=r._original.mass,r.inertia=r._original.inertia,r.density=r._original.density,r.inverseMass=r._original.inverseMass,r.inverseInertia=r._original.inverseInertia,r._original=null)}},r.setMass=function(e,t){var n=e.inertia/(e.mass/6);e.inertia=n*(t/6),e.inverseInertia=1/e.inertia,e.mass=t,e.inverseMass=1/e.mass,e.density=e.mass/e.area},r.setDensity=function(e,t){r.setMass(e,t*e.area),e.density=t},r.setInertia=function(e,t){e.inertia=t,e.inverseInertia=1/e.inertia},r.setVertices=function(e,t){t[0].body===e?e.vertices=t:e.vertices=i.create(t,e),e.axes=u.fromVertices(e.vertices),e.area=i.area(e.vertices),r.setMass(e,e.density*e.area);var n=i.centre(e.vertices);i.translate(e.vertices,n,-1),r.setInertia(e,r._inertiaScale*i.inertia(e.vertices,e.mass)),i.translate(e.vertices,e.position),l.update(e.bounds,e.vertices,e.velocity)},r.setParts=function(e,t,n){var o;for(t=t.slice(0),e.parts.length=0,e.parts.push(e),e.parent=e,o=0;o<t.length;o++){var a=t[o];a!==e&&(a.parent=e,e.parts.push(a))}if(1!==e.parts.length){if(n="undefined"===typeof n||n,n){var s=[];for(o=0;o<t.length;o++)s=s.concat(t[o].vertices);i.clockwiseSort(s);var l=i.hull(s),u=i.centre(l);r.setVertices(e,l),i.translate(e.vertices,u)}var c=r._totalProperties(e);e.area=c.area,e.parent=e,e.position.x=c.centre.x,e.position.y=c.centre.y,e.positionPrev.x=c.centre.x,e.positionPrev.y=c.centre.y,r.setMass(e,c.mass),r.setInertia(e,c.inertia),r.setPosition(e,c.centre)}},r.setCentre=function(e,t,n){n?(e.positionPrev.x+=t.x,e.positionPrev.y+=t.y,e.position.x+=t.x,e.position.y+=t.y):(e.positionPrev.x=t.x-(e.position.x-e.positionPrev.x),e.positionPrev.y=t.y-(e.position.y-e.positionPrev.y),e.position.x=t.x,e.position.y=t.y)},r.setPosition=function(e,t){var n=o.sub(t,e.position);e.positionPrev.x+=n.x,e.positionPrev.y+=n.y;for(var r=0;r<e.parts.length;r++){var a=e.parts[r];a.position.x+=n.x,a.position.y+=n.y,i.translate(a.vertices,n),l.update(a.bounds,a.vertices,e.velocity)}},r.setAngle=function(e,t){var n=t-e.angle;e.anglePrev+=n;for(var r=0;r<e.parts.length;r++){var a=e.parts[r];a.angle+=n,i.rotate(a.vertices,n,e.position),u.rotate(a.axes,n),l.update(a.bounds,a.vertices,e.velocity),r>0&&o.rotateAbout(a.position,n,e.position,a.position)}},r.setVelocity=function(e,t){e.positionPrev.x=e.position.x-t.x,e.positionPrev.y=e.position.y-t.y,e.velocity.x=t.x,e.velocity.y=t.y,e.speed=o.magnitude(e.velocity)},r.setAngularVelocity=function(e,t){e.anglePrev=e.angle-t,e.angularVelocity=t,e.angularSpeed=Math.abs(e.angularVelocity)},r.translate=function(e,t){r.setPosition(e,o.add(e.position,t))},r.rotate=function(e,t,n){if(n){var i=Math.cos(t),o=Math.sin(t),a=e.position.x-n.x,s=e.position.y-n.y;r.setPosition(e,{x:n.x+(a*i-s*o),y:n.y+(a*o+s*i)}),r.setAngle(e,e.angle+t)}else r.setAngle(e,e.angle+t)},r.scale=function(e,t,n,o){var a=0,s=0;o=o||e.position;for(var c=0;c<e.parts.length;c++){var h=e.parts[c];i.scale(h.vertices,t,n,o),h.axes=u.fromVertices(h.vertices),h.area=i.area(h.vertices),r.setMass(h,e.density*h.area),i.translate(h.vertices,{x:-h.position.x,y:-h.position.y}),r.setInertia(h,r._inertiaScale*i.inertia(h.vertices,h.mass)),i.translate(h.vertices,{x:h.position.x,y:h.position.y}),c>0&&(a+=h.area,s+=h.inertia),h.position.x=o.x+(h.position.x-o.x)*t,h.position.y=o.y+(h.position.y-o.y)*n,l.update(h.bounds,h.vertices,e.velocity)}e.parts.length>1&&(e.area=a,e.isStatic||(r.setMass(e,e.density*a),r.setInertia(e,s))),e.circleRadius&&(t===n?e.circleRadius*=t:e.circleRadius=null)},r.update=function(e,t,n,r){var a=Math.pow(t*n*e.timeScale,2),s=1-e.frictionAir*n*e.timeScale,c=e.position.x-e.positionPrev.x,h=e.position.y-e.positionPrev.y;e.velocity.x=c*s*r+e.force.x/e.mass*a,e.velocity.y=h*s*r+e.force.y/e.mass*a,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.position.x+=e.velocity.x,e.position.y+=e.velocity.y,e.angularVelocity=(e.angle-e.anglePrev)*s*r+e.torque/e.inertia*a,e.anglePrev=e.angle,e.angle+=e.angularVelocity,e.speed=o.magnitude(e.velocity),e.angularSpeed=Math.abs(e.angularVelocity);for(var d=0;d<e.parts.length;d++){var f=e.parts[d];i.translate(f.vertices,e.velocity),d>0&&(f.position.x+=e.velocity.x,f.position.y+=e.velocity.y),0!==e.angularVelocity&&(i.rotate(f.vertices,e.angularVelocity,e.position),u.rotate(f.axes,e.angularVelocity),d>0&&o.rotateAbout(f.position,e.angularVelocity,e.position,f.position)),l.update(f.bounds,f.vertices,e.velocity)}},r.applyForce=function(e,t,n){e.force.x+=n.x,e.force.y+=n.y;var r={x:t.x-e.position.x,y:t.y-e.position.y};e.torque+=r.x*n.y-r.y*n.x},r._totalProperties=function(e){for(var t={mass:0,area:0,inertia:0,centre:{x:0,y:0}},n=1===e.parts.length?0:1;n<e.parts.length;n++){var r=e.parts[n],i=r.mass!==1/0?r.mass:1;t.mass+=i,t.area+=r.area,t.inertia+=r.inertia,t.centre=o.add(t.centre,o.mult(r.position,i))}return t.centre=o.div(t.centre,t.mass),t}})()},function(e,t,n){var r={};e.exports=r;var i=n(4);(function(){r._motionWakeThreshold=.18,r._motionSleepThreshold=.08,r._minBias=.9,r.update=function(e,t){for(var n=t*t*t,i=0;i<e.length;i++){var o=e[i],a=o.speed*o.speed+o.angularSpeed*o.angularSpeed;if(0===o.force.x&&0===o.force.y){var s=Math.min(o.motion,a),l=Math.max(o.motion,a);o.motion=r._minBias*s+(1-r._minBias)*l,o.sleepThreshold>0&&o.motion<r._motionSleepThreshold*n?(o.sleepCounter+=1,o.sleepCounter>=o.sleepThreshold&&r.set(o,!0)):o.sleepCounter>0&&(o.sleepCounter-=1)}else r.set(o,!1)}},r.afterCollisions=function(e,t){for(var n=t*t*t,i=0;i<e.length;i++){var o=e[i];if(o.isActive){var a=o.collision,s=a.bodyA.parent,l=a.bodyB.parent;if(!(s.isSleeping&&l.isSleeping||s.isStatic||l.isStatic)&&(s.isSleeping||l.isSleeping)){var u=s.isSleeping&&!s.isStatic?s:l,c=u===s?l:s;!u.isStatic&&c.motion>r._motionWakeThreshold*n&&r.set(u,!1)}}}},r.set=function(e,t){var n=e.isSleeping;t?(e.isSleeping=!0,e.sleepCounter=e.sleepThreshold,e.positionImpulse.x=0,e.positionImpulse.y=0,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.anglePrev=e.angle,e.speed=0,e.angularSpeed=0,e.motion=0,n||i.trigger(e,"sleepStart")):(e.isSleeping=!1,e.sleepCounter=0,n&&i.trigger(e,"sleepEnd"))}})()},function(e,t,n){var r={};e.exports=r;var i=n(3),o=n(2),a=n(7),s=n(1),l=n(10),u=n(0);(function(){r._warming=.4,r._torqueDampen=1,r._minLength=1e-6,r.create=function(e){var t=e;t.bodyA&&!t.pointA&&(t.pointA={x:0,y:0}),t.bodyB&&!t.pointB&&(t.pointB={x:0,y:0});var n=t.bodyA?o.add(t.bodyA.position,t.pointA):t.pointA,r=t.bodyB?o.add(t.bodyB.position,t.pointB):t.pointB,i=o.magnitude(o.sub(n,r));t.length="undefined"!==typeof t.length?t.length:i,t.id=t.id||u.nextId(),t.label=t.label||"Constraint",t.type="constraint",t.stiffness=t.stiffness||(t.length>0?1:.7),t.damping=t.damping||0,t.angularStiffness=t.angularStiffness||0,t.angleA=t.bodyA?t.bodyA.angle:t.angleA,t.angleB=t.bodyB?t.bodyB.angle:t.angleB,t.plugin={};var a={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return 0===t.length&&t.stiffness>.1?(a.type="pin",a.anchors=!1):t.stiffness<.9&&(a.type="spring"),t.render=u.extend(a,t.render),t},r.preSolveAll=function(e){for(var t=0;t<e.length;t+=1){var n=e[t],r=n.constraintImpulse;n.isStatic||0===r.x&&0===r.y&&0===r.angle||(n.position.x+=r.x,n.position.y+=r.y,n.angle+=r.angle)}},r.solveAll=function(e,t){for(var n=0;n<e.length;n+=1){var i=e[n],o=!i.bodyA||i.bodyA&&i.bodyA.isStatic,a=!i.bodyB||i.bodyB&&i.bodyB.isStatic;(o||a)&&r.solve(e[n],t)}for(n=0;n<e.length;n+=1)i=e[n],o=!i.bodyA||i.bodyA&&i.bodyA.isStatic,a=!i.bodyB||i.bodyB&&i.bodyB.isStatic,o||a||r.solve(e[n],t)},r.solve=function(e,t){var n=e.bodyA,i=e.bodyB,a=e.pointA,s=e.pointB;if(n||i){n&&!n.isStatic&&(o.rotate(a,n.angle-e.angleA,a),e.angleA=n.angle),i&&!i.isStatic&&(o.rotate(s,i.angle-e.angleB,s),e.angleB=i.angle);var l=a,u=s;if(n&&(l=o.add(n.position,a)),i&&(u=o.add(i.position,s)),l&&u){var c=o.sub(l,u),h=o.magnitude(c);h<r._minLength&&(h=r._minLength);var d,f,p,v,m,y=(h-e.length)/h,g=e.stiffness<1?e.stiffness*t:e.stiffness,x=o.mult(c,y*g),b=(n?n.inverseMass:0)+(i?i.inverseMass:0),w=(n?n.inverseInertia:0)+(i?i.inverseInertia:0),k=b+w;if(e.damping){var A=o.create();p=o.div(c,h),m=o.sub(i&&o.sub(i.position,i.positionPrev)||A,n&&o.sub(n.position,n.positionPrev)||A),v=o.dot(p,m)}n&&!n.isStatic&&(f=n.inverseMass/b,n.constraintImpulse.x-=x.x*f,n.constraintImpulse.y-=x.y*f,n.position.x-=x.x*f,n.position.y-=x.y*f,e.damping&&(n.positionPrev.x-=e.damping*p.x*v*f,n.positionPrev.y-=e.damping*p.y*v*f),d=o.cross(a,x)/k*r._torqueDampen*n.inverseInertia*(1-e.angularStiffness),n.constraintImpulse.angle-=d,n.angle-=d),i&&!i.isStatic&&(f=i.inverseMass/b,i.constraintImpulse.x+=x.x*f,i.constraintImpulse.y+=x.y*f,i.position.x+=x.x*f,i.position.y+=x.y*f,e.damping&&(i.positionPrev.x+=e.damping*p.x*v*f,i.positionPrev.y+=e.damping*p.y*v*f),d=o.cross(s,x)/k*r._torqueDampen*i.inverseInertia*(1-e.angularStiffness),i.constraintImpulse.angle+=d,i.angle+=d)}}},r.postSolveAll=function(e){for(var t=0;t<e.length;t++){var n=e[t],u=n.constraintImpulse;if(!(n.isStatic||0===u.x&&0===u.y&&0===u.angle)){a.set(n,!1);for(var c=0;c<n.parts.length;c++){var h=n.parts[c];i.translate(h.vertices,u),c>0&&(h.position.x+=u.x,h.position.y+=u.y),0!==u.angle&&(i.rotate(h.vertices,u.angle,n.position),l.rotate(h.axes,u.angle),c>0&&o.rotateAbout(h.position,u.angle,n.position,h.position)),s.update(h.bounds,h.vertices,n.velocity)}u.angle*=r._warming,u.x*=r._warming,u.y*=r._warming}}},r.pointAWorld=function(e){return{x:(e.bodyA?e.bodyA.position.x:0)+e.pointA.x,y:(e.bodyA?e.bodyA.position.y:0)+e.pointA.y}},r.pointBWorld=function(e){return{x:(e.bodyB?e.bodyB.position.x:0)+e.pointB.x,y:(e.bodyB?e.bodyB.position.y:0)+e.pointB.y}}})()},function(e,t,n){var r={};e.exports=r;var i=n(17);(function(){r.create=function(e,t){var n=e.bodyA,i=e.bodyB,o=e.parentA,a=e.parentB,s={id:r.id(n,i),bodyA:n,bodyB:i,contacts:{},activeContacts:[],separation:0,isActive:!0,confirmedActive:!0,isSensor:n.isSensor||i.isSensor,timeCreated:t,timeUpdated:t,inverseMass:o.inverseMass+a.inverseMass,friction:Math.min(o.friction,a.friction),frictionStatic:Math.max(o.frictionStatic,a.frictionStatic),restitution:Math.max(o.restitution,a.restitution),slop:Math.max(o.slop,a.slop)};return r.update(s,e,t),s},r.update=function(e,t,n){var o=e.contacts,a=t.supports,s=e.activeContacts,l=t.parentA,u=t.parentB;if(e.collision=t,e.inverseMass=l.inverseMass+u.inverseMass,e.friction=Math.min(l.friction,u.friction),e.frictionStatic=Math.max(l.frictionStatic,u.frictionStatic),e.restitution=Math.max(l.restitution,u.restitution),e.slop=Math.max(l.slop,u.slop),s.length=0,t.collided){for(var c=0;c<a.length;c++){var h=a[c],d=i.id(h),f=o[d];f?s.push(f):s.push(o[d]=i.create(h))}e.separation=t.depth,r.setActive(e,!0,n)}else!0===e.isActive&&r.setActive(e,!1,n)},r.setActive=function(e,t,n){t?(e.isActive=!0,e.timeUpdated=n):(e.isActive=!1,e.activeContacts.length=0)},r.id=function(e,t){return e.id<t.id?"A"+e.id+"B"+t.id:"A"+t.id+"B"+e.id}})()},function(e,t,n){var r={};e.exports=r;var i=n(2),o=n(0);(function(){r.fromVertices=function(e){for(var t={},n=0;n<e.length;n++){var r=(n+1)%e.length,a=i.normalise({x:e[r].y-e[n].y,y:e[n].x-e[r].x}),s=0===a.y?1/0:a.x/a.y;s=s.toFixed(3).toString(),t[s]=a}return o.values(t)},r.rotate=function(e,t){if(0!==t)for(var n=Math.cos(t),r=Math.sin(t),i=0;i<e.length;i++){var o,a=e[i];o=a.x*n-a.y*r,a.y=a.x*r+a.y*n,a.x=o}}})()},function(e,t,n){var r={};e.exports=r;var i=n(3),o=n(0),a=n(6),s=n(1),l=n(2);(function(){r.rectangle=function(e,t,n,r,s){s=s||{};var l={label:"Rectangle Body",position:{x:e,y:t},vertices:i.fromPath("L 0 0 L "+n+" 0 L "+n+" "+r+" L 0 "+r)};if(s.chamfer){var u=s.chamfer;l.vertices=i.chamfer(l.vertices,u.radius,u.quality,u.qualityMin,u.qualityMax),delete s.chamfer}return a.create(o.extend({},l,s))},r.trapezoid=function(e,t,n,r,s,l){l=l||{},s*=.5;var u,c=(1-2*s)*n,h=n*s,d=h+c,f=d+h;u=s<.5?"L 0 0 L "+h+" "+-r+" L "+d+" "+-r+" L "+f+" 0":"L 0 0 L "+d+" "+-r+" L "+f+" 0";var p={label:"Trapezoid Body",position:{x:e,y:t},vertices:i.fromPath(u)};if(l.chamfer){var v=l.chamfer;p.vertices=i.chamfer(p.vertices,v.radius,v.quality,v.qualityMin,v.qualityMax),delete l.chamfer}return a.create(o.extend({},p,l))},r.circle=function(e,t,n,i,a){i=i||{};var s={label:"Circle Body",circleRadius:n};a=a||25;var l=Math.ceil(Math.max(10,Math.min(a,n)));return l%2===1&&(l+=1),r.polygon(e,t,l,n,o.extend({},s,i))},r.polygon=function(e,t,n,s,l){if(l=l||{},n<3)return r.circle(e,t,s,l);for(var u=2*Math.PI/n,c="",h=.5*u,d=0;d<n;d+=1){var f=h+d*u,p=Math.cos(f)*s,v=Math.sin(f)*s;c+="L "+p.toFixed(3)+" "+v.toFixed(3)+" "}var m={label:"Polygon Body",position:{x:e,y:t},vertices:i.fromPath(c)};if(l.chamfer){var y=l.chamfer;m.vertices=i.chamfer(m.vertices,y.radius,y.quality,y.qualityMin,y.qualityMax),delete l.chamfer}return a.create(o.extend({},m,l))},r.fromVertices=function(e,t,n,r,u,c,h,d){var f,p,v,m,y,g,x,b,w,k,A,S=o.getDecomp();for(f=Boolean(S&&S.quickDecomp),r=r||{},v=[],u="undefined"!==typeof u&&u,c="undefined"!==typeof c?c:.01,h="undefined"!==typeof h?h:10,d="undefined"!==typeof d?d:.01,o.isArray(n[0])||(n=[n]),k=0;k<n.length;k+=1)if(g=n[k],m=i.isConvex(g),y=!m,y&&!f&&o.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),m||!f)g=m?i.clockwiseSort(g):i.hull(g),v.push({position:{x:e,y:t},vertices:g});else{var M=g.map((function(e){return[e.x,e.y]}));S.makeCCW(M),!1!==c&&S.removeCollinearPoints(M,c),!1!==d&&S.removeDuplicatePoints&&S.removeDuplicatePoints(M,d);var T=S.quickDecomp(M);for(x=0;x<T.length;x++){var P=T[x],C=P.map((function(e){return{x:e[0],y:e[1]}}));h>0&&i.area(C)<h||v.push({position:i.centre(C),vertices:C})}}for(x=0;x<v.length;x++)v[x]=a.create(o.extend(v[x],r));if(u){var E=5;for(x=0;x<v.length;x++){var _=v[x];for(b=x+1;b<v.length;b++){var I=v[b];if(s.overlaps(_.bounds,I.bounds)){var R=_.vertices,L=I.vertices;for(w=0;w<_.vertices.length;w++)for(A=0;A<I.vertices.length;A++){var B=l.magnitudeSquared(l.sub(R[(w+1)%R.length],L[A])),N=l.magnitudeSquared(l.sub(R[w],L[(A+1)%L.length]));B<E&&N<E&&(R[w].isInternal=!0,L[A].isInternal=!0)}}}}}return v.length>1?(p=a.create(o.extend({parts:v.slice(0)},r)),a.setPosition(p,{x:e,y:t}),p):v[0]}})()},function(e,t,n){var r={};e.exports=r;var i=n(0);(function(){r.create=function(e){var t={};return e||i.log("Mouse.create: element was undefined, defaulting to document.body","warn"),t.element=e||document.body,t.absolute={x:0,y:0},t.position={x:0,y:0},t.mousedownPosition={x:0,y:0},t.mouseupPosition={x:0,y:0},t.offset={x:0,y:0},t.scale={x:1,y:1},t.wheelDelta=0,t.button=-1,t.pixelRatio=parseInt(t.element.getAttribute("data-pixel-ratio"),10)||1,t.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},t.mousemove=function(e){var n=r._getRelativeMousePosition(e,t.element,t.pixelRatio),i=e.changedTouches;i&&(t.button=0,e.preventDefault()),t.absolute.x=n.x,t.absolute.y=n.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y,t.sourceEvents.mousemove=e},t.mousedown=function(e){var n=r._getRelativeMousePosition(e,t.element,t.pixelRatio),i=e.changedTouches;i?(t.button=0,e.preventDefault()):t.button=e.button,t.absolute.x=n.x,t.absolute.y=n.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y,t.mousedownPosition.x=t.position.x,t.mousedownPosition.y=t.position.y,t.sourceEvents.mousedown=e},t.mouseup=function(e){var n=r._getRelativeMousePosition(e,t.element,t.pixelRatio),i=e.changedTouches;i&&e.preventDefault(),t.button=-1,t.absolute.x=n.x,t.absolute.y=n.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y,t.mouseupPosition.x=t.position.x,t.mouseupPosition.y=t.position.y,t.sourceEvents.mouseup=e},t.mousewheel=function(e){t.wheelDelta=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail)),e.preventDefault()},r.setElement(t,t.element),t},r.setElement=function(e,t){e.element=t,t.addEventListener("mousemove",e.mousemove),t.addEventListener("mousedown",e.mousedown),t.addEventListener("mouseup",e.mouseup),t.addEventListener("mousewheel",e.mousewheel),t.addEventListener("DOMMouseScroll",e.mousewheel),t.addEventListener("touchmove",e.mousemove),t.addEventListener("touchstart",e.mousedown),t.addEventListener("touchend",e.mouseup)},r.clearSourceEvents=function(e){e.sourceEvents.mousemove=null,e.sourceEvents.mousedown=null,e.sourceEvents.mouseup=null,e.sourceEvents.mousewheel=null,e.wheelDelta=0},r.setOffset=function(e,t){e.offset.x=t.x,e.offset.y=t.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y},r.setScale=function(e,t){e.scale.x=t.x,e.scale.y=t.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y},r._getRelativeMousePosition=function(e,t,n){var r,i,o=t.getBoundingClientRect(),a=document.documentElement||document.body.parentNode||document.body,s=void 0!==window.pageXOffset?window.pageXOffset:a.scrollLeft,l=void 0!==window.pageYOffset?window.pageYOffset:a.scrollTop,u=e.changedTouches;return u?(r=u[0].pageX-o.left-s,i=u[0].pageY-o.top-l):(r=e.pageX-o.left-s,i=e.pageY-o.top-l),{x:r/(t.clientWidth/(t.width||t.clientWidth)*n),y:i/(t.clientHeight/(t.height||t.clientHeight)*n)}}})()},function(e,t,n){var r={};e.exports=r;var i=n(14),o=n(9),a=n(1);(function(){r.collisions=function(e,t){for(var n=[],s=t.pairs.table,l=0;l<e.length;l++){var u=e[l][0],c=e[l][1];if((!u.isStatic&&!u.isSleeping||!c.isStatic&&!c.isSleeping)&&(r.canCollide(u.collisionFilter,c.collisionFilter)&&a.overlaps(u.bounds,c.bounds)))for(var h=u.parts.length>1?1:0;h<u.parts.length;h++)for(var d=u.parts[h],f=c.parts.length>1?1:0;f<c.parts.length;f++){var p=c.parts[f];if(d===u&&p===c||a.overlaps(d.bounds,p.bounds)){var v,m=o.id(d,p),y=s[m];v=y&&y.isActive?y.collision:null;var g=i.collides(d,p,v);g.collided&&n.push(g)}}}return n},r.canCollide=function(e,t){return e.group===t.group&&0!==e.group?e.group>0:0!==(e.mask&t.category)&&0!==(t.mask&e.category)}})()},function(e,t,n){var r={};e.exports=r;var i=n(3),o=n(2);(function(){r.collides=function(e,t,n){var a,s,l,u,c=!1;if(n){var h=e.parent,d=t.parent,f=h.speed*h.speed+h.angularSpeed*h.angularSpeed+d.speed*d.speed+d.angularSpeed*d.angularSpeed;c=n&&n.collided&&f<.2,u=n}else u={collided:!1,bodyA:e,bodyB:t};if(n&&c){var p=u.axisBody,v=p===e?t:e,m=[p.axes[n.axisNumber]];if(l=r._overlapAxes(p.vertices,v.vertices,m),u.reused=!0,l.overlap<=0)return u.collided=!1,u}else{if(a=r._overlapAxes(e.vertices,t.vertices,e.axes),a.overlap<=0)return u.collided=!1,u;if(s=r._overlapAxes(t.vertices,e.vertices,t.axes),s.overlap<=0)return u.collided=!1,u;a.overlap<s.overlap?(l=a,u.axisBody=e):(l=s,u.axisBody=t),u.axisNumber=l.axisNumber}u.bodyA=e.id<t.id?e:t,u.bodyB=e.id<t.id?t:e,u.collided=!0,u.depth=l.overlap,u.parentA=u.bodyA.parent,u.parentB=u.bodyB.parent,e=u.bodyA,t=u.bodyB,o.dot(l.axis,o.sub(t.position,e.position))<0?u.normal={x:l.axis.x,y:l.axis.y}:u.normal={x:-l.axis.x,y:-l.axis.y},u.tangent=o.perp(u.normal),u.penetration=u.penetration||{},u.penetration.x=u.normal.x*u.depth,u.penetration.y=u.normal.y*u.depth;var y=r._findSupports(e,t,u.normal),g=[];if(i.contains(e.vertices,y[0])&&g.push(y[0]),i.contains(e.vertices,y[1])&&g.push(y[1]),g.length<2){var x=r._findSupports(t,e,o.neg(u.normal));i.contains(t.vertices,x[0])&&g.push(x[0]),g.length<2&&i.contains(t.vertices,x[1])&&g.push(x[1])}return g.length<1&&(g=[y[0]]),u.supports=g,u},r._overlapAxes=function(e,t,n){for(var i,a,s=o._temp[0],l=o._temp[1],u={overlap:Number.MAX_VALUE},c=0;c<n.length;c++){if(a=n[c],r._projectToAxis(s,e,a),r._projectToAxis(l,t,a),i=Math.min(s.max-l.min,l.max-s.min),i<=0)return u.overlap=i,u;i<u.overlap&&(u.overlap=i,u.axis=a,u.axisNumber=c)}return u},r._projectToAxis=function(e,t,n){for(var r=o.dot(t[0],n),i=r,a=1;a<t.length;a+=1){var s=o.dot(t[a],n);s>i?i=s:s<r&&(r=s)}e.min=r,e.max=i},r._findSupports=function(e,t,n){for(var r,i,a,s,l=Number.MAX_VALUE,u=o._temp[0],c=t.vertices,h=e.position,d=0;d<c.length;d++)i=c[d],u.x=i.x-h.x,u.y=i.y-h.y,r=-o.dot(n,u),r<l&&(l=r,a=i);var f=a.index-1>=0?a.index-1:c.length-1;i=c[f],u.x=i.x-h.x,u.y=i.y-h.y,l=-o.dot(n,u),s=i;var p=(a.index+1)%c.length;return i=c[p],u.x=i.x-h.x,u.y=i.y-h.y,r=-o.dot(n,u),r<l&&(s=i),[a,s]}})()},function(e,t,n){var r={};e.exports=r;var i=n(0);(function(){r._registry={},r.register=function(e){if(r.isPlugin(e)||i.warn("Plugin.register:",r.toString(e),"does not implement all required fields."),e.name in r._registry){var t=r._registry[e.name],n=r.versionParse(e.version).number,o=r.versionParse(t.version).number;n>o?(i.warn("Plugin.register:",r.toString(t),"was upgraded to",r.toString(e)),r._registry[e.name]=e):n<o?i.warn("Plugin.register:",r.toString(t),"can not be downgraded to",r.toString(e)):e!==t&&i.warn("Plugin.register:",r.toString(e),"is already registered to different plugin object")}else r._registry[e.name]=e;return e},r.resolve=function(e){return r._registry[r.dependencyParse(e).name]},r.toString=function(e){return"string"===typeof e?e:(e.name||"anonymous")+"@"+(e.version||e.range||"0.0.0")},r.isPlugin=function(e){return e&&e.name&&e.version&&e.install},r.isUsed=function(e,t){return e.used.indexOf(t)>-1},r.isFor=function(e,t){var n=e.for&&r.dependencyParse(e.for);return!e.for||t.name===n.name&&r.versionSatisfies(t.version,n.range)},r.use=function(e,t){if(e.uses=(e.uses||[]).concat(t||[]),0!==e.uses.length){for(var n=r.dependencies(e),o=i.topologicalSort(n),a=[],s=0;s<o.length;s+=1)if(o[s]!==e.name){var l=r.resolve(o[s]);l?r.isUsed(e,l.name)||(r.isFor(l,e)||(i.warn("Plugin.use:",r.toString(l),"is for",l.for,"but installed on",r.toString(e)+"."),l._warned=!0),l.install?l.install(e):(i.warn("Plugin.use:",r.toString(l),"does not specify an install function."),l._warned=!0),l._warned?(a.push("🔶 "+r.toString(l)),delete l._warned):a.push("✅ "+r.toString(l)),e.used.push(l.name)):a.push("❌ "+o[s])}a.length>0&&i.info(a.join("  "))}else i.warn("Plugin.use:",r.toString(e),"does not specify any dependencies to install.")},r.dependencies=function(e,t){var n=r.dependencyParse(e),o=n.name;if(t=t||{},!(o in t)){e=r.resolve(e)||e,t[o]=i.map(e.uses||[],(function(t){r.isPlugin(t)&&r.register(t);var o=r.dependencyParse(t),a=r.resolve(t);return a&&!r.versionSatisfies(a.version,o.range)?(i.warn("Plugin.dependencies:",r.toString(a),"does not satisfy",r.toString(o),"used by",r.toString(n)+"."),a._warned=!0,e._warned=!0):a||(i.warn("Plugin.dependencies:",r.toString(t),"used by",r.toString(n),"could not be resolved."),e._warned=!0),o.name}));for(var a=0;a<t[o].length;a+=1)r.dependencies(t[o][a],t);return t}},r.dependencyParse=function(e){if(i.isString(e)){var t=/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-]+)?))?$/;return t.test(e)||i.warn("Plugin.dependencyParse:",e,"is not a valid dependency string."),{name:e.split("@")[0],range:e.split("@")[1]||"*"}}return{name:e.name,range:e.range||e.version}},r.versionParse=function(e){var t=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-]+)?$/;t.test(e)||i.warn("Plugin.versionParse:",e,"is not a valid version or range.");var n=t.exec(e),r=Number(n[4]),o=Number(n[5]),a=Number(n[6]);return{isRange:Boolean(n[1]||n[2]),version:n[3],range:e,operator:n[1]||n[2]||"",major:r,minor:o,patch:a,parts:[r,o,a],prerelease:n[7],number:1e8*r+1e4*o+a}},r.versionSatisfies=function(e,t){t=t||"*";var n=r.versionParse(t),i=r.versionParse(e);if(n.isRange){if("*"===n.operator||"*"===e)return!0;if(">"===n.operator)return i.number>n.number;if(">="===n.operator)return i.number>=n.number;if("~"===n.operator)return i.major===n.major&&i.minor===n.minor&&i.patch>=n.patch;if("^"===n.operator)return n.major>0?i.major===n.major&&i.number>=n.number:n.minor>0?i.minor===n.minor&&i.patch>=n.patch:i.patch===n.patch}return e===t||"*"===e}})()},function(e,t,n){var r={};e.exports=r;var i=n(0),o=n(5),a=n(1),s=n(4),l=n(2),u=n(12);(function(){var e,t;"undefined"!==typeof window&&(e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout((function(){e(i.now())}),1e3/60)},t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),r._goodFps=30,r._goodDelta=1e3/60,r.create=function(e){var t={controller:r,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",hasBounds:!!e.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},n=i.extend(t,e);return n.canvas&&(n.canvas.width=n.options.width||n.canvas.width,n.canvas.height=n.options.height||n.canvas.height),n.mouse=e.mouse,n.engine=e.engine,n.canvas=n.canvas||h(n.options.width,n.options.height),n.context=n.canvas.getContext("2d"),n.textures={},n.bounds=n.bounds||{min:{x:0,y:0},max:{x:n.canvas.width,y:n.canvas.height}},1!==n.options.pixelRatio&&r.setPixelRatio(n,n.options.pixelRatio),i.isElement(n.element)?n.element.appendChild(n.canvas):n.canvas.parentNode||i.log("Render.create: options.element was undefined, render.canvas was created but not appended","warn"),n},r.run=function(t){(function i(o){t.frameRequestId=e(i),n(t,o),r.world(t,o),(t.options.showStats||t.options.showDebug)&&r.stats(t,t.context,o),(t.options.showPerformance||t.options.showDebug)&&r.performance(t,t.context,o)})()},r.stop=function(e){t(e.frameRequestId)},r.setPixelRatio=function(e,t){var n=e.options,r=e.canvas;"auto"===t&&(t=d(r)),n.pixelRatio=t,r.setAttribute("data-pixel-ratio",t),r.width=n.width*t,r.height=n.height*t,r.style.width=n.width+"px",r.style.height=n.height+"px"},r.lookAt=function(e,t,n,r){r="undefined"===typeof r||r,t=i.isArray(t)?t:[t],n=n||{x:0,y:0};for(var o={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},a=0;a<t.length;a+=1){var s=t[a],l=s.bounds?s.bounds.min:s.min||s.position||s,c=s.bounds?s.bounds.max:s.max||s.position||s;l&&c&&(l.x<o.min.x&&(o.min.x=l.x),c.x>o.max.x&&(o.max.x=c.x),l.y<o.min.y&&(o.min.y=l.y),c.y>o.max.y&&(o.max.y=c.y))}var h=o.max.x-o.min.x+2*n.x,d=o.max.y-o.min.y+2*n.y,f=e.canvas.height,p=e.canvas.width,v=p/f,m=h/d,y=1,g=1;m>v?g=m/v:y=v/m,e.options.hasBounds=!0,e.bounds.min.x=o.min.x,e.bounds.max.x=o.min.x+h*y,e.bounds.min.y=o.min.y,e.bounds.max.y=o.min.y+d*g,r&&(e.bounds.min.x+=.5*h-h*y*.5,e.bounds.max.x+=.5*h-h*y*.5,e.bounds.min.y+=.5*d-d*g*.5,e.bounds.max.y+=.5*d-d*g*.5),e.bounds.min.x-=n.x,e.bounds.max.x-=n.x,e.bounds.min.y-=n.y,e.bounds.max.y-=n.y,e.mouse&&(u.setScale(e.mouse,{x:(e.bounds.max.x-e.bounds.min.x)/e.canvas.width,y:(e.bounds.max.y-e.bounds.min.y)/e.canvas.height}),u.setOffset(e.mouse,e.bounds.min))},r.startViewTransform=function(e){var t=e.bounds.max.x-e.bounds.min.x,n=e.bounds.max.y-e.bounds.min.y,r=t/e.options.width,i=n/e.options.height;e.context.setTransform(e.options.pixelRatio/r,0,0,e.options.pixelRatio/i,0,0),e.context.translate(-e.bounds.min.x,-e.bounds.min.y)},r.endViewTransform=function(e){e.context.setTransform(e.options.pixelRatio,0,0,e.options.pixelRatio,0,0)},r.world=function(e,t){var n,c=i.now(),h=e.engine,d=h.world,f=e.canvas,v=e.context,m=e.options,y=e.timing,g=o.allBodies(d),x=o.allConstraints(d),b=m.wireframes?m.wireframeBackground:m.background,w=[],k=[],A={timestamp:h.timing.timestamp};if(s.trigger(e,"beforeRender",A),e.currentBackground!==b&&p(e,b),v.globalCompositeOperation="source-in",v.fillStyle="transparent",v.fillRect(0,0,f.width,f.height),v.globalCompositeOperation="source-over",m.hasBounds){for(n=0;n<g.length;n++){var S=g[n];a.overlaps(S.bounds,e.bounds)&&w.push(S)}for(n=0;n<x.length;n++){var M=x[n],T=M.bodyA,P=M.bodyB,C=M.pointA,E=M.pointB;T&&(C=l.add(T.position,M.pointA)),P&&(E=l.add(P.position,M.pointB)),C&&E&&((a.contains(e.bounds,C)||a.contains(e.bounds,E))&&k.push(M))}r.startViewTransform(e),e.mouse&&(u.setScale(e.mouse,{x:(e.bounds.max.x-e.bounds.min.x)/e.options.width,y:(e.bounds.max.y-e.bounds.min.y)/e.options.height}),u.setOffset(e.mouse,e.bounds.min))}else k=x,w=g,1!==e.options.pixelRatio&&e.context.setTransform(e.options.pixelRatio,0,0,e.options.pixelRatio,0,0);!m.wireframes||h.enableSleeping&&m.showSleeping?r.bodies(e,w,v):(m.showConvexHulls&&r.bodyConvexHulls(e,w,v),r.bodyWireframes(e,w,v)),m.showBounds&&r.bodyBounds(e,w,v),(m.showAxes||m.showAngleIndicator)&&r.bodyAxes(e,w,v),m.showPositions&&r.bodyPositions(e,w,v),m.showVelocity&&r.bodyVelocity(e,w,v),m.showIds&&r.bodyIds(e,w,v),m.showSeparations&&r.separations(e,h.pairs.list,v),m.showCollisions&&r.collisions(e,h.pairs.list,v),m.showVertexNumbers&&r.vertexNumbers(e,w,v),m.showMousePosition&&r.mousePosition(e,e.mouse,v),r.constraints(k,v),m.showBroadphase&&r.grid(e,h.grid,v),m.hasBounds&&r.endViewTransform(e),s.trigger(e,"afterRender",A),y.lastElapsed=i.now()-c},r.stats=function(e,t,n){for(var r=e.engine,i=r.world,a=o.allBodies(i),s=0,l=55,u=44,c=0,h=0,d=0;d<a.length;d+=1)s+=a[d].parts.length;var f={Part:s,Body:a.length,Cons:o.allConstraints(i).length,Comp:o.allComposites(i).length,Pair:r.pairs.list.length};for(var p in t.fillStyle="#0e0f19",t.fillRect(c,h,5.5*l,u),t.font="12px Arial",t.textBaseline="top",t.textAlign="right",f){var v=f[p];t.fillStyle="#aaa",t.fillText(p,c+l,h+8),t.fillStyle="#eee",t.fillText(v,c+l,h+26),c+=l}},r.performance=function(e,t){var n=e.engine,i=e.timing,o=i.deltaHistory,a=i.elapsedHistory,s=i.timestampElapsedHistory,l=i.engineDeltaHistory,u=i.engineElapsedHistory,h=n.timing.lastDelta,d=c(o),f=c(a),p=c(l),v=c(u),m=c(s),y=m/d||0,g=1e3/d||0,x=4,b=12,w=60,k=34,A=10,S=69;t.fillStyle="#0e0f19",t.fillRect(0,50,4*b+5*w+22,k),r.status(t,A,S,w,x,o.length,Math.round(g)+" fps",g/r._goodFps,(function(e){return o[e]/d-1})),r.status(t,A+b+w,S,w,x,l.length,h.toFixed(2)+" dt",r._goodDelta/h,(function(e){return l[e]/p-1})),r.status(t,A+2*(b+w),S,w,x,u.length,v.toFixed(2)+" ut",1-v/r._goodFps,(function(e){return u[e]/v-1})),r.status(t,A+3*(b+w),S,w,x,a.length,f.toFixed(2)+" rt",1-f/r._goodFps,(function(e){return a[e]/f-1})),r.status(t,A+4*(b+w),S,w,x,s.length,y.toFixed(2)+" x",y*y*y,(function(e){return(s[e]/o[e]/y||0)-1}))},r.status=function(e,t,n,r,o,a,s,l,u){e.strokeStyle="#888",e.fillStyle="#444",e.lineWidth=1,e.fillRect(t,n+7,r,1),e.beginPath(),e.moveTo(t,n+7-o*i.clamp(.4*u(0),-2,2));for(var c=0;c<r;c+=1)e.lineTo(t+c,n+7-(c<a?o*i.clamp(.4*u(c),-2,2):0));e.stroke(),e.fillStyle="hsl("+i.clamp(25+95*l,0,120)+",100%,60%)",e.fillRect(t,n-7,4,4),e.font="12px Arial",e.textBaseline="middle",e.textAlign="right",e.fillStyle="#eee",e.fillText(s,t+r,n-5)},r.constraints=function(e,t){for(var n=t,r=0;r<e.length;r++){var o=e[r];if(o.render.visible&&o.pointA&&o.pointB){var a,s,u=o.bodyA,c=o.bodyB;if(a=u?l.add(u.position,o.pointA):o.pointA,"pin"===o.render.type)n.beginPath(),n.arc(a.x,a.y,3,0,2*Math.PI),n.closePath();else{if(s=c?l.add(c.position,o.pointB):o.pointB,n.beginPath(),n.moveTo(a.x,a.y),"spring"===o.render.type)for(var h,d=l.sub(s,a),f=l.perp(l.normalise(d)),p=Math.ceil(i.clamp(o.length/5,12,20)),v=1;v<p;v+=1)h=v%2===0?1:-1,n.lineTo(a.x+d.x*(v/p)+f.x*h*4,a.y+d.y*(v/p)+f.y*h*4);n.lineTo(s.x,s.y)}o.render.lineWidth&&(n.lineWidth=o.render.lineWidth,n.strokeStyle=o.render.strokeStyle,n.stroke()),o.render.anchors&&(n.fillStyle=o.render.strokeStyle,n.beginPath(),n.arc(a.x,a.y,3,0,2*Math.PI),n.arc(s.x,s.y,3,0,2*Math.PI),n.closePath(),n.fill())}}},r.bodies=function(e,t,n){var r,i,o,a,s=n,l=(e.engine,e.options),u=l.showInternalEdges||!l.wireframes;for(o=0;o<t.length;o++)if(r=t[o],r.render.visible)for(a=r.parts.length>1?1:0;a<r.parts.length;a++)if(i=r.parts[a],i.render.visible){if(l.showSleeping&&r.isSleeping?s.globalAlpha=.5*i.render.opacity:1!==i.render.opacity&&(s.globalAlpha=i.render.opacity),i.render.sprite&&i.render.sprite.texture&&!l.wireframes){var c=i.render.sprite,h=f(e,c.texture);s.translate(i.position.x,i.position.y),s.rotate(i.angle),s.drawImage(h,h.width*-c.xOffset*c.xScale,h.height*-c.yOffset*c.yScale,h.width*c.xScale,h.height*c.yScale),s.rotate(-i.angle),s.translate(-i.position.x,-i.position.y)}else{if(i.circleRadius)s.beginPath(),s.arc(i.position.x,i.position.y,i.circleRadius,0,2*Math.PI);else{s.beginPath(),s.moveTo(i.vertices[0].x,i.vertices[0].y);for(var d=1;d<i.vertices.length;d++)!i.vertices[d-1].isInternal||u?s.lineTo(i.vertices[d].x,i.vertices[d].y):s.moveTo(i.vertices[d].x,i.vertices[d].y),i.vertices[d].isInternal&&!u&&s.moveTo(i.vertices[(d+1)%i.vertices.length].x,i.vertices[(d+1)%i.vertices.length].y);s.lineTo(i.vertices[0].x,i.vertices[0].y),s.closePath()}l.wireframes?(s.lineWidth=1,s.strokeStyle="#bbb",s.stroke()):(s.fillStyle=i.render.fillStyle,i.render.lineWidth&&(s.lineWidth=i.render.lineWidth,s.strokeStyle=i.render.strokeStyle,s.stroke()),s.fill())}s.globalAlpha=1}},r.bodyWireframes=function(e,t,n){var r,i,o,a,s,l=n,u=e.options.showInternalEdges;for(l.beginPath(),o=0;o<t.length;o++)if(r=t[o],r.render.visible)for(s=r.parts.length>1?1:0;s<r.parts.length;s++){for(i=r.parts[s],l.moveTo(i.vertices[0].x,i.vertices[0].y),a=1;a<i.vertices.length;a++)!i.vertices[a-1].isInternal||u?l.lineTo(i.vertices[a].x,i.vertices[a].y):l.moveTo(i.vertices[a].x,i.vertices[a].y),i.vertices[a].isInternal&&!u&&l.moveTo(i.vertices[(a+1)%i.vertices.length].x,i.vertices[(a+1)%i.vertices.length].y);l.lineTo(i.vertices[0].x,i.vertices[0].y)}l.lineWidth=1,l.strokeStyle="#bbb",l.stroke()},r.bodyConvexHulls=function(e,t,n){var r,i,o,a=n;for(a.beginPath(),i=0;i<t.length;i++)if(r=t[i],r.render.visible&&1!==r.parts.length){for(a.moveTo(r.vertices[0].x,r.vertices[0].y),o=1;o<r.vertices.length;o++)a.lineTo(r.vertices[o].x,r.vertices[o].y);a.lineTo(r.vertices[0].x,r.vertices[0].y)}a.lineWidth=1,a.strokeStyle="rgba(255,255,255,0.2)",a.stroke()},r.vertexNumbers=function(e,t,n){var r,i,o,a=n;for(r=0;r<t.length;r++){var s=t[r].parts;for(o=s.length>1?1:0;o<s.length;o++){var l=s[o];for(i=0;i<l.vertices.length;i++)a.fillStyle="rgba(255,255,255,0.2)",a.fillText(r+"_"+i,l.position.x+.8*(l.vertices[i].x-l.position.x),l.position.y+.8*(l.vertices[i].y-l.position.y))}}},r.mousePosition=function(e,t,n){var r=n;r.fillStyle="rgba(255,255,255,0.8)",r.fillText(t.position.x+"  "+t.position.y,t.position.x+5,t.position.y-5)},r.bodyBounds=function(e,t,n){var r=n,i=(e.engine,e.options);r.beginPath();for(var o=0;o<t.length;o++){var a=t[o];if(a.render.visible)for(var s=t[o].parts,l=s.length>1?1:0;l<s.length;l++){var u=s[l];r.rect(u.bounds.min.x,u.bounds.min.y,u.bounds.max.x-u.bounds.min.x,u.bounds.max.y-u.bounds.min.y)}}i.wireframes?r.strokeStyle="rgba(255,255,255,0.08)":r.strokeStyle="rgba(0,0,0,0.1)",r.lineWidth=1,r.stroke()},r.bodyAxes=function(e,t,n){var r,i,o,a,s=n,l=(e.engine,e.options);for(s.beginPath(),i=0;i<t.length;i++){var u=t[i],c=u.parts;if(u.render.visible)if(l.showAxes)for(o=c.length>1?1:0;o<c.length;o++)for(r=c[o],a=0;a<r.axes.length;a++){var h=r.axes[a];s.moveTo(r.position.x,r.position.y),s.lineTo(r.position.x+20*h.x,r.position.y+20*h.y)}else for(o=c.length>1?1:0;o<c.length;o++)for(r=c[o],a=0;a<r.axes.length;a++)s.moveTo(r.position.x,r.position.y),s.lineTo((r.vertices[0].x+r.vertices[r.vertices.length-1].x)/2,(r.vertices[0].y+r.vertices[r.vertices.length-1].y)/2)}l.wireframes?(s.strokeStyle="indianred",s.lineWidth=1):(s.strokeStyle="rgba(255, 255, 255, 0.4)",s.globalCompositeOperation="overlay",s.lineWidth=2),s.stroke(),s.globalCompositeOperation="source-over"},r.bodyPositions=function(e,t,n){var r,i,o,a,s=n,l=(e.engine,e.options);for(s.beginPath(),o=0;o<t.length;o++)if(r=t[o],r.render.visible)for(a=0;a<r.parts.length;a++)i=r.parts[a],s.arc(i.position.x,i.position.y,3,0,2*Math.PI,!1),s.closePath();for(l.wireframes?s.fillStyle="indianred":s.fillStyle="rgba(0,0,0,0.5)",s.fill(),s.beginPath(),o=0;o<t.length;o++)r=t[o],r.render.visible&&(s.arc(r.positionPrev.x,r.positionPrev.y,2,0,2*Math.PI,!1),s.closePath());s.fillStyle="rgba(255,165,0,0.8)",s.fill()},r.bodyVelocity=function(e,t,n){var r=n;r.beginPath();for(var i=0;i<t.length;i++){var o=t[i];o.render.visible&&(r.moveTo(o.position.x,o.position.y),r.lineTo(o.position.x+2*(o.position.x-o.positionPrev.x),o.position.y+2*(o.position.y-o.positionPrev.y)))}r.lineWidth=3,r.strokeStyle="cornflowerblue",r.stroke()},r.bodyIds=function(e,t,n){var r,i,o=n;for(r=0;r<t.length;r++)if(t[r].render.visible){var a=t[r].parts;for(i=a.length>1?1:0;i<a.length;i++){var s=a[i];o.font="12px Arial",o.fillStyle="rgba(255,255,255,0.5)",o.fillText(s.id,s.position.x+10,s.position.y-10)}}},r.collisions=function(e,t,n){var r,i,o,a,s=n,l=e.options;for(s.beginPath(),o=0;o<t.length;o++)if(r=t[o],r.isActive)for(i=r.collision,a=0;a<r.activeContacts.length;a++){var u=r.activeContacts[a],c=u.vertex;s.rect(c.x-1.5,c.y-1.5,3.5,3.5)}for(l.wireframes?s.fillStyle="rgba(255,255,255,0.7)":s.fillStyle="orange",s.fill(),s.beginPath(),o=0;o<t.length;o++)if(r=t[o],r.isActive&&(i=r.collision,r.activeContacts.length>0)){var h=r.activeContacts[0].vertex.x,d=r.activeContacts[0].vertex.y;2===r.activeContacts.length&&(h=(r.activeContacts[0].vertex.x+r.activeContacts[1].vertex.x)/2,d=(r.activeContacts[0].vertex.y+r.activeContacts[1].vertex.y)/2),i.bodyB===i.supports[0].body||!0===i.bodyA.isStatic?s.moveTo(h-8*i.normal.x,d-8*i.normal.y):s.moveTo(h+8*i.normal.x,d+8*i.normal.y),s.lineTo(h,d)}l.wireframes?s.strokeStyle="rgba(255,165,0,0.7)":s.strokeStyle="orange",s.lineWidth=1,s.stroke()},r.separations=function(e,t,n){var r,i,o,a,s,l=n,u=e.options;for(l.beginPath(),s=0;s<t.length;s++)if(r=t[s],r.isActive){i=r.collision,o=i.bodyA,a=i.bodyB;var c=1;a.isStatic||o.isStatic||(c=.5),a.isStatic&&(c=0),l.moveTo(a.position.x,a.position.y),l.lineTo(a.position.x-i.penetration.x*c,a.position.y-i.penetration.y*c),c=1,a.isStatic||o.isStatic||(c=.5),o.isStatic&&(c=0),l.moveTo(o.position.x,o.position.y),l.lineTo(o.position.x+i.penetration.x*c,o.position.y+i.penetration.y*c)}u.wireframes?l.strokeStyle="rgba(255,165,0,0.5)":l.strokeStyle="orange",l.stroke()},r.grid=function(e,t,n){var r=n,o=e.options;o.wireframes?r.strokeStyle="rgba(255,180,0,0.1)":r.strokeStyle="rgba(255,180,0,0.5)",r.beginPath();for(var a=i.keys(t.buckets),s=0;s<a.length;s++){var l=a[s];if(!(t.buckets[l].length<2)){var u=l.split(/C|R/);r.rect(.5+parseInt(u[1],10)*t.bucketWidth,.5+parseInt(u[2],10)*t.bucketHeight,t.bucketWidth,t.bucketHeight)}}r.lineWidth=1,r.stroke()},r.inspector=function(e,t){e.engine;var n,r=e.selected,i=e.render,o=i.options;if(o.hasBounds){var a=i.bounds.max.x-i.bounds.min.x,s=i.bounds.max.y-i.bounds.min.y,l=a/i.options.width,u=s/i.options.height;t.scale(1/l,1/u),t.translate(-i.bounds.min.x,-i.bounds.min.y)}for(var c=0;c<r.length;c++){var h=r[c].data;switch(t.translate(.5,.5),t.lineWidth=1,t.strokeStyle="rgba(255,165,0,0.9)",t.setLineDash([1,2]),h.type){case"body":n=h.bounds,t.beginPath(),t.rect(Math.floor(n.min.x-3),Math.floor(n.min.y-3),Math.floor(n.max.x-n.min.x+6),Math.floor(n.max.y-n.min.y+6)),t.closePath(),t.stroke();break;case"constraint":var d=h.pointA;h.bodyA&&(d=h.pointB),t.beginPath(),t.arc(d.x,d.y,10,0,2*Math.PI),t.closePath(),t.stroke();break}t.setLineDash([]),t.translate(-.5,-.5)}null!==e.selectStart&&(t.translate(.5,.5),t.lineWidth=1,t.strokeStyle="rgba(255,165,0,0.6)",t.fillStyle="rgba(255,165,0,0.1)",n=e.selectBounds,t.beginPath(),t.rect(Math.floor(n.min.x),Math.floor(n.min.y),Math.floor(n.max.x-n.min.x),Math.floor(n.max.y-n.min.y)),t.closePath(),t.stroke(),t.fill(),t.translate(-.5,-.5)),o.hasBounds&&t.setTransform(1,0,0,1,0,0)};var n=function(e,t){var n=e.engine,i=e.timing,o=i.historySize,a=n.timing.timestamp;i.delta=t-i.lastTime||r._goodDelta,i.lastTime=t,i.timestampElapsed=a-i.lastTimestamp||0,i.lastTimestamp=a,i.deltaHistory.unshift(i.delta),i.deltaHistory.length=Math.min(i.deltaHistory.length,o),i.engineDeltaHistory.unshift(n.timing.lastDelta),i.engineDeltaHistory.length=Math.min(i.engineDeltaHistory.length,o),i.timestampElapsedHistory.unshift(i.timestampElapsed),i.timestampElapsedHistory.length=Math.min(i.timestampElapsedHistory.length,o),i.engineElapsedHistory.unshift(n.timing.lastElapsed),i.engineElapsedHistory.length=Math.min(i.engineElapsedHistory.length,o),i.elapsedHistory.unshift(i.lastElapsed),i.elapsedHistory.length=Math.min(i.elapsedHistory.length,o)},c=function(e){for(var t=0,n=0;n<e.length;n+=1)t+=e[n];return t/e.length||0},h=function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n.oncontextmenu=function(){return!1},n.onselectstart=function(){return!1},n},d=function(e){var t=e.getContext("2d"),n=window.devicePixelRatio||1,r=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return n/r},f=function(e,t){var n=e.textures[t];return n||(n=e.textures[t]=new Image,n.src=t,n)},p=function(e,t){var n=t;/(jpg|gif|png)$/.test(t)&&(n="url("+t+")"),e.canvas.style.background=n,e.canvas.style.backgroundSize="contain",e.currentBackground=t}})()},function(e,t){var n={};e.exports=n,function(){n.create=function(e){return{id:n.id(e),vertex:e,normalImpulse:0,tangentImpulse:0}},n.id=function(e){return e.body.id+"_"+e.index}}()},function(e,t,n){var r={};e.exports=r;var i=n(7),o=n(19),a=n(13),s=n(20),l=n(21),u=n(4),c=n(5),h=n(8),d=n(0),f=n(6);(function(){r.create=function(e){e=e||{};var t={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},grid:null,gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0}},n=d.extend(t,e);return n.world=e.world||c.create({label:"World"}),n.grid=l.create(e.grid||e.broadphase),n.pairs=s.create(),n.world.gravity=n.gravity,n.broadphase=n.grid,n.metrics={},n},r.update=function(e,t,n){var f=d.now();t=t||1e3/60,n=n||1;var p,v=e.world,m=e.timing,y=e.grid,g=[];m.timestamp+=t*m.timeScale,m.lastDelta=t*m.timeScale;var x={timestamp:m.timestamp};u.trigger(e,"beforeUpdate",x);var b=c.allBodies(v),w=c.allConstraints(v);for(e.enableSleeping&&i.update(b,m.timeScale),r._bodiesApplyGravity(b,e.gravity),r._bodiesUpdate(b,t,m.timeScale,n,v.bounds),h.preSolveAll(b),p=0;p<e.constraintIterations;p++)h.solveAll(w,m.timeScale);h.postSolveAll(b),v.isModified&&l.clear(y),l.update(y,b,e,v.isModified),g=y.pairsList,v.isModified&&c.setModified(v,!1,!1,!0);var k=a.collisions(g,e),A=e.pairs,S=m.timestamp;for(s.update(A,k,S),s.removeOld(A,S),e.enableSleeping&&i.afterCollisions(A.list,m.timeScale),A.collisionStart.length>0&&u.trigger(e,"collisionStart",{pairs:A.collisionStart}),o.preSolvePosition(A.list),p=0;p<e.positionIterations;p++)o.solvePosition(A.list,m.timeScale);for(o.postSolvePosition(b),h.preSolveAll(b),p=0;p<e.constraintIterations;p++)h.solveAll(w,m.timeScale);for(h.postSolveAll(b),o.preSolveVelocity(A.list),p=0;p<e.velocityIterations;p++)o.solveVelocity(A.list,m.timeScale);return A.collisionActive.length>0&&u.trigger(e,"collisionActive",{pairs:A.collisionActive}),A.collisionEnd.length>0&&u.trigger(e,"collisionEnd",{pairs:A.collisionEnd}),r._bodiesClearForces(b),u.trigger(e,"afterUpdate",x),e.timing.lastElapsed=d.now()-f,e},r.merge=function(e,t){if(d.extend(e,t),t.world){e.world=t.world,r.clear(e);for(var n=c.allBodies(e.world),o=0;o<n.length;o++){var a=n[o];i.set(a,!1),a.id=d.nextId()}}},r.clear=function(e){var t=e.world,n=c.allBodies(t);s.clear(e.pairs),l.clear(e.grid),l.update(e.grid,n,e,!0)},r._bodiesClearForces=function(e){for(var t=0;t<e.length;t++){var n=e[t];n.force.x=0,n.force.y=0,n.torque=0}},r._bodiesApplyGravity=function(e,t){var n="undefined"!==typeof t.scale?t.scale:.001;if((0!==t.x||0!==t.y)&&0!==n)for(var r=0;r<e.length;r++){var i=e[r];i.isStatic||i.isSleeping||(i.force.y+=i.mass*t.y*n,i.force.x+=i.mass*t.x*n)}},r._bodiesUpdate=function(e,t,n,r,i){for(var o=0;o<e.length;o++){var a=e[o];a.isStatic||a.isSleeping||f.update(a,t,n,r)}}})()},function(e,t,n){var r={};e.exports=r;var i=n(3),o=n(2),a=n(0),s=n(1);(function(){r._restingThresh=4,r._restingThreshTangent=6,r._positionDampen=.9,r._positionWarming=.8,r._frictionNormalMultiplier=5,r.preSolvePosition=function(e){var t,n,r;for(t=0;t<e.length;t++)n=e[t],n.isActive&&(r=n.activeContacts.length,n.collision.parentA.totalContacts+=r,n.collision.parentB.totalContacts+=r)},r.solvePosition=function(e,t){var n,i,a,s,l,u,c,h,d,f=o._temp[0],p=o._temp[1],v=o._temp[2],m=o._temp[3];for(n=0;n<e.length;n++)i=e[n],i.isActive&&!i.isSensor&&(a=i.collision,s=a.parentA,l=a.parentB,u=a.normal,c=o.sub(o.add(l.positionImpulse,l.position,f),o.add(s.positionImpulse,o.sub(l.position,a.penetration,p),v),m),i.separation=o.dot(u,c));for(n=0;n<e.length;n++)i=e[n],i.isActive&&!i.isSensor&&(a=i.collision,s=a.parentA,l=a.parentB,u=a.normal,d=(i.separation-i.slop)*t,(s.isStatic||l.isStatic)&&(d*=2),s.isStatic||s.isSleeping||(h=r._positionDampen/s.totalContacts,s.positionImpulse.x+=u.x*d*h,s.positionImpulse.y+=u.y*d*h),l.isStatic||l.isSleeping||(h=r._positionDampen/l.totalContacts,l.positionImpulse.x-=u.x*d*h,l.positionImpulse.y-=u.y*d*h))},r.postSolvePosition=function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.totalContacts=0,0!==n.positionImpulse.x||0!==n.positionImpulse.y){for(var a=0;a<n.parts.length;a++){var l=n.parts[a];i.translate(l.vertices,n.positionImpulse),s.update(l.bounds,l.vertices,n.velocity),l.position.x+=n.positionImpulse.x,l.position.y+=n.positionImpulse.y}n.positionPrev.x+=n.positionImpulse.x,n.positionPrev.y+=n.positionImpulse.y,o.dot(n.positionImpulse,n.velocity)<0?(n.positionImpulse.x=0,n.positionImpulse.y=0):(n.positionImpulse.x*=r._positionWarming,n.positionImpulse.y*=r._positionWarming)}}},r.preSolveVelocity=function(e){var t,n,r,i,a,s,l,u,c,h,d,f,p,v,m=o._temp[0],y=o._temp[1];for(t=0;t<e.length;t++)if(r=e[t],r.isActive&&!r.isSensor)for(i=r.activeContacts,a=r.collision,s=a.parentA,l=a.parentB,u=a.normal,c=a.tangent,n=0;n<i.length;n++)h=i[n],d=h.vertex,f=h.normalImpulse,p=h.tangentImpulse,0===f&&0===p||(m.x=u.x*f+c.x*p,m.y=u.y*f+c.y*p,s.isStatic||s.isSleeping||(v=o.sub(d,s.position,y),s.positionPrev.x+=m.x*s.inverseMass,s.positionPrev.y+=m.y*s.inverseMass,s.anglePrev+=o.cross(v,m)*s.inverseInertia),l.isStatic||l.isSleeping||(v=o.sub(d,l.position,y),l.positionPrev.x-=m.x*l.inverseMass,l.positionPrev.y-=m.y*l.inverseMass,l.anglePrev-=o.cross(v,m)*l.inverseInertia))},r.solveVelocity=function(e,t){for(var n=t*t,i=o._temp[0],s=o._temp[1],l=o._temp[2],u=o._temp[3],c=o._temp[4],h=o._temp[5],d=0;d<e.length;d++){var f=e[d];if(f.isActive&&!f.isSensor){var p=f.collision,v=p.parentA,m=p.parentB,y=p.normal,g=p.tangent,x=f.activeContacts,b=1/x.length;v.velocity.x=v.position.x-v.positionPrev.x,v.velocity.y=v.position.y-v.positionPrev.y,m.velocity.x=m.position.x-m.positionPrev.x,m.velocity.y=m.position.y-m.positionPrev.y,v.angularVelocity=v.angle-v.anglePrev,m.angularVelocity=m.angle-m.anglePrev;for(var w=0;w<x.length;w++){var k=x[w],A=k.vertex,S=o.sub(A,v.position,s),M=o.sub(A,m.position,l),T=o.add(v.velocity,o.mult(o.perp(S),v.angularVelocity),u),P=o.add(m.velocity,o.mult(o.perp(M),m.angularVelocity),c),C=o.sub(T,P,h),E=o.dot(y,C),_=o.dot(g,C),I=Math.abs(_),R=a.sign(_),L=(1+f.restitution)*E,B=a.clamp(f.separation+E,0,1)*r._frictionNormalMultiplier,N=_,O=1/0;I>f.friction*f.frictionStatic*B*n&&(O=I,N=a.clamp(f.friction*R*n,-O,O));var V=o.cross(S,y),D=o.cross(M,y),F=b/(v.inverseMass+m.inverseMass+v.inverseInertia*V*V+m.inverseInertia*D*D);if(L*=F,N*=F,E<0&&E*E>r._restingThresh*n)k.normalImpulse=0;else{var U=k.normalImpulse;k.normalImpulse=Math.min(k.normalImpulse+L,0),L=k.normalImpulse-U}if(_*_>r._restingThreshTangent*n)k.tangentImpulse=0;else{var j=k.tangentImpulse;k.tangentImpulse=a.clamp(k.tangentImpulse+N,-O,O),N=k.tangentImpulse-j}i.x=y.x*L+g.x*N,i.y=y.y*L+g.y*N,v.isStatic||v.isSleeping||(v.positionPrev.x+=i.x*v.inverseMass,v.positionPrev.y+=i.y*v.inverseMass,v.anglePrev+=o.cross(S,i)*v.inverseInertia),m.isStatic||m.isSleeping||(m.positionPrev.x-=i.x*m.inverseMass,m.positionPrev.y-=i.y*m.inverseMass,m.anglePrev-=o.cross(M,i)*m.inverseInertia)}}}}})()},function(e,t,n){var r={};e.exports=r;var i=n(9),o=n(0);(function(){r._pairMaxIdleLife=1e3,r.create=function(e){return o.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},e)},r.update=function(e,t,n){var r,o,a,s,l=e.list,u=e.table,c=e.collisionStart,h=e.collisionEnd,d=e.collisionActive;for(c.length=0,h.length=0,d.length=0,s=0;s<l.length;s++)l[s].confirmedActive=!1;for(s=0;s<t.length;s++)r=t[s],r.collided&&(o=i.id(r.bodyA,r.bodyB),a=u[o],a?(a.isActive?d.push(a):c.push(a),i.update(a,r,n),a.confirmedActive=!0):(a=i.create(r,n),u[o]=a,c.push(a),l.push(a)));for(s=0;s<l.length;s++)a=l[s],a.isActive&&!a.confirmedActive&&(i.setActive(a,!1,n),h.push(a))},r.removeOld=function(e,t){var n,i,o,a,s=e.list,l=e.table,u=[];for(a=0;a<s.length;a++)n=s[a],i=n.collision,i.bodyA.isSleeping||i.bodyB.isSleeping?n.timeUpdated=t:t-n.timeUpdated>r._pairMaxIdleLife&&u.push(a);for(a=0;a<u.length;a++)o=u[a]-a,n=s[o],delete l[n.id],s.splice(o,1)},r.clear=function(e){return e.table={},e.list.length=0,e.collisionStart.length=0,e.collisionActive.length=0,e.collisionEnd.length=0,e}})()},function(e,t,n){var r={};e.exports=r;var i=n(9),o=n(0);(function(){r.create=function(e){var t={buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return o.extend(t,e)},r.update=function(e,t,n,i){var o,a,s,l,u,c=n.world,h=e.buckets,d=!1;for(o=0;o<t.length;o++){var f=t[o];if((!f.isSleeping||i)&&(!c.bounds||!(f.bounds.max.x<c.bounds.min.x||f.bounds.min.x>c.bounds.max.x||f.bounds.max.y<c.bounds.min.y||f.bounds.min.y>c.bounds.max.y))){var p=r._getRegion(e,f);if(!f.region||p.id!==f.region.id||i){f.region&&!i||(f.region=p);var v=r._regionUnion(p,f.region);for(a=v.startCol;a<=v.endCol;a++)for(s=v.startRow;s<=v.endRow;s++){u=r._getBucketId(a,s),l=h[u];var m=a>=p.startCol&&a<=p.endCol&&s>=p.startRow&&s<=p.endRow,y=a>=f.region.startCol&&a<=f.region.endCol&&s>=f.region.startRow&&s<=f.region.endRow;!m&&y&&y&&l&&r._bucketRemoveBody(e,l,f),(f.region===p||m&&!y||i)&&(l||(l=r._createBucket(h,u)),r._bucketAddBody(e,l,f))}f.region=p,d=!0}}}d&&(e.pairsList=r._createActivePairsList(e))},r.clear=function(e){e.buckets={},e.pairs={},e.pairsList=[]},r._regionUnion=function(e,t){var n=Math.min(e.startCol,t.startCol),i=Math.max(e.endCol,t.endCol),o=Math.min(e.startRow,t.startRow),a=Math.max(e.endRow,t.endRow);return r._createRegion(n,i,o,a)},r._getRegion=function(e,t){var n=t.bounds,i=Math.floor(n.min.x/e.bucketWidth),o=Math.floor(n.max.x/e.bucketWidth),a=Math.floor(n.min.y/e.bucketHeight),s=Math.floor(n.max.y/e.bucketHeight);return r._createRegion(i,o,a,s)},r._createRegion=function(e,t,n,r){return{id:e+","+t+","+n+","+r,startCol:e,endCol:t,startRow:n,endRow:r}},r._getBucketId=function(e,t){return"C"+e+"R"+t},r._createBucket=function(e,t){var n=e[t]=[];return n},r._bucketAddBody=function(e,t,n){for(var r=0;r<t.length;r++){var o=t[r];if(!(n.id===o.id||n.isStatic&&o.isStatic)){var a=i.id(n,o),s=e.pairs[a];s?s[2]+=1:e.pairs[a]=[n,o,1]}}t.push(n)},r._bucketRemoveBody=function(e,t,n){t.splice(o.indexOf(t,n),1);for(var r=0;r<t.length;r++){var a=t[r],s=i.id(n,a),l=e.pairs[s];l&&(l[2]-=1)}},r._createActivePairsList=function(e){var t,n,r=[];t=o.keys(e.pairs);for(var i=0;i<t.length;i++)n=e.pairs[t[i]],n[2]>0?r.push(n):delete e.pairs[t[i]];return r}})()},function(e,t,n){var r=e.exports=n(23);r.Axes=n(10),r.Bodies=n(11),r.Body=n(6),r.Bounds=n(1),r.Common=n(0),r.Composite=n(5),r.Composites=n(24),r.Constraint=n(8),r.Contact=n(17),r.Detector=n(13),r.Engine=n(18),r.Events=n(4),r.Grid=n(21),r.Mouse=n(12),r.MouseConstraint=n(25),r.Pair=n(9),r.Pairs=n(20),r.Plugin=n(15),r.Query=n(26),r.Render=n(16),r.Resolver=n(19),r.Runner=n(27),r.SAT=n(14),r.Sleeping=n(7),r.Svg=n(28),r.Vector=n(2),r.Vertices=n(3),r.World=n(29),r.Engine.run=r.Runner.run,r.Common.deprecated(r.Engine,"run","Engine.run ➤ use Matter.Runner.run(engine) instead")},function(e,t,n){var r={};e.exports=r;var i=n(15),o=n(0);(function(){r.name="matter-js",r.version="0.17.1",r.uses=[],r.used=[],r.use=function(){i.use(r,Array.prototype.slice.call(arguments))},r.before=function(e,t){return e=e.replace(/^Matter./,""),o.chainPathBefore(r,e,t)},r.after=function(e,t){return e=e.replace(/^Matter./,""),o.chainPathAfter(r,e,t)}})()},function(e,t,n){var r={};e.exports=r;var i=n(5),o=n(8),a=n(0),s=n(6),l=n(11),u=a.deprecated;(function(){r.stack=function(e,t,n,r,o,a,l){for(var u,c=i.create({label:"Stack"}),h=e,d=t,f=0,p=0;p<r;p++){for(var v=0,m=0;m<n;m++){var y=l(h,d,m,p,u,f);if(y){var g=y.bounds.max.y-y.bounds.min.y,x=y.bounds.max.x-y.bounds.min.x;g>v&&(v=g),s.translate(y,{x:.5*x,y:.5*g}),h=y.bounds.max.x+o,i.addBody(c,y),u=y,f+=1}else h+=o}d+=v+a,h=e}return c},r.chain=function(e,t,n,r,s,l){for(var u=e.bodies,c=1;c<u.length;c++){var h=u[c-1],d=u[c],f=h.bounds.max.y-h.bounds.min.y,p=h.bounds.max.x-h.bounds.min.x,v=d.bounds.max.y-d.bounds.min.y,m=d.bounds.max.x-d.bounds.min.x,y={bodyA:h,pointA:{x:p*t,y:f*n},bodyB:d,pointB:{x:m*r,y:v*s}},g=a.extend(y,l);i.addConstraint(e,o.create(g))}return e.label+=" Chain",e},r.mesh=function(e,t,n,r,s){var l,u,c,h,d,f=e.bodies;for(l=0;l<n;l++){for(u=1;u<t;u++)c=f[u-1+l*t],h=f[u+l*t],i.addConstraint(e,o.create(a.extend({bodyA:c,bodyB:h},s)));if(l>0)for(u=0;u<t;u++)c=f[u+(l-1)*t],h=f[u+l*t],i.addConstraint(e,o.create(a.extend({bodyA:c,bodyB:h},s))),r&&u>0&&(d=f[u-1+(l-1)*t],i.addConstraint(e,o.create(a.extend({bodyA:d,bodyB:h},s)))),r&&u<t-1&&(d=f[u+1+(l-1)*t],i.addConstraint(e,o.create(a.extend({bodyA:d,bodyB:h},s))))}return e.label+=" Mesh",e},r.pyramid=function(e,t,n,i,o,a,l){return r.stack(e,t,n,i,o,a,(function(t,r,a,u,c,h){var d=Math.min(i,Math.ceil(n/2)),f=c?c.bounds.max.x-c.bounds.min.x:0;if(!(u>d)){u=d-u;var p=u,v=n-1-u;if(!(a<p||a>v)){1===h&&s.translate(c,{x:(a+(n%2===1?1:-1))*f,y:0});var m=c?a*f:0;return l(e+m+a*o,r,a,u,c,h)}}}))},r.newtonsCradle=function(e,t,n,r,a){for(var s=i.create({label:"Newtons Cradle"}),u=0;u<n;u++){var c=1.9,h=l.circle(e+u*(r*c),t+a,r,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),d=o.create({pointA:{x:e+u*(r*c),y:t},bodyB:h});i.addBody(s,h),i.addConstraint(s,d)}return s},u(r,"newtonsCradle","Composites.newtonsCradle ➤ moved to newtonsCradle example"),r.car=function(e,t,n,r,a){var u=s.nextGroup(!0),c=20,h=.5*-n+c,d=.5*n-c,f=0,p=i.create({label:"Car"}),v=l.rectangle(e,t,n,r,{collisionFilter:{group:u},chamfer:{radius:.5*r},density:2e-4}),m=l.circle(e+h,t+f,a,{collisionFilter:{group:u},friction:.8}),y=l.circle(e+d,t+f,a,{collisionFilter:{group:u},friction:.8}),g=o.create({bodyB:v,pointB:{x:h,y:f},bodyA:m,stiffness:1,length:0}),x=o.create({bodyB:v,pointB:{x:d,y:f},bodyA:y,stiffness:1,length:0});return i.addBody(p,v),i.addBody(p,m),i.addBody(p,y),i.addConstraint(p,g),i.addConstraint(p,x),p},u(r,"car","Composites.car ➤ moved to car example"),r.softBody=function(e,t,n,i,o,s,u,c,h,d){h=a.extend({inertia:1/0},h),d=a.extend({stiffness:.2,render:{type:"line",anchors:!1}},d);var f=r.stack(e,t,n,i,o,s,(function(e,t){return l.circle(e,t,c,h)}));return r.mesh(f,n,i,u,d),f.label="Soft Body",f},u(r,"softBody","Composites.softBody ➤ moved to softBody and cloth examples")})()},function(e,t,n){var r={};e.exports=r;var i=n(3),o=n(7),a=n(12),s=n(4),l=n(13),u=n(8),c=n(5),h=n(0),d=n(1);(function(){r.create=function(e,t){var n=(e?e.mouse:null)||(t?t.mouse:null);n||(e&&e.render&&e.render.canvas?n=a.create(e.render.canvas):t&&t.element?n=a.create(t.element):(n=a.create(),h.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var i=u.create({label:"Mouse Constraint",pointA:n.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),o={type:"mouseConstraint",mouse:n,element:null,body:null,constraint:i,collisionFilter:{category:1,mask:4294967295,group:0}},l=h.extend(o,t);return s.on(e,"beforeUpdate",(function(){var t=c.allBodies(e.world);r.update(l,t),r._triggerEvents(l)})),l},r.update=function(e,t){var n=e.mouse,r=e.constraint,a=e.body;if(0===n.button){if(r.bodyB)o.set(r.bodyB,!1),r.pointA=n.position;else for(var u=0;u<t.length;u++)if(a=t[u],d.contains(a.bounds,n.position)&&l.canCollide(a.collisionFilter,e.collisionFilter))for(var c=a.parts.length>1?1:0;c<a.parts.length;c++){var h=a.parts[c];if(i.contains(h.vertices,n.position)){r.pointA=n.position,r.bodyB=e.body=a,r.pointB={x:n.position.x-a.position.x,y:n.position.y-a.position.y},r.angleB=a.angle,o.set(a,!1),s.trigger(e,"startdrag",{mouse:n,body:a});break}}}else r.bodyB=e.body=null,r.pointB=null,a&&s.trigger(e,"enddrag",{mouse:n,body:a})},r._triggerEvents=function(e){var t=e.mouse,n=t.sourceEvents;n.mousemove&&s.trigger(e,"mousemove",{mouse:t}),n.mousedown&&s.trigger(e,"mousedown",{mouse:t}),n.mouseup&&s.trigger(e,"mouseup",{mouse:t}),a.clearSourceEvents(t)}})()},function(e,t,n){var r={};e.exports=r;var i=n(2),o=n(14),a=n(1),s=n(11),l=n(3);(function(){r.collides=function(e,t){for(var n=[],r=0;r<t.length;r++){var i=t[r];if(a.overlaps(i.bounds,e.bounds))for(var s=1===i.parts.length?0:1;s<i.parts.length;s++){var l=i.parts[s];if(a.overlaps(l.bounds,e.bounds)){var u=o.collides(l,e);if(u.collided){n.push(u);break}}}}return n},r.ray=function(e,t,n,o){o=o||1e-100;for(var a=i.angle(t,n),l=i.magnitude(i.sub(t,n)),u=.5*(n.x+t.x),c=.5*(n.y+t.y),h=s.rectangle(u,c,l,o,{angle:a}),d=r.collides(h,e),f=0;f<d.length;f+=1){var p=d[f];p.body=p.bodyB=p.bodyA}return d},r.region=function(e,t,n){for(var r=[],i=0;i<e.length;i++){var o=e[i],s=a.overlaps(o.bounds,t);(s&&!n||!s&&n)&&r.push(o)}return r},r.point=function(e,t){for(var n=[],r=0;r<e.length;r++){var i=e[r];if(a.contains(i.bounds,t))for(var o=1===i.parts.length?0:1;o<i.parts.length;o++){var s=i.parts[o];if(a.contains(s.bounds,t)&&l.contains(s.vertices,t)){n.push(i);break}}}return n}})()},function(e,t,n){var r={};e.exports=r;var i=n(4),o=n(18),a=n(0);(function(){var e,t,n;("undefined"!==typeof window&&(e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),e)||(e=function(e){n=setTimeout((function(){e(a.now())}),1e3/60)},t=function(){clearTimeout(n)});r.create=function(e){var t={fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0},n=a.extend(t,e);return n.delta=n.delta||1e3/n.fps,n.deltaMin=n.deltaMin||1e3/n.fps,n.deltaMax=n.deltaMax||1e3/(.5*n.fps),n.fps=1e3/n.delta,n},r.run=function(t,n){return"undefined"!==typeof t.positionIterations&&(n=t,t=r.create()),function i(o){t.frameRequestId=e(i),o&&t.enabled&&r.tick(t,n,o)}(),t},r.tick=function(e,t,n){var r,a=t.timing,s=1,l={timestamp:a.timestamp};i.trigger(e,"beforeTick",l),e.isFixed?r=e.delta:(r=n-e.timePrev||e.delta,e.timePrev=n,e.deltaHistory.push(r),e.deltaHistory=e.deltaHistory.slice(-e.deltaSampleSize),r=Math.min.apply(null,e.deltaHistory),r=r<e.deltaMin?e.deltaMin:r,r=r>e.deltaMax?e.deltaMax:r,s=r/e.delta,e.delta=r),0!==e.timeScalePrev&&(s*=a.timeScale/e.timeScalePrev),0===a.timeScale&&(s=0),e.timeScalePrev=a.timeScale,e.correction=s,e.frameCounter+=1,n-e.counterTimestamp>=1e3&&(e.fps=e.frameCounter*((n-e.counterTimestamp)/1e3),e.counterTimestamp=n,e.frameCounter=0),i.trigger(e,"tick",l),i.trigger(e,"beforeUpdate",l),o.update(t,r,s),i.trigger(e,"afterUpdate",l),i.trigger(e,"afterTick",l)},r.stop=function(e){t(e.frameRequestId)},r.start=function(e,t){r.run(e,t)}})()},function(e,t,n){var r={};e.exports=r;n(1);var i=n(0);(function(){r.pathToVertices=function(e,t){"undefined"===typeof window||"SVGPathSeg"in window||i.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var n,o,a,s,l,u,c,h,d,f,p,v,m=[],y=0,g=0,x=0;t=t||15;var b=function(e,t,n){var r=n%2===1&&n>1;if(!d||e!=d.x||t!=d.y){d&&r?(p=d.x,v=d.y):(p=0,v=0);var i={x:p+e,y:v+t};!r&&d||(d=i),m.push(i),g=p+e,x=v+t}},w=function(e){var t=e.pathSegTypeAsLetter.toUpperCase();if("Z"!==t){switch(t){case"M":case"L":case"T":case"C":case"S":case"Q":g=e.x,x=e.y;break;case"H":g=e.x;break;case"V":x=e.y;break}b(g,x,e.pathSegType)}};for(r._svgPathToAbsolute(e),a=e.getTotalLength(),u=[],n=0;n<e.pathSegList.numberOfItems;n+=1)u.push(e.pathSegList.getItem(n));c=u.concat();while(y<a){if(f=e.getPathSegAtLength(y),l=u[f],l!=h){while(c.length&&c[0]!=l)w(c.shift());h=l}switch(l.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":s=e.getPointAtLength(y),b(s.x,s.y,0);break}y+=t}for(n=0,o=c.length;n<o;++n)w(c[n]);return m},r._svgPathToAbsolute=function(e){for(var t,n,r,i,o,a,s=e.pathSegList,l=0,u=0,c=s.numberOfItems,h=0;h<c;++h){var d=s.getItem(h),f=d.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(f))"x"in d&&(l=d.x),"y"in d&&(u=d.y);else switch("x1"in d&&(r=l+d.x1),"x2"in d&&(o=l+d.x2),"y1"in d&&(i=u+d.y1),"y2"in d&&(a=u+d.y2),"x"in d&&(l+=d.x),"y"in d&&(u+=d.y),f){case"m":s.replaceItem(e.createSVGPathSegMovetoAbs(l,u),h);break;case"l":s.replaceItem(e.createSVGPathSegLinetoAbs(l,u),h);break;case"h":s.replaceItem(e.createSVGPathSegLinetoHorizontalAbs(l),h);break;case"v":s.replaceItem(e.createSVGPathSegLinetoVerticalAbs(u),h);break;case"c":s.replaceItem(e.createSVGPathSegCurvetoCubicAbs(l,u,r,i,o,a),h);break;case"s":s.replaceItem(e.createSVGPathSegCurvetoCubicSmoothAbs(l,u,o,a),h);break;case"q":s.replaceItem(e.createSVGPathSegCurvetoQuadraticAbs(l,u,r,i),h);break;case"t":s.replaceItem(e.createSVGPathSegCurvetoQuadraticSmoothAbs(l,u),h);break;case"a":s.replaceItem(e.createSVGPathSegArcAbs(l,u,d.r1,d.r2,d.angle,d.largeArcFlag,d.sweepFlag),h);break;case"z":case"Z":l=t,u=n;break}"M"!=f&&"m"!=f||(t=l,n=u)}}})()},function(e,t,n){var r={};e.exports=r;var i=n(5);n(0);(function(){r.create=i.create,r.add=i.add,r.remove=i.remove,r.clear=i.clear,r.addComposite=i.addComposite,r.addBody=i.addBody,r.addConstraint=i.addConstraint})()}])}))},4893:function(e,t,n){"use strict";
/**
 * @package      npmjs.com/package/@yandeu/events (events.min.js)
 *
 * @author       Arnout Kazemier (https://github.com/3rd-Eden)
 * @copyright    Copyright (c) 2014 Arnout Kazemier
 * @license      {@link https://github.com/primus/eventemitter3/blob/master/LICENSE|MIT}
 *
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/yandeu/events
 * @license      {@link https://github.com/yandeu/events/blob/master/LICENSE|MIT}
 */n(1703),n(1532),n(1539),n(8783),n(3948),n(1038);var r=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.Events=void 0;var i=n(1730),o=function(){function e(e,t,n){void 0===n&&(n=!1),this.fn=e,this.context=t,this.once=n}return e}(),a=function(e,t,n,r,i){if("function"!==typeof n)throw new TypeError("The listener must be a function");var a=new o(n,r||e,i);return e._events.has(t)?e._events.get(t).fn?e._events.set(t,[e._events.get(t),a]):e._events.get(t).push(a):(e._events.set(t,a),e._eventsCount++),e},s=function(e,t){0===--e._eventsCount?e._events=new Map:e._events.delete(t)},l=function(){function e(){this._events=new Map,this._eventsCount=0}return Object.defineProperty(e,"VERSION",{get:function(){return i.VERSION},enumerable:!1,configurable:!0}),e.prototype.eventNames=function(){return Array.from(this._events.keys())},e.prototype.listeners=function(e){var t=this._events.get(e);if(!t)return[];if(t.fn)return[t.fn];for(var n=0,r=t.length,i=new Array(r);n<r;n++)i[n]=t[n].fn;return i},e.prototype.listenerCount=function(e){var t=this._events.get(e);return t?t.fn?1:t.length:0},e.prototype.emit=function(e){for(var t,n,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];if(!this._events.has(e))return!1;var a,s=this._events.get(e);if(s.fn)return s.once&&this.removeListener(e,s.fn,void 0,!0),(t=s.fn).call.apply(t,r([s.context],i)),!0;var l=s.length;for(a=0;a<l;a++)s[a].once&&this.removeListener(e,s[a].fn,void 0,!0),(n=s[a].fn).call.apply(n,r([s[a].context],i));return!0},e.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},e.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},e.prototype.removeListener=function(e,t,n,r){if(!this._events.has(e))return this;if(!t)return s(this,e),this;var i=this._events.get(e);if(i.fn)i.fn!==t||r&&!i.once||n&&i.context!==n||s(this,e);else{for(var o=0,a=[],l=i.length;o<l;o++)(i[o].fn!==t||r&&!i[o].once||n&&i[o].context!==n)&&a.push(i[o]);a.length?this._events.set(e,1===a.length?a[0]:a):s(this,e)}return this},e.prototype.removeAllListeners=function(e){return e?this._events.delete(e)&&s(this,e):(this._events=new Map,this._eventsCount=0),this},Object.defineProperty(e.prototype,"off",{get:function(){return this.removeListener},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"addListener",{get:function(){return this.on},enumerable:!1,configurable:!0}),e}();t.Events=l},1730:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION=void 0,t.VERSION="0.0.5"}}]);
//# sourceMappingURL=370-legacy.6974d9d6.js.map