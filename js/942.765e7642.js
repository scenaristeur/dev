(self["webpackChunkdev"]=self["webpackChunkdev"]||[]).push([[942],{3942:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Ps}});var o={};n.r(o),n.d(o,{AsyncCompress:function(){return nt},AsyncDecompress:function(){return vt},AsyncDeflate:function(){return Ke},AsyncGunzip:function(){return it},AsyncGzip:function(){return nt},AsyncInflate:function(){return Qe},AsyncUnzipInflate:function(){return Wt},AsyncUnzlib:function(){return mt},AsyncZipDeflate:function(){return Ft},AsyncZlib:function(){return ut},Compress:function(){return tt},DecodeUTF8:function(){return Pt},Decompress:function(){return yt},Deflate:function(){return qe},EncodeUTF8:function(){return Ct},Gunzip:function(){return st},Gzip:function(){return tt},Inflate:function(){return Ye},Unzip:function(){return Xt},UnzipInflate:function(){return Gt},UnzipPassThrough:function(){return jt},Unzlib:function(){return pt},Zip:function(){return Ut},ZipDeflate:function(){return Dt},ZipPassThrough:function(){return Vt},Zlib:function(){return ct},compress:function(){return ot},compressSync:function(){return rt},decompress:function(){return xt},decompressSync:function(){return bt},deflate:function(){return $e},deflateSync:function(){return Ze},gunzip:function(){return at},gunzipSync:function(){return lt},gzip:function(){return ot},gzipSync:function(){return rt},inflate:function(){return Je},inflateSync:function(){return et},strFromU8:function(){return kt},strToU8:function(){return Et},unzip:function(){return qt},unzipSync:function(){return Kt},unzlib:function(){return ft},unzlibSync:function(){return gt},zip:function(){return zt},zipSync:function(){return Ht},zlib:function(){return ht},zlibSync:function(){return dt}});var r=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},s=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e._v(" Physic World "),n("div",{staticClass:"home",attrs:{id:"myCanvas"}})])}],i=n(3226);n(1703),n(8675),n(3462);const a=new i.yGw,l=new i.Tme,c=new i.Pa4;class u extends i.pBf{constructor(){super(),this.uuid=i.M8C.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){const t=(new i.Vkp).getNormalMatrix(e);for(let n=0,o=this.vertices.length;n<o;n++){const t=this.vertices[n];t.applyMatrix4(e)}for(let n=0,o=this.faces.length;n<o;n++){const e=this.faces[n];e.normal.applyMatrix3(t).normalize();for(let n=0,o=e.vertexNormals.length;n<o;n++)e.vertexNormals[n].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return a.makeRotationX(e),this.applyMatrix4(a),this}rotateY(e){return a.makeRotationY(e),this.applyMatrix4(a),this}rotateZ(e){return a.makeRotationZ(e),this.applyMatrix4(a),this}translate(e,t,n){return a.makeTranslation(e,t,n),this.applyMatrix4(a),this}scale(e,t,n){return a.makeScale(e,t,n),this.applyMatrix4(a),this}lookAt(e){return l.lookAt(e),l.updateMatrix(),this.applyMatrix4(l.matrix),this}fromBufferGeometry(e){const t=this,n=null!==e.index?e.index:void 0,o=e.attributes;if(void 0===o.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;const r=o.position,s=o.normal,a=o.color,l=o.uv,c=o.uv2;void 0!==c&&(this.faceVertexUvs[1]=[]);for(let d=0;d<r.count;d++)t.vertices.push((new i.Pa4).fromBufferAttribute(r,d)),void 0!==a&&t.colors.push((new i.Ilk).fromBufferAttribute(a,d));function u(e,n,o,r){const u=void 0===a?[]:[t.colors[e].clone(),t.colors[n].clone(),t.colors[o].clone()],h=void 0===s?[]:[(new i.Pa4).fromBufferAttribute(s,e),(new i.Pa4).fromBufferAttribute(s,n),(new i.Pa4).fromBufferAttribute(s,o)],p=new d(e,n,o,h,u,r);t.faces.push(p),void 0!==l&&t.faceVertexUvs[0].push([(new i.FM8).fromBufferAttribute(l,e),(new i.FM8).fromBufferAttribute(l,n),(new i.FM8).fromBufferAttribute(l,o)]),void 0!==c&&t.faceVertexUvs[1].push([(new i.FM8).fromBufferAttribute(c,e),(new i.FM8).fromBufferAttribute(c,n),(new i.FM8).fromBufferAttribute(c,o)])}const h=e.groups;if(h.length>0)for(let i=0;i<h.length;i++){const e=h[i],t=e.start,o=e.count;for(let r=t,s=t+o;r<s;r+=3)void 0!==n?u(n.getX(r),n.getX(r+1),n.getX(r+2),e.materialIndex):u(r,r+1,r+2,e.materialIndex)}else if(void 0!==n)for(let i=0;i<n.count;i+=3)u(n.getX(i),n.getX(i+1),n.getX(i+2));else for(let i=0;i<r.count;i+=3)u(i,i+1,i+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(c).negate(),this.translate(c.x,c.y,c.z),this}normalize(){this.computeBoundingSphere();const e=this.boundingSphere.center,t=this.boundingSphere.radius,n=0===t?1:1/t,o=new i.yGw;return o.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix4(o),this}computeFaceNormals(){const e=new i.Pa4,t=new i.Pa4;for(let n=0,o=this.faces.length;n<o;n++){const o=this.faces[n],r=this.vertices[o.a],s=this.vertices[o.b],i=this.vertices[o.c];e.subVectors(i,s),t.subVectors(r,s),e.cross(t),e.normalize(),o.normal.copy(e)}}computeVertexNormals(e=!0){const t=new Array(this.vertices.length);for(let n=0,o=this.vertices.length;n<o;n++)t[n]=new i.Pa4;if(e){const e=new i.Pa4,n=new i.Pa4;for(let o=0,r=this.faces.length;o<r;o++){const r=this.faces[o],s=this.vertices[r.a],i=this.vertices[r.b],a=this.vertices[r.c];e.subVectors(a,i),n.subVectors(s,i),e.cross(n),t[r.a].add(e),t[r.b].add(e),t[r.c].add(e)}}else{this.computeFaceNormals();for(let e=0,n=this.faces.length;e<n;e++){const n=this.faces[e];t[n.a].add(n.normal),t[n.b].add(n.normal),t[n.c].add(n.normal)}}for(let n=0,o=this.vertices.length;n<o;n++)t[n].normalize();for(let n=0,o=this.faces.length;n<o;n++){const e=this.faces[n],o=e.vertexNormals;3===o.length?(o[0].copy(t[e.a]),o[1].copy(t[e.b]),o[2].copy(t[e.c])):(o[0]=t[e.a].clone(),o[1]=t[e.b].clone(),o[2]=t[e.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e],n=t.vertexNormals;3===n.length?(n[0].copy(t.normal),n[1].copy(t.normal),n[2].copy(t.normal)):(n[0]=t.normal.clone(),n[1]=t.normal.clone(),n[2]=t.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let t=0,n=this.faces.length;t<n;t++){const e=this.faces[t];e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]);for(let t=0,n=e.vertexNormals.length;t<n;t++)e.__originalVertexNormals[t]?e.__originalVertexNormals[t].copy(e.vertexNormals[t]):e.__originalVertexNormals[t]=e.vertexNormals[t].clone()}const e=new u;e.faces=this.faces;for(let t=0,n=this.morphTargets.length;t<n;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];const e=this.morphNormals[t].faceNormals,n=this.morphNormals[t].vertexNormals;for(let t=0,o=this.faces.length;t<o;t++){const t=new i.Pa4,o={a:new i.Pa4,b:new i.Pa4,c:new i.Pa4};e.push(t),n.push(o)}}const n=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e],o=n.faceNormals[e],r=n.vertexNormals[e];o.copy(t.normal),r.a.copy(t.vertexNormals[0]),r.b.copy(t.vertexNormals[1]),r.c.copy(t.vertexNormals[2])}}for(let t=0,n=this.faces.length;t<n;t++){const e=this.faces[t];e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals}}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new i.ZzF),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new i.aLr),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t,n=0){if(!e||!e.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);let o;const r=this.vertices.length,s=this.vertices,a=e.vertices,l=this.faces,c=e.faces,u=this.colors,h=e.colors;void 0!==t&&(o=(new i.Vkp).getNormalMatrix(t));for(let i=0,d=a.length;i<d;i++){const e=a[i],n=e.clone();void 0!==t&&n.applyMatrix4(t),s.push(n)}for(let i=0,d=h.length;i<d;i++)u.push(h[i].clone());for(let i=0,p=c.length;i<p;i++){const e=c[i];let t,s;const a=e.vertexNormals,u=e.vertexColors,h=new d(e.a+r,e.b+r,e.c+r);h.normal.copy(e.normal),void 0!==o&&h.normal.applyMatrix3(o).normalize();for(let n=0,r=a.length;n<r;n++)t=a[n].clone(),void 0!==o&&t.applyMatrix3(o).normalize(),h.vertexNormals.push(t);h.color.copy(e.color);for(let n=0,o=u.length;n<o;n++)s=u[n],h.vertexColors.push(s.clone());h.materialIndex=e.materialIndex+n,l.push(h)}for(let i=0,d=e.faceVertexUvs.length;i<d;i++){const t=e.faceVertexUvs[i];void 0===this.faceVertexUvs[i]&&(this.faceVertexUvs[i]=[]);for(let e=0,n=t.length;e<n;e++){const n=t[e],o=[];for(let e=0,t=n.length;e<t;e++)o.push(n[e].clone());this.faceVertexUvs[i].push(o)}}}mergeMesh(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)}mergeVertices(e=4){const t={},n=[],o=[],r=Math.pow(10,e);for(let a=0,l=this.vertices.length;a<l;a++){const e=this.vertices[a],s=Math.round(e.x*r)+"_"+Math.round(e.y*r)+"_"+Math.round(e.z*r);void 0===t[s]?(t[s]=a,n.push(this.vertices[a]),o[a]=n.length-1):o[a]=o[t[s]]}const s=[];for(let a=0,l=this.faces.length;a<l;a++){const e=this.faces[a];e.a=o[e.a],e.b=o[e.b],e.c=o[e.c];const t=[e.a,e.b,e.c];for(let n=0;n<3;n++)if(t[n]===t[(n+1)%3]){s.push(a);break}}for(let a=s.length-1;a>=0;a--){const e=s[a];this.faces.splice(e,1);for(let t=0,n=this.faceVertexUvs.length;t<n;t++)this.faceVertexUvs[t].splice(e,1)}const i=this.vertices.length-n.length;return this.vertices=n,i}setFromPoints(e){this.vertices=[];for(let t=0,n=e.length;t<n;t++){const n=e[t];this.vertices.push(new i.Pa4(n.x,n.y,n.z||0))}return this}sortFacesByMaterialIndex(){const e=this.faces,t=e.length;for(let a=0;a<t;a++)e[a]._id=a;function n(e,t){return e.materialIndex-t.materialIndex}e.sort(n);const o=this.faceVertexUvs[0],r=this.faceVertexUvs[1];let s,i;o&&o.length===t&&(s=[]),r&&r.length===t&&(i=[]);for(let a=0;a<t;a++){const t=e[a]._id;s&&s.push(o[t]),i&&i.push(r[t])}s&&(this.faceVertexUvs[0]=s),i&&(this.faceVertexUvs[1]=i)}toJSON(){const e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}const t=[];for(let p=0;p<this.vertices.length;p++){const e=this.vertices[p];t.push(e.x,e.y,e.z)}const n=[],o=[],r={},s=[],i={},a=[],l={};for(let p=0;p<this.faces.length;p++){const e=this.faces[p],t=!0,o=!1,r=void 0!==this.faceVertexUvs[0][p],s=e.normal.length()>0,i=e.vertexNormals.length>0,a=1!==e.color.r||1!==e.color.g||1!==e.color.b,l=e.vertexColors.length>0;let m=0;if(m=c(m,0,0),m=c(m,1,t),m=c(m,2,o),m=c(m,3,r),m=c(m,4,s),m=c(m,5,i),m=c(m,6,a),m=c(m,7,l),n.push(m),n.push(e.a,e.b,e.c),n.push(e.materialIndex),r){const e=this.faceVertexUvs[0][p];n.push(d(e[0]),d(e[1]),d(e[2]))}if(s&&n.push(u(e.normal)),i){const t=e.vertexNormals;n.push(u(t[0]),u(t[1]),u(t[2]))}if(a&&n.push(h(e.color)),l){const t=e.vertexColors;n.push(h(t[0]),h(t[1]),h(t[2]))}}function c(e,t,n){return n?e|1<<t:e&~(1<<t)}function u(e){const t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==r[t]||(r[t]=o.length/3,o.push(e.x,e.y,e.z)),r[t]}function h(e){const t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==i[t]||(i[t]=s.length,s.push(e.getHex())),i[t]}function d(e){const t=e.x.toString()+e.y.toString();return void 0!==l[t]||(l[t]=a.length/2,a.push(e.x,e.y)),l[t]}return e.data={},e.data.vertices=t,e.data.normals=o,s.length>0&&(e.data.colors=s),a.length>0&&(e.data.uvs=[a]),e.data.faces=n,e}clone(){return(new u).copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;const t=e.vertices;for(let h=0,d=t.length;h<d;h++)this.vertices.push(t[h].clone());const n=e.colors;for(let h=0,d=n.length;h<d;h++)this.colors.push(n[h].clone());const o=e.faces;for(let h=0,d=o.length;h<d;h++)this.faces.push(o[h].clone());for(let h=0,d=e.faceVertexUvs.length;h<d;h++){const t=e.faceVertexUvs[h];void 0===this.faceVertexUvs[h]&&(this.faceVertexUvs[h]=[]);for(let e=0,n=t.length;e<n;e++){const n=t[e],o=[];for(let e=0,t=n.length;e<t;e++){const t=n[e];o.push(t.clone())}this.faceVertexUvs[h].push(o)}}const r=e.morphTargets;for(let h=0,d=r.length;h<d;h++){const e={};if(e.name=r[h].name,void 0!==r[h].vertices){e.vertices=[];for(let t=0,n=r[h].vertices.length;t<n;t++)e.vertices.push(r[h].vertices[t].clone())}if(void 0!==r[h].normals){e.normals=[];for(let t=0,n=r[h].normals.length;t<n;t++)e.normals.push(r[h].normals[t].clone())}this.morphTargets.push(e)}const s=e.morphNormals;for(let h=0,d=s.length;h<d;h++){const e={};if(void 0!==s[h].vertexNormals){e.vertexNormals=[];for(let t=0,n=s[h].vertexNormals.length;t<n;t++){const n=s[h].vertexNormals[t],o={};o.a=n.a.clone(),o.b=n.b.clone(),o.c=n.c.clone(),e.vertexNormals.push(o)}}if(void 0!==s[h].faceNormals){e.faceNormals=[];for(let t=0,n=s[h].faceNormals.length;t<n;t++)e.faceNormals.push(s[h].faceNormals[t].clone())}this.morphNormals.push(e)}const i=e.skinWeights;for(let h=0,d=i.length;h<d;h++)this.skinWeights.push(i[h].clone());const a=e.skinIndices;for(let h=0,d=a.length;h<d;h++)this.skinIndices.push(a[h].clone());const l=e.lineDistances;for(let h=0,d=l.length;h<d;h++)this.lineDistances.push(l[h]);const c=e.boundingBox;null!==c&&(this.boundingBox=c.clone());const u=e.boundingSphere;return null!==u&&(this.boundingSphere=u.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){const e=(new h).fromGeometry(this),t=new i.u9r,n=new Float32Array(3*e.vertices.length);if(t.setAttribute("position",new i.TlE(n,3).copyVector3sArray(e.vertices)),e.normals.length>0){const n=new Float32Array(3*e.normals.length);t.setAttribute("normal",new i.TlE(n,3).copyVector3sArray(e.normals))}if(e.colors.length>0){const n=new Float32Array(3*e.colors.length);t.setAttribute("color",new i.TlE(n,3).copyColorsArray(e.colors))}if(e.uvs.length>0){const n=new Float32Array(2*e.uvs.length);t.setAttribute("uv",new i.TlE(n,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){const n=new Float32Array(2*e.uvs2.length);t.setAttribute("uv2",new i.TlE(n,2).copyVector2sArray(e.uvs2))}t.groups=e.groups;for(const o in e.morphTargets){const n=[],r=e.morphTargets[o];for(let e=0,t=r.length;e<t;e++){const t=r[e],o=new i.a$l(3*t.data.length,3);o.name=t.name,n.push(o.copyVector3sArray(t.data))}t.morphAttributes[o]=n}if(e.skinIndices.length>0){const n=new i.a$l(4*e.skinIndices.length,4);t.setAttribute("skinIndex",n.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){const n=new i.a$l(4*e.skinWeights.length,4);t.setAttribute("skinWeight",n.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(t.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(e){let t=new i.u9r;const n=e.geometry;if(e.isPoints||e.isLine){const e=new i.a$l(3*n.vertices.length,3),o=new i.a$l(3*n.colors.length,3);if(t.setAttribute("position",e.copyVector3sArray(n.vertices)),t.setAttribute("color",o.copyColorsArray(n.colors)),n.lineDistances&&n.lineDistances.length===n.vertices.length){const e=new i.a$l(n.lineDistances.length,1);t.setAttribute("lineDistance",e.copyArray(n.lineDistances))}null!==n.boundingSphere&&(t.boundingSphere=n.boundingSphere.clone()),null!==n.boundingBox&&(t.boundingBox=n.boundingBox.clone())}else e.isMesh&&(t=n.toBufferGeometry());return t}}u.prototype.isGeometry=!0;class h{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){const t=[];let n,o,r;const s=e.faces;for(o=0;o<s.length;o++){const e=s[o];e.materialIndex!==r&&(r=e.materialIndex,void 0!==n&&(n.count=3*o-n.start,t.push(n)),n={start:3*o,materialIndex:r})}void 0!==n&&(n.count=3*o-n.start,t.push(n)),this.groups=t}fromGeometry(e){const t=e.faces,n=e.vertices,o=e.faceVertexUvs,r=o[0]&&o[0].length>0,s=o[1]&&o[1].length>0,a=e.morphTargets,l=a.length;let c;if(l>0){c=[];for(let e=0;e<l;e++)c[e]={name:a[e].name,data:[]};this.morphTargets.position=c}const u=e.morphNormals,h=u.length;let d;if(h>0){d=[];for(let e=0;e<h;e++)d[e]={name:u[e].name,data:[]};this.morphTargets.normal=d}const p=e.skinIndices,m=e.skinWeights,f=p.length===n.length,g=m.length===n.length;n.length>0&&0===t.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let y=0;y<t.length;y++){const e=t[y];this.vertices.push(n[e.a],n[e.b],n[e.c]);const v=e.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{const t=e.normal;this.normals.push(t,t,t)}const x=e.vertexColors;if(3===x.length)this.colors.push(x[0],x[1],x[2]);else{const t=e.color;this.colors.push(t,t,t)}if(!0===r){const e=o[0][y];void 0!==e?this.uvs.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",y),this.uvs.push(new i.FM8,new i.FM8,new i.FM8))}if(!0===s){const e=o[1][y];void 0!==e?this.uvs2.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",y),this.uvs2.push(new i.FM8,new i.FM8,new i.FM8))}for(let t=0;t<l;t++){const n=a[t].vertices;c[t].data.push(n[e.a],n[e.b],n[e.c])}for(let t=0;t<h;t++){const e=u[t].vertexNormals[y];d[t].data.push(e.a,e.b,e.c)}f&&this.skinIndices.push(p[e.a],p[e.b],p[e.c]),g&&this.skinWeights.push(m[e.a],m[e.b],m[e.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}}class d{constructor(e,t,n,o,r,s=0){this.a=e,this.b=t,this.c=n,this.normal=o&&o.isVector3?o:new i.Pa4,this.vertexNormals=Array.isArray(o)?o:[],this.color=r&&r.isColor?r:new i.Ilk,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=s}clone(){return(new this.constructor).copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}class p{constructor(e,t,n,o,r,s=0){this.a=e,this.b=t,this.c=n,this.normal=o&&o.isVector3?o:new i.Pa4,this.vertexNormals=Array.isArray(o)?o:[],this.color=r&&r.isColor?r:new i.Ilk,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=s}clone(){return(new this.constructor).copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}class m extends i.aNw{constructor(e){super(e),this.defaultDPI=90,this.defaultUnit="px"}load(e,t,n,o){const r=this,s=new i.hH6(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,(function(n){try{t(r.parse(n))}catch(s){o?o(s):console.error(s),r.manager.itemError(e)}}),n,o)}parse(e){const t=this;function n(e,t){if(1!==e.nodeType)return;const s=b(e);let i=!0,a=null;switch(e.nodeName){case"svg":break;case"style":r(e);break;case"g":t=m(e,t);break;case"path":t=m(e,t),e.hasAttribute("d")&&(a=o(e));break;case"rect":t=m(e,t),a=l(e);break;case"polygon":t=m(e,t),a=c(e);break;case"polyline":t=m(e,t),a=u(e);break;case"circle":t=m(e,t),a=h(e);break;case"ellipse":t=m(e,t),a=d(e);break;case"line":t=m(e,t),a=p(e);break;case"defs":i=!1;break;case"use":t=m(e,t);const s=e.getAttributeNS("http://www.w3.org/1999/xlink","href")||"",f=s.substring(1),g=e.viewportElement.getElementById(f);g?n(g,t):console.warn("SVGLoader: 'use node' references non-existent node id: "+f);break;default:}if(a&&(void 0!==t.fill&&"none"!==t.fill&&a.color.setStyle(t.fill),A(a,B),P.push(a),a.userData={node:e,style:t}),i){const o=e.childNodes;for(let e=0;e<o.length;e++)n(o[e],t)}s&&(E.pop(),E.length>0?B.copy(E[E.length-1]):B.identity())}function o(e){const t=new i.T_1,n=new i.FM8,o=new i.FM8,r=new i.FM8;let a=!0,l=!1;const c=e.getAttribute("d"),u=c.match(/[a-df-z][^a-df-z]*/gi);for(let i=0,h=u.length;i<h;i++){const e=u[i],c=e.charAt(0),h=e.substr(1).trim();let d;switch(!0===a&&(l=!0,a=!1),c){case"M":d=g(h);for(let e=0,s=d.length;e<s;e+=2)n.x=d[e+0],n.y=d[e+1],o.x=n.x,o.y=n.y,0===e?t.moveTo(n.x,n.y):t.lineTo(n.x,n.y),0===e&&r.copy(n);break;case"H":d=g(h);for(let e=0,s=d.length;e<s;e++)n.x=d[e],o.x=n.x,o.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===l&&r.copy(n);break;case"V":d=g(h);for(let e=0,s=d.length;e<s;e++)n.y=d[e],o.x=n.x,o.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===l&&r.copy(n);break;case"L":d=g(h);for(let e=0,s=d.length;e<s;e+=2)n.x=d[e+0],n.y=d[e+1],o.x=n.x,o.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===l&&r.copy(n);break;case"C":d=g(h);for(let e=0,s=d.length;e<s;e+=6)t.bezierCurveTo(d[e+0],d[e+1],d[e+2],d[e+3],d[e+4],d[e+5]),o.x=d[e+2],o.y=d[e+3],n.x=d[e+4],n.y=d[e+5],0===e&&!0===l&&r.copy(n);break;case"S":d=g(h);for(let e=0,s=d.length;e<s;e+=4)t.bezierCurveTo(f(n.x,o.x),f(n.y,o.y),d[e+0],d[e+1],d[e+2],d[e+3]),o.x=d[e+0],o.y=d[e+1],n.x=d[e+2],n.y=d[e+3],0===e&&!0===l&&r.copy(n);break;case"Q":d=g(h);for(let e=0,s=d.length;e<s;e+=4)t.quadraticCurveTo(d[e+0],d[e+1],d[e+2],d[e+3]),o.x=d[e+0],o.y=d[e+1],n.x=d[e+2],n.y=d[e+3],0===e&&!0===l&&r.copy(n);break;case"T":d=g(h);for(let e=0,s=d.length;e<s;e+=2){const s=f(n.x,o.x),i=f(n.y,o.y);t.quadraticCurveTo(s,i,d[e+0],d[e+1]),o.x=s,o.y=i,n.x=d[e+0],n.y=d[e+1],0===e&&!0===l&&r.copy(n)}break;case"A":d=g(h,[3,4],7);for(let e=0,i=d.length;e<i;e+=7){if(d[e+5]==n.x&&d[e+6]==n.y)continue;const i=n.clone();n.x=d[e+5],n.y=d[e+6],o.x=n.x,o.y=n.y,s(t,d[e],d[e+1],d[e+2],d[e+3],d[e+4],i,n),0===e&&!0===l&&r.copy(n)}break;case"m":d=g(h);for(let e=0,s=d.length;e<s;e+=2)n.x+=d[e+0],n.y+=d[e+1],o.x=n.x,o.y=n.y,0===e?t.moveTo(n.x,n.y):t.lineTo(n.x,n.y),0===e&&r.copy(n);break;case"h":d=g(h);for(let e=0,s=d.length;e<s;e++)n.x+=d[e],o.x=n.x,o.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===l&&r.copy(n);break;case"v":d=g(h);for(let e=0,s=d.length;e<s;e++)n.y+=d[e],o.x=n.x,o.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===l&&r.copy(n);break;case"l":d=g(h);for(let e=0,s=d.length;e<s;e+=2)n.x+=d[e+0],n.y+=d[e+1],o.x=n.x,o.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===l&&r.copy(n);break;case"c":d=g(h);for(let e=0,s=d.length;e<s;e+=6)t.bezierCurveTo(n.x+d[e+0],n.y+d[e+1],n.x+d[e+2],n.y+d[e+3],n.x+d[e+4],n.y+d[e+5]),o.x=n.x+d[e+2],o.y=n.y+d[e+3],n.x+=d[e+4],n.y+=d[e+5],0===e&&!0===l&&r.copy(n);break;case"s":d=g(h);for(let e=0,s=d.length;e<s;e+=4)t.bezierCurveTo(f(n.x,o.x),f(n.y,o.y),n.x+d[e+0],n.y+d[e+1],n.x+d[e+2],n.y+d[e+3]),o.x=n.x+d[e+0],o.y=n.y+d[e+1],n.x+=d[e+2],n.y+=d[e+3],0===e&&!0===l&&r.copy(n);break;case"q":d=g(h);for(let e=0,s=d.length;e<s;e+=4)t.quadraticCurveTo(n.x+d[e+0],n.y+d[e+1],n.x+d[e+2],n.y+d[e+3]),o.x=n.x+d[e+0],o.y=n.y+d[e+1],n.x+=d[e+2],n.y+=d[e+3],0===e&&!0===l&&r.copy(n);break;case"t":d=g(h);for(let e=0,s=d.length;e<s;e+=2){const s=f(n.x,o.x),i=f(n.y,o.y);t.quadraticCurveTo(s,i,n.x+d[e+0],n.y+d[e+1]),o.x=s,o.y=i,n.x=n.x+d[e+0],n.y=n.y+d[e+1],0===e&&!0===l&&r.copy(n)}break;case"a":d=g(h,[3,4],7);for(let e=0,i=d.length;e<i;e+=7){if(0==d[e+5]&&0==d[e+6])continue;const i=n.clone();n.x+=d[e+5],n.y+=d[e+6],o.x=n.x,o.y=n.y,s(t,d[e],d[e+1],d[e+2],d[e+3],d[e+4],i,n),0===e&&!0===l&&r.copy(n)}break;case"Z":case"z":t.currentPath.autoClose=!0,t.currentPath.curves.length>0&&(n.copy(r),t.currentPath.currentPoint.copy(n),a=!0);break;default:console.warn(e)}l=!1}return t}function r(e){if(e.sheet&&e.sheet.cssRules&&e.sheet.cssRules.length)for(let t=0;t<e.sheet.cssRules.length;t++){const n=e.sheet.cssRules[t];if(1!==n.type)continue;const o=n.selectorText.split(/,/gm).filter(Boolean).map((e=>e.trim()));for(let e=0;e<o.length;e++){const t=Object.fromEntries(Object.entries(n.style).filter((([,e])=>""!==e)));C[o[e]]=Object.assign(C[o[e]]||{},t)}}}function s(e,t,n,o,r,s,i,l){if(0==t||0==n)return void e.lineTo(l.x,l.y);o=o*Math.PI/180,t=Math.abs(t),n=Math.abs(n);const c=(i.x-l.x)/2,u=(i.y-l.y)/2,h=Math.cos(o)*c+Math.sin(o)*u,d=-Math.sin(o)*c+Math.cos(o)*u;let p=t*t,m=n*n;const f=h*h,g=d*d,y=f/p+g/m;if(y>1){const e=Math.sqrt(y);t*=e,n*=e,p=t*t,m=n*n}const v=p*g+m*f,x=(p*m-v)/v;let b=Math.sqrt(Math.max(0,x));r===s&&(b=-b);const w=b*t*d/n,A=-b*n*h/t,S=Math.cos(o)*w-Math.sin(o)*A+(i.x+l.x)/2,M=Math.sin(o)*w+Math.cos(o)*A+(i.y+l.y)/2,T=a(1,0,(h-w)/t,(d-A)/n),P=a((h-w)/t,(d-A)/n,(-h-w)/t,(-d-A)/n)%(2*Math.PI);e.currentPath.absellipse(S,M,t,n,T,T+P,0===s,o)}function a(e,t,n,o){const r=e*n+t*o,s=Math.sqrt(e*e+t*t)*Math.sqrt(n*n+o*o);let i=Math.acos(Math.max(-1,Math.min(1,r/s)));return e*o-t*n<0&&(i=-i),i}function l(e){const t=x(e.getAttribute("x")||0),n=x(e.getAttribute("y")||0),o=x(e.getAttribute("rx")||e.getAttribute("ry")||0),r=x(e.getAttribute("ry")||e.getAttribute("rx")||0),s=x(e.getAttribute("width")),a=x(e.getAttribute("height")),l=.448084975506,c=new i.T_1;return c.moveTo(t+o,n),c.lineTo(t+s-o,n),0===o&&0===r||c.bezierCurveTo(t+s-o*l,n,t+s,n+r*l,t+s,n+r),c.lineTo(t+s,n+a-r),0===o&&0===r||c.bezierCurveTo(t+s,n+a-r*l,t+s-o*l,n+a,t+s-o,n+a),c.lineTo(t+o,n+a),0===o&&0===r||c.bezierCurveTo(t+o*l,n+a,t,n+a-r*l,t,n+a-r),c.lineTo(t,n+r),0===o&&0===r||c.bezierCurveTo(t,n+r*l,t+o*l,n,t+o,n),c}function c(e){function t(e,t,n){const s=x(t),i=x(n);0===r?o.moveTo(s,i):o.lineTo(s,i),r++}const n=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,o=new i.T_1;let r=0;return e.getAttribute("points").replace(n,t),o.currentPath.autoClose=!0,o}function u(e){function t(e,t,n){const s=x(t),i=x(n);0===r?o.moveTo(s,i):o.lineTo(s,i),r++}const n=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,o=new i.T_1;let r=0;return e.getAttribute("points").replace(n,t),o.currentPath.autoClose=!1,o}function h(e){const t=x(e.getAttribute("cx")||0),n=x(e.getAttribute("cy")||0),o=x(e.getAttribute("r")||0),r=new i.y$t;r.absarc(t,n,o,0,2*Math.PI);const s=new i.T_1;return s.subPaths.push(r),s}function d(e){const t=x(e.getAttribute("cx")||0),n=x(e.getAttribute("cy")||0),o=x(e.getAttribute("rx")||0),r=x(e.getAttribute("ry")||0),s=new i.y$t;s.absellipse(t,n,o,r,0,2*Math.PI);const a=new i.T_1;return a.subPaths.push(s),a}function p(e){const t=x(e.getAttribute("x1")||0),n=x(e.getAttribute("y1")||0),o=x(e.getAttribute("x2")||0),r=x(e.getAttribute("y2")||0),s=new i.T_1;return s.moveTo(t,n),s.lineTo(o,r),s.currentPath.autoClose=!1,s}function m(e,t){t=Object.assign({},t);let n={};if(e.hasAttribute("class")){const t=e.getAttribute("class").split(/\s/).filter(Boolean).map((e=>e.trim()));for(let e=0;e<t.length;e++)n=Object.assign(n,C["."+t[e]])}function o(o,r,s){void 0===s&&(s=function(e){return e.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),e}),e.hasAttribute(o)&&(t[r]=s(e.getAttribute(o))),n[o]&&(t[r]=s(n[o])),e.style&&""!==e.style[o]&&(t[r]=s(e.style[o]))}function r(e){return Math.max(0,Math.min(1,x(e)))}function s(e){return Math.max(0,x(e))}return e.hasAttribute("id")&&(n=Object.assign(n,C["#"+e.getAttribute("id")])),o("fill","fill"),o("fill-opacity","fillOpacity",r),o("fill-rule","fillRule"),o("opacity","opacity",r),o("stroke","stroke"),o("stroke-opacity","strokeOpacity",r),o("stroke-width","strokeWidth",s),o("stroke-linejoin","strokeLineJoin"),o("stroke-linecap","strokeLineCap"),o("stroke-miterlimit","strokeMiterLimit",s),o("visibility","visibility"),t}function f(e,t){return e-(t-e)}function g(e,t,n){if("string"!==typeof e)throw new TypeError("Invalid input: "+typeof e);const o={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},r=0,s=1,i=2,a=3;let l=r,c=!0,u="",h="";const d=[];function p(e,t,n){const o=new SyntaxError('Unexpected character "'+e+'" at index '+t+".");throw o.partial=n,o}function m(){""!==u&&(""===h?d.push(Number(u)):d.push(Number(u)*Math.pow(10,Number(h)))),u="",h=""}let f;const g=e.length;for(let y=0;y<g;y++)if(f=e[y],Array.isArray(t)&&t.includes(d.length%n)&&o.FLAGS.test(f))l=s,u=f,m();else{if(l===r){if(o.WHITESPACE.test(f))continue;if(o.DIGIT.test(f)||o.SIGN.test(f)){l=s,u=f;continue}if(o.POINT.test(f)){l=i,u=f;continue}o.COMMA.test(f)&&(c&&p(f,y,d),c=!0)}if(l===s){if(o.DIGIT.test(f)){u+=f;continue}if(o.POINT.test(f)){u+=f,l=i;continue}if(o.EXP.test(f)){l=a;continue}o.SIGN.test(f)&&1===u.length&&o.SIGN.test(u[0])&&p(f,y,d)}if(l===i){if(o.DIGIT.test(f)){u+=f;continue}if(o.EXP.test(f)){l=a;continue}o.POINT.test(f)&&"."===u[u.length-1]&&p(f,y,d)}if(l===a){if(o.DIGIT.test(f)){h+=f;continue}if(o.SIGN.test(f)){if(""===h){h+=f;continue}1===h.length&&o.SIGN.test(h)&&p(f,y,d)}}o.WHITESPACE.test(f)?(m(),l=r,c=!1):o.COMMA.test(f)?(m(),l=r,c=!0):o.SIGN.test(f)?(m(),l=s,u=f):o.POINT.test(f)?(m(),l=i,u=f):p(f,y,d)}return m(),d}const y=["mm","cm","in","pt","pc","px"],v={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function x(e){let n,o="px";if("string"===typeof e||e instanceof String)for(let t=0,r=y.length;t<r;t++){const n=y[t];if(e.endsWith(n)){o=n,e=e.substring(0,e.length-n.length);break}}return"px"===o&&"px"!==t.defaultUnit?n=v["in"][t.defaultUnit]/t.defaultDPI:(n=v[o][t.defaultUnit],n<0&&(n=v[o]["in"]*t.defaultDPI)),n*parseFloat(e)}function b(e){if(!(e.hasAttribute("transform")||"use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))))return null;const t=w(e);return E.length>0&&t.premultiply(E[E.length-1]),B.copy(t),E.push(t),t}function w(e){const t=new i.Vkp,n=k;if("use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))){const n=x(e.getAttribute("x")),o=x(e.getAttribute("y"));t.translate(n,o)}if(e.hasAttribute("transform")){const o=e.getAttribute("transform").split(")");for(let e=o.length-1;e>=0;e--){const r=o[e].trim();if(""===r)continue;const s=r.indexOf("("),i=r.length;if(s>0&&s<i){const e=r.substr(0,s),t=g(r.substr(s+1,i-s-1));switch(n.identity(),e){case"translate":if(t.length>=1){const e=t[0];let o=e;t.length>=2&&(o=t[1]),n.translate(e,o)}break;case"rotate":if(t.length>=1){let e=0,o=0,r=0;e=-t[0]*Math.PI/180,t.length>=3&&(o=t[1],r=t[2]),_.identity().translate(-o,-r),I.identity().rotate(e),R.multiplyMatrices(I,_),_.identity().translate(o,r),n.multiplyMatrices(_,R)}break;case"scale":if(t.length>=1){const e=t[0];let o=e;t.length>=2&&(o=t[1]),n.scale(e,o)}break;case"skewX":1===t.length&&n.set(1,Math.tan(t[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===t.length&&n.set(1,0,0,Math.tan(t[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===t.length&&n.set(t[0],t[2],t[4],t[1],t[3],t[5],0,0,1);break}}t.premultiply(n)}}return t}function A(e,t){function n(e){N.set(e.x,e.y,1).applyMatrix3(t),e.set(N.x,N.y)}const o=S(t),r=e.subPaths;for(let s=0,i=r.length;s<i;s++){const e=r[s],i=e.curves;for(let r=0;r<i.length;r++){const e=i[r];e.isLineCurve?(n(e.v1),n(e.v2)):e.isCubicBezierCurve?(n(e.v0),n(e.v1),n(e.v2),n(e.v3)):e.isQuadraticBezierCurve?(n(e.v0),n(e.v1),n(e.v2)):e.isEllipseCurve&&(o&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),L.set(e.aX,e.aY),n(L),e.aX=L.x,e.aY=L.y,e.xRadius*=M(t),e.yRadius*=T(t))}}}function S(e){return 0!==e.elements[1]||0!==e.elements[3]}function M(e){const t=e.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function T(e){const t=e.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}const P=[],C={},E=[],k=new i.Vkp,_=new i.Vkp,I=new i.Vkp,R=new i.Vkp,L=new i.FM8,N=new i.Pa4,B=new i.Vkp,O=(new DOMParser).parseFromString(e,"image/svg+xml");n(O.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4});const V={paths:P,xml:O.documentElement};return V}static createShapes(e){const t=999999999,n={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},o={loc:n.ORIGIN,t:0};function r(e,t,r,i){const a=e.x,l=t.x,c=r.x,u=i.x,h=e.y,d=t.y,p=r.y,m=i.y,f=(u-c)*(h-p)-(m-p)*(a-c),g=(l-a)*(h-p)-(d-h)*(a-c),y=(m-p)*(l-a)-(u-c)*(d-h),v=f/y,x=g/y;if(0===y&&0!==f||v<=0||v>=1||x<0||x>1)return null;if(0===f&&0===y){for(let c=0;c<2;c++){if(s(0===c?r:i,e,t),o.loc==n.ORIGIN){const e=0===c?r:i;return{x:e.x,y:e.y,t:o.t}}if(o.loc==n.BETWEEN){const e=+(a+o.t*(l-a)).toPrecision(10),t=+(h+o.t*(d-h)).toPrecision(10);return{x:e,y:t,t:o.t}}}return null}{for(let a=0;a<2;a++)if(s(0===a?r:i,e,t),o.loc==n.ORIGIN){const e=0===a?r:i;return{x:e.x,y:e.y,t:o.t}}const c=+(a+v*(l-a)).toPrecision(10),u=+(h+v*(d-h)).toPrecision(10);return{x:c,y:u,t:v}}}function s(e,t,r){const s=r.x-t.x,i=r.y-t.y,a=e.x-t.x,l=e.y-t.y,c=s*l-a*i;if(e.x===t.x&&e.y===t.y)return o.loc=n.ORIGIN,void(o.t=0);if(e.x===r.x&&e.y===r.y)return o.loc=n.DESTINATION,void(o.t=1);if(c<-Number.EPSILON)return void(o.loc=n.LEFT);if(c>Number.EPSILON)return void(o.loc=n.RIGHT);if(s*a<0||i*l<0)return void(o.loc=n.BEHIND);if(Math.sqrt(s*s+i*i)<Math.sqrt(a*a+l*l))return void(o.loc=n.BEYOND);let u;u=0!==s?a/s:l/i,o.loc=n.BETWEEN,o.t=u}function a(e,t){const n=[],o=[];for(let s=1;s<e.length;s++){const a=e[s-1],l=e[s];for(let e=1;e<t.length;e++){const s=t[e-1],c=t[e],u=r(a,l,s,c);null!==u&&void 0===n.find((e=>e.t<=u.t+Number.EPSILON&&e.t>=u.t-Number.EPSILON))&&(n.push(u),o.push(new i.FM8(u.x,u.y)))}}return o}function l(e,t,n){const o=new i.FM8;t.getCenter(o);const r=[];return n.forEach((t=>{if(t.boundingBox.containsPoint(o)){const n=a(e,t.points);n.forEach((e=>{r.push({identifier:t.identifier,isCW:t.isCW,point:e})}))}})),r.sort(((e,t)=>e.point.x-t.point.x)),r}function c(e,t,n,o,r){null!==r&&void 0!==r&&""!==r||(r="nonzero");const s=new i.FM8;e.boundingBox.getCenter(s);const a=[new i.FM8(n,s.y),new i.FM8(o,s.y)],c=l(a,e.boundingBox,t);c.sort(((e,t)=>e.point.x-t.point.x));const u=[],h=[];c.forEach((t=>{t.identifier===e.identifier?u.push(t):h.push(t)}));const d=u[0].point.x,p=[];let m=0;while(m<h.length&&h[m].point.x<d)p.length>0&&p[p.length-1]===h[m].identifier?p.pop():p.push(h[m].identifier),m++;if(p.push(e.identifier),"evenodd"===r){const t=p.length%2===0,n=p[p.length-2];return{identifier:e.identifier,isHole:t,for:n}}if("nonzero"===r){let n=!0,o=null,r=null;for(let e=0;e<p.length;e++){const s=p[e];n?(r=t[s].isCW,n=!1,o=s):r!==t[s].isCW&&(r=t[s].isCW,n=!0)}return{identifier:e.identifier,isHole:n,for:o}}console.warn('fill-rule: "'+r+'" is currently not implemented.')}let u=0,h=t,d=-t,p=e.subPaths.map((e=>{const n=e.getPoints();let o=-t,r=t,s=-t,a=t;for(let t=0;t<n.length;t++){const e=n[t];e.y>o&&(o=e.y),e.y<r&&(r=e.y),e.x>s&&(s=e.x),e.x<a&&(a=e.x)}return d<=s&&(d=s+1),h>=a&&(h=a-1),{curves:e.curves,points:n,isCW:i.iDF.isClockWise(n),identifier:u++,boundingBox:new i.TUj(new i.FM8(a,r),new i.FM8(s,o))}}));p=p.filter((e=>e.points.length>1));const m=p.map((t=>c(t,p,h,d,e.userData.style.fillRule))),f=[];return p.forEach((e=>{const t=m[e.identifier];if(!t.isHole){const t=new i.bnF;t.curves=e.curves;const n=m.filter((t=>t.isHole&&t.for===e.identifier));n.forEach((e=>{const n=p[e.identifier],o=new i.y$t;o.curves=n.curves,t.holes.push(o)})),f.push(t)}})),f}static getStrokeStyle(e,t,n,o,r){return e=void 0!==e?e:1,t=void 0!==t?t:"#000",n=void 0!==n?n:"miter",o=void 0!==o?o:"butt",r=void 0!==r?r:4,{strokeColor:t,strokeWidth:e,strokeLineJoin:n,strokeLineCap:o,strokeMiterLimit:r}}static pointsToStroke(e,t,n,o){const r=[],s=[],a=[];if(0===m.pointsToStrokeWithBuffers(e,t,n,o,r,s,a))return null;const l=new i.u9r;return l.setAttribute("position",new i.a$l(r,3)),l.setAttribute("normal",new i.a$l(s,3)),l.setAttribute("uv",new i.a$l(a,2)),l}static pointsToStrokeWithBuffers(e,t,n,o,r,s,a,l){const c=new i.FM8,u=new i.FM8,h=new i.FM8,d=new i.FM8,p=new i.FM8,m=new i.FM8,f=new i.FM8,g=new i.FM8,y=new i.FM8,v=new i.FM8,x=new i.FM8,b=new i.FM8,w=new i.FM8,A=new i.FM8,S=new i.FM8,M=new i.FM8,T=new i.FM8;n=void 0!==n?n:12,o=void 0!==o?o:.001,l=void 0!==l?l:0,e=$(e);const P=e.length;if(P<2)return 0;const C=e[0].equals(e[P-1]);let E,k,_=e[0];const I=t.strokeWidth/2,R=1/(P-1);let L,N,B,O,V=0,D=!1,F=0,U=3*l,z=2*l;H(e[0],e[1],c).multiplyScalar(I),g.copy(e[0]).sub(c),y.copy(e[0]).add(c),v.copy(g),x.copy(y);for(let i=1;i<P;i++){E=e[i],k=i===P-1?C?e[1]:void 0:e[i+1];const n=c;if(H(_,E,n),h.copy(n).multiplyScalar(I),b.copy(E).sub(h),w.copy(E).add(h),L=V+R,N=!1,void 0!==k){H(E,k,u),h.copy(u).multiplyScalar(I),A.copy(E).sub(h),S.copy(E).add(h),B=!0,h.subVectors(k,_),n.dot(h)<0&&(B=!1),1===i&&(D=B),h.subVectors(k,E),h.normalize();const e=Math.abs(n.dot(h));if(0!==e){const n=I/e;h.multiplyScalar(-n),d.subVectors(E,_),p.copy(d).setLength(n).add(h),M.copy(p).negate();const o=p.length(),r=d.length();d.divideScalar(r),m.subVectors(k,E);const s=m.length();switch(m.divideScalar(s),d.dot(M)<r&&m.dot(M)<s&&(N=!0),T.copy(p).add(E),M.add(E),O=!1,N?B?(S.copy(M),w.copy(M)):(A.copy(M),b.copy(M)):W(),t.strokeLineJoin){case"bevel":X(B,N,L);break;case"round":q(B,N),B?G(E,b,A,L,0):G(E,S,w,L,1);break;case"miter":case"miter-clip":default:const e=I*t.strokeMiterLimit/o;if(e<1){if("miter-clip"!==t.strokeLineJoin){X(B,N,L);break}q(B,N),B?(m.subVectors(T,b).multiplyScalar(e).add(b),f.subVectors(T,A).multiplyScalar(e).add(A),j(b,L,0),j(m,L,0),j(E,L,.5),j(E,L,.5),j(m,L,0),j(f,L,0),j(E,L,.5),j(f,L,0),j(A,L,0)):(m.subVectors(T,w).multiplyScalar(e).add(w),f.subVectors(T,S).multiplyScalar(e).add(S),j(w,L,1),j(m,L,1),j(E,L,.5),j(E,L,.5),j(m,L,1),j(f,L,1),j(E,L,.5),j(f,L,1),j(S,L,1))}else N?(B?(j(y,V,1),j(g,V,0),j(T,L,0),j(y,V,1),j(T,L,0),j(M,L,1)):(j(y,V,1),j(g,V,0),j(T,L,1),j(g,V,0),j(M,L,0),j(T,L,1)),B?A.copy(T):S.copy(T)):B?(j(b,L,0),j(T,L,0),j(E,L,.5),j(E,L,.5),j(T,L,0),j(A,L,0)):(j(w,L,1),j(T,L,1),j(E,L,.5),j(E,L,.5),j(T,L,1),j(S,L,1)),O=!0;break}}else W()}else W();C||i!==P-1||K(e[0],v,x,B,!0,V),V=L,_=E,g.copy(A),y.copy(S)}if(C){if(N&&r){let e=T,t=M;D!==B&&(e=M,t=T),B?(O||D)&&(t.toArray(r,0),t.toArray(r,9),O&&e.toArray(r,3)):!O&&D||(t.toArray(r,3),t.toArray(r,9),O&&e.toArray(r,0))}}else K(E,b,w,B,!1,L);return F;function H(e,t,n){return n.subVectors(t,e),n.set(-n.y,n.x).normalize()}function j(e,t,n){r&&(r[U]=e.x,r[U+1]=e.y,r[U+2]=0,s&&(s[U]=0,s[U+1]=0,s[U+2]=1),U+=3,a&&(a[z]=t,a[z+1]=n,z+=2)),F+=3}function G(e,t,o,r,s){c.copy(t).sub(e).normalize(),u.copy(o).sub(e).normalize();let i=Math.PI;const a=c.dot(u);Math.abs(a)<1&&(i=Math.abs(Math.acos(a))),i/=n,h.copy(t);for(let l=0,c=n-1;l<c;l++)d.copy(h).rotateAround(e,i),j(h,r,s),j(d,r,s),j(e,r,.5),h.copy(d);j(d,r,s),j(o,r,s),j(e,r,.5)}function W(){j(y,V,1),j(g,V,0),j(b,L,0),j(y,V,1),j(b,L,1),j(w,L,0)}function X(e,t,n){t?e?(j(y,V,1),j(g,V,0),j(b,L,0),j(y,V,1),j(b,L,0),j(M,L,1),j(b,n,0),j(A,n,0),j(M,n,.5)):(j(y,V,1),j(g,V,0),j(w,L,1),j(g,V,0),j(M,L,0),j(w,L,1),j(w,n,1),j(S,n,0),j(M,n,.5)):e?(j(b,n,0),j(A,n,0),j(E,n,.5)):(j(w,n,1),j(S,n,0),j(E,n,.5))}function q(e,t){t&&(e?(j(y,V,1),j(g,V,0),j(b,L,0),j(y,V,1),j(b,L,0),j(M,L,1),j(b,V,0),j(E,L,.5),j(M,L,1),j(E,L,.5),j(A,V,0),j(M,L,1)):(j(y,V,1),j(g,V,0),j(w,L,1),j(g,V,0),j(M,L,0),j(w,L,1),j(w,V,1),j(M,L,0),j(E,L,.5),j(E,L,.5),j(M,L,0),j(S,V,1)))}function K(e,n,o,s,i,a){switch(t.strokeLineCap){case"round":i?G(e,o,n,a,.5):G(e,n,o,a,.5);break;case"square":if(i)c.subVectors(n,e),u.set(c.y,-c.x),h.addVectors(c,u).add(e),d.subVectors(u,c).add(e),s?(h.toArray(r,3),d.toArray(r,0),d.toArray(r,9)):(h.toArray(r,3),h.toArray(r,9),d.toArray(r,0));else{c.subVectors(o,e),u.set(c.y,-c.x),h.addVectors(c,u).add(e),d.subVectors(u,c).add(e);const t=r.length;s?(h.toArray(r,t-3),d.toArray(r,t-6),d.toArray(r,t-12)):(h.toArray(r,t-6),d.toArray(r,t-3),d.toArray(r,t-12))}break;case"butt":default:break}}function $(e){let t=!1;for(let r=1,s=e.length-1;r<s;r++)if(e[r].distanceTo(e[r+1])<o){t=!0;break}if(!t)return e;const n=[];n.push(e[0]);for(let r=1,s=e.length-1;r<s;r++)e[r].distanceTo(e[r+1])>=o&&n.push(e[r]);return n.push(e[e.length-1]),n}}}class f{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){const t=[];let n,o,r;const s=e.faces;for(o=0;o<s.length;o++){const e=s[o];e.materialIndex!==r&&(r=e.materialIndex,void 0!==n&&(n.count=3*o-n.start,t.push(n)),n={start:3*o,materialIndex:r})}void 0!==n&&(n.count=3*o-n.start,t.push(n)),this.groups=t}fromGeometry(e){const t=e.faces,n=e.vertices,o=e.faceVertexUvs,r=o[0]&&o[0].length>0,s=o[1]&&o[1].length>0,a=e.morphTargets,l=a.length;let c;if(l>0){c=[];for(let e=0;e<l;e++)c[e]={name:a[e].name,data:[]};this.morphTargets.position=c}const u=e.morphNormals,h=u.length;let d;if(h>0){d=[];for(let e=0;e<h;e++)d[e]={name:u[e].name,data:[]};this.morphTargets.normal=d}const p=e.skinIndices,m=e.skinWeights,f=p.length===n.length,g=m.length===n.length;n.length>0&&0===t.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let y=0;y<t.length;y++){const e=t[y];this.vertices.push(n[e.a],n[e.b],n[e.c]);const v=e.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{const t=e.normal;this.normals.push(t,t,t)}const x=e.vertexColors;if(3===x.length)this.colors.push(x[0],x[1],x[2]);else{const t=e.color;this.colors.push(t,t,t)}if(!0===r){const e=o[0][y];void 0!==e?this.uvs.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",y),this.uvs.push(new i.FM8,new i.FM8,new i.FM8))}if(!0===s){const e=o[1][y];void 0!==e?this.uvs2.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",y),this.uvs2.push(new i.FM8,new i.FM8,new i.FM8))}for(let t=0;t<l;t++){const n=a[t].vertices;c[t].data.push(n[e.a],n[e.b],n[e.c])}for(let t=0;t<h;t++){const e=u[t].vertexNormals[y];d[t].data.push(e.a,e.b,e.c)}f&&this.skinIndices.push(p[e.a],p[e.b],p[e.c]),g&&this.skinWeights.push(m[e.a],m[e.b],m[e.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}}const g=(e,t)=>{const n=(new f).fromGeometry(t);return y(e,n)},y=(e,t)=>{var n,o;const r=new Float32Array(3*t.vertices.length);if(e.setAttribute("position",new i.TlE(r,3).copyVector3sArray(t.vertices)),t.normals.length>0){const n=new Float32Array(3*t.normals.length);e.setAttribute("normal",new i.TlE(n,3).copyVector3sArray(t.normals))}if(t.colors.length>0){const n=new Float32Array(3*t.colors.length);e.setAttribute("color",new i.TlE(n,3).copyColorsArray(t.colors))}if(t.uvs.length>0){const n=new Float32Array(2*t.uvs.length);e.setAttribute("uv",new i.TlE(n,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){const n=new Float32Array(2*t.uvs2.length);e.setAttribute("uv2",new i.TlE(n,2).copyVector2sArray(t.uvs2))}e.groups=t.groups;for(const s in t.morphTargets){const n=[],o=t.morphTargets[s];for(let e=0,t=o.length;e<t;e++){const t=o[e],r=new i.a$l(3*t.data.length,3);r.name=t.name,n.push(r.copyVector3sArray(t.data))}e.morphAttributes[s]=n}if(t.skinIndices.length>0){const n=new i.a$l(4*t.skinIndices.length,4);e.setAttribute("skinIndex",n.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){const n=new i.a$l(4*t.skinWeights.length,4);e.setAttribute("skinWeight",n.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(e.boundingSphere=null===(n=t.boundingSphere)||void 0===n?void 0:n.clone()),null!==t.boundingBox&&(e.boundingBox=null===(o=t.boundingBox)||void 0===o?void 0:o.clone()),e};
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class v{constructor(e,t){this.camera=e,this.renderer=t}static geometryToBufferGeometry(e){return e.isGeometry?g(new i.u9r,e):e}static bufferGeometryToGeometry(e){return e.isBufferGeometry?(new u).fromBufferGeometry(e):e}fromSVGtoShape(e,t=!1,n){if(e){const o=new m,r=[];return o.parse(e).paths.forEach((e=>{e.toShapes(t,n).forEach((e=>{r.push(e)}))})),r}return[]}from3dto2d(e){const t=new i.Pa4(e.x,e.y,e.z),n=this.renderer.domElement;this.camera.updateMatrixWorld(),t.project(this.camera);const o=Math.round((t.x+1)*(n.width/2)),r=Math.round((1-t.y)*(n.height/2));return new i.FM8(o,r)}from2dto3d(e,t,n){var o;if(!this.tmpPlane){const e=new i.BKK(1e4,1e4),t=new i.vBJ({transparent:!0,opacity:.25});this.tmpPlane=new i.Kj0(e,t),this.tmpPlane.name="_tmp_raycast_plane"}let r;this.tmpRaycaster||(this.tmpRaycaster=new i.iMs),this.tmpVector3||(this.tmpVector3=new i.Pa4),this.tmpPlane.setRotationFromEuler(this.camera.rotation);const s=this.camera.position;this.tmpPlane.position.set(s.x,s.y,s.z),this.camera.getWorldDirection(this.tmpVector3),this.tmpPlane.position.add(this.tmpVector3.clone().multiplyScalar(n)),this.tmpPlane.updateMatrix(),this.tmpPlane.updateMatrixWorld(!0),this.tmpRaycaster.setFromCamera({x:e,y:t},this.camera);const a=this.tmpRaycaster.intersectObjects([this.tmpPlane]);return"_tmp_raycast_plane"===(null===(o=a[0])||void 0===o?void 0:o.object.name)&&(r=a[0].point),r}}
/**
 * @author       Evan Wallace (http://madebyevan.com/))
 * @copyright    Copyright (c) 2011 Evan Wallace
 * @license      MIT license
 *
 * @author       manthrax (https://github.com/manthrax)
 *
 * @author       Jiro-Digital (https://github.com/Jiro-Digital)
 * @copyright    Copyright (c) 2020 Jiro Digital Ltd
 * @license      {@link https://github.com/Jiro-Digital/three-csg-ts/blob/master/LICENSE|MIT}
 *
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class x{static toGeometry(e,t){e.geometry=v.bufferGeometryToGeometry(e.geometry),t.geometry=v.bufferGeometryToGeometry(t.geometry)}static toBufferGeometry(e){e.geometry=v.geometryToBufferGeometry(e.geometry)}static union(e,t){this.toGeometry(e,t);const n=this.doCSG(e,t,"union");return this.toBufferGeometry(n),n}static subtract(e,t){this.toGeometry(e,t);const n=this.doCSG(e,t,"subtract");return this.toBufferGeometry(n),n}static intersect(e,t){this.toGeometry(e,t);const n=this.doCSG(e,t,"intersect");return this.toBufferGeometry(n),n}static doCSG(e,t,n){e.updateMatrix(),t.updateMatrix();const o=b.fromMesh(e),r=b.fromMesh(t),s=o[n](r),i=b.toMesh(s,e.matrix);return i}}class b{constructor(){this.polygons=[]}static fromPolygons(e){const t=new b;return t.polygons=e,t}static fromGeometry(e){e.isBufferGeometry&&(e=(new u).fromBufferGeometry(e));const t=e.faces,n=e.vertices,o=[],r=["a","b","c"];for(let s=0;s<t.length;s++){const i=t[s],a=[];for(let t=0;t<3;t++){const o=void 0!==e.faceVertexUvs[0][s]&&void 0!==e.faceVertexUvs[0][s][t]?e.faceVertexUvs[0][s][t]:void 0;a.push(new A(n[i[r[t]]],i.vertexNormals[t],o))}o.push(new M(a))}return b.fromPolygons(o)}static fromMesh(e){const t=b.fromGeometry(e.geometry);b._tmpm3.getNormalMatrix(e.matrix);for(const n of t.polygons)for(const t of n.vertices)t.pos.applyMatrix4(e.matrix),t.normal.applyMatrix3(b._tmpm3);return t}static toMesh(e,t){const n=new u,o=e.polygons,r=n.vertices,s=n.faceVertexUvs[0];for(const c of o){const e=c.vertices,t=r.length,o=e.length;for(const n of e)r.push((new i.Pa4).copy(n.pos));for(let r=3;r<=o;r++){const o=new p(t,t+r-2,t+r-1),a=[];s.push(a);const l=o.vertexNormals;l.push((new i.Pa4).copy(e[0].normal)),l.push((new i.Pa4).copy(e[r-2].normal)),l.push((new i.Pa4).copy(e[r-1].normal)),e[0].uv&&e[r-2].uv&&e[r-1].uv&&(a.push((new i.Pa4).copy(e[0].uv)),a.push((new i.Pa4).copy(e[r-2].uv)),a.push((new i.Pa4).copy(e[r-1].uv))),o.normal=(new i.Pa4).copy(c.plane.normal),n.faces.push(o)}}const a=parseInt(i.UZH)>=123?(new i.yGw).copy(t).invert():(new i.yGw).getInverse(t);n.applyMatrix4(a),n.verticesNeedUpdate=n.elementsNeedUpdate=n.normalsNeedUpdate=!0,n.computeBoundingSphere(),n.computeBoundingBox();const l=new i.Kj0(n);return l.matrix.copy(t),l.matrix.decompose(l.position,l.rotation,l.scale),l.updateMatrixWorld(),l}static iEval(e,t=0){var n;if("string"===typeof e)b.currentOp=e;else if(e instanceof Array)for(const o of e)b.iEval(o,0);else if("object"===typeof e){const t=b.currentOp;e.updateMatrix(),e.updateMatrixWorld(),b.sourceMesh?(b.nextPrim=b.fromMesh(e),b.currentPrim=b.currentPrim[t](b.nextPrim)):b.currentPrim=b.fromMesh(b.sourceMesh=e),b.doRemove&&(null===(n=null===e||void 0===e?void 0:e.parent)||void 0===n||n.remove(e))}}static eval(e,t){delete b.currentOp,delete b.sourceMesh,b.doRemove=t,b.iEval(e);const n=b.toMesh(b.currentPrim,b.sourceMesh.matrix);return n.material=b.sourceMesh.material,n.castShadow=n.receiveShadow=!0,n}clone(){const e=new b;return e.polygons=this.polygons.map((e=>e.clone())),e}toPolygons(){return this.polygons}union(e){const t=new T(this.clone().polygons),n=new T(e.clone().polygons);return t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),b.fromPolygons(t.allPolygons())}subtract(e){const t=new T(this.clone().polygons),n=new T(e.clone().polygons);return t.invert(),t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),t.invert(),b.fromPolygons(t.allPolygons())}intersect(e){const t=new T(this.clone().polygons),n=new T(e.clone().polygons);return t.invert(),n.clipTo(t),n.invert(),t.clipTo(n),n.clipTo(t),t.build(n.allPolygons()),t.invert(),b.fromPolygons(t.allPolygons())}inverse(){const e=this.clone();return e.polygons.map((e=>{e.flip()})),e}}b._tmpm3=new i.Vkp;class w extends i.Pa4{constructor(e,t,n){if(3===arguments.length)super(e,t,n);else if(Array.isArray(e))super(e[0],e[1],e[2]);else{if("object"!==typeof e)throw new Error("Invalid constructor to vector");this.copy(e)}}clone(){return new w(this.x,this.y,this.z)}negated(){return this.clone().multiplyScalar(-1)}plus(e){return this.clone().add(e)}minus(e){return this.clone().sub(e)}times(e){return this.clone().multiplyScalar(e)}dividedBy(e){return this.clone().divideScalar(e)}lerp(e,t){return this.plus(e.minus(this).times(t))}unit(){return this.dividedBy(this.length())}cross(e,t){return i.Pa4.prototype.cross.call(this.clone(),e)}}class A{constructor(e,t,n){this.pos=new w(e.x,e.y,e.z),this.normal=new w(t.x,t.y,t.z),n&&(this.uv=new w(n.x,n.y,n.z))}clone(){return new A(this.pos.clone(),this.normal.clone(),this.uv?this.uv.clone():void 0)}flip(){this.normal=this.normal.negated()}interpolate(e,t){return new A(this.pos.lerp(e.pos,t),this.normal.lerp(e.normal,t),this.uv?this.uv.lerp(e.uv,t):void 0)}}class S{constructor(e,t){this.normal=e,this.w=t}static fromPoints(e,t,n){const o=t.minus(e).cross(n.minus(e)).unit();return new S(o,o.dot(e))}clone(){return new S(this.normal.clone(),this.w)}flip(){this.normal=this.normal.negated(),this.w=-this.w}splitPolygon(e,t,n,o,r){const s=0,i=1,a=2,l=3;let c=0;const u=[];for(const h of e.vertices){const e=this.normal.dot(h.pos)-this.w,t=e<-S.EPSILON?a:e>S.EPSILON?i:s;c|=t,u.push(t)}switch(c){case s:this.normal.dot(e.plane.normal)>0?t.push(e):n.push(e);break;case i:o.push(e);break;case a:r.push(e);break;case l:const c=[],h=[];for(let t=0;t<e.vertices.length;t++){const n=(t+1)%e.vertices.length,o=u[t],r=u[n],s=e.vertices[t],d=e.vertices[n];if(o!==a&&c.push(s),o!==i&&h.push(o!==a?s.clone():s),(o|r)===l){const e=(this.w-this.normal.dot(s.pos))/this.normal.dot(d.pos.minus(s.pos)),t=s.interpolate(d,e);c.push(t),h.push(t.clone())}}c.length>=3&&o.push(new M(c,e.shared)),h.length>=3&&r.push(new M(h,e.shared));break}}}S.EPSILON=1e-5;class M{constructor(e,t=null){this.vertices=e,this.shared=t,this.plane=S.fromPoints(e[0].pos,e[1].pos,e[2].pos)}clone(){const e=this.vertices.map((e=>e.clone()));return new M(e,this.shared)}flip(){this.vertices.reverse().map((e=>{e.flip()})),this.plane.flip()}}class T{constructor(e){delete this.plane,delete this.front,delete this.back,this.polygons=[],e&&this.build(e)}clone(){const e=new T;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map((e=>e.clone())),e}invert(){for(const t of this.polygons)t.flip();this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();const e=this.front;this.front=this.back,this.back=e}clipPolygons(e){if(!this.plane)return e.slice();let t=[],n=[];for(const o of e)this.plane.splitPolygon(o,t,n,t,n);return this.front&&(t=this.front.clipPolygons(t)),n=this.back?this.back.clipPolygons(n):[],t.concat(n)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}allPolygons(){let e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}build(e){if(!e.length)return;this.plane||(this.plane=e[0].plane.clone());const t=[],n=[];for(const o of e)this.plane.splitPolygon(o,this.polygons,this.polygons,t,n);t.length&&(this.front||(this.front=new T),this.front.build(t)),n.length&&(this.back||(this.back=new T),this.back.build(n))}}
/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/
var P={},C=function(e){return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},E=function(e){return new Worker(e)};try{URL.revokeObjectURL(C(""))}catch(Cs){C=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},E=function(e){return new Worker(e,{type:"module"})}}var k=function(e,t,n,o,r){var s=E(P[t]||(P[t]=C(e)));return s.onerror=function(e){return r(e.error,null)},s.onmessage=function(e){return r(null,e.data)},s.postMessage(n,o),s},_=Uint8Array,I=Uint16Array,R=Uint32Array,L=new _([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),N=new _([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),B=new _([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),O=function(e,t){for(var n=new I(31),o=0;o<31;++o)n[o]=t+=1<<e[o-1];var r=new R(n[30]);for(o=1;o<30;++o)for(var s=n[o];s<n[o+1];++s)r[s]=s-n[o]<<5|o;return[n,r]},V=O(L,2),D=V[0],F=V[1];D[28]=258,F[258]=28;for(var U=O(N,0),z=U[0],H=U[1],j=new I(32768),G=0;G<32768;++G){var W=(43690&G)>>>1|(21845&G)<<1;W=(52428&W)>>>2|(13107&W)<<2,W=(61680&W)>>>4|(3855&W)<<4,j[G]=((65280&W)>>>8|(255&W)<<8)>>>1}var X=function(e,t,n){for(var o=e.length,r=0,s=new I(t);r<o;++r)++s[e[r]-1];var i,a=new I(t);for(r=0;r<t;++r)a[r]=a[r-1]+s[r-1]<<1;if(n){i=new I(1<<t);var l=15-t;for(r=0;r<o;++r)if(e[r])for(var c=r<<4|e[r],u=t-e[r],h=a[e[r]-1]++<<u,d=h|(1<<u)-1;h<=d;++h)i[j[h]>>>l]=c}else for(i=new I(o),r=0;r<o;++r)e[r]&&(i[r]=j[a[e[r]-1]++]>>>15-e[r]);return i},q=new _(288);for(G=0;G<144;++G)q[G]=8;for(G=144;G<256;++G)q[G]=9;for(G=256;G<280;++G)q[G]=7;for(G=280;G<288;++G)q[G]=8;var K=new _(32);for(G=0;G<32;++G)K[G]=5;var $=X(q,9,0),Z=X(q,9,1),Y=X(K,5,0),Q=X(K,5,1),J=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},ee=function(e,t,n){var o=t/8|0;return(e[o]|e[o+1]<<8)>>(7&t)&n},te=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},ne=function(e){return(e/8|0)+(7&e&&1)},oe=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var o=new(e instanceof I?I:e instanceof R?R:_)(n-t);return o.set(e.subarray(t,n)),o},re=function(e,t,n){var o=e.length;if(!o||n&&!n.l&&o<5)return t||new _(0);var r=!t||n,s=!n||n.i;n||(n={}),t||(t=new _(3*o));var i=function(e){var n=t.length;if(e>n){var o=new _(Math.max(2*n,e));o.set(t),t=o}},a=n.f||0,l=n.p||0,c=n.b||0,u=n.l,h=n.d,d=n.m,p=n.n,m=8*o;do{if(!u){n.f=a=ee(e,l,1);var f=ee(e,l+1,3);if(l+=3,!f){var g=ne(l)+4,y=e[g-4]|e[g-3]<<8,v=g+y;if(v>o){if(s)throw"unexpected EOF";break}r&&i(c+y),t.set(e.subarray(g,v),c),n.b=c+=y,n.p=l=8*v;continue}if(1==f)u=Z,h=Q,d=9,p=5;else{if(2!=f)throw"invalid block type";var x=ee(e,l,31)+257,b=ee(e,l+10,15)+4,w=x+ee(e,l+5,31)+1;l+=14;for(var A=new _(w),S=new _(19),M=0;M<b;++M)S[B[M]]=ee(e,l+3*M,7);l+=3*b;var T=J(S),P=(1<<T)-1,C=X(S,T,1);for(M=0;M<w;){var E=C[ee(e,l,P)];l+=15&E;g=E>>>4;if(g<16)A[M++]=g;else{var k=0,I=0;16==g?(I=3+ee(e,l,3),l+=2,k=A[M-1]):17==g?(I=3+ee(e,l,7),l+=3):18==g&&(I=11+ee(e,l,127),l+=7);while(I--)A[M++]=k}}var R=A.subarray(0,x),O=A.subarray(x);d=J(R),p=J(O),u=X(R,d,1),h=X(O,p,1)}if(l>m){if(s)throw"unexpected EOF";break}}r&&i(c+131072);for(var V=(1<<d)-1,F=(1<<p)-1,U=l;;U=l){k=u[te(e,l)&V];var H=k>>>4;if(l+=15&k,l>m){if(s)throw"unexpected EOF";break}if(!k)throw"invalid length/literal";if(H<256)t[c++]=H;else{if(256==H){U=l,u=null;break}var j=H-254;if(H>264){M=H-257;var G=L[M];j=ee(e,l,(1<<G)-1)+D[M],l+=G}var W=h[te(e,l)&F],q=W>>>4;if(!W)throw"invalid distance";l+=15&W;O=z[q];if(q>3){G=N[q];O+=te(e,l)&(1<<G)-1,l+=G}if(l>m){if(s)throw"unexpected EOF";break}r&&i(c+131072);for(var K=c+j;c<K;c+=4)t[c]=t[c-O],t[c+1]=t[c+1-O],t[c+2]=t[c+2-O],t[c+3]=t[c+3-O];c=K}}n.l=u,n.p=U,n.b=c,u&&(a=1,n.m=d,n.d=h,n.n=p)}while(!a);return c==t.length?t:oe(t,0,c)},se=function(e,t,n){n<<=7&t;var o=t/8|0;e[o]|=n,e[o+1]|=n>>>8},ie=function(e,t,n){n<<=7&t;var o=t/8|0;e[o]|=n,e[o+1]|=n>>>8,e[o+2]|=n>>>16},ae=function(e,t){for(var n=[],o=0;o<e.length;++o)e[o]&&n.push({s:o,f:e[o]});var r=n.length,s=n.slice();if(!r)return[me,0];if(1==r){var i=new _(n[0].s+1);return i[n[0].s]=1,[i,1]}n.sort((function(e,t){return e.f-t.f})),n.push({s:-1,f:25001});var a=n[0],l=n[1],c=0,u=1,h=2;n[0]={s:-1,f:a.f+l.f,l:a,r:l};while(u!=r-1)a=n[n[c].f<n[h].f?c++:h++],l=n[c!=u&&n[c].f<n[h].f?c++:h++],n[u++]={s:-1,f:a.f+l.f,l:a,r:l};var d=s[0].s;for(o=1;o<r;++o)s[o].s>d&&(d=s[o].s);var p=new I(d+1),m=le(n[u-1],p,0);if(m>t){o=0;var f=0,g=m-t,y=1<<g;for(s.sort((function(e,t){return p[t.s]-p[e.s]||e.f-t.f}));o<r;++o){var v=s[o].s;if(!(p[v]>t))break;f+=y-(1<<m-p[v]),p[v]=t}f>>>=g;while(f>0){var x=s[o].s;p[x]<t?f-=1<<t-p[x]++-1:++o}for(;o>=0&&f;--o){var b=s[o].s;p[b]==t&&(--p[b],++f)}m=t}return[new _(p),m]},le=function(e,t,n){return-1==e.s?Math.max(le(e.l,t,n+1),le(e.r,t,n+1)):t[e.s]=n},ce=function(e){var t=e.length;while(t&&!e[--t]);for(var n=new I(++t),o=0,r=e[0],s=1,i=function(e){n[o++]=e},a=1;a<=t;++a)if(e[a]==r&&a!=t)++s;else{if(!r&&s>2){for(;s>138;s-=138)i(32754);s>2&&(i(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(i(r),--s;s>6;s-=6)i(8304);s>2&&(i(s-3<<5|8208),s=0)}while(s--)i(r);s=1,r=e[a]}return[n.subarray(0,o),t]},ue=function(e,t){for(var n=0,o=0;o<t.length;++o)n+=e[o]*t[o];return n},he=function(e,t,n){var o=n.length,r=ne(t+2);e[r]=255&o,e[r+1]=o>>>8,e[r+2]=255^e[r],e[r+3]=255^e[r+1];for(var s=0;s<o;++s)e[r+s+4]=n[s];return 8*(r+4+o)},de=function(e,t,n,o,r,s,i,a,l,c,u){se(t,u++,n),++r[256];for(var h=ae(r,15),d=h[0],p=h[1],m=ae(s,15),f=m[0],g=m[1],y=ce(d),v=y[0],x=y[1],b=ce(f),w=b[0],A=b[1],S=new I(19),M=0;M<v.length;++M)S[31&v[M]]++;for(M=0;M<w.length;++M)S[31&w[M]]++;for(var T=ae(S,7),P=T[0],C=T[1],E=19;E>4&&!P[B[E-1]];--E);var k,_,R,O,V=c+5<<3,D=ue(r,q)+ue(s,K)+i,F=ue(r,d)+ue(s,f)+i+14+3*E+ue(S,P)+(2*S[16]+3*S[17]+7*S[18]);if(V<=D&&V<=F)return he(t,u,e.subarray(l,l+c));if(se(t,u,1+(F<D)),u+=2,F<D){k=X(d,p,0),_=d,R=X(f,g,0),O=f;var U=X(P,C,0);se(t,u,x-257),se(t,u+5,A-1),se(t,u+10,E-4),u+=14;for(M=0;M<E;++M)se(t,u+3*M,P[B[M]]);u+=3*E;for(var z=[v,w],H=0;H<2;++H){var j=z[H];for(M=0;M<j.length;++M){var G=31&j[M];se(t,u,U[G]),u+=P[G],G>15&&(se(t,u,j[M]>>>5&127),u+=j[M]>>>12)}}}else k=$,_=q,R=Y,O=K;for(M=0;M<a;++M)if(o[M]>255){G=o[M]>>>18&31;ie(t,u,k[G+257]),u+=_[G+257],G>7&&(se(t,u,o[M]>>>23&31),u+=L[G]);var W=31&o[M];ie(t,u,R[W]),u+=O[W],W>3&&(ie(t,u,o[M]>>>5&8191),u+=N[W])}else ie(t,u,k[o[M]]),u+=_[o[M]];return ie(t,u,k[256]),u+_[256]},pe=new R([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),me=new _(0),fe=function(e,t,n,o,r,s){var i=e.length,a=new _(o+i+5*(1+Math.ceil(i/7e3))+r),l=a.subarray(o,a.length-r),c=0;if(!t||i<8)for(var u=0;u<=i;u+=65535){var h=u+65535;h<i?c=he(l,c,e.subarray(u,h)):(l[u]=s,c=he(l,c,e.subarray(u,i)))}else{for(var d=pe[t-1],p=d>>>13,m=8191&d,f=(1<<n)-1,g=new I(32768),y=new I(f+1),v=Math.ceil(n/3),x=2*v,b=function(t){return(e[t]^e[t+1]<<v^e[t+2]<<x)&f},w=new R(25e3),A=new I(288),S=new I(32),M=0,T=0,P=(u=0,0),C=0,E=0;u<i;++u){var k=b(u),B=32767&u,O=y[k];if(g[B]=O,y[k]=B,C<=u){var V=i-u;if((M>7e3||P>24576)&&V>423){c=de(e,l,0,w,A,S,T,P,E,u-E,c),P=M=T=0,E=u;for(var D=0;D<286;++D)A[D]=0;for(D=0;D<30;++D)S[D]=0}var U=2,z=0,j=m,G=B-O&32767;if(V>2&&k==b(u-G)){var W=Math.min(p,V)-1,X=Math.min(32767,u),q=Math.min(258,V);while(G<=X&&--j&&B!=O){if(e[u+U]==e[u+U-G]){for(var K=0;K<q&&e[u+K]==e[u+K-G];++K);if(K>U){if(U=K,z=G,K>W)break;var $=Math.min(G,K-2),Z=0;for(D=0;D<$;++D){var Y=u-G+D+32768&32767,Q=g[Y],J=Y-Q+32768&32767;J>Z&&(Z=J,O=Y)}}}B=O,O=g[B],G+=B-O+32768&32767}}if(z){w[P++]=268435456|F[U]<<18|H[z];var ee=31&F[U],te=31&H[z];T+=L[ee]+N[te],++A[257+ee],++S[te],C=u+U,++M}else w[P++]=e[u],++A[e[u]]}}c=de(e,l,s,w,A,S,T,P,E,u-E,c),!s&&7&c&&(c=he(l,c+1,me))}return oe(a,0,o+ne(c)+r)},ge=function(){for(var e=new R(256),t=0;t<256;++t){var n=t,o=9;while(--o)n=(1&n&&3988292384)^n>>>1;e[t]=n}return e}(),ye=function(){var e=-1;return{p:function(t){for(var n=e,o=0;o<t.length;++o)n=ge[255&n^t[o]]^n>>>8;e=n},d:function(){return~e}}},ve=function(){var e=1,t=0;return{p:function(n){for(var o=e,r=t,s=n.length,i=0;i!=s;){for(var a=Math.min(i+2655,s);i<a;++i)r+=o+=n[i];o=(65535&o)+15*(o>>16),r=(65535&r)+15*(r>>16)}e=o,t=r},d:function(){return e%=65521,t%=65521,(255&e)<<24|e>>>8<<16|(255&t)<<8|t>>>8}}},xe=function(e,t,n,o,r){return fe(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,n,o,!r)},be=function(e,t){var n={};for(var o in e)n[o]=e[o];for(var o in t)n[o]=t[o];return n},we=function(e,t,n){for(var o=e(),r=e.toString(),s=r.slice(r.indexOf("[")+1,r.lastIndexOf("]")).replace(/ /g,"").split(","),i=0;i<o.length;++i){var a=o[i],l=s[i];if("function"==typeof a){t+=";"+l+"=";var c=a.toString();if(a.prototype)if(-1!=c.indexOf("[native code]")){var u=c.indexOf(" ",8)+1;t+=c.slice(u,c.indexOf("(",u))}else for(var h in t+=c,a.prototype)t+=";"+l+".prototype."+h+"="+a.prototype[h].toString();else t+=c}else n[l]=a}return[t,n]},Ae=[],Se=function(e){var t=[];for(var n in e)(e[n]instanceof _||e[n]instanceof I||e[n]instanceof R)&&t.push((e[n]=new e[n].constructor(e[n])).buffer);return t},Me=function(e,t,n,o){var r;if(!Ae[n]){for(var s="",i={},a=e.length-1,l=0;l<a;++l)r=we(e[l],s,i),s=r[0],i=r[1];Ae[n]=we(e[a],s,i)}var c=be({},Ae[n][1]);return k(Ae[n][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",n,c,Se(c),o)},Te=function(){return[_,I,R,L,N,B,D,z,Z,Q,j,X,J,ee,te,ne,oe,re,et,Ie,Re]},Pe=function(){return[_,I,R,L,N,B,F,H,$,q,Y,K,j,pe,me,X,se,ie,ae,le,ce,ue,he,de,ne,oe,fe,xe,Ze,Ie]},Ce=function(){return[Ue,je,Fe,ye,ge]},Ee=function(){return[ze,He]},ke=function(){return[Ge,Fe,ve]},_e=function(){return[We]},Ie=function(e){return postMessage(e,[e.buffer])},Re=function(e){return e&&e.size&&new _(e.size)},Le=function(e,t,n,o,r,s){var i=Me(n,o,r,(function(e,t){i.terminate(),s(e,t)}));return i.postMessage([e,t],t.consume?[e.buffer]:[]),function(){i.terminate()}},Ne=function(e){return e.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(t){return e.push(t.data[0],t.data[1])}},Be=function(e,t,n,o,r){var s,i=Me(e,o,r,(function(e,n){e?(i.terminate(),t.ondata.call(t,e)):(n[1]&&i.terminate(),t.ondata.call(t,e,n[0],n[1]))}));i.postMessage(n),t.push=function(e,n){if(s)throw"stream finished";if(!t.ondata)throw"no stream handler";i.postMessage([e,s=n],[e.buffer])},t.terminate=function(){i.terminate()}},Oe=function(e,t){return e[t]|e[t+1]<<8},Ve=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},De=function(e,t){return Ve(e,t)+4294967296*Ve(e,t+4)},Fe=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8},Ue=function(e,t){var n=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&Fe(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),n){e[3]=8;for(var o=0;o<=n.length;++o)e[o+10]=n.charCodeAt(o)}},ze=function(e){if(31!=e[0]||139!=e[1]||8!=e[2])throw"invalid gzip data";var t=e[3],n=10;4&t&&(n+=e[10]|2+(e[11]<<8));for(var o=(t>>3&1)+(t>>4&1);o>0;o-=!e[n++]);return n+(2&t)},He=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},je=function(e){return 10+(e.filename&&e.filename.length+1||0)},Ge=function(e,t){var n=t.level,o=0==n?0:n<6?1:9==n?3:2;e[0]=120,e[1]=o<<6|(o?32-2*o:1)},We=function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function Xe(e,t){return t||"function"!=typeof e||(t=e,e={}),this.ondata=t,e}var qe=function(){function e(e,t){t||"function"!=typeof e||(t=e,e={}),this.ondata=t,this.o=e||{}}return e.prototype.p=function(e,t){this.ondata(xe(e,this.o,0,0,!t),t)},e.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},e}(),Ke=function(){function e(e,t){Be([Pe,function(){return[Ne,qe]}],this,Xe.call(this,e,t),(function(e){var t=new qe(e.data);onmessage=Ne(t)}),6)}return e}();function $e(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return Le(e,t,[Pe],(function(e){return Ie(Ze(e.data[0],e.data[1]))}),0,n)}function Ze(e,t){return xe(e,t||{},0,0)}var Ye=function(){function e(e){this.s={},this.p=new _(0),this.ondata=e}return e.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new _(t+e.length);n.set(this.p),n.set(e,t),this.p=n},e.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=re(this.p,this.o,this.s);this.ondata(oe(n,t,this.s.b),this.d),this.o=oe(n,this.s.b-32768),this.s.b=this.o.length,this.p=oe(this.p,this.s.p/8|0),this.s.p&=7},e.prototype.push=function(e,t){this.e(e),this.c(t)},e}(),Qe=function(){function e(e){this.ondata=e,Be([Te,function(){return[Ne,Ye]}],this,0,(function(){var e=new Ye;onmessage=Ne(e)}),7)}return e}();function Je(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return Le(e,t,[Te],(function(e){return Ie(et(e.data[0],Re(e.data[1])))}),1,n)}function et(e,t){return re(e,t)}var tt=function(){function e(e,t){this.c=ye(),this.l=0,this.v=1,qe.call(this,e,t)}return e.prototype.push=function(e,t){qe.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=xe(e,this.o,this.v&&je(this.o),t&&8,!t);this.v&&(Ue(n,this.o),this.v=0),t&&(Fe(n,n.length-8,this.c.d()),Fe(n,n.length-4,this.l)),this.ondata(n,t)},e}(),nt=function(){function e(e,t){Be([Pe,Ce,function(){return[Ne,qe,tt]}],this,Xe.call(this,e,t),(function(e){var t=new tt(e.data);onmessage=Ne(t)}),8)}return e}();function ot(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return Le(e,t,[Pe,Ce,function(){return[rt]}],(function(e){return Ie(rt(e.data[0],e.data[1]))}),2,n)}function rt(e,t){t||(t={});var n=ye(),o=e.length;n.p(e);var r=xe(e,t,je(t),8),s=r.length;return Ue(r,t),Fe(r,s-8,n.d()),Fe(r,s-4,o),r}var st=function(){function e(e){this.v=1,Ye.call(this,e)}return e.prototype.push=function(e,t){if(Ye.prototype.e.call(this,e),this.v){var n=this.p.length>3?ze(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Ye.prototype.c.call(this,t)},e}(),it=function(){function e(e){this.ondata=e,Be([Te,Ee,function(){return[Ne,Ye,st]}],this,0,(function(){var e=new st;onmessage=Ne(e)}),9)}return e}();function at(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return Le(e,t,[Te,Ee,function(){return[lt]}],(function(e){return Ie(lt(e.data[0]))}),3,n)}function lt(e,t){return re(e.subarray(ze(e),-8),t||new _(He(e)))}var ct=function(){function e(e,t){this.c=ve(),this.v=1,qe.call(this,e,t)}return e.prototype.push=function(e,t){qe.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e);var n=xe(e,this.o,this.v&&2,t&&4,!t);this.v&&(Ge(n,this.o),this.v=0),t&&Fe(n,n.length-4,this.c.d()),this.ondata(n,t)},e}(),ut=function(){function e(e,t){Be([Pe,ke,function(){return[Ne,qe,ct]}],this,Xe.call(this,e,t),(function(e){var t=new ct(e.data);onmessage=Ne(t)}),10)}return e}();function ht(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return Le(e,t,[Pe,ke,function(){return[dt]}],(function(e){return Ie(dt(e.data[0],e.data[1]))}),4,n)}function dt(e,t){t||(t={});var n=ve();n.p(e);var o=xe(e,t,2,4);return Ge(o,t),Fe(o,o.length-4,n.d()),o}var pt=function(){function e(e){this.v=1,Ye.call(this,e)}return e.prototype.push=function(e,t){if(Ye.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Ye.prototype.c.call(this,t)},e}(),mt=function(){function e(e){this.ondata=e,Be([Te,_e,function(){return[Ne,Ye,pt]}],this,0,(function(){var e=new pt;onmessage=Ne(e)}),11)}return e}();function ft(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return Le(e,t,[Te,_e,function(){return[gt]}],(function(e){return Ie(gt(e.data[0],Re(e.data[1])))}),5,n)}function gt(e,t){return re((We(e),e.subarray(2,-4)),t)}var yt=function(){function e(e){this.G=st,this.I=Ye,this.Z=pt,this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new _(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var o=this,r=function(){o.ondata.apply(o,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(r):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(r):new this.Z(r),this.s.push(this.p,t),this.p=null}}},e}(),vt=function(){function e(e){this.G=it,this.I=Qe,this.Z=mt,this.ondata=e}return e.prototype.push=function(e,t){yt.prototype.push.call(this,e,t)},e}();function xt(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return 31==e[0]&&139==e[1]&&8==e[2]?at(e,t,n):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Je(e,t,n):ft(e,t,n)}function bt(e,t){return 31==e[0]&&139==e[1]&&8==e[2]?lt(e,t):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?et(e,t):gt(e,t)}var wt=function(e,t,n,o){for(var r in e){var s=e[r],i=t+r;s instanceof _?n[i]=[s,o]:Array.isArray(s)?n[i]=[s[0],be(o,s[1])]:wt(s,i+"/",n,o)}},At="undefined"!=typeof TextEncoder&&new TextEncoder,St="undefined"!=typeof TextDecoder&&new TextDecoder,Mt=0;try{St.decode(me,{stream:!0}),Mt=1}catch(Cs){}var Tt=function(e){for(var t="",n=0;;){var o=e[n++],r=(o>127)+(o>223)+(o>239);if(n+r>e.length)return[t,oe(e,n-1)];r?3==r?(o=((15&o)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t+=String.fromCharCode(55296|o>>10,56320|1023&o)):t+=1&r?String.fromCharCode((31&o)<<6|63&e[n++]):String.fromCharCode((15&o)<<12|(63&e[n++])<<6|63&e[n++]):t+=String.fromCharCode(o)}},Pt=function(){function e(e){this.ondata=e,Mt?this.t=new TextDecoder:this.p=me}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var n=new _(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var o=Tt(n),r=o[0],s=o[1];if(t){if(s.length)throw"invalid utf-8 data";this.p=null}else this.p=s;this.ondata(r,t)}},e}(),Ct=function(){function e(e){this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(Et(e),this.d=t||!1)},e}();function Et(e,t){if(t){for(var n=new _(e.length),o=0;o<e.length;++o)n[o]=e.charCodeAt(o);return n}if(At)return At.encode(e);var r=e.length,s=new _(e.length+(e.length>>1)),i=0,a=function(e){s[i++]=e};for(o=0;o<r;++o){if(i+5>s.length){var l=new _(i+8+(r-o<<1));l.set(s),s=l}var c=e.charCodeAt(o);c<128||t?a(c):c<2048?(a(192|c>>6),a(128|63&c)):c>55295&&c<57344?(c=65536+(1047552&c)|1023&e.charCodeAt(++o),a(240|c>>18),a(128|c>>12&63),a(128|c>>6&63),a(128|63&c)):(a(224|c>>12),a(128|c>>6&63),a(128|63&c))}return oe(s,0,i)}function kt(e,t){if(t){for(var n="",o=0;o<e.length;o+=16384)n+=String.fromCharCode.apply(null,e.subarray(o,o+16384));return n}if(St)return St.decode(e);var r=Tt(e),s=r[0],i=r[1];if(i.length)throw"invalid utf-8 data";return s}var _t=function(e){return 1==e?3:e<6?2:9==e?1:0},It=function(e,t){return t+30+Oe(e,t+26)+Oe(e,t+28)},Rt=function(e,t,n){var o=Oe(e,t+28),r=kt(e.subarray(t+46,t+46+o),!(2048&Oe(e,t+8))),s=t+46+o,i=Ve(e,t+20),a=n&&4294967295==i?Lt(e,s):[i,Ve(e,t+24),Ve(e,t+42)],l=a[0],c=a[1],u=a[2];return[Oe(e,t+10),l,c,r,s+Oe(e,t+30)+Oe(e,t+32),u]},Lt=function(e,t){for(;1!=Oe(e,t);t+=4+Oe(e,t+2));return[De(e,t+12),De(e,t+4),De(e,t+20)]},Nt=function(e){var t=0;if(e)for(var n in e){var o=e[n].length;if(o>65535)throw"extra field too long";t+=o+4}return t},Bt=function(e,t,n,o,r,s,i,a){var l=o.length,c=n.extra,u=a&&a.length,h=Nt(c);Fe(e,t,null!=i?33639248:67324752),t+=4,null!=i&&(e[t++]=20,e[t++]=n.os),e[t]=20,t+=2,e[t++]=n.flag<<1|(null==s&&8),e[t++]=r&&8,e[t++]=255&n.compression,e[t++]=n.compression>>8;var d=new Date(null==n.mtime?Date.now():n.mtime),p=d.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(Fe(e,t,p<<25|d.getMonth()+1<<21|d.getDate()<<16|d.getHours()<<11|d.getMinutes()<<5|d.getSeconds()>>>1),t+=4,null!=s&&(Fe(e,t,n.crc),Fe(e,t+4,s),Fe(e,t+8,n.size)),Fe(e,t+12,l),Fe(e,t+14,h),t+=16,null!=i&&(Fe(e,t,u),Fe(e,t+6,n.attrs),Fe(e,t+10,i),t+=14),e.set(o,t),t+=l,h)for(var m in c){var f=c[m],g=f.length;Fe(e,t,+m),Fe(e,t+2,g),e.set(f,t+4),t+=4+g}return u&&(e.set(a,t),t+=u),t},Ot=function(e,t,n,o,r){Fe(e,t,101010256),Fe(e,t+8,n),Fe(e,t+10,n),Fe(e,t+12,o),Fe(e,t+16,r)},Vt=function(){function e(e){this.filename=e,this.c=ye(),this.size=0,this.compression=0}return e.prototype.process=function(e,t){this.ondata(null,e,t)},e.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},e}(),Dt=function(){function e(e,t){var n=this;t||(t={}),Vt.call(this,e),this.d=new qe(t,(function(e,t){n.ondata(null,e,t)})),this.compression=8,this.flag=_t(t.level)}return e.prototype.process=function(e,t){try{this.d.push(e,t)}catch(Cs){this.ondata(Cs,null,t)}},e.prototype.push=function(e,t){Vt.prototype.push.call(this,e,t)},e}(),Ft=function(){function e(e,t){var n=this;t||(t={}),Vt.call(this,e),this.d=new Ke(t,(function(e,t,o){n.ondata(e,t,o)})),this.compression=8,this.flag=_t(t.level),this.terminate=this.d.terminate}return e.prototype.process=function(e,t){this.d.push(e,t)},e.prototype.push=function(e,t){Vt.prototype.push.call(this,e,t)},e}(),Ut=function(){function e(e){this.ondata=e,this.u=[],this.d=1}return e.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var n=Et(e.filename),o=n.length,r=e.comment,s=r&&Et(r),i=o!=e.filename.length||s&&r.length!=s.length,a=o+Nt(e.extra)+30;if(o>65535)throw"filename too long";var l=new _(a);Bt(l,0,e,n,i);var c=[l],u=function(){for(var e=0,n=c;e<n.length;e++){var o=n[e];t.ondata(null,o,!1)}c=[]},h=this.d;this.d=0;var d=this.u.length,p=be(e,{f:n,u:i,o:s,t:function(){e.terminate&&e.terminate()},r:function(){if(u(),h){var e=t.u[d+1];e?e.r():t.d=1}h=1}}),m=0;e.ondata=function(n,o,r){if(n)t.ondata(n,o,r),t.terminate();else if(m+=o.length,c.push(o),r){var s=new _(16);Fe(s,0,134695760),Fe(s,4,e.crc),Fe(s,8,m),Fe(s,12,e.size),c.push(s),p.c=m,p.b=a+m+16,p.crc=e.crc,p.size=e.size,h&&p.r(),h=1}else h&&u()},this.u.push(p)},e.prototype.end=function(){var e=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},e.prototype.e=function(){for(var e=0,t=0,n=0,o=0,r=this.u;o<r.length;o++){var s=r[o];n+=46+s.f.length+Nt(s.extra)+(s.o?s.o.length:0)}for(var i=new _(n+22),a=0,l=this.u;a<l.length;a++){s=l[a];Bt(i,e,s,s.f,s.u,s.c,t,s.o),e+=46+s.f.length+Nt(s.extra)+(s.o?s.o.length:0),t+=s.b}Ot(i,e,this.u.length,n,t),this.ondata(null,i,!0),this.d=2},e.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){var n=t[e];n.t()}this.d=2},e}();function zt(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";var o={};wt(e,"",o,t);var r=Object.keys(o),s=r.length,i=0,a=0,l=s,c=new Array(s),u=[],h=function(){for(var e=0;e<u.length;++e)u[e]()},d=function(){var e=new _(a+22),t=i,o=a-i;a=0;for(var r=0;r<l;++r){var s=c[r];try{var u=s.c.length;Bt(e,a,s,s.f,s.u,u);var h=30+s.f.length+Nt(s.extra),d=a+h;e.set(s.c,d),Bt(e,i,s,s.f,s.u,u,a,s.m),i+=16+h+(s.m?s.m.length:0),a=d+u}catch(Cs){return n(Cs,null)}}Ot(e,i,c.length,o,t),n(null,e)};s||d();for(var p=function(e){var t=r[e],l=o[t],p=l[0],m=l[1],f=ye(),g=p.length;f.p(p);var y=Et(t),v=y.length,x=m.comment,b=x&&Et(x),w=b&&b.length,A=Nt(m.extra),S=0==m.level?0:8,M=function(o,r){if(o)h(),n(o,null);else{var l=r.length;c[e]=be(m,{size:g,crc:f.d(),c:r,f:y,m:b,u:v!=t.length||b&&x.length!=w,compression:S}),i+=30+v+A+l,a+=76+2*(v+A)+(w||0)+l,--s||d()}};if(v>65535&&M("filename too long",null),S)if(g<16e4)try{M(null,Ze(p,m))}catch(Cs){M(Cs,null)}else u.push($e(p,m,M));else M(null,p)},m=0;m<l;++m)p(m);return h}function Ht(e,t){t||(t={});var n={},o=[];wt(e,"",n,t);var r=0,s=0;for(var i in n){var a=n[i],l=a[0],c=a[1],u=0==c.level?0:8,h=Et(i),d=h.length,p=c.comment,m=p&&Et(p),f=m&&m.length,g=Nt(c.extra);if(d>65535)throw"filename too long";var y=u?Ze(l,c):l,v=y.length,x=ye();x.p(l),o.push(be(c,{size:l.length,crc:x.d(),c:y,f:h,m:m,u:d!=i.length||m&&p.length!=f,o:r,compression:u})),r+=30+d+g+v,s+=76+2*(d+g)+(f||0)+v}for(var b=new _(s+22),w=r,A=s-r,S=0;S<o.length;++S){h=o[S];Bt(b,h.o,h,h.f,h.u,h.c.length);var M=30+h.f.length+Nt(h.extra);b.set(h.c,h.o+M),Bt(b,r,h,h.f,h.u,h.c.length,h.o,h.m),r+=16+M+(h.m?h.m.length:0)}return Ot(b,r,o.length,A,w),b}var jt=function(){function e(){}return e.prototype.push=function(e,t){this.ondata(null,e,t)},e.compression=0,e}(),Gt=function(){function e(){var e=this;this.i=new Ye((function(t,n){e.ondata(null,t,n)}))}return e.prototype.push=function(e,t){try{this.i.push(e,t)}catch(Cs){this.ondata(Cs,e,t)}},e.compression=8,e}(),Wt=function(){function e(e,t){var n=this;t<32e4?this.i=new Ye((function(e,t){n.ondata(null,e,t)})):(this.i=new Qe((function(e,t,o){n.ondata(e,t,o)})),this.terminate=this.i.terminate)}return e.prototype.push=function(e,t){this.i.terminate&&(e=oe(e,0)),this.i.push(e,t)},e.compression=8,e}(),Xt=function(){function e(e){this.onfile=e,this.k=[],this.o={0:jt},this.p=me}return e.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var o=Math.min(this.c,e.length),r=e.subarray(0,o);if(this.c-=o,this.d?this.d.push(r,!this.c):this.k[0].push(r),e=e.subarray(o),e.length)return this.push(e,t)}else{var s=0,i=0,a=void 0,l=void 0;this.p.length?e.length?(l=new _(this.p.length+e.length),l.set(this.p),l.set(e,this.p.length)):l=this.p:l=e;for(var c=l.length,u=this.c,h=u&&this.d,d=function(){var e,t=Ve(l,i);if(67324752==t){s=1,a=i,p.d=null,p.c=0;var o=Oe(l,i+6),r=Oe(l,i+8),h=2048&o,d=8&o,m=Oe(l,i+26),f=Oe(l,i+28);if(c>i+30+m+f){var g=[];p.k.unshift(g),s=2;var y,v=Ve(l,i+18),x=Ve(l,i+22),b=kt(l.subarray(i+30,i+=30+m),!h);4294967295==v?(e=d?[-2]:Lt(l,i),v=e[0],x=e[1]):d&&(v=-1),i+=f,p.c=v;var w={name:b,compression:r,start:function(){if(!w.ondata)throw"no callback";if(v){var e=n.o[r];if(!e)throw"unknown compression type "+r;y=v<0?new e(b):new e(b,v,x),y.ondata=function(e,t,n){w.ondata(e,t,n)};for(var t=0,o=g;t<o.length;t++){var s=o[t];y.push(s,!1)}n.k[0]==g&&n.c?n.d=y:y.push(me,!0)}else w.ondata(null,me,!0)},terminate:function(){y&&y.terminate&&y.terminate()}};v>=0&&(w.size=v,w.originalSize=x),p.onfile(w)}return"break"}if(u){if(134695760==t)return a=i+=12+(-2==u&&8),s=3,p.c=0,"break";if(33639248==t)return a=i-=4,s=3,p.c=0,"break"}},p=this;i<c-4;++i){var m=d();if("break"===m)break}if(this.p=me,u<0){var f=s?l.subarray(0,a-12-(-2==u&&8)-(134695760==Ve(l,a-16)&&4)):l.subarray(0,i);h?h.push(f,!!s):this.k[+(2==s)].push(f)}if(2&s)return this.push(l.subarray(i),t);this.p=l.subarray(i)}if(t){if(this.c)throw"invalid zip file";this.p=null}},e.prototype.register=function(e){this.o[e.compression]=e},e}();function qt(e,t){if("function"!=typeof t)throw"no callback";for(var n=[],o=function(){for(var e=0;e<n.length;++e)n[e]()},r={},s=e.length-22;101010256!=Ve(e,s);--s)if(!s||e.length-s>65558)return void t("invalid zip file",null);var i=Oe(e,s+8);i||t(null,{});var a=i,l=Ve(e,s+16),c=4294967295==l;if(c){if(s=Ve(e,s-12),101075792!=Ve(e,s))return void t("invalid zip file",null);a=i=Ve(e,s+32),l=Ve(e,s+48)}for(var u=function(a){var u=Rt(e,l,c),h=u[0],d=u[1],p=u[2],m=u[3],f=u[4],g=u[5],y=It(e,g);l=f;var v=function(e,n){e?(o(),t(e,null)):(r[m]=n,--i||t(null,r))};if(h)if(8==h){var x=e.subarray(y,y+d);if(d<32e4)try{v(null,et(x,new _(p)))}catch(s){v(s,null)}else n.push(Je(x,{size:p},v))}else v("unknown compression type "+h,null);else v(null,oe(e,y,y+d))},h=0;h<a;++h)u(h);return o}function Kt(e){for(var t={},n=e.length-22;101010256!=Ve(e,n);--n)if(!n||e.length-n>65558)throw"invalid zip file";var o=Oe(e,n+8);if(!o)return{};var r=Ve(e,n+16),s=4294967295==r;if(s){if(n=Ve(e,n-12),101075792!=Ve(e,n))throw"invalid zip file";o=Ve(e,n+32),r=Ve(e,n+48)}for(var i=0;i<o;++i){var a=Rt(e,r,s),l=a[0],c=a[1],u=a[2],h=a[3],d=a[4],p=a[5],m=It(e,p);if(r=d,l){if(8!=l)throw"unknown compression type "+l;t[h]=et(e.subarray(m,m+c),new _(u))}else t[h]=oe(e,m,m+c)}return t}function $t(e,t,n){const o=n.length-e-1;if(t>=n[o])return o-1;if(t<=n[e])return e;let r=e,s=o,i=Math.floor((r+s)/2);while(t<n[i]||t>=n[i+1])t<n[i]?s=i:r=i,i=Math.floor((r+s)/2);return i}function Zt(e,t,n,o){const r=[],s=[],i=[];r[0]=1;for(let a=1;a<=n;++a){s[a]=t-o[e+1-a],i[a]=o[e+a]-t;let n=0;for(let e=0;e<a;++e){const t=i[e+1],o=s[a-e],l=r[e]/(t+o);r[e]=n+t*l,n=o*l}r[a]=n}return r}function Yt(e,t,n,o){const r=$t(e,o,t),s=Zt(r,o,e,t),a=new i.Ltg(0,0,0,0);for(let i=0;i<=e;++i){const t=n[r-e+i],o=s[i],l=t.w*o;a.x+=t.x*l,a.y+=t.y*l,a.z+=t.z*l,a.w+=t.w*o}return a}function Qt(e,t,n,o,r){const s=[];for(let h=0;h<=n;++h)s[h]=0;const i=[];for(let h=0;h<=o;++h)i[h]=s.slice(0);const a=[];for(let h=0;h<=n;++h)a[h]=s.slice(0);a[0][0]=1;const l=s.slice(0),c=s.slice(0);for(let h=1;h<=n;++h){l[h]=t-r[e+1-h],c[h]=r[e+h]-t;let n=0;for(let e=0;e<h;++e){const t=c[e+1],o=l[h-e];a[h][e]=t+o;const r=a[e][h-1]/a[h][e];a[e][h]=n+t*r,n=o*r}a[h][h]=n}for(let h=0;h<=n;++h)i[0][h]=a[h][n];for(let h=0;h<=n;++h){let e=0,t=1;const r=[];for(let o=0;o<=n;++o)r[o]=s.slice(0);r[0][0]=1;for(let s=1;s<=o;++s){let o=0;const l=h-s,c=n-s;h>=s&&(r[t][0]=r[e][0]/a[c+1][l],o=r[t][0]*a[l][c]);const u=l>=-1?1:-l,d=h-1<=c?s-1:n-h;for(let n=u;n<=d;++n)r[t][n]=(r[e][n]-r[e][n-1])/a[c+1][l+n],o+=r[t][n]*a[l+n][c];h<=c&&(r[t][s]=-r[e][s-1]/a[c+1][h],o+=r[t][s]*a[h][c]),i[s][h]=o;const p=e;e=t,t=p}}let u=n;for(let h=1;h<=o;++h){for(let e=0;e<=n;++e)i[h][e]*=u;u*=n-h}return i}function Jt(e,t,n,o,r){const s=r<e?r:e,a=[],l=$t(e,o,t),c=Qt(l,o,e,s,t),u=[];for(let i=0;i<n.length;++i){const e=n[i].clone(),t=e.w;e.x*=t,e.y*=t,e.z*=t,u[i]=e}for(let i=0;i<=s;++i){const t=u[l-e].clone().multiplyScalar(c[i][0]);for(let n=1;n<=e;++n)t.add(u[l-e+n].clone().multiplyScalar(c[i][n]));a[i]=t}for(let h=s+1;h<=r+1;++h)a[h]=new i.Ltg(0,0,0);return a}function en(e,t){let n=1;for(let r=2;r<=e;++r)n*=r;let o=1;for(let r=2;r<=t;++r)o*=r;for(let r=2;r<=e-t;++r)o*=r;return n/o}function tn(e){const t=e.length,n=[],o=[];for(let s=0;s<t;++s){const t=e[s];n[s]=new i.Pa4(t.x,t.y,t.z),o[s]=t.w}const r=[];for(let s=0;s<t;++s){const e=n[s].clone();for(let t=1;t<=s;++t)e.sub(r[s-t].clone().multiplyScalar(en(s,t)*o[t]));r[s]=e.divideScalar(o[0])}return r}function nn(e,t,n,o,r){const s=Jt(e,t,n,o,r);return tn(s)}class on extends i.Hyl{constructor(e,t,n,o,r){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=o||0,this.endKnot=r||this.knots.length-1;for(let s=0;s<n.length;++s){const e=n[s];this.controlPoints[s]=new i.Ltg(e.x,e.y,e.z,e.w)}}getPoint(e,t=new i.Pa4){const n=t,o=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=Yt(this.degree,this.knots,this.controlPoints,o);return 1!==r.w&&r.divideScalar(r.w),n.set(r.x,r.y,r.z)}getTangent(e,t=new i.Pa4){const n=t,o=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=nn(this.degree,this.knots,this.controlPoints,o,1);return n.copy(r[1]).normalize(),n}}let rn,sn,an;class ln extends i.aNw{constructor(e){super(e)}load(e,t,n,o){const r=this,s=""===r.path?i.Zp0.extractUrlBase(e):r.path,a=new i.hH6(this.manager);a.setPath(r.path),a.setResponseType("arraybuffer"),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,(function(n){try{t(r.parse(n,s))}catch(Cs){o?o(Cs):console.error(Cs),r.manager.itemError(e)}}),n,o)}parse(e,t){if(gn(e))rn=(new pn).parse(e);else{const t=Cn(e);if(!yn(t))throw new Error("THREE.FBXLoader: Unknown format.");if(vn(t)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+vn(t));rn=(new dn).parse(t)}const n=new i.dpR(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new cn(n,this.manager).parse(rn)}}class cn{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){sn=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),o=this.parseDeformers(),r=(new un).parse(o);return this.parseScene(o,r,n),an}parseConnections(){const e=new Map;if("Connections"in rn){const t=rn.Connections.connections;t.forEach((function(t){const n=t[0],o=t[1],r=t[2];e.has(n)||e.set(n,{parents:[],children:[]});const s={ID:o,relationship:r};e.get(n).parents.push(s),e.has(o)||e.set(o,{parents:[],children:[]});const i={ID:n,relationship:r};e.get(o).children.push(i)}))}return e}parseImages(){const e={},t={};if("Video"in rn.Objects){const n=rn.Objects.Video;for(const o in n){const r=n[o],s=parseInt(o);if(e[s]=r.RelativeFilename||r.Filename,"Content"in r){const e=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,s="string"===typeof r.Content&&""!==r.Content;if(e||s){const e=this.parseImage(n[o]);t[r.RelativeFilename||r.Filename]=e}}}}for(const n in e){const o=e[n];void 0!==t[o]?e[n]=t[o]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,o=n.slice(n.lastIndexOf(".")+1).toLowerCase();let r;switch(o){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),r="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+o+'" is not supported.')}if("string"===typeof t)return"data:"+r+";base64,"+t;{const e=new Uint8Array(t);return window.URL.createObjectURL(new Blob([e],{type:r}))}}parseTextures(e){const t=new Map;if("Texture"in rn.Objects){const n=rn.Objects.Texture;for(const o in n){const r=this.parseTexture(n[o],e);t.set(parseInt(o),r)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const o=e.WrapModeU,r=e.WrapModeV,s=void 0!==o?o.value:0,a=void 0!==r?r.value:0;if(n.wrapS=0===s?i.rpg:i.uWy,n.wrapT=0===a?i.rpg:i.uWy,"Scaling"in e){const t=e.Scaling.value;n.repeat.x=t[0],n.repeat.y=t[1]}return n}loadTexture(e,t){let n;const o=this.textureLoader.path,r=sn.get(e.id).children;let s;void 0!==r&&r.length>0&&void 0!==t[r[0].ID]&&(n=t[r[0].ID],0!==n.indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));const a=e.FileName.slice(-3).toLowerCase();if("tga"===a){const t=this.manager.getHandler(".tga");null===t?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),s=new i.xEZ):(t.setPath(this.textureLoader.path),s=t.load(n))}else"psd"===a?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),s=new i.xEZ):s=this.textureLoader.load(n);return this.textureLoader.setPath(o),s}parseMaterials(e){const t=new Map;if("Material"in rn.Objects){const n=rn.Objects.Material;for(const o in n){const r=this.parseMaterial(n[o],e);null!==r&&t.set(parseInt(o),r)}}return t}parseMaterial(e,t){const n=e.id,o=e.attrName;let r=e.ShadingModel;if("object"===typeof r&&(r=r.value),!sn.has(n))return null;const s=this.parseParameters(e,t,n);let a;switch(r.toLowerCase()){case"phong":a=new i.xoR;break;case"lambert":a=new i.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),a=new i.xoR;break}return a.setValues(s),a.name=o,a}parseParameters(e,t,n){const o={};e.BumpFactor&&(o.bumpScale=e.BumpFactor.value),e.Diffuse?o.color=(new i.Ilk).fromArray(e.Diffuse.value):!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(o.color=(new i.Ilk).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(o.displacementScale=e.DisplacementFactor.value),e.Emissive?o.emissive=(new i.Ilk).fromArray(e.Emissive.value):!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(o.emissive=(new i.Ilk).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(o.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(o.opacity=parseFloat(e.Opacity.value)),o.opacity<1&&(o.transparent=!0),e.ReflectionFactor&&(o.reflectivity=e.ReflectionFactor.value),e.Shininess&&(o.shininess=e.Shininess.value),e.Specular?o.specular=(new i.Ilk).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(o.specular=(new i.Ilk).fromArray(e.SpecularColor.value));const r=this;return sn.get(n).children.forEach((function(e){const n=e.relationship;switch(n){case"Bump":o.bumpMap=r.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":o.aoMap=r.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":o.map=r.getTexture(t,e.ID),void 0!==o.map&&(o.map.encoding=i.knz);break;case"DisplacementColor":o.displacementMap=r.getTexture(t,e.ID);break;case"EmissiveColor":o.emissiveMap=r.getTexture(t,e.ID),void 0!==o.emissiveMap&&(o.emissiveMap.encoding=i.knz);break;case"NormalMap":case"Maya|TEX_normal_map":o.normalMap=r.getTexture(t,e.ID);break;case"ReflectionColor":o.envMap=r.getTexture(t,e.ID),void 0!==o.envMap&&(o.envMap.mapping=i.dSO,o.envMap.encoding=i.knz);break;case"SpecularColor":o.specularMap=r.getTexture(t,e.ID),void 0!==o.specularMap&&(o.specularMap.encoding=i.knz);break;case"TransparentColor":case"TransparencyFactor":o.alphaMap=r.getTexture(t,e.ID),o.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",n);break}})),o}getTexture(e,t){return"LayeredTexture"in rn.Objects&&t in rn.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=sn.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in rn.Objects){const n=rn.Objects.Deformer;for(const o in n){const r=n[o],s=sn.get(parseInt(o));if("Skin"===r.attrType){const t=this.parseSkeleton(s,n);t.ID=o,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=s.parents[0].ID,e[o]=t}else if("BlendShape"===r.attrType){const e={id:o};e.rawTargets=this.parseMorphTargets(s,n),e.id=o,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[o]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach((function(e){const o=t[e.ID];if("Cluster"!==o.attrType)return;const r={ID:e.ID,indices:[],weights:[],transformLink:(new i.yGw).fromArray(o.TransformLink.a)};"Indexes"in o&&(r.indices=o.Indexes.a,r.weights=o.Weights.a),n.push(r)})),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let o=0;o<e.children.length;o++){const r=e.children[o],s=t[r.ID],i={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if("BlendShapeChannel"!==s.attrType)return;i.geoID=sn.get(parseInt(r.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,n.push(i)}return n}parseScene(e,t,n){an=new i.ZAu;const o=this.parseModels(e.skeletons,t,n),r=rn.Objects.Model,s=this;o.forEach((function(e){const t=r[e.ID];s.setLookAtProperties(e,t);const n=sn.get(e.ID).parents;n.forEach((function(t){const n=o.get(t.ID);void 0!==n&&n.add(e)})),null===e.parent&&an.add(e)})),this.bindSkeleton(e.skeletons,t,o),this.createAmbientLight(),an.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);const t=Mn(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));const a=(new hn).parse();1===an.children.length&&an.children[0].isGroup&&(an.children[0].animations=a,an=an.children[0]),an.animations=a}parseModels(e,t,n){const o=new Map,r=rn.Objects.Model;for(const s in r){const a=parseInt(s),l=r[s],c=sn.get(a);let u=this.buildSkeleton(c,e,a,l.attrName);if(!u){switch(l.attrType){case"Camera":u=this.createCamera(c);break;case"Light":u=this.createLight(c);break;case"Mesh":u=this.createMesh(c,t,n);break;case"NurbsCurve":u=this.createCurve(c,t);break;case"LimbNode":case"Root":u=new i.N$j;break;case"Null":default:u=new i.ZAu;break}u.name=l.attrName?i.iUV.sanitizeNodeName(l.attrName):"",u.ID=a}this.getTransformData(u,l),o.set(a,u)}return o}buildSkeleton(e,t,n,o){let r=null;return e.parents.forEach((function(e){for(const s in t){const a=t[s];a.rawBones.forEach((function(t,s){if(t.ID===e.ID){const e=r;r=new i.N$j,r.matrixWorld.copy(t.transformLink),r.name=o?i.iUV.sanitizeNodeName(o):"",r.ID=n,a.bones[s]=r,null!==e&&r.add(e)}}))}})),r}createCamera(e){let t,n;if(e.children.forEach((function(e){const t=rn.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)})),void 0===n)t=new i.Tme;else{let e=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(e=1);let o=1;void 0!==n.NearPlane&&(o=n.NearPlane.value/1e3);let r=1e3;void 0!==n.FarPlane&&(r=n.FarPlane.value/1e3);let s=window.innerWidth,a=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(s=n.AspectWidth.value,a=n.AspectHeight.value);const l=s/a;let c=45;void 0!==n.FieldOfView&&(c=n.FieldOfView.value);const u=n.FocalLength?n.FocalLength.value:null;switch(e){case 0:t=new i.cPb(c,l,o,r),null!==u&&t.setFocalLength(u);break;case 1:t=new i.iKG(-s/2,s/2,a/2,-a/2,o,r);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),t=new i.Tme;break}}return t}createLight(e){let t,n;if(e.children.forEach((function(e){const t=rn.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)})),void 0===n)t=new i.Tme;else{let e;e=void 0===n.LightType?0:n.LightType.value;let o=16777215;void 0!==n.Color&&(o=(new i.Ilk).fromArray(n.Color.value));let r=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(r=0);let s=0;void 0!==n.FarAttenuationEnd&&(s=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);const a=1;switch(e){case 0:t=new i.cek(o,r,s,a);break;case 1:t=new i.Ox3(o,r);break;case 2:let e=Math.PI/3;void 0!==n.InnerAngle&&(e=i.M8C.degToRad(n.InnerAngle.value));let l=0;void 0!==n.OuterAngle&&(l=i.M8C.degToRad(n.OuterAngle.value),l=Math.max(l,1)),t=new i.PMe(o,r,s,e,l,a);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new i.cek(o,r);break}void 0!==n.CastShadows&&1===n.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,n){let o,r=null,s=null;const a=[];return e.children.forEach((function(e){t.has(e.ID)&&(r=t.get(e.ID)),n.has(e.ID)&&a.push(n.get(e.ID))})),a.length>1?s=a:a.length>0?s=a[0]:(s=new i.xoR({color:13421772}),a.push(s)),"color"in r.attributes&&a.forEach((function(e){e.vertexColors=!0})),r.FBX_Deformer?(o=new i.TUv(r,s),o.normalizeSkinWeights()):o=new i.Kj0(r,s),o}createCurve(e,t){const n=e.children.reduce((function(e,n){return t.has(n.ID)&&(e=t.get(n.ID)),e}),null),o=new i.nls({color:3342591,linewidth:1});return new i.x12(n,o)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?Tn(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){if("LookAtProperty"in t){const t=sn.get(e.ID).children;t.forEach((function(t){if("LookAtProperty"===t.relationship){const n=rn.Objects.Model[t.ID];if("Lcl_Translation"in n){const t=n.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(t),an.add(e.target)):e.lookAt((new i.Pa4).fromArray(t))}}}))}}bindSkeleton(e,t,n){const o=this.parsePoseNodes();for(const r in e){const s=e[r],a=sn.get(parseInt(s.ID)).parents;a.forEach((function(e){if(t.has(e.ID)){const t=e.ID,r=sn.get(t);r.parents.forEach((function(e){if(n.has(e.ID)){const t=n.get(e.ID);t.bind(new i.OdW(s.bones),o[e.ID])}}))}}))}}parsePoseNodes(){const e={};if("Pose"in rn.Objects){const t=rn.Objects.Pose;for(const n in t)if("BindPose"===t[n].attrType&&t[n].NbPoseNodes>0){const o=t[n].PoseNode;Array.isArray(o)?o.forEach((function(t){e[t.Node]=(new i.yGw).fromArray(t.Matrix.a)})):e[o.Node]=(new i.yGw).fromArray(o.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in rn&&"AmbientColor"in rn.GlobalSettings){const e=rn.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],o=e[2];if(0!==t||0!==n||0!==o){const e=new i.Ilk(t,n,o);an.add(new i.Mig(e,1))}}}}class un{parse(e){const t=new Map;if("Geometry"in rn.Objects){const n=rn.Objects.Geometry;for(const o in n){const r=sn.get(parseInt(o)),s=this.parseGeometry(r,n[o],e);t.set(parseInt(o),s)}}return t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const o=n.skeletons,r=[],s=e.parents.map((function(e){return rn.Objects.Model[e.ID]}));if(0===s.length)return;const i=e.children.reduce((function(e,t){return void 0!==o[t.ID]&&(e=o[t.ID]),e}),null);e.children.forEach((function(e){void 0!==n.morphTargets[e.ID]&&r.push(n.morphTargets[e.ID])}));const a=s[0],l={};"RotationOrder"in a&&(l.eulerOrder=Tn(a.RotationOrder.value)),"InheritType"in a&&(l.inheritType=parseInt(a.InheritType.value)),"GeometricTranslation"in a&&(l.translation=a.GeometricTranslation.value),"GeometricRotation"in a&&(l.rotation=a.GeometricRotation.value),"GeometricScaling"in a&&(l.scale=a.GeometricScaling.value);const c=Mn(l);return this.genGeometry(t,i,r,c)}genGeometry(e,t,n,o){const r=new i.u9r;e.attrName&&(r.name=e.attrName);const s=this.parseGeoNode(e,t),a=this.genBuffers(s),l=new i.a$l(a.vertex,3);if(l.applyMatrix4(o),r.setAttribute("position",l),a.colors.length>0&&r.setAttribute("color",new i.a$l(a.colors,3)),t&&(r.setAttribute("skinIndex",new i.qlB(a.weightsIndices,4)),r.setAttribute("skinWeight",new i.a$l(a.vertexWeights,4)),r.FBX_Deformer=t),a.normal.length>0){const e=(new i.Vkp).getNormalMatrix(o),t=new i.a$l(a.normal,3);t.applyNormalMatrix(e),r.setAttribute("normal",t)}if(a.uvs.forEach((function(e,t){let n="uv"+(t+1).toString();0===t&&(n="uv"),r.setAttribute(n,new i.a$l(a.uvs[t],2))})),s.material&&"AllSame"!==s.material.mappingType){let e=a.materialIndex[0],t=0;if(a.materialIndex.forEach((function(n,o){n!==e&&(r.addGroup(t,o-t,e),e=n,t=o)})),r.groups.length>0){const t=r.groups[r.groups.length-1],n=t.start+t.count;n!==a.materialIndex.length&&r.addGroup(n,a.materialIndex.length-n,e)}0===r.groups.length&&r.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(r,e,n,o),r}parseGeoNode(e,t){const n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let t=0;while(e.LayerElementUV[t])e.LayerElementUV[t].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return n.weightTable={},null!==t&&(n.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(o,r){void 0===n.weightTable[o]&&(n.weightTable[o]=[]),n.weightTable[o].push({id:t,weight:e.weights[r]})}))}))),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,o=0,r=!1,s=[],i=[],a=[],l=[],c=[],u=[];const h=this;return e.vertexIndices.forEach((function(d,p){let m,f=!1;d<0&&(d^=-1,f=!0);let g=[],y=[];if(s.push(3*d,3*d+1,3*d+2),e.color){const t=wn(p,n,d,e.color);a.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[d]&&e.weightTable[d].forEach((function(e){y.push(e.weight),g.push(e.id)})),y.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);const e=[0,0,0,0],t=[0,0,0,0];y.forEach((function(n,o){let r=n,s=g[o];t.forEach((function(t,n,o){if(r>t){o[n]=r,r=t;const i=e[n];e[n]=s,s=i}}))})),g=e,y=t}while(y.length<4)y.push(0),g.push(0);for(let e=0;e<4;++e)c.push(y[e]),u.push(g[e])}if(e.normal){const t=wn(p,n,d,e.normal);i.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(m=wn(p,n,d,e.material)[0]),e.uv&&e.uv.forEach((function(e,t){const o=wn(p,n,d,e);void 0===l[t]&&(l[t]=[]),l[t].push(o[0]),l[t].push(o[1])})),o++,f&&(h.genFace(t,e,s,m,i,a,l,c,u,o),n++,o=0,s=[],i=[],a=[],l=[],c=[],u=[])})),t}genFace(e,t,n,o,r,s,i,a,l,c){for(let u=2;u<c;u++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(u-1)]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+2]]),e.vertex.push(t.vertexPositions[n[3*u]]),e.vertex.push(t.vertexPositions[n[3*u+1]]),e.vertex.push(t.vertexPositions[n[3*u+2]]),t.skeleton&&(e.vertexWeights.push(a[0]),e.vertexWeights.push(a[1]),e.vertexWeights.push(a[2]),e.vertexWeights.push(a[3]),e.vertexWeights.push(a[4*(u-1)]),e.vertexWeights.push(a[4*(u-1)+1]),e.vertexWeights.push(a[4*(u-1)+2]),e.vertexWeights.push(a[4*(u-1)+3]),e.vertexWeights.push(a[4*u]),e.vertexWeights.push(a[4*u+1]),e.vertexWeights.push(a[4*u+2]),e.vertexWeights.push(a[4*u+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[4*(u-1)]),e.weightsIndices.push(l[4*(u-1)+1]),e.weightsIndices.push(l[4*(u-1)+2]),e.weightsIndices.push(l[4*(u-1)+3]),e.weightsIndices.push(l[4*u]),e.weightsIndices.push(l[4*u+1]),e.weightsIndices.push(l[4*u+2]),e.weightsIndices.push(l[4*u+3])),t.color&&(e.colors.push(s[0]),e.colors.push(s[1]),e.colors.push(s[2]),e.colors.push(s[3*(u-1)]),e.colors.push(s[3*(u-1)+1]),e.colors.push(s[3*(u-1)+2]),e.colors.push(s[3*u]),e.colors.push(s[3*u+1]),e.colors.push(s[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(o),e.materialIndex.push(o),e.materialIndex.push(o)),t.normal&&(e.normal.push(r[0]),e.normal.push(r[1]),e.normal.push(r[2]),e.normal.push(r[3*(u-1)]),e.normal.push(r[3*(u-1)+1]),e.normal.push(r[3*(u-1)+2]),e.normal.push(r[3*u]),e.normal.push(r[3*u+1]),e.normal.push(r[3*u+2])),t.uv&&t.uv.forEach((function(t,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(i[n][0]),e.uvs[n].push(i[n][1]),e.uvs[n].push(i[n][2*(u-1)]),e.uvs[n].push(i[n][2*(u-1)+1]),e.uvs[n].push(i[n][2*u]),e.uvs[n].push(i[n][2*u+1])}))}addMorphTargets(e,t,n,o){if(0===n.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const r=this;n.forEach((function(n){n.rawTargets.forEach((function(n){const s=rn.Objects.Geometry[n.geoID];void 0!==s&&r.genMorphGeometry(e,t,s,o,n.name)}))}))}genMorphGeometry(e,t,n,o,r){const s=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],a=void 0!==n.Vertices?n.Vertices.a:[],l=void 0!==n.Indexes?n.Indexes.a:[],c=3*e.attributes.position.count,u=new Float32Array(c);for(let i=0;i<l.length;i++){const e=3*l[i];u[e]=a[3*i],u[e+1]=a[3*i+1],u[e+2]=a[3*i+2]}const h={vertexIndices:s,vertexPositions:u},d=this.genBuffers(h),p=new i.a$l(d.vertex,3);p.name=r||n.attrName,p.applyMatrix4(o),e.morphAttributes.position.push(p)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,o=e.Normals.a;let r=[];return"IndexToDirect"===n&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:o,indices:r,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,o=e.UV.a;let r=[];return"IndexToDirect"===n&&(r=e.UVIndex.a),{dataSize:2,buffer:o,indices:r,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,o=e.Colors.a;let r=[];return"IndexToDirect"===n&&(r=e.ColorIndex.a),{dataSize:4,buffer:o,indices:r,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const o=e.Materials.a,r=[];for(let s=0;s<o.length;++s)r.push(s);return{dataSize:1,buffer:o,indices:r,mappingType:t,referenceType:n}}parseNurbsGeometry(e){if(void 0===on)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new i.u9r;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new i.u9r;const n=t-1,o=e.KnotVector.a,r=[],s=e.Points.a;for(let h=0,d=s.length;h<d;h+=4)r.push((new i.Ltg).fromArray(s,h));let a,l;if("Closed"===e.Form)r.push(r[0]);else if("Periodic"===e.Form){a=n,l=o.length-1-a;for(let e=0;e<n;++e)r.push(r[e])}const c=new on(n,o,r,a,l),u=c.getPoints(12*r.length);return(new i.u9r).setFromPoints(u)}}class hn{parse(){const e=[],t=this.parseClips();if(void 0!==t)for(const n in t){const o=t[n],r=this.addClip(o);e.push(r)}return e}parseClips(){if(void 0===rn.Objects.AnimationCurve)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e),n=this.parseAnimStacks(t);return n}parseAnimationCurveNodes(){const e=rn.Objects.AnimationCurveNode,t=new Map;for(const n in e){const o=e[n];if(null!==o.attrName.match(/S|R|T|DeformPercent/)){const e={id:o.id,attr:o.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){const t=rn.Objects.AnimationCurve;for(const n in t){const o={id:t[n].id,times:t[n].KeyTime.a.map(xn),values:t[n].KeyValueFloat.a},r=sn.get(o.id);if(void 0!==r){const t=r.parents[0].ID,n=r.parents[0].relationship;n.match(/X/)?e.get(t).curves["x"]=o:n.match(/Y/)?e.get(t).curves["y"]=o:n.match(/Z/)?e.get(t).curves["z"]=o:n.match(/d|DeformPercent/)&&e.has(t)&&(e.get(t).curves["morph"]=o)}}}parseAnimationLayers(e){const t=rn.Objects.AnimationLayer,n=new Map;for(const o in t){const t=[],r=sn.get(parseInt(o));if(void 0!==r){const s=r.children;s.forEach((function(n,o){if(e.has(n.ID)){const r=e.get(n.ID);if(void 0!==r.curves.x||void 0!==r.curves.y||void 0!==r.curves.z){if(void 0===t[o]){const e=sn.get(n.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==e){const r=rn.Objects.Model[e.toString()];if(void 0===r)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",n);const s={modelName:r.attrName?i.iUV.sanitizeNodeName(r.attrName):"",ID:r.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};an.traverse((function(e){e.ID===r.id&&(s.transform=e.matrix,e.userData.transformData&&(s.eulerOrder=e.userData.transformData.eulerOrder))})),s.transform||(s.transform=new i.yGw),"PreRotation"in r&&(s.preRotation=r.PreRotation.value),"PostRotation"in r&&(s.postRotation=r.PostRotation.value),t[o]=s}}t[o]&&(t[o][r.attr]=r)}else if(void 0!==r.curves.morph){if(void 0===t[o]){const e=sn.get(n.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,r=sn.get(e).parents[0].ID,s=sn.get(r).parents[0].ID,a=sn.get(s).parents[0].ID,l=rn.Objects.Model[a],c={modelName:l.attrName?i.iUV.sanitizeNodeName(l.attrName):"",morphName:rn.Objects.Deformer[e].attrName};t[o]=c}t[o][r.attr]=r}}})),n.set(parseInt(o),t)}}return n}parseAnimStacks(e){const t=rn.Objects.AnimationStack,n={};for(const o in t){const r=sn.get(parseInt(o)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const s=e.get(r[0].ID);n[o]={name:t[o].attrName,layer:s}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach((function(e){t=t.concat(n.generateTracks(e))})),new i.m7l(e.name,-1,t)}generateTracks(e){const t=[];let n=new i.Pa4,o=new i._fP,r=new i.Pa4;if(e.transform&&e.transform.decompose(n,o,r),n=n.toArray(),o=(new i.USm).setFromQuaternion(o,e.eulerOrder).toArray(),r=r.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");void 0!==o&&t.push(o)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){const n=this.generateRotationTrack(e.modelName,e.R.curves,o,e.preRotation,e.postRotation,e.eulerOrder);void 0!==n&&t.push(n)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){const n=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");void 0!==n&&t.push(n)}if(void 0!==e.DeformPercent){const n=this.generateMorphTrack(e);void 0!==n&&t.push(n)}return t}generateVectorTrack(e,t,n,o){const r=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(r,t,n);return new i.yC1(e+"."+o,r,s)}generateRotationTrack(e,t,n,o,r,s){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(i.M8C.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(i.M8C.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(i.M8C.degToRad));const a=this.getTimesForAllAxes(t),l=this.getKeyframeTrackValues(a,t,n);void 0!==o&&(o=o.map(i.M8C.degToRad),o.push(s),o=(new i.USm).fromArray(o),o=(new i._fP).setFromEuler(o)),void 0!==r&&(r=r.map(i.M8C.degToRad),r.push(s),r=(new i.USm).fromArray(r),r=(new i._fP).setFromEuler(r).invert());const c=new i._fP,u=new i.USm,h=[];for(let i=0;i<l.length;i+=3)u.set(l[i],l[i+1],l[i+2],s),c.setFromEuler(u),void 0!==o&&c.premultiply(o),void 0!==r&&c.multiply(r),c.toArray(h,i/3*4);return new i.iLg(e+".quaternion",a,h)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map((function(e){return e/100})),o=an.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new i.dUE(e.modelName+".morphTargetInfluences["+o+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})),t.length>1){let e=1,n=t[0];for(let o=1;o<t.length;o++){const r=t[o];r!==n&&(t[e]=r,n=r,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,n){const o=n,r=[];let s=-1,i=-1,a=-1;return e.forEach((function(e){if(t.x&&(s=t.x.times.indexOf(e)),t.y&&(i=t.y.times.indexOf(e)),t.z&&(a=t.z.times.indexOf(e)),-1!==s){const e=t.x.values[s];r.push(e),o[0]=e}else r.push(o[0]);if(-1!==i){const e=t.y.values[i];r.push(e),o[1]=e}else r.push(o[1]);if(-1!==a){const e=t.z.values[a];r.push(e),o[2]=e}else r.push(o[2])})),r}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],o=e.values[t]-n,r=Math.abs(o);if(r>=180){const s=r/180,i=o/s;let a=n+i;const l=e.times[t-1],c=e.times[t]-l,u=c/s;let h=l+u;const d=[],p=[];while(h<e.times[t])d.push(h),h+=u,p.push(a),a+=i;e.times=_n(e.times,t,d),e.values=_n(e.values,t,p)}}}}class dn{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new fn,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach((function(e,o){const r=e.match(/^[\s\t]*;/),s=e.match(/^[\s\t]*$/);if(r||s)return;const i=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),a=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");i?t.parseNodeBegin(e,i):a?t.parseNodeProperty(e,a,n[++o]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)})),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),o=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),r={name:n},s=this.parseNodeAttr(o),i=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,r):n in i?("PoseNode"===n?i.PoseNode.push(r):void 0!==i[n].id&&(i[n]={},i[n][i[n].id]=i[n]),""!==s.id&&(i[n][s.id]=r)):"number"===typeof s.id?(i[n]={},i[n][s.id]=r):"Properties70"!==n&&(i[n]="PoseNode"===n?[r]:r),"number"===typeof s.id&&(r.id=s.id),""!==s.name&&(r.attrName=s.name),""!==s.type&&(r.attrType=s.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",o="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),o=e[2]),{id:t,name:n,type:o}}parseNodeProperty(e,t,n){let o=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===o&&","===r&&(r=n.replace(/"/g,"").replace(/,$/,"").trim());const s=this.getCurrentNode(),i=s.name;if("Properties70"!==i){if("C"===o){const e=r.split(",").slice(1),t=parseInt(e[0]),n=parseInt(e[1]);let i=r.split(",").slice(3);i=i.map((function(e){return e.trim().replace(/^"/,"")})),o="connections",r=[t,n],En(r,i),void 0===s[o]&&(s[o]=[])}"Node"===o&&(s.id=r),o in s&&Array.isArray(s[o])?s[o].push(r):"a"!==o?s[o]=r:s.a=r,this.setCurrentProp(s,o),"a"===o&&","!==r.slice(-1)&&(s.a=Pn(r))}else this.parseNodeSpecialProperty(e,o,r)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=Pn(t.a))}parseNodeSpecialProperty(e,t,n){const o=n.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),r=o[0],s=o[1],i=o[2],a=o[3];let l=o[4];switch(s){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=Pn(l);break}this.getPrevNode()[r]={type:s,type2:i,flag:a,value:l},this.setCurrentProp(this.getPrevNode(),r)}}class pn{parse(e){const t=new mn(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const o=new fn;while(!this.endOfContent(t)){const e=this.parseNode(t,n);null!==e&&o.add(e.name,e)}return o}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},o=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const s=e.getUint8(),i=e.getString(s);if(0===o)return null;const a=[];for(let h=0;h<r;h++)a.push(this.parseProperty(e));const l=a.length>0?a[0]:"",c=a.length>1?a[1]:"",u=a.length>2?a[2]:"";n.singleProperty=1===r&&e.getOffset()===o;while(o>e.getOffset()){const o=this.parseNode(e,t);null!==o&&this.parseSubNode(i,n,o)}return n.propertyList=a,"number"===typeof l&&(n.id=l),""!==c&&(n.attrName=c),""!==u&&(n.attrType=u),""!==i&&(n.name=i),n}parseSubNode(e,t,n){if(!0===n.singleProperty){const e=n.propertyList[0];Array.isArray(e)?(t[n.name]=n,n.a=e):t[n.name]=e}else if("Connections"===e&&"C"===n.name){const e=[];n.propertyList.forEach((function(t,n){0!==n&&e.push(t)})),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===n.name){const e=Object.keys(n);e.forEach((function(e){t[e]=n[e]}))}else if("Properties70"===e&&"P"===n.name){let e=n.propertyList[0],o=n.propertyList[1];const r=n.propertyList[2],s=n.propertyList[3];let i;0===e.indexOf("Lcl ")&&(e=e.replace("Lcl ","Lcl_")),0===o.indexOf("Lcl ")&&(o=o.replace("Lcl ","Lcl_")),i="Color"===o||"ColorRGB"===o||"Vector"===o||"Vector3D"===o||0===o.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[e]={type:o,type2:r,flag:s,value:i}}else void 0===t[n.name]?"number"===typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=e.getUint32(),s=e.getUint32(),i=e.getUint32();if(0===s)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}"undefined"===typeof o&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const a=gt(new Uint8Array(e.getArrayBuffer(i))),l=new mn(a.buffer);switch(t){case"b":case"c":return l.getBooleanArray(r);case"d":return l.getFloat64Array(r);case"f":return l.getFloat32Array(r);case"i":return l.getInt32Array(r);case"l":return l.getInt64Array(r)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class mn{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return 1===(1&this.getUint8())}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let o=0;o<e;o++)t[o]=this.getUint8();const n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),i.Zp0.decodeText(new Uint8Array(t))}}class fn{add(e,t){this[e]=t}}function gn(e){const t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===Cn(e,0,t.length)}function yn(e){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function o(t){const o=e[t-1];return e=e.slice(n+t),n++,o}for(let r=0;r<t.length;++r){const e=o(1);if(e===t[r])return!1}return!0}function vn(e){const t=/FBXVersion: (\d+)/,n=e.match(t);if(n){const e=parseInt(n[1]);return e}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function xn(e){return e/46186158e3}const bn=[];function wn(e,t,n,o){let r;switch(o.mappingType){case"ByPolygonVertex":r=e;break;case"ByPolygon":r=t;break;case"ByVertice":r=n;break;case"AllSame":r=o.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+o.mappingType)}"IndexToDirect"===o.referenceType&&(r=o.indices[r]);const s=r*o.dataSize,i=s+o.dataSize;return kn(bn,o.buffer,s,i)}const An=new i.USm,Sn=new i.Pa4;function Mn(e){const t=new i.yGw,n=new i.yGw,o=new i.yGw,r=new i.yGw,s=new i.yGw,a=new i.yGw,l=new i.yGw,c=new i.yGw,u=new i.yGw,h=new i.yGw,d=new i.yGw,p=new i.yGw,m=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(Sn.fromArray(e.translation)),e.preRotation){const t=e.preRotation.map(i.M8C.degToRad);t.push(e.eulerOrder),n.makeRotationFromEuler(An.fromArray(t))}if(e.rotation){const t=e.rotation.map(i.M8C.degToRad);t.push(e.eulerOrder),o.makeRotationFromEuler(An.fromArray(t))}if(e.postRotation){const t=e.postRotation.map(i.M8C.degToRad);t.push(e.eulerOrder),r.makeRotationFromEuler(An.fromArray(t)),r.invert()}e.scale&&s.scale(Sn.fromArray(e.scale)),e.scalingOffset&&l.setPosition(Sn.fromArray(e.scalingOffset)),e.scalingPivot&&a.setPosition(Sn.fromArray(e.scalingPivot)),e.rotationOffset&&c.setPosition(Sn.fromArray(e.rotationOffset)),e.rotationPivot&&u.setPosition(Sn.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(d.copy(e.parentMatrix),h.copy(e.parentMatrixWorld));const f=n.clone().multiply(o).multiply(r),g=new i.yGw;g.extractRotation(h);const y=new i.yGw;y.copyPosition(h);const v=y.clone().invert().multiply(h),x=g.clone().invert().multiply(v),b=s,w=new i.yGw;if(0===m)w.copy(g).multiply(f).multiply(x).multiply(b);else if(1===m)w.copy(g).multiply(x).multiply(f).multiply(b);else{const e=(new i.yGw).scale((new i.Pa4).setFromMatrixScale(d)),t=e.clone().invert(),n=x.clone().multiply(t);w.copy(g).multiply(f).multiply(n).multiply(b)}const A=u.clone().invert(),S=a.clone().invert();let M=t.clone().multiply(c).multiply(u).multiply(n).multiply(o).multiply(r).multiply(A).multiply(l).multiply(a).multiply(s).multiply(S);const T=(new i.yGw).copyPosition(M),P=h.clone().multiply(T);return p.copyPosition(P),M=p.clone().multiply(w),M.premultiply(h.invert()),M}function Tn(e){e=e||0;const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===e?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function Pn(e){const t=e.split(",").map((function(e){return parseFloat(e)}));return t}function Cn(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),i.Zp0.decodeText(new Uint8Array(e,t,n))}function En(e,t){for(let n=0,o=e.length,r=t.length;n<r;n++,o++)e[o]=t[n]}function kn(e,t,n,o){for(let r=n,s=0;r<o;r++,s++)e[s]=t[r];return e}function _n(e,t,n){return e.slice(0,t).concat(n).concat(e.slice(t))}class In extends i.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new On(e)})),this.register((function(e){return new Hn(e)})),this.register((function(e){return new jn(e)})),this.register((function(e){return new Vn(e)})),this.register((function(e){return new Dn(e)})),this.register((function(e){return new Fn(e)})),this.register((function(e){return new Un(e)})),this.register((function(e){return new zn(e)})),this.register((function(e){return new Nn(e)})),this.register((function(e){return new Gn(e)}))}load(e,t,n,o){const r=this;let s;s=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:i.Zp0.extractUrlBase(e),this.manager.itemStart(e);const a=function(t){o?o(t):console.error(t),r.manager.itemError(e),r.manager.itemEnd(e)},l=new i.hH6(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,(function(n){try{r.parse(n,s,(function(n){t(n),r.manager.itemEnd(e)}),a)}catch(Cs){a(Cs)}}),n,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,o){let r;const s={},a={};if("string"===typeof e)r=e;else{const t=i.Zp0.decodeText(new Uint8Array(e,0,4));if(t===Wn){try{s[Ln.KHR_BINARY_GLTF]=new Kn(e)}catch(u){return void(o&&o(u))}r=s[Ln.KHR_BINARY_GLTF].content}else r=i.Zp0.decodeText(new Uint8Array(e))}const l=JSON.parse(r);if(void 0===l.asset||l.asset.version[0]<2)return void(o&&o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const c=new wo(l,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let i=0;i<this.pluginCallbacks.length;i++){const e=this.pluginCallbacks[i](c);a[e.name]=e,s[e.name]=!0}if(l.extensionsUsed)for(let i=0;i<l.extensionsUsed.length;++i){const e=l.extensionsUsed[i],t=l.extensionsRequired||[];switch(e){case Ln.KHR_MATERIALS_UNLIT:s[e]=new Bn;break;case Ln.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[e]=new Qn;break;case Ln.KHR_DRACO_MESH_COMPRESSION:s[e]=new $n(l,this.dracoLoader);break;case Ln.KHR_TEXTURE_TRANSFORM:s[e]=new Zn;break;case Ln.KHR_MESH_QUANTIZATION:s[e]=new Jn;break;default:t.indexOf(e)>=0&&void 0===a[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}c.setExtensions(s),c.setPlugins(a),c.parse(n,o)}parseAsync(e,t){const n=this;return new Promise((function(o,r){n.parse(e,t,o,r)}))}}function Rn(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const Ln={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class Nn{constructor(e){this.parser=e,this.name=Ln.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,o=t.length;n<o;n++){const o=t[n];o.extensions&&o.extensions[this.name]&&void 0!==o.extensions[this.name].light&&e._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let o=t.cache.get(n);if(o)return o;const r=t.json,s=r.extensions&&r.extensions[this.name]||{},a=s.lights||[],l=a[e];let c;const u=new i.Ilk(16777215);void 0!==l.color&&u.fromArray(l.color);const h=void 0!==l.range?l.range:0;switch(l.type){case"directional":c=new i.Ox3(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new i.cek(u),c.distance=h;break;case"spot":c=new i.PMe(u),c.distance=h,l.spot=l.spot||{},l.spot.innerConeAngle=void 0!==l.spot.innerConeAngle?l.spot.innerConeAngle:0,l.spot.outerConeAngle=void 0!==l.spot.outerConeAngle?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,void 0!==l.intensity&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),o=Promise.resolve(c),t.cache.add(n,o),o}createNodeAttachment(e){const t=this,n=this.parser,o=n.json,r=o.nodes[e],s=r.extensions&&r.extensions[this.name]||{},i=s.light;return void 0===i?null:this._loadLight(i).then((function(e){return n._getNodeRef(t.cache,i,e)}))}}class Bn{constructor(){this.name=Ln.KHR_MATERIALS_UNLIT}getMaterialType(){return i.vBJ}extendParams(e,t,n){const o=[];e.color=new i.Ilk(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const t=r.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==r.baseColorTexture&&o.push(n.assignTexture(e,"map",r.baseColorTexture))}return Promise.all(o)}}class On{constructor(e){this.parser=e,this.name=Ln.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser,n=t.json.materials[e];return n.extensions&&n.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const r=[],s=o.extensions[this.name];if(void 0!==s.clearcoatFactor&&(t.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&r.push(n.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(r.push(n.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){const e=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new i.FM8(e,e)}return Promise.all(r)}}class Vn{constructor(e){this.parser=e,this.name=Ln.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser,n=t.json.materials[e];return n.extensions&&n.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new i.Ilk(0,0,0),t.sheenRoughness=0,t.sheen=1;const s=o.extensions[this.name];return void 0!==s.sheenColorFactor&&t.sheenColor.fromArray(s.sheenColorFactor),void 0!==s.sheenRoughnessFactor&&(t.sheenRoughness=s.sheenRoughnessFactor),void 0!==s.sheenColorTexture&&r.push(n.assignTexture(t,"sheenColorMap",s.sheenColorTexture)),void 0!==s.sheenRoughnessTexture&&r.push(n.assignTexture(t,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(r)}}class Dn{constructor(e){this.parser=e,this.name=Ln.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser,n=t.json.materials[e];return n.extensions&&n.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const r=[],s=o.extensions[this.name];return void 0!==s.transmissionFactor&&(t.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&r.push(n.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(r)}}class Fn{constructor(e){this.parser=e,this.name=Ln.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser,n=t.json.materials[e];return n.extensions&&n.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const r=[],s=o.extensions[this.name];t.thickness=void 0!==s.thicknessFactor?s.thicknessFactor:0,void 0!==s.thicknessTexture&&r.push(n.assignTexture(t,"thicknessMap",s.thicknessTexture)),t.attenuationDistance=s.attenuationDistance||0;const a=s.attenuationColor||[1,1,1];return t.attenuationColor=new i.Ilk(a[0],a[1],a[2]),Promise.all(r)}}class Un{constructor(e){this.parser=e,this.name=Ln.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser,n=t.json.materials[e];return n.extensions&&n.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const r=o.extensions[this.name];return t.ior=void 0!==r.ior?r.ior:1.5,Promise.resolve()}}class zn{constructor(e){this.parser=e,this.name=Ln.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser,n=t.json.materials[e];return n.extensions&&n.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const r=[],s=o.extensions[this.name];t.specularIntensity=void 0!==s.specularFactor?s.specularFactor:1,void 0!==s.specularTexture&&r.push(n.assignTexture(t,"specularIntensityMap",s.specularTexture));const a=s.specularColorFactor||[1,1,1];return t.specularColor=new i.Ilk(a[0],a[1],a[2]),void 0!==s.specularColorTexture&&r.push(n.assignTexture(t,"specularColorMap",s.specularColorTexture).then((function(e){e.encoding=i.knz}))),Promise.all(r)}}class Hn{constructor(e){this.parser=e,this.name=Ln.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,o=n.textures[e];if(!o.extensions||!o.extensions[this.name])return null;const r=o.extensions[this.name],s=n.images[r.source],i=t.options.ktx2Loader;if(!i){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s,i)}}class jn{constructor(e){this.parser=e,this.name=Ln.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,o=n.json,r=o.textures[e];if(!r.extensions||!r.extensions[t])return null;const s=r.extensions[t],i=o.images[s.source];let a=n.textureLoader;if(i.uri){const e=n.options.manager.getHandler(i.uri);null!==e&&(a=e)}return this.detectSupport().then((function(r){if(r)return n.loadTextureImage(e,i,a);if(o.extensionsRequired&&o.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class Gn{constructor(e){this.name=Ln.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],o=this.parser.getDependency("buffer",e.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([o,r.ready]).then((function(t){const n=e.byteOffset||0,o=e.byteLength||0,s=e.count,i=e.byteStride,a=new ArrayBuffer(s*i),l=new Uint8Array(t[0],n,o);return r.decodeGltfBuffer(new Uint8Array(a),s,i,l,e.mode,e.filter),a}))}return null}}const Wn="glTF",Xn=12,qn={JSON:1313821514,BIN:5130562};class Kn{constructor(e){this.name=Ln.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,Xn);if(this.header={magic:i.Zp0.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Wn)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-Xn,o=new DataView(e,Xn);let r=0;while(r<n){const t=o.getUint32(r,!0);r+=4;const n=o.getUint32(r,!0);if(r+=4,n===qn.JSON){const n=new Uint8Array(e,Xn+r,t);this.content=i.Zp0.decodeText(n)}else if(n===qn.BIN){const n=Xn+r;this.body=e.slice(n,n+t)}r+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class $n{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ln.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,o=this.dracoLoader,r=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,i={},a={},l={};for(const c in s){const e=lo[c]||c.toLowerCase();i[e]=s[c]}for(const c in e.attributes){const t=lo[c]||c.toLowerCase();if(void 0!==s[c]){const o=n.accessors[e.attributes[c]],r=ro[o.componentType];l[t]=r,a[t]=!0===o.normalized}}return t.getDependency("bufferView",r).then((function(e){return new Promise((function(t){o.decodeDracoFile(e,(function(e){for(const t in e.attributes){const n=e.attributes[t],o=a[t];void 0!==o&&(n.normalized=o)}t(e)}),i,l)}))}))}}class Zn{constructor(){this.name=Ln.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Yn extends i.Wid{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),o=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),s=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),a={specular:{value:(new i.Ilk).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(e){for(const t in a)e.uniforms[t]=a[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",o).replace("#include <metalnessmap_fragment>",r).replace("#include <lights_physical_fragment>",s)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(e){a.specular.value=e}},specularMap:{get:function(){return a.specularMap.value},set:function(e){a.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(e){a.glossiness.value=e}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(e){a.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class Qn{constructor(){this.name=Ln.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return Yn}extendParams(e,t,n){const o=t.extensions[this.name];e.color=new i.Ilk(1,1,1),e.opacity=1;const r=[];if(Array.isArray(o.diffuseFactor)){const t=o.diffuseFactor;e.color.fromArray(t),e.opacity=t[3]}if(void 0!==o.diffuseTexture&&r.push(n.assignTexture(e,"map",o.diffuseTexture)),e.emissive=new i.Ilk(0,0,0),e.glossiness=void 0!==o.glossinessFactor?o.glossinessFactor:1,e.specular=new i.Ilk(1,1,1),Array.isArray(o.specularFactor)&&e.specular.fromArray(o.specularFactor),void 0!==o.specularGlossinessTexture){const t=o.specularGlossinessTexture;r.push(n.assignTexture(e,"glossinessMap",t)),r.push(n.assignTexture(e,"specularMap",t))}return Promise.all(r)}createMaterial(e){const t=new Yn(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=i.IOt,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}class Jn{constructor(){this.name=Ln.KHR_MESH_QUANTIZATION}}class eo extends i._C8{constructor(e,t,n,o){super(e,t,n,o)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,o=this.valueSize,r=e*o*3+o;for(let s=0;s!==o;s++)t[s]=n[r+s];return t}}eo.prototype.beforeStart_=eo.prototype.copySampleValue_,eo.prototype.afterEnd_=eo.prototype.copySampleValue_,eo.prototype.interpolate_=function(e,t,n,o){const r=this.resultBuffer,s=this.sampleValues,i=this.valueSize,a=2*i,l=3*i,c=o-t,u=(n-t)/c,h=u*u,d=h*u,p=e*l,m=p-l,f=-2*d+3*h,g=d-h,y=1-f,v=g-h+u;for(let x=0;x!==i;x++){const e=s[m+x+i],t=s[m+x+a]*c,n=s[p+x+i],o=s[p+x]*c;r[x]=y*e+v*t+f*n+g*o}return r};const to=new i._fP;class no extends eo{interpolate_(e,t,n,o){const r=super.interpolate_(e,t,n,o);return to.fromArray(r).normalize().toArray(r),r}}const oo={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},ro={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},so={9728:i.TyD,9729:i.wem,9984:i.YLQ,9985:i.qyh,9986:i.aH4,9987:i.D1R},io={33071:i.uWy,33648:i.OoA,10497:i.rpg},ao={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},lo={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},co={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},uo={CUBICSPLINE:void 0,LINEAR:i.NMF,STEP:i.Syv},ho={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function po(e){return void 0===e["DefaultMaterial"]&&(e["DefaultMaterial"]=new i.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:i.Wl3})),e["DefaultMaterial"]}function mo(e,t,n){for(const o in n.extensions)void 0===e[o]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[o]=n.extensions[o])}function fo(e,t){void 0!==t.extras&&("object"===typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function go(e,t,n){let o=!1,r=!1;for(let a=0,l=t.length;a<l;a++){const e=t[a];if(void 0!==e.POSITION&&(o=!0),void 0!==e.NORMAL&&(r=!0),o&&r)break}if(!o&&!r)return Promise.resolve(e);const s=[],i=[];for(let a=0,l=t.length;a<l;a++){const l=t[a];if(o){const t=void 0!==l.POSITION?n.getDependency("accessor",l.POSITION):e.attributes.position;s.push(t)}if(r){const t=void 0!==l.NORMAL?n.getDependency("accessor",l.NORMAL):e.attributes.normal;i.push(t)}}return Promise.all([Promise.all(s),Promise.all(i)]).then((function(t){const n=t[0],s=t[1];return o&&(e.morphAttributes.position=n),r&&(e.morphAttributes.normal=s),e.morphTargetsRelative=!0,e}))}function yo(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,o=t.weights.length;n<o;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,o=n.length;t<o;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function vo(e){const t=e.extensions&&e.extensions[Ln.KHR_DRACO_MESH_COMPRESSION];let n;return n=t?"draco:"+t.bufferView+":"+t.indices+":"+xo(t.attributes):e.indices+":"+xo(e.attributes)+":"+e.mode,n}function xo(e){let t="";const n=Object.keys(e).sort();for(let o=0,r=n.length;o<r;o++)t+=n[o]+":"+e[n[o]]+";";return t}function bo(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class wo{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Rn,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},"undefined"!==typeof createImageBitmap&&!1===/Firefox|^((?!chrome|android).)*safari/i.test(navigator.userAgent)?this.textureLoader=new i.QRU(this.options.manager):this.textureLoader=new i.dpR(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new i.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,o=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){const s={scene:t[0][o.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:o.asset,parser:n,userData:{}};mo(r,s,o),fo(s,o),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(s)}))).then((function(){e(s)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let o=0,r=t.length;o<r;o++){const n=t[o].joints;for(let t=0,o=n.length;t<o;t++)e[n[t]].isBone=!0}for(let o=0,r=e.length;o<r;o++){const t=e[o];void 0!==t.mesh&&(this._addNodeRef(this.meshCache,t.mesh),void 0!==t.skin&&(n[t.mesh].isSkinnedMesh=!0)),void 0!==t.camera&&this._addNodeRef(this.cameraCache,t.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const o=n.clone(),r=(e,t)=>{const n=this.associations.get(e);null!=n&&this.associations.set(t,n);for(const[o,s]of e.children.entries())r(s,t.children[o])};return r(n,o),o.name+="_instance_"+e.uses[t]++,o}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const o=e(t[n]);if(o)return o}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let o=0;o<t.length;o++){const r=e(t[o]);r&&n.push(r)}return n}getDependency(e,t){const n=e+":"+t;let o=this.cache.get(n);if(!o){switch(e){case"scene":o=this.loadScene(t);break;case"node":o=this.loadNode(t);break;case"mesh":o=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":o=this.loadAccessor(t);break;case"bufferView":o=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":o=this.loadBuffer(t);break;case"material":o=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":o=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":o=this.loadSkin(t);break;case"animation":o=this.loadAnimation(t);break;case"camera":o=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,o)}return o}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,o=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(o.map((function(t,o){return n.getDependency(e,o)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[Ln.KHR_BINARY_GLTF].body);const o=this.options;return new Promise((function(e,r){n.load(i.Zp0.resolveURL(t.uri,o.path),e,void 0,(function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const n=t.byteLength||0,o=t.byteOffset||0;return e.slice(o,o+n)}))}loadAccessor(e){const t=this,n=this.json,o=this.json.accessors[e];if(void 0===o.bufferView&&void 0===o.sparse)return Promise.resolve(null);const r=[];return void 0!==o.bufferView?r.push(this.getDependency("bufferView",o.bufferView)):r.push(null),void 0!==o.sparse&&(r.push(this.getDependency("bufferView",o.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",o.sparse.values.bufferView))),Promise.all(r).then((function(e){const r=e[0],s=ao[o.type],a=ro[o.componentType],l=a.BYTES_PER_ELEMENT,c=l*s,u=o.byteOffset||0,h=void 0!==o.bufferView?n.bufferViews[o.bufferView].byteStride:void 0,d=!0===o.normalized;let p,m;if(h&&h!==c){const e=Math.floor(u/h),n="InterleavedBuffer:"+o.bufferView+":"+o.componentType+":"+e+":"+o.count;let c=t.cache.get(n);c||(p=new a(r,e*h,o.count*h/l),c=new i.vpT(p,h/l),t.cache.add(n,c)),m=new i.kB5(c,s,u%h/l,d)}else p=null===r?new a(o.count*s):new a(r,u,o.count*s),m=new i.TlE(p,s,d);if(void 0!==o.sparse){const t=ao.SCALAR,n=ro[o.sparse.indices.componentType],l=o.sparse.indices.byteOffset||0,c=o.sparse.values.byteOffset||0,u=new n(e[1],l,o.sparse.count*t),h=new a(e[2],c,o.sparse.count*s);null!==r&&(m=new i.TlE(m.array.slice(),m.itemSize,m.normalized));for(let e=0,o=u.length;e<o;e++){const t=u[e];if(m.setX(t,h[e*s]),s>=2&&m.setY(t,h[e*s+1]),s>=3&&m.setZ(t,h[e*s+2]),s>=4&&m.setW(t,h[e*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return m}))}loadTexture(e){const t=this.json,n=this.options,o=t.textures[e],r=t.images[o.source];let s=this.textureLoader;if(r.uri){const e=n.manager.getHandler(r.uri);null!==e&&(s=e)}return this.loadTextureImage(e,r,s)}loadTextureImage(e,t,n){const o=this,r=this.json,s=this.options,a=r.textures[e],l=(t.uri||t.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];const c=self.URL||self.webkitURL;let u=t.uri||"",h=!1;if(void 0!==t.bufferView)u=o.getDependency("bufferView",t.bufferView).then((function(e){h=!0;const n=new Blob([e],{type:t.mimeType});return u=c.createObjectURL(n),u}));else if(void 0===t.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const d=Promise.resolve(u).then((function(e){return new Promise((function(t,o){let r=t;!0===n.isImageBitmapLoader&&(r=function(e){const n=new i.xEZ(e);n.needsUpdate=!0,t(n)}),n.load(i.Zp0.resolveURL(e,s.path),r,void 0,o)}))})).then((function(t){!0===h&&c.revokeObjectURL(u),t.flipY=!1,a.name&&(t.name=a.name);const n=r.samplers||{},s=n[a.sampler]||{};return t.magFilter=so[s.magFilter]||i.wem,t.minFilter=so[s.minFilter]||i.D1R,t.wrapS=io[s.wrapS]||i.rpg,t.wrapT=io[s.wrapT]||i.rpg,o.associations.set(t,{textures:e}),t})).catch((function(){return console.error("THREE.GLTFLoader: Couldn't load texture",u),null}));return this.textureCache[l]=d,d}assignTexture(e,t,n){const o=this;return this.getDependency("texture",n.index).then((function(r){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),o.extensions[Ln.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[Ln.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=o.associations.get(r);r=o.extensions[Ln.KHR_TEXTURE_TRANSFORM].extendTexture(r,e),o.associations.set(r,t)}}return e[t]=r,r}))}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const o=void 0===t.attributes.tangent,r=void 0!==t.attributes.color,s=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new i.UY4,i.F5T.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(e,t)),n=t}else if(e.isLine){const e="LineBasicMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new i.nls,i.F5T.prototype.copy.call(t,n),t.color.copy(n.color),this.cache.add(e,t)),n=t}if(o||r||s){let e="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),o&&(e+="derivative-tangents:"),r&&(e+="vertex-colors:"),s&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=n.clone(),r&&(t.vertexColors=!0),s&&(t.flatShading=!0),o&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=n}getMaterialType(){return i.Wid}loadMaterial(e){const t=this,n=this.json,o=this.extensions,r=n.materials[e];let s;const a={},l=r.extensions||{},c=[];if(l[Ln.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const e=o[Ln.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];s=e.getMaterialType(),c.push(e.extendParams(a,r,t))}else if(l[Ln.KHR_MATERIALS_UNLIT]){const e=o[Ln.KHR_MATERIALS_UNLIT];s=e.getMaterialType(),c.push(e.extendParams(a,r,t))}else{const n=r.pbrMetallicRoughness||{};if(a.color=new i.Ilk(1,1,1),a.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;a.color.fromArray(e),a.opacity=e[3]}void 0!==n.baseColorTexture&&c.push(t.assignTexture(a,"map",n.baseColorTexture)),a.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,a.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(c.push(t.assignTexture(a,"metalnessMap",n.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",n.metallicRoughnessTexture))),s=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),c.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,a)}))))}!0===r.doubleSided&&(a.side=i.ehD);const u=r.alphaMode||ho.OPAQUE;if(u===ho.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,u===ho.MASK&&(a.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&s!==i.vBJ&&(c.push(t.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new i.FM8(1,1),void 0!==r.normalTexture.scale)){const e=r.normalTexture.scale;a.normalScale.set(e,e)}return void 0!==r.occlusionTexture&&s!==i.vBJ&&(c.push(t.assignTexture(a,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(a.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&s!==i.vBJ&&(a.emissive=(new i.Ilk).fromArray(r.emissiveFactor)),void 0!==r.emissiveTexture&&s!==i.vBJ&&c.push(t.assignTexture(a,"emissiveMap",r.emissiveTexture)),Promise.all(c).then((function(){let n;return n=s===Yn?o[Ln.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):new s(a),r.name&&(n.name=r.name),n.map&&(n.map.encoding=i.knz),n.emissiveMap&&(n.emissiveMap.encoding=i.knz),fo(n,r),t.associations.set(n,{materials:e}),r.extensions&&mo(o,n,r),n}))}createUniqueName(e){const t=i.iUV.sanitizeNodeName(e||"");let n=t;for(let o=1;this.nodeNamesUsed[n];++o)n=t+"_"+o;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const t=this,n=this.extensions,o=this.primitiveCache;function r(e){return n[Ln.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return Mo(n,e,t)}))}const s=[];for(let a=0,l=e.length;a<l;a++){const n=e[a],l=vo(n),c=o[l];if(c)s.push(c.promise);else{let e;e=n.extensions&&n.extensions[Ln.KHR_DRACO_MESH_COMPRESSION]?r(n):Mo(new i.u9r,n,t),o[l]={primitive:n,promise:e},s.push(e)}}return Promise.all(s)}loadMesh(e){const t=this,n=this.json,o=this.extensions,r=n.meshes[e],s=r.primitives,a=[];for(let i=0,l=s.length;i<l;i++){const e=void 0===s[i].material?po(this.cache):this.getDependency("material",s[i].material);a.push(e)}return a.push(t.loadGeometries(s)),Promise.all(a).then((function(n){const a=n.slice(0,n.length-1),l=n[n.length-1],c=[];for(let h=0,d=l.length;h<d;h++){const n=l[h],u=s[h];let d;const p=a[h];if(u.mode===oo.TRIANGLES||u.mode===oo.TRIANGLE_STRIP||u.mode===oo.TRIANGLE_FAN||void 0===u.mode)d=!0===r.isSkinnedMesh?new i.TUv(n,p):new i.Kj0(n,p),!0!==d.isSkinnedMesh||d.geometry.attributes.skinWeight.normalized||d.normalizeSkinWeights(),u.mode===oo.TRIANGLE_STRIP?d.geometry=To(d.geometry,i.UlW):u.mode===oo.TRIANGLE_FAN&&(d.geometry=To(d.geometry,i.z$h));else if(u.mode===oo.LINES)d=new i.ejS(n,p);else if(u.mode===oo.LINE_STRIP)d=new i.x12(n,p);else if(u.mode===oo.LINE_LOOP)d=new i.blk(n,p);else{if(u.mode!==oo.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+u.mode);d=new i.woe(n,p)}Object.keys(d.geometry.morphAttributes).length>0&&yo(d,r),d.name=t.createUniqueName(r.name||"mesh_"+e),fo(d,r),u.extensions&&mo(o,d,u),t.assignFinalMaterial(d),c.push(d)}for(let o=0,r=c.length;o<r;o++)t.associations.set(c[o],{meshes:e,primitives:o});if(1===c.length)return c[0];const u=new i.ZAu;t.associations.set(u,{meshes:e});for(let e=0,t=c.length;e<t;e++)u.add(c[e]);return u}))}loadCamera(e){let t;const n=this.json.cameras[e],o=n[n.type];if(o)return"perspective"===n.type?t=new i.cPb(i.M8C.radToDeg(o.yfov),o.aspectRatio||1,o.znear||1,o.zfar||2e6):"orthographic"===n.type&&(t=new i.iKG(-o.xmag,o.xmag,o.ymag,-o.ymag,o.znear,o.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),fo(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))}loadAnimation(e){const t=this.json,n=t.animations[e],o=[],r=[],s=[],a=[],l=[];for(let i=0,c=n.channels.length;i<c;i++){const e=n.channels[i],t=n.samplers[e.sampler],c=e.target,u=void 0!==c.node?c.node:c.id,h=void 0!==n.parameters?n.parameters[t.input]:t.input,d=void 0!==n.parameters?n.parameters[t.output]:t.output;o.push(this.getDependency("node",u)),r.push(this.getDependency("accessor",h)),s.push(this.getDependency("accessor",d)),a.push(t),l.push(c)}return Promise.all([Promise.all(o),Promise.all(r),Promise.all(s),Promise.all(a),Promise.all(l)]).then((function(t){const o=t[0],r=t[1],s=t[2],a=t[3],l=t[4],c=[];for(let e=0,n=o.length;e<n;e++){const t=o[e],n=r[e],u=s[e],h=a[e],d=l[e];if(void 0===t)continue;let p;switch(t.updateMatrix(),t.matrixAutoUpdate=!0,co[d.path]){case co.weights:p=i.dUE;break;case co.rotation:p=i.iLg;break;case co.position:case co.scale:default:p=i.yC1;break}const m=t.name?t.name:t.uuid,f=void 0!==h.interpolation?uo[h.interpolation]:i.NMF,g=[];co[d.path]===co.weights?t.traverse((function(e){e.morphTargetInfluences&&g.push(e.name?e.name:e.uuid)})):g.push(m);let y=u.array;if(u.normalized){const e=bo(y.constructor),t=new Float32Array(y.length);for(let n=0,o=y.length;n<o;n++)t[n]=y[n]*e;y=t}for(let e=0,o=g.length;e<o;e++){const t=new p(g[e]+"."+co[d.path],n.array,y,f);"CUBICSPLINE"===h.interpolation&&(t.createInterpolant=function(e){const t=this instanceof i.iLg?no:eo;return new t(this.times,this.values,this.getValueSize()/3,e)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(t)}}const u=n.name?n.name:"animation_"+e;return new i.m7l(u,void 0,c)}))}createNodeMesh(e){const t=this.json,n=this,o=t.nodes[e];return void 0===o.mesh?null:n.getDependency("mesh",o.mesh).then((function(e){const t=n._getNodeRef(n.meshCache,o.mesh,e);return void 0!==o.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,n=o.weights.length;t<n;t++)e.morphTargetInfluences[t]=o.weights[t]})),t}))}loadNode(e){const t=this.json,n=this.extensions,o=this,r=t.nodes[e],s=r.name?o.createUniqueName(r.name):"";return function(){const t=[],n=o._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return n&&t.push(n),void 0!==r.camera&&t.push(o.getDependency("camera",r.camera).then((function(e){return o._getNodeRef(o.cameraCache,r.camera,e)}))),o._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(t){let a;if(a=!0===r.isBone?new i.N$j:t.length>1?new i.ZAu:1===t.length?t[0]:new i.Tme,a!==t[0])for(let e=0,n=t.length;e<n;e++)a.add(t[e]);if(r.name&&(a.userData.name=r.name,a.name=s),fo(a,r),r.extensions&&mo(n,a,r),void 0!==r.matrix){const e=new i.yGw;e.fromArray(r.matrix),a.applyMatrix4(e)}else void 0!==r.translation&&a.position.fromArray(r.translation),void 0!==r.rotation&&a.quaternion.fromArray(r.rotation),void 0!==r.scale&&a.scale.fromArray(r.scale);return o.associations.has(a)||o.associations.set(a,{}),o.associations.get(a).nodes=e,a}))}loadScene(e){const t=this.json,n=this.extensions,o=this.json.scenes[e],r=this,s=new i.ZAu;o.name&&(s.name=r.createUniqueName(o.name)),fo(s,o),o.extensions&&mo(n,s,o);const a=o.nodes||[],l=[];for(let i=0,c=a.length;i<c;i++)l.push(Ao(a[i],s,t,r));return Promise.all(l).then((function(){const e=e=>{const t=new Map;for(const[n,o]of r.associations)(n instanceof i.F5T||n instanceof i.xEZ)&&t.set(n,o);return e.traverse((e=>{const n=r.associations.get(e);null!=n&&t.set(e,n)})),t};return r.associations=e(s),s}))}}function Ao(e,t,n,o){const r=n.nodes[e];return o.getDependency("node",e).then((function(e){if(void 0===r.skin)return e;let t;return o.getDependency("skin",r.skin).then((function(e){t=e;const n=[];for(let r=0,s=t.joints.length;r<s;r++)n.push(o.getDependency("node",t.joints[r]));return Promise.all(n)})).then((function(n){return e.traverse((function(e){if(!e.isMesh)return;const o=[],r=[];for(let s=0,a=n.length;s<a;s++){const e=n[s];if(e){o.push(e);const n=new i.yGw;void 0!==t.inverseBindMatrices&&n.fromArray(t.inverseBindMatrices.array,16*s),r.push(n)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[s])}e.bind(new i.OdW(o,r),e.matrixWorld)})),e}))})).then((function(e){t.add(e);const s=[];if(r.children){const t=r.children;for(let r=0,i=t.length;r<i;r++){const i=t[r];s.push(Ao(i,e,n,o))}}return Promise.all(s)}))}function So(e,t,n){const o=t.attributes,r=new i.ZzF;if(void 0===o.POSITION)return;{const e=n.json.accessors[o.POSITION],t=e.min,s=e.max;if(void 0===t||void 0===s)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(r.set(new i.Pa4(t[0],t[1],t[2]),new i.Pa4(s[0],s[1],s[2])),e.normalized){const t=bo(ro[e.componentType]);r.min.multiplyScalar(t),r.max.multiplyScalar(t)}}const s=t.targets;if(void 0!==s){const e=new i.Pa4,t=new i.Pa4;for(let o=0,r=s.length;o<r;o++){const r=s[o];if(void 0!==r.POSITION){const o=n.json.accessors[r.POSITION],s=o.min,i=o.max;if(void 0!==s&&void 0!==i){if(t.setX(Math.max(Math.abs(s[0]),Math.abs(i[0]))),t.setY(Math.max(Math.abs(s[1]),Math.abs(i[1]))),t.setZ(Math.max(Math.abs(s[2]),Math.abs(i[2]))),o.normalized){const e=bo(ro[o.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(e)}e.boundingBox=r;const a=new i.aLr;r.getCenter(a.center),a.radius=r.min.distanceTo(r.max)/2,e.boundingSphere=a}function Mo(e,t,n){const o=t.attributes,r=[];function s(t,o){return n.getDependency("accessor",t).then((function(t){e.setAttribute(o,t)}))}for(const i in o){const t=lo[i]||i.toLowerCase();t in e.attributes||r.push(s(o[i],t))}if(void 0!==t.indices&&!e.index){const o=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));r.push(o)}return fo(e,t),So(e,t,n),Promise.all(r).then((function(){return void 0!==t.targets?go(e,t.targets,n):e}))}function To(e,t){let n=e.getIndex();if(null===n){const t=[],o=e.getAttribute("position");if(void 0===o)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<o.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const o=n.count-2,r=[];if(t===i.z$h)for(let i=1;i<=o;i++)r.push(n.getX(0)),r.push(n.getX(i)),r.push(n.getX(i+1));else for(let i=0;i<o;i++)i%2===0?(r.push(n.getX(i)),r.push(n.getX(i+1)),r.push(n.getX(i+2))):(r.push(n.getX(i+2)),r.push(n.getX(i+1)),r.push(n.getX(i)));r.length/3!==o&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=e.clone();return s.setIndex(r),s}
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
var Po=function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,s){function i(e){try{l(o.next(e))}catch(Cs){s(Cs)}}function a(e){try{l(o["throw"](e))}catch(Cs){s(Cs)}}function l(e){e.done?n(e.value):r(e.value).then(i,a)}l((o=o.apply(e,t||[])).next())}))};class Co{constructor(e,t){this.cache=e,this.textureAnisotropy=t}get fileLoader(){return this._fileLoader||(this._fileLoader=new i.hH6),this._fileLoader}get imageLoader(){return this._imgLoader||(this._imgLoader=new i.S3k),this._imgLoader}get svgLoader(){return this._svgLoader||(this._svgLoader=new m),this._svgLoader}get textureLoader(){return this._textureLoader||(this._textureLoader=new i.dpR),this._textureLoader}get objectLoader(){return this._objectLoader||(this._objectLoader=new i.Gql),this._objectLoader}get gltfLoader(){return this._gltfLoader||(this._gltfLoader=new In),this._gltfLoader}get fbxLoader(){return this._fbxLoader||(this._fbxLoader=new ln),this._fbxLoader}preload(e,t){return Po(this,void 0,void 0,(function*(){return this.cache.add(e,t),new Promise((e=>{const n=/\.fbx$|\.glb$|\.gltf$/.test(t),o=/\.jpe?g$|\.png$/.test(t);o?this.textureLoader.load(t,(t=>e(t))):(n&&this.fileLoader.setResponseType("arraybuffer"),this.fileLoader.load(t,(t=>e(t))))}))}))}textureAtlas(e,t,n="JSONHash"){return Po(this,void 0,void 0,(function*(){let n=JSON.parse(yield this.file(t));const o=n.textures;if(o){const e=n.textures[0].frames;let t={frames:{}};e.forEach((e=>{t=Object.assign(Object.assign({},t),{frames:Object.assign(Object.assign({},t.frames),{[e.filename]:{frame:e.frame,rotated:e.rotated,sourceSize:e.sourceSize,spriteSourceSize:e.spriteSourceSize,trimmed:e.trimmed}})})})),n=t}const r={texture:yield this.texture(e),json:n};return r}))}file(e){const t=this.cache.get(e);return e=t||e,new Promise((t=>{this.fileLoader.load(e,(e=>t(e)))}))}svg(e){const t=this.cache.get(e);return e=t||e,new Promise((t=>{this.svgLoader.load(e,(e=>t(e)))}))}texture(e){const t=/^data:image\/[\S]+;base64,/gm.test(e);if(!t){const t=this.cache.get(e);e=t||e}return new Promise((t=>{this.textureLoader.load(e,(e=>{e.anisotropy=this.textureAnisotropy,e.needsUpdate=!0,t(e)}))}))}object(e){const t=this.cache.get(e);return e=t||e,new Promise((t=>{this.objectLoader.load(e,(e=>{t(e)}))}))}gltf(e){const t=this.cache.get(e);return e=t||e,new Promise((t=>{this.gltfLoader.load(e,(e=>{t(e)}))}))}fbx(e){const t=this.cache.get(e);return e=t||e,new Promise((t=>{this.fbxLoader.load(e,(e=>{t(e)}))}))}}
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class Eo extends i.Tme{constructor(e,t,n,o){super(),this.scene=e,this.light=t,this.size=n,this.color=o,this.geo=new i.Aip(n||.2,16,8),this.mat=new i.vBJ({color:o||t.color}),this.mesh=new i.Kj0(this.geo,this.mat),this.add(this.mesh),t.add(this)}dispose(){this.mesh.geometry.dispose(),Array.isArray(this.mesh.material)?this.mesh.material.forEach((e=>e.dispose())):this.mesh.material.dispose(),this.remove(this.mesh)}update(){}}class ko{constructor(e){this.scene=e}get helper(){return{directionalLightHelper:(e,t,n)=>{const o=new i.cBI(e,t,n);return this.scene.add(o),o},spotLightHelper:(e,t)=>{const n=new i.FvO(e,t);return this.scene.add(n),n},pointLightHelper:(e,t,n)=>new Eo(this.scene,e,t,n)}}directionalLight(e={}){const{color:t=16777215,intensity:n=1}=e,o=new i.Ox3(t,n);return o.castShadow=!0,this.scene.add(o),o}hemisphereLight(e={}){const{skyColor:t=16777215,groundColor:n=16777215,intensity:o=1}=e,r=new i.vmT(t,n,o);return this.scene.add(r),r}ambientLight(e={}){const{color:t=16777215,intensity:n=1}=e,o=new i.Mig(t,n);return this.scene.add(o),o}pointLight(e={}){const{color:t=16777215,intensity:n=1,distance:o=0,decay:r=1}=e,s=new i.cek(t,n,o,r);return s.castShadow=!0,this.scene.add(s),s}spotLight(e={}){const{color:t=16777215,intensity:n=1,distance:o=0,angle:r=Math.PI/8,penumbra:s=0,decay:a=1}=e,l=new i.PMe(t,n,o,r,s,a);return l.castShadow=!0,this.scene.add(l),l}rectAreaLight(e={}){const{color:t=16777215,intensity:n=1,width:o=10,height:r=10}=e,s=new i.T_f(t,n,o,r);return this.scene.add(s),s}}
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class _o extends i.Kj0{constructor(e,t){super(e,t),this.isExtendedMesh=!0,this.isGroup=!1,this.vector3=new i.Pa4,this.hasBody=!1,this.fragmentDepth=0,this.breakable=!1,this.fractureImpulse=1,this.name=`object-${this.id}`}get world(){return{theta:this.worldTheta,phi:this.worldPhi}}get worldTheta(){return this.getWorldDirection(this.vector3),Math.atan2(this.vector3.x,this.vector3.z)}get worldPhi(){return this.getWorldDirection(this.vector3),Math.acos(this.vector3.y)}}const Io=new Map,Ro=5,Lo=(e,t=!1)=>{if(Io.has(e)){const t=Io.get(e);if("undefined"===typeof t)return;if(t>=Ro)return;Io.set(e,t+1)}else Io.set(e,1);t?console.error(`%c [enable3d] ${e} `,"background: #222; color: #bada55"):console.warn(`%c [enable3d] ${e} `,"background: #222; color: #bada55")};class No{constructor(){this._defaultMaterial=new i.YBo({color:13421772})}get(){return this._defaultMaterial}}var Bo=No,Oo=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n};class Vo{constructor(e){this.scene=e,this.isHeadless="headless"===e,this.defaultMaterial=new Bo}get make(){return{plane:(e={},t={})=>this.makePlane(e,t),box:(e={},t={})=>this.makeBox(e,t),sphere:(e={},t={})=>this.makeSphere(e,t),cylinder:(e={},t={})=>this.makeCylinder(e,t),cone:(e={},t={})=>this.makeCone(e,t),torus:(e={},t={})=>this.makeTorus(e,t),extrude:(e,t={})=>this.makeExtrude(e,t)}}get add(){return{mesh:e=>this.addMesh(e),existing:e=>this.addExisting(e),plane:(e={},t={})=>this.addPlane(e,t),box:(e={},t={})=>this.addBox(e,t),ground:(e,t={})=>this.addGround(e,t),sphere:(e={},t={})=>this.addSphere(e,t),cylinder:(e={},t={})=>this.addCylinder(e,t),cone:(e={},t={})=>this.addCone(e,t),torus:(e={},t={})=>this.addTorus(e,t),extrude:(e,t={})=>this.addExtrude(e,t),material:(e={})=>this.addMaterial(e)}}addExisting(...e){"headless"!==this.scene&&this.scene.add(...e)}addMesh(e){if(Array.isArray(e))for(let t=0;t<e.length;t++)this.addExisting(e[t]);else this.addExisting(e);return this}createMesh(e,t,n){const{x:o=0,y:r=0,z:s=0}=n;let a;switch(!Array.isArray(t)&&t.type){case"LineBasicMaterial":a=new i.x12(e,t);break;case"PointsMaterial":a=new i.woe(e,t);break;default:a=new _o(e,t);break}return a.position.set(o,r,s),a.castShadow=a.receiveShadow=!0,a}makeExtrude(e,t){const{x:n,y:o,z:r,name:s,shape:a,autoCenter:l=!0,breakable:c=!1}=e,u=Oo(e,["x","y","z","name","shape","autoCenter","breakable"]),{depth:h=1,bevelEnabled:d=!1}=u,p=new i.$Vf(a,Object.assign({depth:h,bevelEnabled:d},u)),m=this.addMaterial(t),f=this.createMesh(p,m,{x:n,y:o,z:r});return l&&f.geometry.center(),f.name=s||`body_id_${f.id}`,f.shape="extrude",f}addExtrude(e,t={}){const n=this.makeExtrude(e,t);return this.addExisting(n),n}makePlane(e,t){const{x:n,y:o,z:r,name:s,breakable:a=!1}=e,l=Oo(e,["x","y","z","name","breakable"]),c=new i.BKK(l.width||1,l.height||1,l.widthSegments||1,l.heightSegments||1),u=this.addMaterial(t);u.side=i.ehD;const h=this.createMesh(c,u,{x:n,y:o,z:r});return h.name=s||`body_id_${h.id}`,h.shape="plane",h}addPlane(e,t){const n=this.makePlane(e,t);return this.addExisting(n),n}makeSphere(e,t){const{x:n,y:o,z:r,name:s,breakable:a=!1}=e,l=Oo(e,["x","y","z","name","breakable"]),c=new i.Aip(l.radius||1,l.widthSegments||16,l.heightSegments||12,l.phiStart||void 0,l.phiLength||void 0,l.thetaStart||void 0,l.thetaLength||void 0),u=this.addMaterial(t),h=this.createMesh(c,u,{x:n,y:o,z:r});return h.name=s||`body_id_${h.id}`,h.shape="sphere",h}addSphere(e={},t={}){const n=this.makeSphere(e,t);return this.addExisting(n),n}makeBox(e,t){const{x:n,y:o,z:r,name:s,breakable:a=!1}=e,l=Oo(e,["x","y","z","name","breakable"]),c=new i.nvb(l.width||1,l.height||1,l.depth||1,l.widthSegments||void 0,l.heightSegments||void 0,l.depthSegments||void 0),u=this.addMaterial(t),h=this.createMesh(c,u,{x:n,y:o,z:r});return h.name=s||`body_id_${h.id}`,h.shape="box",h}addBox(e={},t={}){const n=this.makeBox(e,t);return this.addExisting(n),n}addGround(e,t={}){const n=this.makeBox(e,t);return n.rotateX(i.M8C.degToRad(90)),this.addExisting(n),n}makeCylinder(e={},t={}){const{x:n,y:o,z:r,name:s,breakable:a=!1}=e,l=Oo(e,["x","y","z","name","breakable"]),c=new i.m_w(l.radiusTop||1,l.radiusBottom||1,l.height||1,l.radiusSegments||void 0,l.heightSegments||void 0,l.openEnded||void 0,l.thetaStart||void 0,l.thetaLength||void 0),u=this.addMaterial(t),h=this.createMesh(c,u,{x:n,y:o,z:r});return h.name=s||`body_id_${h.id}`,h.shape="cylinder",h}addCylinder(e={},t={}){const n=this.makeCylinder(e,t);return this.addExisting(n),n}makeCone(e={},t={}){const{x:n,y:o,z:r,name:s,breakable:a=!1}=e,l=Oo(e,["x","y","z","name","breakable"]),c=new i._3(l.radius||1,l.height||1,l.radiusSegments||8,l.heightSegments||1,l.openEnded||!1,l.thetaStart||0,l.thetaLength||2*Math.PI),u=this.addMaterial(t),h=this.createMesh(c,u,{x:n,y:o,z:r});return h.name=s||`body_id_${h.id}`,h.shape="cone",h}addCone(e={},t={}){const n=this.makeCone(e,t);return this.addExisting(n),n}makeTorus(e={},t={}){const{x:n,y:o,z:r,name:s,breakable:a=!1}=e,l=Oo(e,["x","y","z","name","breakable"]),c=new i.Cne(l.radius||void 0,l.tube||void 0,l.radialSegments||void 0,l.tubularSegments||void 0,l.arc||void 0),u=this.addMaterial(t),h=this.createMesh(c,u,{x:n,y:o,z:r});return h.name=s||`body_id_${h.id}`,h.shape="torus",h}addTorus(e={},t={}){const n=this.makeTorus(e,t);return this.addExisting(n),n}addMaterial(e={}){const t=Object.keys(e)[0];let n;if("headless"===this.scene)return this.defaultMaterial.get();switch(t){case"basic":n=new i.vBJ(e.basic);break;case"normal":n=new i.RSm(e.normal);break;case"standard":n=new i.Wid(e.standard);break;case"lambert":n=new i.YBo(e.lambert);break;case"phong":n=new i.xoR(e.phong);break;case"physical":"undefined"!==typeof e.physical?n=new i.EJi(e.physical):(Lo("You need to pass parameters to the physical material. (Fallback to default material)"),n=this.defaultMaterial.get());break;case"toon":n=new i.IKL(e.toon);break;case"line":n=new i.nls(e.line);break;case"points":n=new i.UY4(e.points);break;case"custom":n=e.custom||this.defaultMaterial.get();break;default:n=this.defaultMaterial.get();break}return n}}
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class Do{constructor(e){this.scene=e}add(e,t={}){const n=this.make(e,t);return n?this.scene.add(n):console.warn("Could not make heightmap"),n}make(e,t={}){const{image:n}=e,{width:o,height:r}=n,{colorScale:s}=t,a=document.createElement("canvas");a.width=o,a.height=r;const l=a.getContext("2d");if(!l)return;l.drawImage(e.image,0,0);const c=l.getImageData(0,0,o,r),h=(new u).fromBufferGeometry(new i.BKK(10,10,o-1,r-1));let d={color:13421772,side:i.ehD};s&&(d=Object.assign(Object.assign({},d),{vertexColors:!0}));const p=new i.xoR(d),m=new _o(h,p);m.receiveShadow=m.castShadow=!0,m.shape="concave";const f=m.geometry;for(let i=0;i<f.vertices.length;i++)f.vertices[i].z=c.data[4*i]/120;const y=(e,t)=>{var n=e.vertices[t.a].z,o=e.vertices[t.b].z,r=e.vertices[t.c].z;return Math.max(n,o,r)};return s&&f.faces.forEach((e=>e.color=new i.Ilk(s(y(f,e)).hex()))),m.rotateX(-Math.PI/2),m.updateMatrix(),h.computeFaceNormals(),h.computeVertexNormals(),m.name="heightmap",m.geometry=g(new i.u9r,m.geometry),m}}var Fo=n(3448),Uo=function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,s){function i(e){try{l(o.next(e))}catch(Cs){s(Cs)}}function a(e){try{l(o["throw"](e))}catch(Cs){s(Cs)}}function l(e){e.done?n(e.value):r(e.value).then(i,a)}l((o=o.apply(e,t||[])).next())}))};class zo{constructor(e,t,n,o,r,s,i){this.scene=e,this.renderer=t,this.camera=n,this.lights=o,this.physics=r,this.load=s,this.factories=i}warpSpeed(...e){return Uo(this,void 0,void 0,(function*(){let t={};const n=e.filter((e=>/^-\w+/.test(e))),o=n.length>0;if((0===e.length||o)&&(e=["light","camera","lookAtCenter","ground","grid","orbitControls","fog","sky"]),o){const t=n.map((e=>e.substr(1)));t.forEach((t=>{const n=e.indexOf(t);e.splice(n,1)}))}if(e.includes("sky")){const e=["varying vec3 vWorldPosition;","","void main() {","","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","","}"].join("\n"),t=["uniform vec3 topColor;","uniform vec3 bottomColor;","uniform float offset;","uniform float exponent;","","varying vec3 vWorldPosition;","","void main() {","","float h = normalize( vWorldPosition + offset ).y;","gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h , 0.0), exponent ), 0.0 ) ), 1.0 );","","}"].join("\n"),n={topColor:{value:new i.Ilk(30719)},bottomColor:{value:new i.Ilk(15595007)},offset:{value:33},exponent:{value:.6}};var r=new i.Aip(500,32,15),s=new i.jyz({uniforms:n,vertexShader:e,fragmentShader:t,side:i._Li}),a=new i.Kj0(r,s);this.scene.add(a)}if(e.includes("camera")&&(this.camera.position.set(0,6,12),t=Object.assign({camera:this.camera},t)),e.includes("light")){const e=.4,n=this.lights.hemisphereLight({skyColor:16777215,groundColor:0,intensity:e}),o=this.lights.ambientLight({color:16777215,intensity:e}),r=this.lights.directionalLight({color:16777215,intensity:e});r.position.set(100,200,50);const s=20;r.shadow.camera.top=s,r.shadow.camera.bottom=-s,r.shadow.camera.left=-s,r.shadow.camera.right=s,r.shadow.mapSize.set(1024,1024);const i={ambientLight:o,directionalLight:r,hemisphereLight:n};t=Object.assign({lights:i},t)}if(e.includes("lookAtCenter")&&this.camera.lookAt(this.scene.position),e.includes("ground")){const n=e.includes("grid"),o="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOnAAADusBZ+q87AAAAJtJREFUeJzt0EENwDAAxLDbNP6UOxh+NEYQ5dl2drFv286598GrA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAu37AD8eaBH5JQdVbAAAAAElFTkSuQmCC",r=yield this.load.texture(o);r.wrapS=r.wrapT=i.rpg,r.repeat.set(21,21);const s={name:"ground",width:21,height:21,depth:1,y:-.5},a={phong:{map:n?r:null,color:16777215}};let l;window.__loadPhysics?(l=this.physics.add.ground(s,a),l.body.setRestitution(1)):l=this.factories.add.ground(s,a),l.receiveShadow=!0,t=Object.assign({ground:l},t)}if(e.includes("orbitControls")){const e=new Fo.z(this.camera,document.getElementById("enable3d-phaser-canvas")||this.renderer.domElement);t=Object.assign({orbitControls:e},t)}return t}))}}class Ho{constructor(){this._mixers=[]}animationMixer(e){const t=new i.Xcj(e);return this.mixers.add(t),t}get mixers(){return{create:e=>this.animationMixer(e),add:e=>this._mixers.push(e),get:()=>this._mixers,update:e=>{var t;return null===(t=this._mixers)||void 0===t?void 0:t.forEach((t=>t.update(e/1e3)))}}}}var jo=Ho;class Go extends i.Kj0{constructor(e,t={}){super(e),this.type="Reflector";const n=this,o=void 0!==t.color?new i.Ilk(t.color):new i.Ilk(8355711),r=t.textureWidth||512,s=t.textureHeight||512,a=t.clipBias||0,l=t.shader||Go.ReflectorShader,c=new i.JOQ,u=new i.Pa4,h=new i.Pa4,d=new i.Pa4,p=new i.yGw,m=new i.Pa4(0,0,-1),f=new i.Ltg,g=new i.Pa4,y=new i.Pa4,v=new i.Ltg,x=new i.yGw,b=new i.cPb,w=new i.dd2(r,s),A=new i.jyz({uniforms:i.rDY.clone(l.uniforms),fragmentShader:l.fragmentShader,vertexShader:l.vertexShader});A.uniforms["tDiffuse"].value=w.texture,A.uniforms["color"].value=o,A.uniforms["textureMatrix"].value=x,this.material=A,this.onBeforeRender=function(e,t,o){if(h.setFromMatrixPosition(n.matrixWorld),d.setFromMatrixPosition(o.matrixWorld),p.extractRotation(n.matrixWorld),u.set(0,0,1),u.applyMatrix4(p),g.subVectors(h,d),g.dot(u)>0)return;g.reflect(u).negate(),g.add(h),p.extractRotation(o.matrixWorld),m.set(0,0,-1),m.applyMatrix4(p),m.add(d),y.subVectors(h,m),y.reflect(u).negate(),y.add(h),b.position.copy(g),b.up.set(0,1,0),b.up.applyMatrix4(p),b.up.reflect(u),b.lookAt(y),b.far=o.far,b.updateMatrixWorld(),b.projectionMatrix.copy(o.projectionMatrix),x.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),x.multiply(b.projectionMatrix),x.multiply(b.matrixWorldInverse),x.multiply(n.matrixWorld),c.setFromNormalAndCoplanarPoint(u,h),c.applyMatrix4(b.matrixWorldInverse),f.set(c.normal.x,c.normal.y,c.normal.z,c.constant);const r=b.projectionMatrix;v.x=(Math.sign(f.x)+r.elements[8])/r.elements[0],v.y=(Math.sign(f.y)+r.elements[9])/r.elements[5],v.z=-1,v.w=(1+r.elements[10])/r.elements[14],f.multiplyScalar(2/f.dot(v)),r.elements[2]=f.x,r.elements[6]=f.y,r.elements[10]=f.z+1-a,r.elements[14]=f.w,w.texture.encoding=e.outputEncoding,n.visible=!1;const s=e.getRenderTarget(),i=e.xr.enabled,l=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(w),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,b),e.xr.enabled=i,e.shadowMap.autoUpdate=l,e.setRenderTarget(s);const A=o.viewport;void 0!==A&&e.state.viewport(A),n.visible=!0},this.getRenderTarget=function(){return w},this.dispose=function(){w.dispose(),n.material.dispose()}}}Go.prototype.isReflector=!0,Go.ReflectorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:"\n\t\tuniform mat4 textureMatrix;\n\t\tvarying vec4 vUv;\n\n\t\t#include <common>\n\t\t#include <logdepthbuf_pars_vertex>\n\n\t\tvoid main() {\n\n\t\t\tvUv = textureMatrix * vec4( position, 1.0 );\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t\t#include <logdepthbuf_vertex>\n\n\t\t}",fragmentShader:"\n\t\tuniform vec3 color;\n\t\tuniform sampler2D tDiffuse;\n\t\tvarying vec4 vUv;\n\n\t\t#include <logdepthbuf_pars_fragment>\n\n\t\tfloat blendOverlay( float base, float blend ) {\n\n\t\t\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n\n\t\t}\n\n\t\tvec3 blendOverlay( vec3 base, vec3 blend ) {\n\n\t\t\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#include <logdepthbuf_fragment>\n\n\t\t\tvec4 base = texture2DProj( tDiffuse, vUv );\n\t\t\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );\n\n\t\t}"};class Wo extends i.Kj0{constructor(e,t={}){super(e),this.type="Refractor";const n=this,o=void 0!==t.color?new i.Ilk(t.color):new i.Ilk(8355711),r=t.textureWidth||512,s=t.textureHeight||512,a=t.clipBias||0,l=t.shader||Wo.RefractorShader,c=new i.cPb;c.matrixAutoUpdate=!1,c.userData.refractor=!0;const u=new i.JOQ,h=new i.yGw,d=new i.dd2(r,s);this.material=new i.jyz({uniforms:i.rDY.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,transparent:!0}),this.material.uniforms["color"].value=o,this.material.uniforms["tDiffuse"].value=d.texture,this.material.uniforms["textureMatrix"].value=h;const p=function(){const e=new i.Pa4,t=new i.Pa4,o=new i.yGw,r=new i.Pa4,s=new i.Pa4;return function(i){return e.setFromMatrixPosition(n.matrixWorld),t.setFromMatrixPosition(i.matrixWorld),r.subVectors(e,t),o.extractRotation(n.matrixWorld),s.set(0,0,1),s.applyMatrix4(o),r.dot(s)<0}}(),m=function(){const e=new i.Pa4,t=new i.Pa4,o=new i._fP,r=new i.Pa4;return function(){n.matrixWorld.decompose(t,o,r),e.set(0,0,1).applyQuaternion(o).normalize(),e.negate(),u.setFromNormalAndCoplanarPoint(e,t)}}(),f=function(){const e=new i.JOQ,t=new i.Ltg,n=new i.Ltg;return function(o){c.matrixWorld.copy(o.matrixWorld),c.matrixWorldInverse.copy(c.matrixWorld).invert(),c.projectionMatrix.copy(o.projectionMatrix),c.far=o.far,e.copy(u),e.applyMatrix4(c.matrixWorldInverse),t.set(e.normal.x,e.normal.y,e.normal.z,e.constant);const r=c.projectionMatrix;n.x=(Math.sign(t.x)+r.elements[8])/r.elements[0],n.y=(Math.sign(t.y)+r.elements[9])/r.elements[5],n.z=-1,n.w=(1+r.elements[10])/r.elements[14],t.multiplyScalar(2/t.dot(n)),r.elements[2]=t.x,r.elements[6]=t.y,r.elements[10]=t.z+1-a,r.elements[14]=t.w}}();function g(e){h.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),h.multiply(e.projectionMatrix),h.multiply(e.matrixWorldInverse),h.multiply(n.matrixWorld)}function y(e,t,o){n.visible=!1;const r=e.getRenderTarget(),s=e.xr.enabled,i=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(d),!1===e.autoClear&&e.clear(),e.render(t,c),e.xr.enabled=s,e.shadowMap.autoUpdate=i,e.setRenderTarget(r);const a=o.viewport;void 0!==a&&e.state.viewport(a),n.visible=!0}this.onBeforeRender=function(e,t,n){d.texture.encoding=e.outputEncoding,!0!==n.userData.refractor&&!0!==!p(n)&&(m(),g(n),f(n),y(e,t,n))},this.getRenderTarget=function(){return d},this.dispose=function(){d.dispose(),n.material.dispose()}}}Wo.prototype.isRefractor=!0,Wo.RefractorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:"\n\n\t\tuniform mat4 textureMatrix;\n\n\t\tvarying vec4 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = textureMatrix * vec4( position, 1.0 );\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform vec3 color;\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec4 vUv;\n\n\t\tfloat blendOverlay( float base, float blend ) {\n\n\t\t\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n\n\t\t}\n\n\t\tvec3 blendOverlay( vec3 base, vec3 blend ) {\n\n\t\t\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvec4 base = texture2DProj( tDiffuse, vUv );\n\t\t\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );\n\n\t\t}"};class Xo extends i.Kj0{constructor(e,t={}){super(e),this.type="Water";const n=this,o=void 0!==t.color?new i.Ilk(t.color):new i.Ilk(16777215),r=t.textureWidth||512,s=t.textureHeight||512,a=t.clipBias||0,l=t.flowDirection||new i.FM8(1,0),c=t.flowSpeed||.03,u=t.reflectivity||.02,h=t.scale||1,d=t.shader||Xo.WaterShader,p=new i.dpR,m=t.flowMap||void 0,f=t.normalMap0||p.load("textures/water/Water_1_M_Normal.jpg"),g=t.normalMap1||p.load("textures/water/Water_2_M_Normal.jpg"),y=.15,v=.5*y,x=new i.yGw,b=new i.SUY;if(void 0===Go)return void console.error("THREE.Water: Required component Reflector not found.");if(void 0===Wo)return void console.error("THREE.Water: Required component Refractor not found.");const w=new Go(e,{textureWidth:r,textureHeight:s,clipBias:a}),A=new Wo(e,{textureWidth:r,textureHeight:s,clipBias:a});function S(e){x.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),x.multiply(e.projectionMatrix),x.multiply(e.matrixWorldInverse),x.multiply(n.matrixWorld)}function M(){const e=b.getDelta(),t=n.material.uniforms["config"];t.value.x+=c*e,t.value.y=t.value.x+v,t.value.x>=y?(t.value.x=0,t.value.y=v):t.value.y>=y&&(t.value.y=t.value.y-y)}w.matrixAutoUpdate=!1,A.matrixAutoUpdate=!1,this.material=new i.jyz({uniforms:i.rDY.merge([i.rBU.fog,d.uniforms]),vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,transparent:!0,fog:!0}),void 0!==m?(this.material.defines.USE_FLOWMAP="",this.material.uniforms["tFlowMap"]={type:"t",value:m}):this.material.uniforms["flowDirection"]={type:"v2",value:l},f.wrapS=f.wrapT=i.rpg,g.wrapS=g.wrapT=i.rpg,this.material.uniforms["tReflectionMap"].value=w.getRenderTarget().texture,this.material.uniforms["tRefractionMap"].value=A.getRenderTarget().texture,this.material.uniforms["tNormalMap0"].value=f,this.material.uniforms["tNormalMap1"].value=g,this.material.uniforms["color"].value=o,this.material.uniforms["reflectivity"].value=u,this.material.uniforms["textureMatrix"].value=x,this.material.uniforms["config"].value.x=0,this.material.uniforms["config"].value.y=v,this.material.uniforms["config"].value.z=v,this.material.uniforms["config"].value.w=h,this.onBeforeRender=function(e,t,o){S(o),M(),n.visible=!1,w.matrixWorld.copy(n.matrixWorld),A.matrixWorld.copy(n.matrixWorld),w.onBeforeRender(e,t,o),A.onBeforeRender(e,t,o),n.visible=!0}}}Xo.prototype.isWater=!0,Xo.WaterShader={uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},textureMatrix:{type:"m4",value:null},config:{type:"v4",value:new i.Ltg}},vertexShader:"\n\n\t\t#include <common>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\n\t\tuniform mat4 textureMatrix;\n\n\t\tvarying vec4 vCoord;\n\t\tvarying vec2 vUv;\n\t\tvarying vec3 vToEye;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tvCoord = textureMatrix * vec4( position, 1.0 );\n\n\t\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\t\t\tvToEye = cameraPosition - worldPosition.xyz;\n\n\t\t\tvec4 mvPosition =  viewMatrix * worldPosition; // used in fog_vertex\n\t\t\tgl_Position = projectionMatrix * mvPosition;\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}",fragmentShader:"\n\n\t\t#include <common>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\n\t\tuniform sampler2D tReflectionMap;\n\t\tuniform sampler2D tRefractionMap;\n\t\tuniform sampler2D tNormalMap0;\n\t\tuniform sampler2D tNormalMap1;\n\n\t\t#ifdef USE_FLOWMAP\n\t\t\tuniform sampler2D tFlowMap;\n\t\t#else\n\t\t\tuniform vec2 flowDirection;\n\t\t#endif\n\n\t\tuniform vec3 color;\n\t\tuniform float reflectivity;\n\t\tuniform vec4 config;\n\n\t\tvarying vec4 vCoord;\n\t\tvarying vec2 vUv;\n\t\tvarying vec3 vToEye;\n\n\t\tvoid main() {\n\n\t\t\t#include <logdepthbuf_fragment>\n\n\t\t\tfloat flowMapOffset0 = config.x;\n\t\t\tfloat flowMapOffset1 = config.y;\n\t\t\tfloat halfCycle = config.z;\n\t\t\tfloat scale = config.w;\n\n\t\t\tvec3 toEye = normalize( vToEye );\n\n\t\t\t// determine flow direction\n\t\t\tvec2 flow;\n\t\t\t#ifdef USE_FLOWMAP\n\t\t\t\tflow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;\n\t\t\t#else\n\t\t\t\tflow = flowDirection;\n\t\t\t#endif\n\t\t\tflow.x *= - 1.0;\n\n\t\t\t// sample normal maps (distort uvs with flowdata)\n\t\t\tvec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );\n\t\t\tvec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );\n\n\t\t\t// linear interpolate to get the final normal color\n\t\t\tfloat flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;\n\t\t\tvec4 normalColor = mix( normalColor0, normalColor1, flowLerp );\n\n\t\t\t// calculate normal vector\n\t\t\tvec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );\n\n\t\t\t// calculate the fresnel term to blend reflection and refraction maps\n\t\t\tfloat theta = max( dot( toEye, normal ), 0.0 );\n\t\t\tfloat reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );\n\n\t\t\t// calculate final uv coords\n\t\t\tvec3 coord = vCoord.xyz / vCoord.w;\n\t\t\tvec2 uv = coord.xy + coord.z * normal.xz * 0.05;\n\n\t\t\tvec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );\n\t\t\tvec4 refractColor = texture2D( tRefractionMap, uv );\n\n\t\t\t// multiply water color with the mix of both textures\n\t\t\tgl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\n\t\t}"};const qo=(e,t,n={})=>{const{width:o=20,height:r=20,x:s=0,y:a=0,z:l=0,color:c="#ffffff",scale:u=4,flowX:h=1,flowY:d=1,normalMap0:p,normalMap1:m}=n,f=new i.BKK(o,r),g=new i.Wid({color:30654,transparent:!0,opacity:.8}),y=new i.Kj0(f,g);y.position.set(s,a,l),y.rotation.x=-.5*Math.PI,e.add(y);const v=new i.BKK(o,r),x=new Xo(v,{color:c,scale:u,flowDirection:new i.FM8(h,d),textureWidth:1024,textureHeight:1024,normalMap0:p,normalMap1:m,encoding:t.outputEncoding});return x.position.set(s,a+.1,l),x.rotation.x=-.5*Math.PI,e.add(x),{ground:y,water:x}};class Ko{constructor(e,t,n){this.scene=e,this.renderer=t,this.factories=n}water(e={}){qo(this.scene,this.renderer,e)}textureCube(e){6!==e.length&&Lo("You need to pass 6 urls to textureCube()");const t=new $o;return e.forEach(((e,n)=>{e.wrapS=e.wrapT=i.rpg;const o=this.factories.add.material({phong:{map:e}});t.materials[n]=o})),t}}class $o{constructor(){this.materials=new Array(6)}get texture(){return{left:this.getTexture(0),right:this.getTexture(1),up:this.getTexture(2),down:this.getTexture(3),front:this.getTexture(4),back:this.getTexture(5)}}getTexture(e){return this.materials[e].map}}function Zo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Yo{static createButton(e,t){t&&console.error('THREE.VRButton: The "options" parameter has been removed. Please set the reference space type via renderer.xr.setReferenceSpaceType() instead.');const n=document.createElement("button");function o(){let t=null;async function o(o){o.addEventListener("end",r),await e.xr.setSession(o),n.textContent="EXIT VR",t=o}function r(){t.removeEventListener("end",r),n.textContent="ENTER VR",t=null}n.style.display="",n.style.cursor="pointer",n.style.left="calc(50% - 50px)",n.style.width="100px",n.textContent="ENTER VR",n.onmouseenter=function(){n.style.opacity="1.0"},n.onmouseleave=function(){n.style.opacity="0.5"},n.onclick=function(){if(null===t){const e={optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]};navigator.xr.requestSession("immersive-vr",e).then(o)}else t.end()}}function r(){n.style.display="",n.style.cursor="auto",n.style.left="calc(50% - 75px)",n.style.width="150px",n.onmouseenter=null,n.onmouseleave=null,n.onclick=null}function s(){r(),n.textContent="VR NOT SUPPORTED"}function i(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator)return n.id="VRButton",n.style.display="none",i(n),navigator.xr.isSessionSupported("immersive-vr").then((function(e){e?o():s(),e&&Yo.xrSessionIsGranted&&n.click()})),n;{const e=document.createElement("a");return!1===window.isSecureContext?(e.href=document.location.href.replace(/^http:/,"https:"),e.innerHTML="WEBXR NEEDS HTTPS"):(e.href="https://immersiveweb.dev/",e.innerHTML="WEBXR NOT AVAILABLE"),e.style.left="calc(50% - 90px)",e.style.width="180px",e.style.textDecoration="none",i(e),e}}static registerSessionGrantedListener(){"xr"in navigator&&navigator.xr.addEventListener("sessiongranted",(()=>{Yo.xrSessionIsGranted=!0}))}}Zo(Yo,"xrSessionIsGranted",!1),Yo.registerSessionGrantedListener();const Qo={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function Jo(e){const t=await fetch(e);if(t.ok)return t.json();throw new Error(t.statusText)}async function er(e){if(!e)throw new Error("No basePath supplied");const t="profilesList.json",n=await Jo(`${e}/${t}`);return n}async function tr(e,t,n=null,o=!0){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No basePath supplied");const r=await er(t);let s;if(e.profiles.some((e=>{const n=r[e];return n&&(s={profileId:e,profilePath:`${t}/${n.path}`,deprecated:!!n.deprecated}),!!s})),!s){if(!n)throw new Error("No matching profile name found");const e=r[n];if(!e)throw new Error(`No matching profile name found and default profile "${n}" missing.`);s={profileId:n,profilePath:`${t}/${e.path}`,deprecated:!!e.deprecated}}const i=await Jo(s.profilePath);let a;if(o){let t;if(t="any"===e.handedness?i.layouts[Object.keys(i.layouts)[0]]:i.layouts[e.handedness],!t)throw new Error(`No matching handedness, ${e.handedness}, in profile ${s.profileId}`);t.assetPath&&(a=s.profilePath.replace("profile.json",t.assetPath))}return{profile:i,assetPath:a}}const nr={xAxis:0,yAxis:0,button:0,state:Qo.ComponentState.DEFAULT};function or(e=0,t=0){let n=e,o=t;const r=Math.sqrt(e*e+t*t);if(r>1){const r=Math.atan2(t,e);n=Math.cos(r),o=Math.sin(r)}const s={normalizedXAxis:.5*n+.5,normalizedYAxis:.5*o+.5};return s}class rr{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===Qo.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(nr)}updateFromComponent({xAxis:e,yAxis:t,button:n,state:o}){const{normalizedXAxis:r,normalizedYAxis:s}=or(e,t);switch(this.componentProperty){case Qo.ComponentProperty.X_AXIS:this.value=this.states.includes(o)?r:.5;break;case Qo.ComponentProperty.Y_AXIS:this.value=this.states.includes(o)?s:.5;break;case Qo.ComponentProperty.BUTTON:this.value=this.states.includes(o)?n:0;break;case Qo.ComponentProperty.STATE:this.valueNodeProperty===Qo.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(o):this.value=this.states.includes(o)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class sr{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||0===Object.keys(t.gamepadIndices).length)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach((e=>{const n=new rr(t.visualResponses[e]);this.visualResponses[e]=n})),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:Qo.ComponentState.DEFAULT,button:void 0!==this.gamepadIndices.button?0:void 0,xAxis:void 0!==this.gamepadIndices.xAxis?0:void 0,yAxis:void 0!==this.gamepadIndices.yAxis?0:void 0}}get data(){const e={id:this.id,...this.values};return e}updateFromGamepad(e){if(this.values.state=Qo.ComponentState.DEFAULT,void 0!==this.gamepadIndices.button&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||1===this.values.button?this.values.state=Qo.ComponentState.PRESSED:(t.touched||this.values.button>Qo.ButtonTouchThreshold)&&(this.values.state=Qo.ComponentState.TOUCHED)}void 0!==this.gamepadIndices.xAxis&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Qo.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Qo.AxisTouchThreshold&&(this.values.state=Qo.ComponentState.TOUCHED)),void 0!==this.gamepadIndices.yAxis&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Qo.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Qo.AxisTouchThreshold&&(this.values.state=Qo.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach((e=>{e.updateFromComponent(this.values)}))}}class ir{constructor(e,t,n){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=n,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach((e=>{const t=this.layoutDescription.components[e];this.components[e]=new sr(e,t)})),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach((t=>{e.push(t.data)})),e}updateFromGamepad(){Object.values(this.components).forEach((e=>{e.updateFromGamepad(this.xrInputSource.gamepad)}))}}const ar="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",lr="generic-trigger";class cr extends i.Tme{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e||(this.envMap=e,this.traverse((e=>{e.isMesh&&(e.material.envMap=this.envMap,e.material.needsUpdate=!0)}))),this}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach((e=>{Object.values(e.visualResponses).forEach((e=>{const{valueNode:t,minNode:n,maxNode:o,value:r,valueNodeProperty:s}=e;t&&(s===Qo.VisualResponseProperty.VISIBILITY?t.visible=r:s===Qo.VisualResponseProperty.TRANSFORM&&(t.quaternion.slerpQuaternions(n.quaternion,o.quaternion,r),t.position.lerpVectors(n.position,o.position,r)))}))})))}}function ur(e,t){Object.values(e.components).forEach((e=>{const{type:n,touchPointNodeName:o,visualResponses:r}=e;if(n===Qo.ComponentType.TOUCHPAD)if(e.touchPointNode=t.getObjectByName(o),e.touchPointNode){const t=new i.xo$(.001),n=new i.vBJ({color:255}),o=new i.Kj0(t,n);e.touchPointNode.add(o)}else console.warn(`Could not find touch dot, ${e.touchPointNodeName}, in touchpad component ${e.id}`);Object.values(r).forEach((e=>{const{valueNodeName:n,minNodeName:o,maxNodeName:r,valueNodeProperty:s}=e;if(s===Qo.VisualResponseProperty.TRANSFORM){if(e.minNode=t.getObjectByName(o),e.maxNode=t.getObjectByName(r),!e.minNode)return void console.warn(`Could not find ${o} in the model`);if(!e.maxNode)return void console.warn(`Could not find ${r} in the model`)}e.valueNode=t.getObjectByName(n),e.valueNode||console.warn(`Could not find ${n} in the model`)}))}))}function hr(e,t){ur(e.motionController,t),e.envMap&&t.traverse((t=>{t.isMesh&&(t.material.envMap=e.envMap,t.material.needsUpdate=!0)})),e.add(t)}class dr{constructor(e=null){this.gltfLoader=e,this.path=ar,this._assetCache={},this.gltfLoader||(this.gltfLoader=new In)}createControllerModel(e){const t=new cr;let n=null;return e.addEventListener("connected",(e=>{const o=e.data;"tracked-pointer"===o.targetRayMode&&o.gamepad&&tr(o,this.path,lr).then((({profile:e,assetPath:r})=>{t.motionController=new ir(o,e,r);const s=this._assetCache[t.motionController.assetUrl];if(s)n=s.scene.clone(),hr(t,n);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,(e=>{this._assetCache[t.motionController.assetUrl]=e,n=e.scene.clone(),hr(t,n)}),null,(()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)}))}})).catch((e=>{console.warn(e)}))})),e.addEventListener("disconnected",(()=>{t.motionController=null,t.remove(n),n=null})),t}}
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class pr{constructor(e,t,n){this._renderer=e,this._scene=t,this._camera=n,this.controllerModelFactory=new dr,this.cameraGroup=new i.ZAu,this.cameraGroup.add(n),t.add(this.cameraGroup),e.xr.enabled=!0;const o=Yo.createButton(e);o.style.cssText+="background: rgba(0, 0, 0, 0.8); ",document.body.appendChild(o)}get isPresenting(){var e,t;return!!(null===(t=null===(e=this._renderer)||void 0===e?void 0:e.xr)||void 0===t?void 0:t.isPresenting)}getController(e){const t=this._renderer.xr.getController(e);return this.cameraGroup.add(t),t}getControllerGrip(e){const t=this._renderer.xr.getControllerGrip(e),n=this.controllerModelFactory.createControllerModel(t);return t.add(n),this.cameraGroup.add(t),t}getControllerRay(e){const{targetRayMode:t}=e;if("tracked-pointer"===t){const e=new i.u9r;e.setAttribute("position",new i.a$l([0,0,0,0,0,-1],3)),e.setAttribute("color",new i.a$l([1,0,0,1,1,1],3));const t=new i.nls({vertexColors:!0});return new i.x12(e,t)}if("gaze"===t){const e=new i.V4E(.02,.04,32).translate(0,0,-1),t=new i.vBJ({color:"red",opacity:.5,transparent:!0});return new i.Kj0(e,t)}}get camera(){return this.WebXRCamera}get WebXRCamera(){var e;return{group:this.cameraGroup,position:null===(e=this.cameraGroup)||void 0===e?void 0:e.position,rotation:this.isPresenting?this._renderer.xr.getCamera(this._camera).rotation:void 0,getWorldDirection:e=>this.isPresenting?this._renderer.xr.getCamera(this._camera).getWorldDirection(e):void 0}}}const mr=(e=20,t)=>{if(window.__loadPhysics)for(let n=0;n<e;n++){const e=["standard","basic","normal","phong","line","points"],n=(e,t)=>Math.floor(Math.random()*(t-e+1)+e),o=e=>e[Math.floor(Math.random()*e.length)];Math.random()>.5?t.add.box({x:n(-10,10),y:n(10,20),z:n(-10,10),width:n(1,2)/10,height:n(1,2)/10,depth:n(1,2)/10,mass:1},{[o(e)]:{color:Math.floor(16777215*Math.random())}}).body.setRestitution(Math.floor(10*Math.random())/20):t.add.sphere({x:n(-10,10),y:n(10,20),z:n(-10,10),radius:n(1,2)/10,mass:1},{[o(e)]:{color:Math.floor(16777215*Math.random())}}).body.setRestitution(Math.floor(10*Math.random())/20)}else console.log("There is not much fun without physics enabled!")};var fr=mr;
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class gr{perspectiveCamera(e={}){return gr.Perspective(e)}orthographicCamera(e={}){return gr.Orthographic(e)}static Perspective(e={}){const{fov:t=50,aspect:n=window.innerWidth/window.innerHeight,near:o=.1,far:r=2e3,x:s=0,y:a=5,z:l=25}=e,c=new i.cPb(t,n,o,r);return c.position.set(s,a,l),c}static Orthographic(e={}){const t=window.innerWidth,n=window.innerHeight,{left:o=t/-2,right:r=t/2,top:s=n/2,bottom:a=n/-2,near:l=1,far:c=1e3,x:u=0,y:h=0,z:d=10}=e,p=new i.iKG(o,r,s,a,l,c);return p.position.set(u,h,d),p}}
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
var yr=function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,s){function i(e){try{l(o.next(e))}catch(Cs){s(Cs)}}function a(e){try{l(o["throw"](e))}catch(Cs){s(Cs)}}function l(e){e.done?n(e.value):r(e.value).then(i,a)}l((o=o.apply(e,t||[])).next())}))};class vr{constructor(e={}){this.sceneConfig=e,this.scenes=new Map,this.__config={},this._isRunning=!1,this._deconstructor=[];const{key:t=Math.random().toString(),enableXR:n=!1}=e;this.__config.sceneKey=t,this.__config.enableXR=n}get deconstructor(){return{add:(...e)=>{e.forEach((e=>{this._deconstructor.push(e)}))}}}initializeScene(e){const{renderer:t,parent:n,canvas:o,scene:r,scenes:s,camera:a,cache:l,physics:c,sceneConfig:u}=e;this.scene=r,this.scenes=s,this.camera=a,this.cache=l,this.physics=c,this.renderer=t,this.parent=n,this.canvas=o;const{autoStart:h,textureAnisotropy:d}=u;this.load=new Co(this.cache,d),this.lights=new ko(this.scene),this.transform=new v(this.camera,this.renderer),this.csg=x,this.heightMap=new Do(this.scene),this.factories=new Vo(this.scene),this.misc=new Ko(this.scene,this.renderer,this.factories),this.ws=new zo(r,t,a,this.lights,this.physics,this.load,this.factories),this.mixers=new jo,this.cameras=new gr,this.clock=new i.SUY,this.__config.enableXR&&(this.webXR=new pr(this.renderer,this.scene,this.camera)),h&&this.start(this.__config.sceneKey)}get sceneKey(){return this.__config.sceneKey}destroy(e){var t;null===(t=this.physics)||void 0===t||t.destroy(e.body),this.scene.remove(e),e=null}warpSpeed(...e){return yr(this,void 0,void 0,(function*(){return yield this.ws.warpSpeed(...e)}))}get animationMixers(){return this.mixers.mixers}get make(){return this.factories.make}get add(){return this.factories.add}haveSomeFun(e=20){fr(e,this.physics)}isRunning(){return this._isRunning}start(e,t){var n;return yr(this,void 0,void 0,(function*(){e&&e!==this.__config.sceneKey?(this.stop(),null===(n=this.scenes.get(e))||void 0===n||n._start(t)):this._start(t)}))}_start(e){var t;return yr(this,void 0,void 0,(function*(){yield null===(t=this.init)||void 0===t?void 0:t.call(this,e),yield this._preload(),yield this._create(),this.renderer.setAnimationLoop((()=>{this._update()})),this._isRunning=!0}))}restart(e){return yr(this,void 0,void 0,(function*(){yield this.stop(),yield this.start(this.__config.sceneKey,e)}))}stop(){var e,t,n;return yr(this,void 0,void 0,(function*(){this._isRunning=!1,this.renderer.setAnimationLoop(null),this.clock.start();for(let n of this._deconstructor)yield null===(e=n.dispose)||void 0===e?void 0:e.call(n),yield null===(t=n.destroy)||void 0===t?void 0:t.call(n),"function"===typeof n&&(yield null===n||void 0===n?void 0:n()),n=null;if(this._deconstructor=[],null===(n=this.physics)||void 0===n?void 0:n.rigidBodies)for(let e=this.physics.rigidBodies.length-1;e>=0;e--)this.physics.destroy(this.physics.rigidBodies[e]);for(let e=this.scene.children.length-1;e>=0;e--)this.scene.remove(this.scene.children[e])}))}setSize(e,t){this.renderer.setSize(e,t),"undefined"!==typeof this.camera.aspect&&(this.camera.aspect=e/t),this.camera.updateProjectionMatrix()}setPixelRatio(e){this.renderer.setPixelRatio(e)}init(e={}){}preload(){}create(){}update(e,t){}preRender(){}postRender(){}_preload(){var e;return yr(this,void 0,void 0,(function*(){yield null===(e=this.preload)||void 0===e?void 0:e.call(this)}))}_create(){var e;return yr(this,void 0,void 0,(function*(){yield null===(e=this.create)||void 0===e?void 0:e.call(this)}))}_update(){var e,t,n;const o=1e3*this.clock.getDelta(),r=this.clock.getElapsedTime();null===(e=this.update)||void 0===e||e.call(this,parseFloat(r.toFixed(3)),parseInt(o.toString())),null===(t=this.physics)||void 0===t||t.update(o),null===(n=this.physics)||void 0===n||n.updateDebugger(),this.animationMixers.update(o),this.preRender(),this.composer?this.composer.render():this.renderer.render(this.scene,this.camera),this.postRender()}}var xr=n(4893);
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class br{constructor(e,t){this.physics=e,this.ammo=t,this.ignoreScale=!1,this.isSoftBody=!1,this.offset={x:0,y:0,z:0},this.errors=[],this.checkCollisions=!1,this.breakable=!1,this.fractureImpulse=1,this.didUpdate=!1,this.skipUpdate=!1,this._emitUpdateEvents=!1,this._needUpdate=!1,this.tmpEuler=new i.USm,this.tmpQuaternion=new i._fP,this.tmpBtVector3=new Ammo.btVector3,this.tmpBtVector3_1=new Ammo.btVector3,this.tmpBtQuaternion=new Ammo.btQuaternion(0,0,0,1),this.eventEmitter=new xr.Events,this.name=t.name}destructor(){this.eventEmitter&&this.eventEmitter.removeAllListeners(),Ammo.destroy(this.tmpBtVector3),Ammo.destroy(this.tmpBtVector3_1),Ammo.destroy(this.tmpBtQuaternion),Ammo.destroy(this.ammo.getCollisionShape()),Ammo.destroy(this.ammo)}setupEventEmitter(){"undefined"===typeof this.eventEmitter&&(this.eventEmitter=new xr.Events)}get needUpdate(){return this._needUpdate}set needUpdate(e){!e&&this._needUpdate&&(this.didUpdate=!0),this._needUpdate=e}onUpdateEvent(e,t=!1){this.setupEventEmitter(),this._emitUpdateEvents=!0,t?this.eventEmitter.once("update",(()=>{e()})):this.eventEmitter.on("update",(()=>{e()}))}get on(){return{update:e=>this.onUpdateEvent(e),collision:e=>this.onCollision(e)}}get once(){return{update:e=>this.onUpdateEvent(e,!0)}}onCollision(e){this.checkCollisions=!0,this.physics.collisionEvents.on("collision",(t=>{const{bodies:n,event:o}=t;n[0].name===this.name?e(n[1],o):n[1].name===this.name&&e(n[0],o)}))}transform(){const e=this.physics.worldTransform;this.ammo.getMotionState().getWorldTransform(e)}refresh(){const e=this.physics.worldTransform;this.ammo.getMotionState().setWorldTransform(e)}setRotation(e,t,n){const o=this.tmpEuler.set(e,t,n),r=this.tmpQuaternion.set(0,0,0,1);r.setFromEuler(o),this.tmpBtQuaternion.setValue(0,0,0,1);const s=this.tmpBtQuaternion;s.setValue(r.x,r.y,r.z,r.w);const i=this.physics.worldTransform;i.setRotation(s)}get rotation(){let e,t,n;const o=this.physics.worldTransform,r=o.getRotation();let s=this.tmpQuaternion.set(r.x(),r.y(),r.z(),r.w());s.w>1&&(s=s.normalize());const i=2*Math.acos(s.w),a=Math.sqrt(1-s.w*s.w);return a<.001?(e=s.x,t=s.y,n=s.z):(e=s.x/a,t=s.y/a,n=s.z/a),{x:e*i,y:t*i,z:n*i}}get quaternion(){const e=this.physics.worldTransform,t=e.getRotation();return{x:t.x(),y:t.y(),z:t.z(),w:t.w()}}setPosition(e,t,n){const o=this.physics.worldTransform;o.getOrigin().setValue(e,t,n)}get position(){const e=this.physics.worldTransform;return{x:e.getOrigin().x(),y:e.getOrigin().y(),z:e.getOrigin().z()}}get velocity(){return{x:this.ammo.getLinearVelocity().x(),y:this.ammo.getLinearVelocity().y(),z:this.ammo.getLinearVelocity().z()}}get angularVelocity(){return{x:this.ammo.getAngularVelocity().x(),y:this.ammo.getAngularVelocity().y(),z:this.ammo.getAngularVelocity().z()}}setVelocity(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityX(e){this.tmpBtVector3.setValue(e,this.velocity.y,this.velocity.z),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityY(e){this.tmpBtVector3.setValue(this.velocity.x,e,this.velocity.z),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityZ(e){this.tmpBtVector3.setValue(this.velocity.x,this.velocity.y,e),this.ammo.setLinearVelocity(this.tmpBtVector3)}setAngularVelocity(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityX(e){this.tmpBtVector3.setValue(e,this.angularVelocity.y,this.angularVelocity.z),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityY(e){this.tmpBtVector3.setValue(this.angularVelocity.x,e,this.angularVelocity.z),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityZ(e){this.tmpBtVector3.setValue(this.angularVelocity.x,this.angularVelocity.y,e),this.ammo.setAngularVelocity(this.tmpBtVector3)}applyForce(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceX(e){this.tmpBtVector3.setValue(e,0,0),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceY(e){this.tmpBtVector3.setValue(0,e,0),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceZ(e){this.tmpBtVector3.setValue(0,0,e),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyCentralForce(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyCentralForce(this.tmpBtVector3)}applyCentralImpulse(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyCentralLocalForce(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyCentralLocalForce(this.tmpBtVector3)}applyImpulse(e,t){this.tmpBtVector3.setValue(e.x||0,e.y||0,e.z||0),this.tmpBtVector3_1.setValue(t.x||0,t.y||0,t.z||0),this.ammo.applyImpulse(this.tmpBtVector3,this.tmpBtVector3_1)}applyLocalTorque(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyLocalTorque(this.tmpBtVector3)}applyTorque(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyTorque(this.tmpBtVector3)}applyTorqueImpulse(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyTorqueImpulse(this.tmpBtVector3)}setCollisionFlags(e){this.ammo.setCollisionFlags(e)}getCollisionFlags(){return this.ammo.getCollisionFlags()}setRestitution(e){this.ammo.setRestitution(e)}setBounciness(e){this.setRestitution(e)}setFriction(e){this.ammo.setFriction(e)}setDamping(e,t){this.ammo.setDamping(e,t)}setGravity(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.setGravity(this.tmpBtVector3)}setLinearFactor(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.setLinearFactor(this.tmpBtVector3)}setAngularFactor(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.setAngularFactor(this.tmpBtVector3)}setCcdMotionThreshold(e){this.ammo.setCcdMotionThreshold(e)}setCcdSweptSphereRadius(e){this.ammo.setCcdSweptSphereRadius(e)}}var wr=br;
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class Ar{constructor(e,t){this.factory=e,this.addExisting=t}addPlane(e={},t={}){const n=this.factory.add.plane(e,t);return this.addExisting(n,e),n}addSphere(e={},t={}){const n=this.factory.add.sphere(e,t);return this.addExisting(n,e),n}addBox(e={},t={}){const n=this.factory.add.box(e,t);return this.addExisting(n,e),n}addGround(e,t={}){const n=this.factory.add.ground(e,t),o=Object.assign(Object.assign({},e),{mass:0,collisionFlags:1});return this.addExisting(n,o),n}addCylinder(e={},t={}){const n=this.factory.add.cylinder(e,t);return this.addExisting(n,e),n}addCone(e={},t={}){const n=this.factory.add.cone(e,t);return this.addExisting(n,e),n}addTorus(e={},t={}){const n=this.factory.add.torus(e,t);return this.addExisting(n,e),n}addExtrude(e,t={}){const n=this.factory.add.extrude(e,t);return n.translateX(1),this.addExisting(n),n}}var Sr=Ar;
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class Mr{constructor(e,t){this.worldTransform=e,this.physicsWorld=t,this.tmpBtVector3=new Ammo.btVector3}toAmmoV3(e,t=0){return new Ammo.btVector3("undefined"!==typeof(null===e||void 0===e?void 0:e.x)?e.x:t,"undefined"!==typeof(null===e||void 0===e?void 0:e.y)?e.y:t,"undefined"!==typeof(null===e||void 0===e?void 0:e.z)?e.z:t)}get addConstraints(){return{lock:(e,t,n)=>this.lock(e,t,n),fixed:(e,t,n)=>this.fixed(e,t,n),pointToPoint:(e,t,n,o)=>this.pointToPoint(e,t,n,o),hinge:(e,t,n,o)=>this.hinge(e,t,n,o),slider:(e,t,n={},o)=>this.slider(e,t,n,o),spring:(e,t,n={},o)=>this.spring(e,t,n,o),coneTwist:(e,t,n={frameA:{},frameB:{}},o)=>this.coneTwist(e,t,n,o),dof:(e,t,n,o)=>this.dof(e,t,n,o)}}getTransform(e,t,n={x:0,y:0,z:0},o=!1){n=Object.assign({x:0,y:0,z:0},n);const r=(e,t)=>{var o=(e.x()-t.x())/2+n.x,r=(e.y()-t.y())/2+n.y,s=(e.z()-t.z())/2+n.z;return new Ammo.btVector3(o,r,s)},s=new Ammo.btTransform;if(s.setIdentity(),o){const n=r(e.getWorldTransform().getOrigin(),t.getWorldTransform().getOrigin()),o=new Ammo.btTransform;o.setIdentity(),o.setOrigin(n);const s=e.getCenterOfMassTransform().inverse().op_mul(t.getWorldTransform());return s.op_mul(o),{transformA:s,transformB:o}}{s.setOrigin(new Ammo.btVector3(n.x,n.y,n.z));const o=e.getCenterOfMassTransform().inverse().op_mul(t.getWorldTransform()).op_mul(s);return{transformA:o,transformB:s}}}lock(e,t,n=!0){const o={x:0,y:0,z:0};return this.dof(e,t,{angularLowerLimit:o,angularUpperLimit:o},n)}fixed(e,t,n=!0){const o=this.getTransform(e.ammo,t.ammo);o.transformA.setRotation(e.ammo.getWorldTransform().getRotation()),o.transformB.setRotation(t.ammo.getWorldTransform().getRotation());const r=new Ammo.btFixedConstraint(e.ammo,t.ammo,o.transformA,o.transformB);return this.physicsWorld.addConstraint(r,n),r}pointToPoint(e,t,n={},o=!0){const{pivotA:r,pivotB:s}=n,i=new Ammo.btVector3((null===r||void 0===r?void 0:r.x)||0,(null===r||void 0===r?void 0:r.y)||0,(null===r||void 0===r?void 0:r.z)||0),a=new Ammo.btVector3((null===s||void 0===s?void 0:s.x)||0,(null===s||void 0===s?void 0:s.y)||0,(null===s||void 0===s?void 0:s.z)||0),l=new Ammo.btPoint2PointConstraint(e.ammo,t.ammo,i,a);return this.physicsWorld.addConstraint(l,o),l}hinge(e,t,n={},o=!0){const{pivotA:r,pivotB:s,axisA:i,axisB:a}=n,l=new Ammo.btVector3((null===r||void 0===r?void 0:r.x)||0,(null===r||void 0===r?void 0:r.y)||0,(null===r||void 0===r?void 0:r.z)||0),c=new Ammo.btVector3((null===s||void 0===s?void 0:s.x)||0,(null===s||void 0===s?void 0:s.y)||0,(null===s||void 0===s?void 0:s.z)||0),u=new Ammo.btVector3((null===i||void 0===i?void 0:i.x)||0,(null===i||void 0===i?void 0:i.y)||0,(null===i||void 0===i?void 0:i.z)||0),h=new Ammo.btVector3((null===a||void 0===a?void 0:a.x)||0,(null===a||void 0===a?void 0:a.y)||0,(null===a||void 0===a?void 0:a.z)||0),d=new Ammo.btHingeConstraint(e.ammo,t.ammo,l,c,u,h,!0);return this.physicsWorld.addConstraint(d,o),d}slider(e,t,n={},o=!0){const r=this.getTransform(e.ammo,t.ammo),{frameA:s={},frameB:i={},linearLowerLimit:a=0,linearUpperLimit:l=0,angularLowerLimit:c=0,angularUpperLimit:u=0}=n,h=r.transformA.getRotation();h.setEulerZYX(s.x||0,s.y||0,s.z||0),r.transformA.setRotation(h);const d=r.transformB.getRotation();d.setEulerZYX(i.x||0,i.y||0,i.z||0),r.transformB.setRotation(d);const p=new Ammo.btSliderConstraint(e.ammo,t.ammo,r.transformA,r.transformB,!0);return p.setLowerLinLimit(a),p.setUpperLinLimit(l),p.setLowerAngLimit(c),p.setUpperAngLimit(u),this.physicsWorld.addConstraint(p,o),p}spring(e,t,n={},o=!0){const{stiffness:r=50,damping:s=.01,angularLock:i=!1,linearLowerLimit:a={},linearUpperLimit:l={},angularLowerLimit:c={},angularUpperLimit:u={},offset:h={},center:d=!1,enableSpring:p=!0}=n,m=Object.assign({x:0,y:0,z:0},h),f=this.getTransform(e.ammo,t.ammo,m,d),g=new Ammo.btGeneric6DofSpringConstraint(e.ammo,t.ammo,f.transformA,f.transformB,!0);this.tmpBtVector3.setValue(a.x||0,a.y||0,a.z||0),g.setLinearLowerLimit(this.tmpBtVector3),this.tmpBtVector3.setValue(l.x||0,l.y||0,l.z||0),g.setLinearUpperLimit(this.tmpBtVector3),i?(this.tmpBtVector3.setValue(0,0,0),g.setAngularLowerLimit(this.tmpBtVector3),g.setAngularUpperLimit(this.tmpBtVector3)):(console.log(c,u),g.setAngularLowerLimit(this.toAmmoV3(c,-Math.PI)),g.setAngularUpperLimit(this.toAmmoV3(u,Math.PI)));for(let y=0;y<3;y++)g.enableSpring(y,p),g.setStiffness(y,r),g.setDamping(y,s);return this.physicsWorld.addConstraint(g,o),g}coneTwist(e,t,n,o=!0){const{frameA:r,frameB:s}=n,i=new Ammo.btTransform;i.setIdentity(),i.getOrigin().setValue((null===r||void 0===r?void 0:r.x)||0,(null===r||void 0===r?void 0:r.y)||0,(null===r||void 0===r?void 0:r.z)||0);const a=new Ammo.btTransform;a.setIdentity(),a.getOrigin().setValue((null===s||void 0===s?void 0:s.x)||0,(null===s||void 0===s?void 0:s.y)||0,(null===s||void 0===s?void 0:s.z)||0);this.getTransform(e.ammo,t.ammo);const l=new Ammo.btConeTwistConstraint(t.ammo,e.ammo,i,a);return l.setAngularOnly(!0),this.physicsWorld.addConstraint(l,o),l}dof(e,t,n={},o=!0){const{offset:r,center:s=!1}=n,i=Object.assign({x:0,y:0,z:0},r),a=this.getTransform(e.ammo,t.ammo,i,s),l=new Ammo.btGeneric6DofConstraint(e.ammo,t.ammo,a.transformA,a.transformB,!0),{linearLowerLimit:c,linearUpperLimit:u,angularLowerLimit:h,angularUpperLimit:d}=n,p=this.toAmmoV3(c),m=this.toAmmoV3(u),f=this.toAmmoV3(h,-Math.PI),g=this.toAmmoV3(d,Math.PI);return l.setLinearLowerLimit(p),l.setLinearUpperLimit(m),l.setAngularLowerLimit(f),l.setAngularUpperLimit(g),Ammo.destroy(p),Ammo.destroy(m),Ammo.destroy(f),Ammo.destroy(g),this.physicsWorld.addConstraint(l,o),l}}
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
const Tr=(e,t)=>{const{radius:n=1,tube:o=.4,tubularSegments:r=8}=e,s=Math.PI,i=r,a=Math.sqrt(2*o*o-2*o*o*Math.cos(2*s/i)),l=new Ammo.btVector3(o,s/i+.5*a,o),c=new Ammo.btCylinderShape(l);c.setMargin(.05);const u=new Ammo.btCompoundShape,h=new Ammo.btVector3(0,0,1),d=new Ammo.btVector3(0,n,0),p=new Ammo.btQuaternion(t.x,t.y,t.z,t.w);for(let m=0;m<i;m++){const e=2*m*s/i,t=d.rotate(h,e),n=new Ammo.btTransform;p.setRotation(h,e+Math.PI/2),n.setIdentity(),n.setOrigin(t),n.setRotation(p),u.addChildShape(n,c)}return u};
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class Pr extends xr.Events{addCollider(e,t,n){e.body&&t.body&&(e.body.checkCollisions=!0,t.body.checkCollisions=!0,this.on("collision",(o=>{var r,s;const{bodies:i,event:a}=o;(null===(r=i[0])||void 0===r?void 0:r.name)&&(null===(s=i[1])||void 0===s?void 0:s.name)&&(null===e||void 0===e?void 0:e.name)&&(null===t||void 0===t?void 0:t.name)&&(i[0].name===e.name&&i[1].name===t.name||i[1].name===e.name&&i[0].name===t.name)&&n(a)})))}}
/**
 * @author       Kevin Lee (https://github.com/InfiniteLee)
 * @copyright    Copyright (c) 2019 Kevin Lee; Project Url: https://github.com/InfiniteLee/ammo-debug-drawer
 * @license      {@link https://github.com/InfiniteLee/ammo-debug-drawer/blob/master/LICENSE|MPL-2.0}
 */
const Cr={NoDebug:0,DrawWireframe:1,DrawAabb:2,DrawFeaturesText:4,DrawContactPoints:8,NoDeactivation:16,NoHelpText:32,DrawText:64,ProfileTimings:128,EnableSatComparison:256,DisableBulletLCP:512,EnableCCD:1024,DrawConstraints:2048,DrawConstraintLimits:4096,FastWireframe:8192,DrawNormals:16384,DrawOnTop:32768,MAX_DEBUG_DRAW_MODE:4294967295};class Er{constructor(e,t,n={}){this.scene=e,this.world=t,this.options=n,this.debugDrawMode=n.debugDrawMode||Cr.DrawWireframe;const o=this.debugDrawMode&Cr.DrawOnTop||!1,r=n.maxBufferSize||1e6;this.geometry=new i.u9r;const s=new Float32Array(3*r),a=new Float32Array(3*r);this.geometry.setAttribute("position",new i.TlE(s,3).setUsage(i.W2J)),this.geometry.setAttribute("color",new i.TlE(a,3).setUsage(i.W2J)),this.index=0;const l=new i.nls({vertexColors:!0,depthTest:!o});this.mesh=new i.ejS(this.geometry,l),o&&(this.mesh.renderOrder=999),this.mesh.frustumCulled=!1,this.enabled=!1,this.debugDrawer=new Ammo.DebugDrawer,this.debugDrawer.drawLine=this.drawLine.bind(this),this.debugDrawer.drawContactPoint=this.drawContactPoint.bind(this),this.debugDrawer.reportErrorWarning=this.reportErrorWarning.bind(this),this.debugDrawer.draw3dText=this.draw3dText.bind(this),this.debugDrawer.setDebugMode=this.setDebugMode.bind(this),this.debugDrawer.getDebugMode=this.getDebugMode.bind(this),this.world.setDebugDrawer(this.debugDrawer)}enable(){this.enabled=!0,this.scene.add(this.mesh)}disable(){this.enabled=!1,this.scene.remove(this.mesh)}update(){this.enabled&&(0!=this.index&&(this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0),this.index=0,this.world.debugDrawWorld(),this.geometry.setDrawRange(0,this.index))}drawLine(e,t,n){const o=Ammo.HEAPF32,r=o[(n+0)/4],s=o[(n+4)/4],i=o[(n+8)/4],a=o[(e+0)/4],l=o[(e+4)/4],c=o[(e+8)/4];this.geometry.attributes.position.setXYZ(this.index,a,l,c),this.geometry.attributes.color.setXYZ(this.index++,r,s,i);const u=o[(t+0)/4],h=o[(t+4)/4],d=o[(t+8)/4];this.geometry.attributes.position.setXYZ(this.index,u,h,d),this.geometry.attributes.color.setXYZ(this.index++,r,s,i)}drawContactPoint(e,t,n,o,r){const s=Ammo.HEAPF32,i=s[(r+0)/4],a=s[(r+4)/4],l=s[(r+8)/4],c=s[(e+0)/4],u=s[(e+4)/4],h=s[(e+8)/4];this.geometry.attributes.position.setXYZ(this.index,c,u,h),this.geometry.attributes.color.setXYZ(this.index++,i,a,l);const d=s[(t+0)/4]*n,p=s[(t+4)/4]*n,m=s[(t+8)/4]*n;this.geometry.attributes.position.setXYZ(this.index,c+d,u+p,h+m),this.geometry.attributes.color.setXYZ(this.index++,i,a,l)}reportErrorWarning(e){Ammo.hasOwnProperty("Pointer_stringify")?console.warn(Ammo.Pointer_stringify(e)):this.warnedOnce||(this.warnedOnce=!0,console.warn("Cannot print warningString, please rebuild Ammo.js using 'debug' flag"))}draw3dText(e,t){console.warn("TODO: draw3dText")}setDebugMode(e){this.debugDrawMode=e}getDebugMode(){return this.debugDrawMode}}var kr=Er;n(2262),n(4506);const _r=0,Ir=1,Rr=new i.Pa4,Lr=new i.Zzh,Nr=new i.JOQ,Br=new i.Pa4,Or=new i.CJI;class Vr{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new zr,this.unassigned=new zr,this.vertices=[]}setFromPoints(e){if(e.length>=4){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.vertices.push(new Ur(e[t]));this.compute()}return this}setFromObject(e){const t=[];return e.updateMatrixWorld(!0),e.traverse((function(e){const n=e.geometry;if(void 0!==n){if(n.isGeometry)return void console.error("THREE.ConvexHull no longer supports Geometry. Use THREE.BufferGeometry instead.");if(n.isBufferGeometry){const o=n.attributes.position;if(void 0!==o)for(let n=0,r=o.count;n<r;n++){const r=new i.Pa4;r.fromBufferAttribute(o,n).applyMatrix4(e.matrixWorld),t.push(r)}}}})),this.setFromPoints(t)}containsPoint(e){const t=this.faces;for(let n=0,o=t.length;n<o;n++){const o=t[n];if(o.distanceToPoint(e)>this.tolerance)return!1}return!0}intersectRay(e,t){const n=this.faces;let o=-1/0,r=1/0;for(let s=0,i=n.length;s<i;s++){const t=n[s],i=t.distanceToPoint(e.origin),a=t.normal.dot(e.direction);if(i>0&&a>=0)return null;const l=0!==a?-i/a:0;if(!(l<=0)&&(a>0?r=Math.min(l,r):o=Math.max(l,o),o>r))return null}return o!==-1/0?e.at(o,t):e.at(r,t),t}intersectsRay(e){return null!==this.intersectRay(e,Rr)}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(e,t){return e.face=t,null===t.outside?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this}removeVertexFromFace(e,t){return e===t.outside&&(null!==e.next&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this}removeAllVerticesFromFace(e){if(null!==e.outside){const t=e.outside;let n=e.outside;while(null!==n.next&&n.next.face===e)n=n.next;return this.assigned.removeSubList(t,n),t.prev=n.next=null,e.outside=null,t}}deleteFaceVertices(e,t){const n=this.removeAllVerticesFromFace(e);if(void 0!==n)if(void 0===t)this.unassigned.appendChain(n);else{let e=n;do{const n=e.next,o=t.distanceToPoint(e.point);o>this.tolerance?this.addVertexToFace(e,t):this.unassigned.append(e),e=n}while(null!==e)}return this}resolveUnassignedPoints(e){if(!1===this.unassigned.isEmpty()){let t=this.unassigned.first();do{const n=t.next;let o=this.tolerance,r=null;for(let s=0;s<e.length;s++){const n=e[s];if(n.mark===_r){const e=n.distanceToPoint(t.point);if(e>o&&(o=e,r=n),o>1e3*this.tolerance)break}}null!==r&&this.addVertexToFace(t,r),t=n}while(null!==t)}return this}computeExtremes(){const e=new i.Pa4,t=new i.Pa4,n=[],o=[];for(let r=0;r<3;r++)n[r]=o[r]=this.vertices[0];e.copy(this.vertices[0].point),t.copy(this.vertices[0].point);for(let r=0,s=this.vertices.length;r<s;r++){const s=this.vertices[r],i=s.point;for(let t=0;t<3;t++)i.getComponent(t)<e.getComponent(t)&&(e.setComponent(t,i.getComponent(t)),n[t]=s);for(let e=0;e<3;e++)i.getComponent(e)>t.getComponent(e)&&(t.setComponent(e,i.getComponent(e)),o[e]=s)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e.x),Math.abs(t.x))+Math.max(Math.abs(e.y),Math.abs(t.y))+Math.max(Math.abs(e.z),Math.abs(t.z))),{min:n,max:o}}computeInitialHull(){const e=this.vertices,t=this.computeExtremes(),n=t.min,o=t.max;let r=0,s=0;for(let h=0;h<3;h++){const e=o[h].point.getComponent(h)-n[h].point.getComponent(h);e>r&&(r=e,s=h)}const i=n[s],a=o[s];let l,c;r=0,Lr.set(i.point,a.point);for(let h=0,d=this.vertices.length;h<d;h++){const t=e[h];if(t!==i&&t!==a){Lr.closestPointToPoint(t.point,!0,Br);const e=Br.distanceToSquared(t.point);e>r&&(r=e,l=t)}}r=-1,Nr.setFromCoplanarPoints(i.point,a.point,l.point);for(let h=0,d=this.vertices.length;h<d;h++){const t=e[h];if(t!==i&&t!==a&&t!==l){const e=Math.abs(Nr.distanceToPoint(t.point));e>r&&(r=e,c=t)}}const u=[];if(Nr.distanceToPoint(c.point)<0){u.push(Dr.create(i,a,l),Dr.create(c,a,i),Dr.create(c,l,a),Dr.create(c,i,l));for(let e=0;e<3;e++){const t=(e+1)%3;u[e+1].getEdge(2).setTwin(u[0].getEdge(t)),u[e+1].getEdge(1).setTwin(u[t+1].getEdge(0))}}else{u.push(Dr.create(i,l,a),Dr.create(c,i,a),Dr.create(c,a,l),Dr.create(c,l,i));for(let e=0;e<3;e++){const t=(e+1)%3;u[e+1].getEdge(2).setTwin(u[0].getEdge((3-e)%3)),u[e+1].getEdge(0).setTwin(u[t+1].getEdge(1))}}for(let h=0;h<4;h++)this.faces.push(u[h]);for(let h=0,d=e.length;h<d;h++){const t=e[h];if(t!==i&&t!==a&&t!==l&&t!==c){r=this.tolerance;let e=null;for(let n=0;n<4;n++){const o=this.faces[n].distanceToPoint(t.point);o>r&&(r=o,e=this.faces[n])}null!==e&&this.addVertexToFace(t,e)}}return this}reindexFaces(){const e=[];for(let t=0;t<this.faces.length;t++){const n=this.faces[t];n.mark===_r&&e.push(n)}return this.faces=e,this}nextVertexToAdd(){if(!1===this.assigned.isEmpty()){let e,t=0;const n=this.assigned.first().face;let o=n.outside;do{const r=n.distanceToPoint(o.point);r>t&&(t=r,e=o),o=o.next}while(null!==o&&o.face===n);return e}}computeHorizon(e,t,n,o){let r;this.deleteFaceVertices(n),n.mark=Ir,r=null===t?t=n.getEdge(0):t.next;do{const t=r.twin,n=t.face;n.mark===_r&&(n.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,t,n,o):o.push(r)),r=r.next}while(r!==t);return this}addAdjoiningFace(e,t){const n=Dr.create(e,t.tail(),t.head());return this.faces.push(n),n.getEdge(-1).setTwin(t.twin),n.getEdge(0)}addNewFaces(e,t){this.newFaces=[];let n=null,o=null;for(let r=0;r<t.length;r++){const s=t[r],i=this.addAdjoiningFace(e,s);null===n?n=i:i.next.setTwin(o),this.newFaces.push(i.face),o=i}return n.next.setTwin(o),this}addVertexToHull(e){const t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let e;this.computeInitialHull();while(void 0!==(e=this.nextVertexToAdd()))this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}}class Dr{constructor(){this.normal=new i.Pa4,this.midpoint=new i.Pa4,this.area=0,this.constant=0,this.outside=null,this.mark=_r,this.edge=null}static create(e,t,n){const o=new Dr,r=new Fr(e,o),s=new Fr(t,o),i=new Fr(n,o);return r.next=i.prev=s,s.next=r.prev=i,i.next=s.prev=r,o.edge=r,o.compute()}getEdge(e){let t=this.edge;while(e>0)t=t.next,e--;while(e<0)t=t.prev,e++;return t}compute(){const e=this.edge.tail(),t=this.edge.head(),n=this.edge.next.head();return Or.set(e.point,t.point,n.point),Or.getNormal(this.normal),Or.getMidpoint(this.midpoint),this.area=Or.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(e){return this.normal.dot(e)-this.constant}}class Fr{constructor(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const e=this.head(),t=this.tail();return null!==t?t.point.distanceTo(e.point):-1}lengthSquared(){const e=this.head(),t=this.tail();return null!==t?t.point.distanceToSquared(e.point):-1}setTwin(e){return this.twin=e,e.twin=this,this}}class Ur{constructor(e){this.point=e,this.prev=null,this.next=null,this.face=null}}class zr{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(e,t){return t.prev=e.prev,t.next=e,null===t.prev?this.head=t:t.prev.next=t,e.prev=t,this}insertAfter(e,t){return t.prev=e,t.next=e.next,null===t.next?this.tail=t:t.next.prev=t,e.next=t,this}append(e){return null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this}appendChain(e){null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail;while(null!==e.next)e=e.next;return this.tail=e,this}remove(e){return null===e.prev?this.head=e.next:e.prev.next=e.next,null===e.next?this.tail=e.prev:e.next.prev=e.prev,this}removeSubList(e,t){return null===e.prev?this.head=t.next:e.prev.next=t.next,null===t.next?this.tail=e.prev:t.next.prev=e.prev,this}isEmpty(){return null===this.head}}class Hr extends i.u9r{constructor(e=[]){super();const t=[],n=[];void 0===Vr&&console.error("THREE.ConvexBufferGeometry: ConvexBufferGeometry relies on ConvexHull");const o=(new Vr).setFromPoints(e),r=o.faces;for(let s=0;s<r.length;s++){const e=r[s];let o=e.edge;do{const r=o.head().point;t.push(r.x,r.y,r.z),n.push(e.normal.x,e.normal.y,e.normal.z),o=o.next}while(o!==e.edge)}this.setAttribute("position",new i.a$l(t,3)),this.setAttribute("normal",new i.a$l(n,3))}}const jr=e=>{const t=window.THREE&&window.THREE.ConvexGeometry?window.THREE.ConvexGeometry:Hr;return new t(e)},Gr=function(e,t){this.minSizeForBreak=e||1.4,this.smallDelta=t||1e-4,this.tempLine1=new i.Zzh,this.tempPlane1=new i.JOQ,this.tempPlane2=new i.JOQ,this.tempPlane_Cut=new i.JOQ,this.tempCM1=new i.Pa4,this.tempCM2=new i.Pa4,this.tempVector3=new i.Pa4,this.tempVector3_2=new i.Pa4,this.tempVector3_3=new i.Pa4,this.tempVector3_P0=new i.Pa4,this.tempVector3_P1=new i.Pa4,this.tempVector3_P2=new i.Pa4,this.tempVector3_N0=new i.Pa4,this.tempVector3_N1=new i.Pa4,this.tempVector3_AB=new i.Pa4,this.tempVector3_CB=new i.Pa4,this.tempResultObjects={object1:null,object2:null},this.segments=[];for(var n=900,o=0;o<n;o++)this.segments[o]=!1};Gr.prototype={constructor:Gr,prepareBreakableObject:function(e,t,n,o,r){e.geometry.isBufferGeometry||console.error("THREE.ConvexObjectBreaker.prepareBreakableObject(): Parameter object must have a BufferGeometry."),e.userData.ammoPhysicsData={};var s=e.userData.ammoPhysicsData;s.mass=t,s.velocity=n.clone(),s.angularVelocity=o.clone(),s.breakable=r},subdivideByImpact:function(e,t,n,o,r){var s=[],i=this.tempPlane1,a=this.tempPlane2;this.tempVector3.addVectors(t,n),i.setFromCoplanarPoints(t,e.position,this.tempVector3);var l=r+o,c=this;function u(r,h,d,p){if(Math.random()<.05*p||p>l)s.push(r);else{var m=Math.PI;0===p?(a.normal.copy(i.normal),a.constant=i.constant):p<=o?(m=(d-h)*(.2+.6*Math.random())+h,c.tempVector3_2.copy(e.position).sub(t).applyAxisAngle(n,m).add(t),a.setFromCoplanarPoints(t,c.tempVector3,c.tempVector3_2)):(m=(.5*(1&p)+.2*(2-Math.random()))*Math.PI,c.tempVector3_2.copy(t).sub(r.position).applyAxisAngle(n,m).add(r.position),c.tempVector3_3.copy(n).add(r.position),a.setFromCoplanarPoints(r.position,c.tempVector3_3,c.tempVector3_2)),c.cutByPlane(r,a,c.tempResultObjects);var f=c.tempResultObjects.object1,g=c.tempResultObjects.object2;f&&u(f,h,m,p+1),g&&u(g,m,d,p+1)}}return u(e,0,2*Math.PI,0),s},cutByPlane:function(e,t,n){var o=e.geometry,r=o.attributes.position.array,s=o.attributes.normal.array,a=r.length/3,l=a/3,c=o.getIndex();function u(e,t){var n=3*e+t;return c?c[n]:n}c&&(c=c.array,l=c.length/3);for(var h=[],d=[],p=this.smallDelta,m=a*a,f=0;f<m;f++)this.segments[f]=!1;var g=this.tempVector3_P0,y=this.tempVector3_P1,v=this.tempVector3_N0,x=this.tempVector3_N1;for(f=0;f<l-1;f++){var b=u(f,0),w=u(f,1),A=u(f,2);v.set(s[b],s[b]+1,s[b]+2);for(var S=f+1;S<l;S++){var M=u(S,0),T=u(S,1),P=u(S,2);x.set(s[M],s[M]+1,s[M]+2);var C=1-v.dot(x)<p;C&&(b===M||b===T||b===P?w===M||w===T||w===P?(this.segments[b*a+w]=!0,this.segments[w*a+b]=!0):(this.segments[A*a+b]=!0,this.segments[b*a+A]=!0):w!==M&&w!==T&&w!==P||(this.segments[A*a+w]=!0,this.segments[w*a+A]=!0))}}var E=this.tempPlane_Cut;e.updateMatrix(),Gr.transformPlaneToLocalSpace(t,e.matrix,E);for(f=0;f<l;f++)for(var k=u(f,0),_=u(f,1),I=u(f,2),R=0;R<3;R++){var L=0===R?k:1===R?_:I,N=0===R?_:1===R?I:k,B=this.segments[L*a+N];if(!B){this.segments[L*a+N]=!0,this.segments[N*a+L]=!0,g.set(r[3*L],r[3*L+1],r[3*L+2]),y.set(r[3*N],r[3*N+1],r[3*N+2]);var O=0,V=E.distanceToPoint(g);V>p?(O=2,d.push(g.clone())):V<-p?(O=1,h.push(g.clone())):(O=3,h.push(g.clone()),d.push(g.clone()));var D=0;V=E.distanceToPoint(y);if(V>p?(D=2,d.push(y.clone())):V<-p?(D=1,h.push(y.clone())):(D=3,h.push(y.clone()),d.push(y.clone())),1===O&&2===D||2===O&&1===D){this.tempLine1.start.copy(g),this.tempLine1.end.copy(y);var F=new i.Pa4;if(F=E.intersectLine(this.tempLine1,F),void 0===F)return console.error("Internal error: segment does not intersect plane."),n.segmentedObject1=null,n.segmentedObject2=null,0;h.push(F),d.push(F.clone())}}}var U=.5*e.userData.ammoPhysicsData.mass;this.tempCM1.set(0,0,0);var z=0,H=h.length;if(H>0){for(f=0;f<H;f++)this.tempCM1.add(h[f]);this.tempCM1.divideScalar(H);for(f=0;f<H;f++){var j=h[f];j.sub(this.tempCM1),z=Math.max(z,j.x,j.y,j.z)}this.tempCM1.add(e.position)}this.tempCM2.set(0,0,0);var G=0,W=d.length;if(W>0){for(f=0;f<W;f++)this.tempCM2.add(d[f]);this.tempCM2.divideScalar(W);for(f=0;f<W;f++){j=d[f];j.sub(this.tempCM2),G=Math.max(G,j.x,j.y,j.z)}this.tempCM2.add(e.position)}var X=null,q=null,K=0;if(H>4)try{X=new i.Kj0(jr(h),e.material),X.position.copy(this.tempCM1),X.quaternion.copy(e.quaternion),X.userData=e.userData,this.prepareBreakableObject(X,U,e.userData.ammoPhysicsData.velocity,e.userData.ammoPhysicsData.angularVelocity,2*z>this.minSizeForBreak),K++}catch($){Lo("Error in ConvexObjectBreaker.ts",!0),Lo($,!0)}if(W>4)try{q=new i.Kj0(jr(d),e.material),q.position.copy(this.tempCM2),q.quaternion.copy(e.quaternion),q.userData=e.userData,this.prepareBreakableObject(q,U,e.userData.ammoPhysicsData.velocity,e.userData.ammoPhysicsData.angularVelocity,2*G>this.minSizeForBreak),K++}catch($){Lo("Error in ConvexObjectBreaker.ts",!0),Lo($,!0)}return n.object1=X,n.object2=q,K}},Gr.transformFreeVector=function(e,t){var n=e.x,o=e.y,r=e.z,s=t.elements;return e.x=s[0]*n+s[4]*o+s[8]*r,e.y=s[1]*n+s[5]*o+s[9]*r,e.z=s[2]*n+s[6]*o+s[10]*r,e},Gr.transformFreeVectorInverse=function(e,t){var n=e.x,o=e.y,r=e.z,s=t.elements;return e.x=s[0]*n+s[1]*o+s[2]*r,e.y=s[4]*n+s[5]*o+s[6]*r,e.z=s[8]*n+s[9]*o+s[10]*r,e},Gr.transformTiedVectorInverse=function(e,t){var n=e.x,o=e.y,r=e.z,s=t.elements;return e.x=s[0]*n+s[1]*o+s[2]*r-s[12],e.y=s[4]*n+s[5]*o+s[6]*r-s[13],e.z=s[8]*n+s[9]*o+s[10]*r-s[14],e},Gr.transformPlaneToLocalSpace=function(){var e=new i.Pa4;return function(t,n,o){o.normal.copy(t.normal),o.constant=t.constant;var r=Gr.transformTiedVectorInverse(t.coplanarPoint(e),n);Gr.transformFreeVectorInverse(o.normal,n),o.constant=-r.dot(o.normal)}}();const Wr=(()=>{try{if("object"===typeof WebAssembly&&"function"===typeof WebAssembly.instantiate){const e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(e instanceof WebAssembly.Module)return new WebAssembly.Instance(e)instanceof WebAssembly.Instance}}catch(e){e instanceof Error&&console.error(e.message)}return!1})(),Xr=(e,t)=>{var n=document.createElement("script");n.onload=()=>{t()},n.onerror=()=>{throw new Error(`failed to load ${e}`)},n.async=!0,n.src=e,document.head.appendChild(n)},qr=(e,t)=>{Xr(Wr?`${e}/ammo.wasm.js`:`${e}/ammo.js`,(()=>t()))};var Kr=qr;const $r=(e,t)=>{"undefined"!==typeof window&&(window.__loadPhysics=!0),Kr(e,(()=>{Ammo().then((()=>{t()}))}))};function Zr(e,t){t.forEach((t=>{Object.getOwnPropertyNames(t.prototype).forEach((n=>{Object.defineProperty(e.prototype,n,Object.getOwnPropertyDescriptor(t.prototype,n)||Object.create(null))}))}))}var Yr=Zr;
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class Qr{constructor(e){this.physics=e}getHitPointWorld(){const e=this._btRayCallback.get_m_hitPointWorld(),t={x:e.x(),y:e.y(),z:e.z()};return t}getHitNormalWorld(){const e=this._btRayCallback.get_m_hitNormalWorld(),t={x:e.x(),y:e.y(),z:e.z()};return t}getCollisionObject(){const e=Ammo.castObject(this._btRayCallback.get_m_collisionObject(),Ammo.btRigidBody);return e.threeObject}}
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class Jr{constructor(e){this.physics=e}getHitPointsWorld(){const e=this._btRayCallback.get_m_hitPointWorld(),t=[];for(let n=e.size()-1;n>=0;n--){const o=e.at(n);t.push({x:o.x(),y:o.y(),z:o.z()})}return t}getHitPointWorld(){return Lo("Use getHitPointsWorld() instead of getHitPointWorld() for the AllHitsRayCaster!"),this.getHitPointsWorld()}getHitNormalsWorld(){const e=this._btRayCallback.get_m_hitNormalWorld(),t=[];for(let n=e.size()-1;n>=0;n--){const o=e.at(n);t.push({x:o.x(),y:o.y(),z:o.z()})}return t}getCollisionObjects(){const e=[],t=this._btRayCallback.get_m_collisionObjects();for(let n=t.size()-1;n>=0;n--){const o=Ammo.castObject(t.at(n),Ammo.btRigidBody);e.push(o.threeObject)}return e}}
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class es{constructor(e){this.physics=e}setRayFromWorld(e=0,t=0,n=0){this._btRayFrom.setValue(e,t,n)}setRayToWorld(e=0,t=0,n=0){this._btRayTo.setValue(e,t,n)}hasHit(){return this._btRayCallback.hasHit()}rayTest(){"undefined"!==typeof this._btRayCallback&&Ammo.destroy(this._btRayCallback),this._btRayCallback="closest"===this.type?new Ammo.ClosestRayResultCallback(this._btRayFrom,this._btRayTo):new Ammo.AllHitsRayResultCallback(this._btRayFrom,this._btRayTo),this.physics.physicsWorld.rayTest(this._btRayFrom,this._btRayTo,this._btRayCallback)}destroy(){"undefined"!==typeof this._btRayFrom&&Ammo.destroy(this._btRayFrom),"undefined"!==typeof this._btRayTo&&Ammo.destroy(this._btRayTo),"undefined"!==typeof this._btRayCallback&&Ammo.destroy(this._btRayCallback)}}class ts{constructor(e){this.physics=e,this.type="closest",this._btRayFrom=new Ammo.btVector3(0,0,0),this._btRayTo=new Ammo.btVector3(0,0,0)}}class ns{constructor(e){this.physics=e,this.type="allHits",this._btRayFrom=new Ammo.btVector3(0,0,0),this._btRayTo=new Ammo.btVector3(0,0,0)}}Yr(ts,[es,Qr]),Yr(ns,[es,Jr]);
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
const{createHACDShapes:os,createHullShape:rs,createTriMeshShape:ss,createVHACDShapes:is,iterateGeometries:as}=n(8423);class ls extends xr.Events{constructor(e,t={}){super(),this.scene=e,this.config=t,this.rigidBodies=[],this.earlierDetectedCollisions=[],this.complexShapes=["plane","hull","hacd","vhacd","convexMesh","concaveMesh"],this.gravity=t.gravity||{x:0,y:-9.81,z:0},this.isHeadless="headless"===e,this.tmpEuler=new i.USm,this.tmpQuaternion=new i._fP,this.tmpVector3=new i.Pa4,this.tmpVector3a=new i.Pa4,this.tmpMatrix4=new i.yGw,this.tmpMatrix4a=new i.yGw,this.tmpBtVector3=new Ammo.btVector3,this.tmpBtQuaternion=new Ammo.btQuaternion(0,0,0,1),this.emptyV3=new i.Pa4,this.impactPoint=new i.Pa4,this.impactNormal=new i.Pa4,"headless"!==e&&(this.defaultMaterial=new Bo),this.start()}get tmpTrans(){return console.warn("Use worldTransform instead of tmpTrans."),this.worldTransform}set tmpTrans(e){console.warn("Use worldTransform instead of tmpTrans."),this.worldTransform=e}destroy(e){var t;const n=Object.keys(e).includes("body")?e.body:e;if("undefined"===typeof(null===n||void 0===n?void 0:n.ammo))return;let o=n.ammo.threeObject;const r=o.name;if(r&&o&&(null===(t=null===o||void 0===o?void 0:o.body)||void 0===t?void 0:t.ammo)){o.body.isSoftBody?this.physicsWorld.removeSoftBody(o.body.ammo):this.physicsWorld.removeRigidBody(o.body.ammo),o.body.destructor(),o.body=void 0,o.hasBody=!1,delete n.ammo.threeObject;for(let e=0;e<this.rigidBodies.length;e++)this.rigidBodies[e].name===r&&(this.rigidBodies.splice(e,1),e--)}"headless"===this.scene&&o&&(o=null)}setup(){if(this.worldTransform=new Ammo.btTransform,"function"===typeof this.config.setupPhysicsWorld?this.physicsWorld=this.config.setupPhysicsWorld():this.physicsWorld=this.setupPhysicsWorld(),"headless"!==this.scene){this.convexBreaker=new Gr,this.objectsToRemove=[],this.numObjectsToRemove=0;for(let e=0;e<500;e++)this.objectsToRemove[e]=null}this.collisionEvents=new Pr,this.factory=new Vo(this.scene),this.shapes=new Sr(this.factory,((e,t)=>this.addExisting(e,t))),this.constraints=new Mr(this.worldTransform,this.physicsWorld),"headless"!==this.scene&&(this.debugDrawer=new kr(this.scene,this.physicsWorld,{}))}updateDebugger(){"headless"!==this.scene&&this.debugDrawer&&this.debugDrawer.enabled&&this.debugDrawer.update()}setupPhysicsWorld(){const e=this.gravity,{softBodies:t=!1}=this.config;let n;if(!t){const e=new Ammo.btDefaultCollisionConfiguration,t=new Ammo.btCollisionDispatcher(e),o=new Ammo.btDbvtBroadphase,r=new Ammo.btSequentialImpulseConstraintSolver;n=new Ammo.btDiscreteDynamicsWorld(t,o,r,e)}if(t){const e=new Ammo.btSoftBodyRigidBodyCollisionConfiguration,t=new Ammo.btCollisionDispatcher(e),o=new Ammo.btDbvtBroadphase,r=new Ammo.btSequentialImpulseConstraintSolver,s=new Ammo.btDefaultSoftBodySolver;n=new Ammo.btSoftRigidDynamicsWorld(t,o,r,e,s)}return n.setGravity(new Ammo.btVector3(e.x,e.y,e.z)),n}createDebrisFromBreakableObject(e,t){"headless"!==this.scene&&(e.material=t.material,e.shape="hull",e.fragmentDepth=t.fragmentDepth+1,e.name=`${t.name}__DEBRIS_${e.id}`,this.scene.add(e),this.addExisting(e,{autoCenter:!0}),e.body.fractureImpulse=t.body.fractureImpulse,e.body.breakable=!1,setTimeout((()=>{e.body.breakable=!0}),2500))}removeDebris(e){"headless"!==this.scene&&(this.scene.remove(e),this.destroy(e))}update(e){this.updatePhysics(e),this.detectCollisions()}updatePhysics(e){const t=e/1e3;this.physicsWorld.stepSimulation(t,this.config.maxSubSteps||4,this.config.fixedTimeStep||1/60);for(let n=0;n<this.rigidBodies.length;n++){const e=this.rigidBodies[n],t=e.body.ammo,o=t.getMotionState();if(o)if(o.getWorldTransform(this.worldTransform),e.body.didUpdate&&(e.body._emitUpdateEvents&&e.body.eventEmitter.emit("update"),e.body.didUpdate=!1),e.body.ammo.isKinematicObject()&&e.body.needUpdate)e.getWorldQuaternion(this.tmpQuaternion),e.getWorldPosition(this.tmpVector3),this.tmpBtVector3.setValue(this.tmpVector3.x,this.tmpVector3.y,this.tmpVector3.z),this.tmpBtQuaternion.setValue(this.tmpQuaternion.x,this.tmpQuaternion.y,this.tmpQuaternion.z,this.tmpQuaternion.w),this.worldTransform.setOrigin(this.tmpBtVector3),this.worldTransform.setRotation(this.tmpBtQuaternion),o.setWorldTransform(this.worldTransform),e.body.needUpdate=!1;else if(e.body.skipUpdate);else if(!e.body.ammo.isStaticObject()){const t=this.worldTransform.getOrigin(),n=this.worldTransform.getRotation(),o=e.body.offset;if(e.body.ignoreScale)this.tmpVector3a.set(e.scale.x,e.scale.y,e.scale.z);else{const t=e.body.ammo.getCollisionShape().getLocalScaling();this.tmpVector3a.set(t.x(),t.y(),t.z())}this.tmpVector3.set(t.x()+o.x,t.y()+o.y,t.z()+o.z),this.tmpQuaternion.set(n.x(),n.y(),n.z(),n.w()),this.tmpMatrix4.compose(this.tmpVector3,this.tmpQuaternion,this.tmpVector3a),e.parent?parseInt(i.UZH)>=123?this.tmpMatrix4a.copy(e.parent.matrixWorld).invert():this.tmpMatrix4a.getInverse(e.parent.matrixWorld):this.tmpMatrix4a.identity(),this.tmpMatrix4a.multiply(this.tmpMatrix4),this.tmpMatrix4a.decompose(e.position,e.quaternion,e.scale)}}}detectCollisions(){var e,t;const n=[];this.impactPoint.set(0,0,0),this.impactNormal.set(0,0,0);const o=this.physicsWorld.getDispatcher(),r=o.getNumManifolds();for(let s=0;s<r;s++){const r=o.getManifoldByIndexInternal(s),i=r.getNumContacts(),a=Ammo.castObject(r.getBody0(),Ammo.btRigidBody),l=Ammo.castObject(r.getBody1(),Ammo.btRigidBody),c=a.threeObject,u=l.threeObject;if(!c||!u)continue;if(""===a.name&&""===l.name)continue;const h=null===(e=c.body)||void 0===e?void 0:e.checkCollisions,d=null===(t=u.body)||void 0===t?void 0:t.checkCollisions,p=c.body.breakable,m=u.body.breakable,f=c.body.fractureImpulse,g=u.body.fractureImpulse,y=h||d,v=p||m;if("undefined"===typeof c.fragmentDepth&&(c.fragmentDepth=0),"undefined"===typeof u.fragmentDepth&&(u.fragmentDepth=0),!y&&!v)continue;let x=!1,b=0,w="start";for(let e=0;e<i;e++){const t=r.getContactPoint(e),o=t.getDistance();if(o<=0){x=!0;const e=t.getAppliedImpulse(),o=t.get_m_positionWorldOnB(),r=t.get_m_normalWorldOnB();if(h||d){const e=[c.uuid,u.uuid].sort(),t=`${e[0]}__${e[1]}`;this.earlierDetectedCollisions.find((e=>e.combinedName===t))&&(w="collision"),n.find((e=>e.combinedName===t))||(n.push({combinedName:t,collision:!0}),this.collisionEvents.emit("collision",{bodies:[c,u],event:w}))}e>=b&&(b=e,(p||m)&&(this.impactPoint.set(o.x(),o.y(),o.z()),this.impactNormal.set(r.x(),r.y(),r.z())));break}}if(!x)continue;if(!v)continue;const A=2;if(this.emptyV3.set(0,0,0),c.userData.ammoPhysicsData={mass:1,velocity:this.emptyV3,angularVelocity:this.emptyV3,breakable:p,physicsBody:a},u.userData.ammoPhysicsData={mass:1,velocity:this.emptyV3,angularVelocity:this.emptyV3,breakable:m,physicsBody:l},p&&b>f&&c.fragmentDepth<A){const e=this.convexBreaker.subdivideByImpact(c,this.impactPoint,this.impactNormal,1,2),t=e.length;for(let n=0;n<t;n++){const t=a.getLinearVelocity(),o=a.getAngularVelocity(),r=e[n];r.userData.ammoPhysicsData.velocity.set(t.x(),t.y(),t.z()),r.userData.ammoPhysicsData.angularVelocity.set(o.x(),o.y(),o.z()),this.createDebrisFromBreakableObject(r,c)}this.objectsToRemove[this.numObjectsToRemove++]=c}if(m&&b>g&&u.fragmentDepth<A){const e=this.convexBreaker.subdivideByImpact(u,this.impactPoint,this.impactNormal,1,2),t=e.length;for(let n=0;n<t;n++){const t=l.getLinearVelocity(),o=l.getAngularVelocity(),r=e[n];r.userData.ammoPhysicsData.velocity.set(t.x(),t.y(),t.z()),r.userData.ammoPhysicsData.angularVelocity.set(o.x(),o.y(),o.z()),this.createDebrisFromBreakableObject(r,u)}this.objectsToRemove[this.numObjectsToRemove++]=u}}for(let s=0;s<this.numObjectsToRemove;s++)this.removeDebris(this.objectsToRemove[s]);this.numObjectsToRemove=0,this.earlierDetectedCollisions.forEach((e=>{const{combinedName:t}=e;if(!n.find((e=>e.combinedName===t))){const e=t.split("__"),n=this.rigidBodies.find((t=>t.uuid===e[0])),o=this.rigidBodies.find((t=>t.uuid===e[1])),r="end";n&&o&&this.collisionEvents.emit("collision",{bodies:[n,o],event:r})}})),this.earlierDetectedCollisions=[...n]}setGravity(e=0,t=-9.8,n=0){this.tmpBtVector3.setValue(e,t,n),this.physicsWorld.setGravity(this.tmpBtVector3)}get debug(){return this.isHeadless?null:{enable:()=>{this.debugDrawer.enable()},mode:(e=1)=>{this.debugDrawer.setDebugMode(e)},disable:()=>{this.debugDrawer.disable()}}}start(){"undefined"!==typeof Ammo?"function"===typeof Ammo?Ammo().then((()=>{this.setup()})):this.setup():Lo("Are you sure you included ammo.js?")}get add(){return{collider:(e,t,n)=>this.collisionEvents.addCollider(e,t,n),constraints:this.constraints.addConstraints,existing:(e,t)=>this.addExisting(e,t),plane:(e={},t={})=>this.shapes.addPlane(e,t),sphere:(e={},t={})=>this.shapes.addSphere(e,t),ground:(e={},t={})=>this.shapes.addGround(e,t),box:(e={},t={})=>this.shapes.addBox(e,t),cylinder:(e={},t={})=>this.shapes.addCylinder(e,t),cone:(e={},t={})=>this.shapes.addCone(e,t),torus:(e={},t={})=>this.shapes.addTorus(e,t),extrude:(e,t={})=>this.shapes.addExtrude(e,t),raycaster:(e="closest")=>"closest"===e?new ts(this):new ns(this)}}prepareThreeObjectForCollisionShape(e,t={}){var n,o;const{autoCenter:r=!1}=t,s={width:1,height:1,depth:1,radius:1,radiusTop:1,radiusBottom:1,tube:.4,tubularSegments:6};let i="unknown";const a=(null===(n=e.geometry)||void 0===n?void 0:n.type)||"unknown";/box/i.test(a)?i="box":/cone/i.test(a)?i="cone":/cylinder/i.test(a)?i="cylinder":/extrude/i.test(a)?i="extrude":/plane/i.test(a)?i="plane":/sphere/i.test(a)?i="sphere":/torus/i.test(a)&&(i="torus");let l=Object.assign(Object.assign({},s),null===(o=null===e||void 0===e?void 0:e.geometry)||void 0===o?void 0:o.parameters);return t.shape?(l=Object.assign(Object.assign({},s),t),i=t.shape):e.shape&&(i=e.shape),Object.keys(l).forEach((e=>{"undefined"===typeof l[e]&&s[e]&&(l[e]=s[e])})),r&&e.geometry.center(),"cylinder"===i&&(l.radius=t.radius||l.radiusTop),"extrude"===i&&(i="hacd"),"mesh"!==i&&"convex"!==i||(i="convexMesh"),"concave"===i&&(i="concaveMesh"),"unknown"===i&&(Lo(`Shape for ${null===e||void 0===e?void 0:e.name} not recognized! Will fallback to box.`),i="box"),{shape:i,params:l,object:e}}createCollisionShape(e,t,n){const o=(null===n||void 0===n?void 0:n.quaternion)?null===n||void 0===n?void 0:n.quaternion:new i._fP(0,0,0,1),{axis:r="y"}=t,s=new Ammo.btVector3,a=null===n||void 0===n?void 0:n.geometry;n&&(null===a||void 0===a?void 0:a.isGeometry)&&(n.geometry=(new i.u9r).fromGeometry(a));const l=e=>{const t=(new i.yGw).elements,n=[],o=[],r=[];return as(e,{},((e,t,s)=>{n.push(e),o.push(t),r.push(s)})),{vertices:n,matrices:o,indexes:r,matrixWorld:t}};let c,u={};switch(-1!==this.complexShapes.indexOf(e)&&(u=l(n)),e){case"box":s.setValue(t.width/2,t.height/2,t.depth/2),c=new Ammo.btBoxShape(s);break;case"sphere":c=new Ammo.btSphereShape(t.radius);break;case"cylinder":switch(r){case"y":s.setValue(t.radius,t.height/2,t.radius),c=new Ammo.btCylinderShape(s);break;case"x":s.setValue(t.height/2,t.radius,t.radius),c=new Ammo.btCylinderShapeX(s);break;case"z":s.setValue(t.radius,t.radius,t.height/2),c=new Ammo.btCylinderShapeZ(s);break}break;case"cone":switch(r){case"y":c=new Ammo.btConeShape(t.radius,t.height);break;case"x":c=new Ammo.btConeShapeX(t.radius,t.height);break;case"z":c=new Ammo.btConeShapeZ(t.radius,t.height);break}break;case"capsule":switch(r){case"y":c=new Ammo.btCapsuleShape(t.radius,t.height);break;case"x":c=new Ammo.btCapsuleShapeX(t.radius,t.height);break;case"z":c=new Ammo.btCapsuleShapeZ(t.radius,t.height);break}break;case"torus":c=Tr(t,o);break;case"plane":c=ss(u.vertices,u.matrices,u.indexes,u.matrixWorld,Object.assign(Object.assign({},t),{concave:!1}));break;case"hull":c=rs(u.vertices,u.matrices,u.matrixWorld,t);break;case"hacd":c=os(u.vertices,u.matrices,u.indexes,u.matrixWorld,t);break;case"vhacd":c=is(u.vertices,u.matrices,u.indexes,u.matrixWorld,t);break;case"convexMesh":c=ss(u.vertices,u.matrices,u.indexes,u.matrixWorld,Object.assign(Object.assign({},t),{concave:!1}));break;case"concaveMesh":c=ss(u.vertices,u.matrices,u.indexes,u.matrixWorld,Object.assign(Object.assign({},t),{concave:!0}));break}Ammo.destroy(s);const{x:h,y:d,z:p}=t;return(h||d||p)&&(c._compoundOffset={x:h||0,y:d||0,z:p||0}),Array.isArray(c)&&(c=this.mergeCollisionShapesToCompoundShape(c)),c}mergeCollisionShapesToCompoundShape(e){const t=new Ammo.btCompoundShape;return e.forEach((e=>{const{_childOffset:n,_compoundOffset:o}=e;if(n){const{pos:o,quat:r,scale:s,margin:i}=n,a=this.applyPosQuatScaleMargin(e,o,r,s,i);t.addChildShape(a,e)}else if(o){const n=new Ammo.btTransform;n.setIdentity(),n.setOrigin(new Ammo.btVector3(o.x,o.y,o.z)),t.addChildShape(n,e)}else{const n=new Ammo.btTransform;n.setIdentity(),t.addChildShape(n,e)}})),t}addExisting(e,t={}){const{hasBody:n}=e;if(n)return void Lo(`Object "${e.name}" already has a physical body!`);const o=new i.Pa4,r=new i._fP,s=new i.Pa4;e.getWorldPosition(o),e.getWorldQuaternion(r),e.getWorldScale(s);const a="1"===(t.collisionFlags||0).toString(2).slice(-1),l="1"===(t.collisionFlags||0).toString(2).slice(-2,-1),{shape:c="unknown",compound:u=[],mass:h=(a||l?0:1),collisionFlags:d=0,collisionGroup:p=1,collisionMask:m=-1,offset:f,breakable:g=!1,addChildren:y=!0,margin:v=.01,ignoreScale:x=!1,fractureImpulse:b=1}=t;if(x&&s.set(1,1,1),u.length>=1){const t=u.map((e=>this.createCollisionShape(e.shape,e))),n=this.mergeCollisionShapesToCompoundShape(t),i=this.applyPosQuatScaleMargin(n,o,r,s,v),a=this.collisionShapeToRigidBody(n,i,h,l);return this.addRigidBodyToWorld(e,a,d,p,m,f),e.body.breakable=g,e.body.fractureImpulse=b,void(e.body.ignoreScale=x)}const w=[];if("unknown"!==c||e.isMesh){const n=this.prepareThreeObjectForCollisionShape(e,t),o=this.createCollisionShape(n.shape,n.params,n.object);w.push(o)}if("unknown"===c&&y&&e.children.length>=1&&e.children.forEach((e=>{if(e.isMesh){const t=this.prepareThreeObjectForCollisionShape(e),n=this.createCollisionShape(t.shape,t.params,t.object);n._childOffset={pos:e.position.clone(),quat:e.quaternion.clone(),scale:e.scale.clone(),margin:v},w.push(n)}})),0===w.length){const n=this.prepareThreeObjectForCollisionShape(e,t),o=this.createCollisionShape(n.shape,n.params,n.object);w.push(o)}const A=1===w.length?w[0]:this.mergeCollisionShapesToCompoundShape(w),S=this.applyPosQuatScaleMargin(A,o,r,s,v),M=this.collisionShapeToRigidBody(A,S,h,l);this.addRigidBodyToWorld(e,M,d,p,m,f),e.body.breakable=g,e.body.fractureImpulse=b,e.body.ignoreScale=x}addRigidBodyToWorld(e,t,n,o,r,s){this.rigidBodies.push(e),this.physicsWorld.addRigidBody(t,o,r);const i=Object.values(t)[0];e.name||(e.name=`object-${e.id}`),t.name=e.name,e.body=new wr(this,t),e.hasBody=!0,e.ptr=i,t.threeObject=e,s&&(e.body.offset=Object.assign({x:0,y:0,z:0},s)),e.body.setCollisionFlags(n)}applyPosQuatScaleMargin(e,t=new i.Pa4,n=new i._fP,o=new i.Pa4,r=.01){e.setMargin(r);const s=new Ammo.btQuaternion(0,0,0,1);s.setValue(n.x,n.y,n.z,n.w);const a=new Ammo.btTransform;a.setIdentity(),a.getOrigin().setValue(t.x,t.y,t.z),a.setRotation(s),Ammo.destroy(s);const l=new Ammo.btVector3(o.x,o.y,o.z);return e.setLocalScaling(l),Ammo.destroy(l),a}collisionShapeToRigidBody(e,t,n,o){const r=new Ammo.btDefaultMotionState(t),s=new Ammo.btVector3(0,0,0);n>0&&e.calculateLocalInertia(n,s);const i=new Ammo.btRigidBodyConstructionInfo(n,r,e,s),a=new Ammo.btRigidBody(i);return(n>0||o)&&a.setActivationState(4),a}}
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class cs{constructor(e={}){this.threeGraphicsConfig=e;const{alpha:t=!1,anisotropy:n=1,camera:o=gr.Perspective({z:25,y:5}),antialias:r=!1,usePhysics:s=!0,renderer:a}=e;this.textureAnisotropy=n,this.camera=o,this.scene=new i.xsS,this.renderer=a||new i.CP7({antialias:r,alpha:t}),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=i.ntZ,this.cache=i.CtF,this.cache.enabled=!0,s&&("undefined"!==typeof Ammo?this.physics=new ls(this.scene,e):Lo("Are you sure you included ammo.js?"))}}const us="0.24.0",hs=`Powered by enable3d v${us}`;console.log(`%c %c %c %c %c ${hs} %c https://enable3d.io/`,"background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none");
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class ds extends cs{constructor(e){var t;super(e),this.projectConfig=e,this.scenes=new Map,this.renderer.setSize(window.innerWidth,window.innerHeight),this.projectConfig.parent?this.parent=document.getElementById(this.projectConfig.parent):this.parent=document.body,this.parent||(Lo(`Parent "${this.projectConfig.parent}" not found! Will add it to the body.`),this.parent=document.body),this.parent.appendChild(this.renderer.domElement),this.canvas=this.renderer.domElement;let n="";this.projectConfig.scenes.forEach(((e,t)=>{const o=new e;0===t&&(n=o.sceneKey);const r={sceneConfig:{textureAnisotropy:this.textureAnisotropy,autoStart:!1},renderer:this.renderer,parent:this.parent,canvas:this.canvas,scene:this.scene,scenes:this.scenes,camera:this.camera,cache:this.cache,physics:this.physics};o.initializeScene(r),0===t&&(o.setSize(this.parent.clientWidth,this.parent.clientHeight),o.setPixelRatio(Math.max(1,window.devicePixelRatio/2))),this.scenes.set(o.sceneKey,o)})),null===(t=this.scenes.get(n))||void 0===t||t.start(n)}}window,"ontouchstart"in window&&window.navigator.maxTouchPoints,window;new Map,document.createElement("canvas");new i.iMs,new i.FM8,new i.FM8,new i.FM8;n(1697);n(2089),n(8595),n(2868),n(3900);new i.FM8(256,256),new i.FM8(.5,.5);var ps=function(){var e=0,t=document.createElement("div");function n(e){return t.appendChild(e.dom),e}function o(n){for(var o=0;o<t.children.length;o++)t.children[o].style.display=o===n?"block":"none";e=n}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",(function(n){n.preventDefault(),o(++e%t.children.length)}),!1);var r=(performance||Date).now(),s=r,i=0,a=n(new ps.Panel("FPS","#0ff","#002")),l=n(new ps.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=n(new ps.Panel("MB","#f08","#201"));return o(0),{REVISION:16,dom:t,addPanel:n,showPanel:o,begin:function(){r=(performance||Date).now()},end:function(){i++;var e=(performance||Date).now();if(l.update(e-r,200),e>=s+1e3&&(a.update(1e3*i/(e-s),100),s=e,i=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){r=this.end()},domElement:t,setMode:o}};ps.Panel=function(e,t,n){var o=1/0,r=0,s=Math.round,i=s(window.devicePixelRatio||1),a=80*i,l=48*i,c=3*i,u=2*i,h=3*i,d=15*i,p=74*i,m=30*i,f=document.createElement("canvas");f.width=a,f.height=l,f.style.cssText="width:80px;height:48px";var g=f.getContext("2d");return g.font="bold "+9*i+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,a,l),g.fillStyle=t,g.fillText(e,c,u),g.fillRect(h,d,p,m),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h,d,p,m),{dom:f,update:function(l,y){o=Math.min(o,l),r=Math.max(r,l),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,a,d),g.fillStyle=t,g.fillText(s(l)+" "+e+" ("+s(o)+"-"+s(r)+")",c,u),g.drawImage(f,h+i,d,p-i,m,h,d,p-i,m),g.fillRect(h+p-i,d,i,m),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h+p-i,d,i,s((1-l/y)*m))}}};var ms=ps;let fs=!1,gs=!0;const ys=ms();let vs,xs,bs={x:0,y:0};class ws extends vr{constructor(){super("MainScene")}async init(){console.log("init"),this.renderer.setPixelRatio(1),this.renderer.setSize(window.innerWidth,window.innerHeight),gs&&document.body.appendChild(ys.dom)}async preload(){console.log("preload")}create(){console.log("create"),this.warpSpeed(),this.debug=fs,1==fs&&this.physics.debug?.enable(),this.camera.position.set(0,14,20);const e=[],t=()=>{const t=this.add.material({lambert:{color:10502144}});for(let n=0;n<12;n++)n%2==0?e.push(this.physics.add.box({y:.85*n,z:-1.3,width:4,height:.65},{custom:t}),this.physics.add.box({y:.85*n,z:0,width:4,height:.65},{custom:t}),this.physics.add.box({y:.85*n,z:1.3,width:4,height:.65},{custom:t})):e.push(this.physics.add.box({y:.85*n,x:-1.3,depth:4,height:.65},{custom:t}),this.physics.add.box({y:.85*n,x:0,depth:4,height:.65},{custom:t}),this.physics.add.box({y:.85*n,x:1.3,depth:4,height:.65},{custom:t}));e.forEach((e=>{e.body.setFriction(.8)}))};t(),xs=this,vs=new i.iMs,this.renderer.domElement.addEventListener("click",this.raycast,!1)}raycast(e){var t=xs.renderer.domElement.getBoundingClientRect();bs.x=(e.clientX-t.left)/(t.right-t.left)*2-1,bs.y=-(e.clientY-t.top)/(t.bottom-t.top)*2+1,vs.setFromCamera(bs,xs.camera);var n=vs.intersectObjects(xs.scene.children);if(n.length>0){let e=n[0].point;xs.physics.add.box({x:e.x,y:e.y,z:e.z})}for(var o=0;o<n.length;o++){let e=n[o].object.name;e.length>0&&"ground"!=e&&console.log(e,n[o])}}update(){gs&&ys.update()}}var As={name:"PhysicWorld",created(){console.log("/dev/"),$r("lib/ammo",(()=>new ds({scenes:[ws]})))}},Ss=As,Ms=n(1001),Ts=(0,Ms.Z)(Ss,r,s,!1,null,null,null),Ps=Ts.exports},8423:function(e,t,n){"use strict";n.r(t),n.d(t,{FIT:function(){return s},HEIGHTFIELD_DATA_TYPE:function(){return i},TYPE:function(){return r},createBoxShape:function(){return l},createCapsuleShape:function(){return u},createCollisionShapes:function(){return a},createConeShape:function(){return h},createCylinderShape:function(){return c},createHACDShapes:function(){return m},createHeightfieldTerrainShape:function(){return y},createHullShape:function(){return p},createSphereShape:function(){return d},createTriMeshShape:function(){return g},createVHACDShapes:function(){return f},iterateGeometries:function(){return b}});var o=n(3226);
/**
 * @author       Kevin Lee (https://github.com/InfiniteLee)
 * @copyright    Copyright (c) 2020 Kevin Lee; Project Url: https://github.com/InfiniteLee/three-to-ammo
 * @license      {@link https://github.com/InfiniteLee/three-to-ammo/blob/master/LICENSE|MPL-2.0}
 */const r={BOX:"box",CYLINDER:"cylinder",SPHERE:"sphere",CAPSULE:"capsule",CONE:"cone",HULL:"hull",HACD:"hacd",VHACD:"vhacd",MESH:"mesh",HEIGHTFIELD:"heightfield"},s={ALL:"all",MANUAL:"manual"},i={short:"short",float:"float"},a=function(e,t,n,o,s={}){switch(s.type){case r.BOX:return[l(e,t,o,s)];case r.CYLINDER:return[c(e,t,o,s)];case r.CAPSULE:return[u(e,t,o,s)];case r.CONE:return[h(e,t,o,s)];case r.SPHERE:return[d(e,t,o,s)];case r.HULL:return[p(e,t,o,s)];case r.HACD:return m(e,t,n,o,s);case r.VHACD:return f(e,t,n,o,s);case r.MESH:return[g(e,t,n,o,s)];case r.HEIGHTFIELD:return[y(s)];default:return console.warn(s.type+" is not currently supported"),[]}},l=function(e,t,n,o={}){o.type=r.BOX,v(o),o.fit===s.ALL&&(o.halfExtents=S(M(e,t),o.minHalfExtent,o.maxHalfExtent));const i=new Ammo.btVector3(o.halfExtents.x,o.halfExtents.y,o.halfExtents.z),a=new Ammo.btBoxShape(i);return Ammo.destroy(i),x(a,o,w(n,o)),a},c=function(e,t,n,o={}){o.type=r.CYLINDER,v(o),o.fit===s.ALL&&(o.halfExtents=S(M(e,t),o.minHalfExtent,o.maxHalfExtent));const i=new Ammo.btVector3(o.halfExtents.x,o.halfExtents.y,o.halfExtents.z),a=(()=>{switch(o.cylinderAxis){case"y":return new Ammo.btCylinderShape(i);case"x":return new Ammo.btCylinderShapeX(i);case"z":return new Ammo.btCylinderShapeZ(i)}return null})();return Ammo.destroy(i),x(a,o,w(n,o)),a},u=function(e,t,n,o={}){o.type=r.CAPSULE,v(o),o.fit===s.ALL&&(o.halfExtents=S(M(e,t),o.minHalfExtent,o.maxHalfExtent));const{x:i,y:a,z:l}=o.halfExtents,c=(()=>{switch(o.cylinderAxis){case"y":return new Ammo.btCapsuleShape(Math.max(i,l),2*a);case"x":return new Ammo.btCapsuleShapeX(Math.max(a,l),2*i);case"z":return new Ammo.btCapsuleShapeZ(Math.max(i,a),2*l)}return null})();return x(c,o,w(n,o)),c},h=function(e,t,n,o={}){o.type=r.CONE,v(o),o.fit===s.ALL&&(o.halfExtents=S(M(e,t),o.minHalfExtent,o.maxHalfExtent));const{x:i,y:a,z:l}=o.halfExtents,c=(()=>{switch(o.cylinderAxis){case"y":return new Ammo.btConeShape(Math.max(i,l),2*a);case"x":return new Ammo.btConeShapeX(Math.max(a,l),2*i);case"z":return new Ammo.btConeShapeZ(Math.max(i,a),2*l)}return null})();return x(c,o,w(n,o)),c},d=function(e,t,n,o={}){let i;o.type=r.SPHERE,v(o),i=o.fit!==s.MANUAL||isNaN(o.sphereRadius)?A(e,t,M(e,t)):o.sphereRadius;const a=new Ammo.btSphereShape(i);return x(a,o,w(n,o)),a},p=function(){const e=new o.Pa4,t=new o.Pa4,n=new o.yGw;return function(o,i,a,l={}){if(l.type=r.HULL,v(l),l.fit===s.MANUAL)return console.warn("cannot use fit: manual with type: hull"),null;const c=M(o,i),u=new Ammo.btVector3,h=new Ammo.btConvexHullShape;h.setMargin(l.margin),t.addVectors(c.max,c.min).multiplyScalar(.5);let d=0;for(let e=0;e<o.length;e++)d+=o[e].length/3;const p=l.hullMaxVertices||1e5;d>p&&console.warn(`too many vertices for hull shape; sampling ~${p} from ~${d} vertices`);const m=Math.min(1,p/d);for(let r=0;r<o.length;r++){const s=o[r];n.fromArray(i[r]);for(let i=0;i<s.length;i+=3){const a=r===o.length-1&&i===s.length-3;(Math.random()<=m||a)&&(e.set(s[i],s[i+1],s[i+2]).applyMatrix4(n).sub(t),u.setValue(e.x,e.y,e.z),h.addPoint(u,a))}}let f=h;if(h.getNumVertices()>=100){const e=new Ammo.btShapeHull(h);e.buildHull(l.margin),Ammo.destroy(h),f=new Ammo.btConvexHullShape(Ammo.getPointer(e.getVertexPointer()),e.numVertices()),Ammo.destroy(e)}return Ammo.destroy(u),x(f,l,w(a,l)),f}}(),m=function(){const e=new o.Pa4,t=new o.Pa4,n=new o.yGw;return function(o,i,a,l,c={}){if(c.type=r.HACD,v(c),c.fit===s.MANUAL)return console.warn("cannot use fit: manual with type: hacd"),[];if(!Ammo.hasOwnProperty("HACD"))return console.warn("HACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];const u=M(o,i),h=w(l,c);let d=0,p=0;t.addVectors(u.max,u.min).multiplyScalar(.5);for(let e=0;e<o.length;e++)d+=o[e].length/3,a&&a[e]?p+=a[e].length/3:p+=o[e].length/9;const m=new Ammo.HACD;c.hasOwnProperty("compacityWeight")&&m.SetCompacityWeight(c.compacityWeight),c.hasOwnProperty("volumeWeight")&&m.SetVolumeWeight(c.volumeWeight),c.hasOwnProperty("nClusters")&&m.SetNClusters(c.nClusters),c.hasOwnProperty("nVerticesPerCH")&&m.SetNVerticesPerCH(c.nVerticesPerCH),c.hasOwnProperty("concavity")&&m.SetConcavity(c.concavity);const f=Ammo._malloc(3*d*8),g=Ammo._malloc(3*p*4);m.SetPoints(f),m.SetTriangles(g),m.SetNPoints(d),m.SetNTriangles(p);let y=f/8,b=g/4;for(let r=0;r<o.length;r++){const s=o[r];n.fromArray(i[r]);for(let o=0;o<s.length;o+=3)e.set(s[o+0],s[o+1],s[o+2]).applyMatrix4(n).sub(t),Ammo.HEAPF64[y+0]=e.x,Ammo.HEAPF64[y+1]=e.y,Ammo.HEAPF64[y+2]=e.z,y+=3;if(a[r]){const e=a[r];for(let t=0;t<e.length;t++)Ammo.HEAP32[b]=e[t],b++}else for(let e=0;e<s.length/3;e++)Ammo.HEAP32[b]=e,b++}m.Compute(),Ammo._free(f),Ammo._free(g);const A=m.GetNClusters(),S=[];for(let e=0;e<A;e++){const t=new Ammo.btConvexHullShape;t.setMargin(c.margin);const n=m.GetNPointsCH(e),o=m.GetNTrianglesCH(e),r=Ammo._malloc(3*n*8),s=Ammo._malloc(3*o*4);m.GetCH(e,r,s);const i=r/8;for(let e=0;e<n;e++){const o=new Ammo.btVector3,r=Ammo.HEAPF64[i+3*e+0],s=Ammo.HEAPF64[i+3*e+1],a=Ammo.HEAPF64[i+3*e+2];o.setValue(r,s,a),t.addPoint(o,e===n-1),Ammo.destroy(o)}x(t,c,h),S.push(t)}return S}}(),f=function(){const e=new o.Pa4,t=new o.Pa4,n=new o.yGw;return function(o,i,a,l,c={}){if(c.type=r.VHACD,v(c),c.fit===s.MANUAL)return console.warn("cannot use fit: manual with type: vhacd"),[];if(!Ammo.hasOwnProperty("VHACD"))return console.warn("VHACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];const u=M(o,i),h=w(l,c);let d=0,p=0;t.addVectors(u.max,u.min).multiplyScalar(.5);for(let e=0;e<o.length;e++)d+=o[e].length/3,a&&a[e]?p+=a[e].length/3:p+=o[e].length/9;const m=new Ammo.VHACD,f=new Ammo.Parameters;c.hasOwnProperty("resolution")&&f.set_m_resolution(c.resolution),c.hasOwnProperty("depth")&&f.set_m_depth(c.depth),c.hasOwnProperty("concavity")&&f.set_m_concavity(c.concavity),c.hasOwnProperty("planeDownsampling")&&f.set_m_planeDownsampling(c.planeDownsampling),c.hasOwnProperty("convexhullDownsampling")&&f.set_m_convexhullDownsampling(c.convexhullDownsampling),c.hasOwnProperty("alpha")&&f.set_m_alpha(c.alpha),c.hasOwnProperty("beta")&&f.set_m_beta(c.beta),c.hasOwnProperty("gamma")&&f.set_m_gamma(c.gamma),c.hasOwnProperty("pca")&&f.set_m_pca(c.pca),c.hasOwnProperty("mode")&&f.set_m_mode(c.mode),c.hasOwnProperty("maxNumVerticesPerCH")&&f.set_m_maxNumVerticesPerCH(c.maxNumVerticesPerCH),c.hasOwnProperty("minVolumePerCH")&&f.set_m_minVolumePerCH(c.minVolumePerCH),c.hasOwnProperty("convexhullApproximation")&&f.set_m_convexhullApproximation(c.convexhullApproximation),c.hasOwnProperty("oclAcceleration")&&f.set_m_oclAcceleration(c.oclAcceleration);const g=Ammo._malloc(3*d*8+3),y=Ammo._malloc(3*p*4);let b=g/8,A=y/4;for(let r=0;r<o.length;r++){const s=o[r];n.fromArray(i[r]);for(let o=0;o<s.length;o+=3)e.set(s[o+0],s[o+1],s[o+2]).applyMatrix4(n).sub(t),Ammo.HEAPF64[b+0]=e.x,Ammo.HEAPF64[b+1]=e.y,Ammo.HEAPF64[b+2]=e.z,b+=3;if(a[r]){const e=a[r];for(let t=0;t<e.length;t++)Ammo.HEAP32[A]=e[t],A++}else for(let e=0;e<s.length/3;e++)Ammo.HEAP32[A]=e,A++}m.Compute(g,3,d,y,3,p,f),Ammo._free(g),Ammo._free(y);const S=m.GetNConvexHulls(),T=[],P=new Ammo.ConvexHull;for(let e=0;e<S;e++){m.GetConvexHull(e,P);const t=P.get_m_nPoints(),n=(P.get_m_points(),new Ammo.btConvexHullShape);n.setMargin(c.margin);for(let e=0;e<t;e++){const o=new Ammo.btVector3,r=P.get_m_points(3*e+0),s=P.get_m_points(3*e+1),i=P.get_m_points(3*e+2);o.setValue(r,s,i),n.addPoint(o,e===t-1),Ammo.destroy(o)}x(n,c,h),T.push(n)}return Ammo.destroy(P),Ammo.destroy(m),T}}(),g=function(){const e=new o.Pa4,t=new o.Pa4,n=new o.Pa4,i=new o.yGw;return function(o,a,l,c,u={}){if(u.type=r.MESH,v(u),u.fit===s.MANUAL)return console.warn("cannot use fit: manual with type: mesh"),null;const h=w(c,u),d=new Ammo.btVector3,p=new Ammo.btVector3,m=new Ammo.btVector3,f=new Ammo.btTriangleMesh(!0,!1);for(let r=0;r<o.length;r++){const s=o[r],c=l[r]?l[r]:null;if(i.fromArray(a[r]),c)for(let o=0;o<c.length;o+=3){const r=3*c[o],a=3*c[o+1],l=3*c[o+2];e.set(s[r],s[r+1],s[r+2]).applyMatrix4(i),t.set(s[a],s[a+1],s[a+2]).applyMatrix4(i),n.set(s[l],s[l+1],s[l+2]).applyMatrix4(i),d.setValue(e.x,e.y,e.z),p.setValue(t.x,t.y,t.z),m.setValue(n.x,n.y,n.z),f.addTriangle(d,p,m,!1)}else for(let o=0;o<s.length;o+=9)e.set(s[o+0],s[o+1],s[o+2]).applyMatrix4(i),t.set(s[o+3],s[o+4],s[o+5]).applyMatrix4(i),n.set(s[o+6],s[o+7],s[o+8]).applyMatrix4(i),d.setValue(e.x,e.y,e.z),p.setValue(t.x,t.y,t.z),m.setValue(n.x,n.y,n.z),f.addTriangle(d,p,m,!1)}const g=new Ammo.btVector3(h.x,h.y,h.z);let y;return f.setScaling(g),Ammo.destroy(g),y=u.concave?new Ammo.btBvhTriangleMeshShape(f,!0,!0):new Ammo.btConvexTriangleMeshShape(f,!0),y.resources=[f],Ammo.destroy(d),Ammo.destroy(p),Ammo.destroy(m),x(y,u),y}}(),y=function(e={}){if(v(e),e.fit===s.ALL)return console.warn("cannot use fit: all with type: heightfield"),null;const t=e.heightfieldDistance||1,n=e.heightfieldData||[],o=e.heightScale||0,r=e.hasOwnProperty("upAxis")?e.upAxis:1,i=(()=>{switch(e.heightDataType){case"short":return Ammo.PHY_SHORT;case"float":return Ammo.PHY_FLOAT;default:return Ammo.PHY_FLOAT}})(),a=!e.hasOwnProperty("flipQuadEdges")||e.flipQuadEdges,l=n.length,c=l>0?n[0].length:0,u=Ammo._malloc(l*c*4),h=u/4;let d=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,m=0;for(let s=0;s<l;s++)for(let e=0;e<c;e++){const t=n[s][e];Ammo.HEAPF32[h+m]=t,m++,d=Math.min(d,t),p=Math.max(p,t)}const f=new Ammo.btHeightfieldTerrainShape(c,l,u,o,d,p,r,i,a),g=new Ammo.btVector3(t,1,t);return f.setLocalScaling(g),Ammo.destroy(g),f.heightfieldData=u,x(f,e),f};function v(e){e.type=e.type||r.HULL,e.margin=e.hasOwnProperty("margin")?e.margin:.01}const x=function(e,t,n){},b=function(){const e=new o.yGw;return function(t,n,r){parseInt(o.UZH)>=123?e.copy(t.matrixWorld).invert():e.getInverse(t.matrixWorld);const s=new o.Pa4;s.setFromMatrixScale(t.matrixWorld),t.traverse((s=>{const i=new o.yGw;s.isMesh&&(n.includeInvisible||s.el&&s.el.object3D.visible||s.visible)&&(s===t?i.identity():(s.updateWorldMatrix(!0),i.multiplyMatrices(e,s.matrixWorld)),r(s.geometry.isBufferGeometry?s.geometry.attributes.position.array:s.geometry.vertices,i.elements,s.geometry.index?s.geometry.index.array:null))}))}}(),w=function(){const e=new o.yGw;return function(t,n={}){const r=new o.Pa4(1,1,1);return n.fit===s.ALL&&(e.fromArray(t),r.setFromMatrixScale(e)),r}}(),A=function(){const e=new o.Pa4;return function(t,n,o){let r=0,{x:s,y:i,z:a}=o.getCenter(e);return T(t,n,(e=>{const t=s-e.x,n=i-e.y,o=a-e.z;r=Math.max(r,t*t+n*n+o*o)})),Math.sqrt(r)}}(),S=function(e,t,n){const r=new o.Pa4;return r.subVectors(e.max,e.min).multiplyScalar(.5).clampScalar(t,n)},M=function(e,t){const n=new o.ZzF;let r=1/0,s=1/0,i=1/0,a=-1/0,l=-1/0,c=-1/0;return n.min.set(0,0,0),n.max.set(0,0,0),T(e,t,(e=>{e.x<r&&(r=e.x),e.y<s&&(s=e.y),e.z<i&&(i=e.z),e.x>a&&(a=e.x),e.y>l&&(l=e.y),e.z>c&&(c=e.z)})),n.min.set(r,s,i),n.max.set(a,l,c),n},T=function(){const e=new o.Pa4,t=new o.yGw;return function(n,o,r){for(let s=0;s<n.length;s++){t.fromArray(o[s]);for(let o=0;o<n[s].length;o+=3)e.set(n[s][o],n[s][o+1],n[s][o+2]).applyMatrix4(t),r(e)}}}()},1697:function(e,t,n){
/*!
 * matter-js 0.17.1 by @liabru
 * http://brm.io/matter-js/
 * License MIT
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) Liam Brummitt and contributors.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
(function(t,n){e.exports=n()})(0,(function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=22)}([function(e,t){var o={};e.exports=o,function(){o._nextId=0,o._seed=0,o._nowStartTime=+new Date,o._warnedOnce={},o._decomp=null,o.extend=function(e,t){var n,r;"boolean"===typeof t?(n=2,r=t):(n=1,r=!0);for(var s=n;s<arguments.length;s++){var i=arguments[s];if(i)for(var a in i)r&&i[a]&&i[a].constructor===Object?e[a]&&e[a].constructor!==Object?e[a]=i[a]:(e[a]=e[a]||{},o.extend(e[a],r,i[a])):e[a]=i[a]}return e},o.clone=function(e,t){return o.extend({},t,e)},o.keys=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)t.push(n);return t},o.values=function(e){var t=[];if(Object.keys){for(var n=Object.keys(e),o=0;o<n.length;o++)t.push(e[n[o]]);return t}for(var r in e)t.push(e[r]);return t},o.get=function(e,t,n,o){t=t.split(".").slice(n,o);for(var r=0;r<t.length;r+=1)e=e[t[r]];return e},o.set=function(e,t,n,r,s){var i=t.split(".").slice(r,s);return o.get(e,t,0,-1)[i[i.length-1]]=n,n},o.shuffle=function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(o.random()*(t+1)),r=e[t];e[t]=e[n],e[n]=r}return e},o.choose=function(e){return e[Math.floor(o.random()*e.length)]},o.isElement=function(e){return"undefined"!==typeof HTMLElement?e instanceof HTMLElement:!!(e&&e.nodeType&&e.nodeName)},o.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},o.isFunction=function(e){return"function"===typeof e},o.isPlainObject=function(e){return"object"===typeof e&&e.constructor===Object},o.isString=function(e){return"[object String]"===toString.call(e)},o.clamp=function(e,t,n){return e<t?t:e>n?n:e},o.sign=function(e){return e<0?-1:1},o.now=function(){if("undefined"!==typeof window&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-o._nowStartTime},o.random=function(t,n){return t="undefined"!==typeof t?t:0,n="undefined"!==typeof n?n:1,t+e()*(n-t)};var e=function(){return o._seed=(9301*o._seed+49297)%233280,o._seed/233280};o.colorToNumber=function(e){return e=e.replace("#",""),3==e.length&&(e=e.charAt(0)+e.charAt(0)+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2)),parseInt(e,16)},o.logLevel=1,o.log=function(){console&&o.logLevel>0&&o.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},o.info=function(){console&&o.logLevel>0&&o.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},o.warn=function(){console&&o.logLevel>0&&o.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},o.warnOnce=function(){var e=Array.prototype.slice.call(arguments).join(" ");o._warnedOnce[e]||(o.warn(e),o._warnedOnce[e]=!0)},o.deprecated=function(e,t,n){e[t]=o.chain((function(){o.warnOnce("🔅 deprecated 🔅",n)}),e[t])},o.nextId=function(){return o._nextId++},o.indexOf=function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1},o.map=function(e,t){if(e.map)return e.map(t);for(var n=[],o=0;o<e.length;o+=1)n.push(t(e[o]));return n},o.topologicalSort=function(e){var t=[],n=[],r=[];for(var s in e)n[s]||r[s]||o._topologicalSort(s,n,r,e,t);return t},o._topologicalSort=function(e,t,n,r,s){var i=r[e]||[];n[e]=!0;for(var a=0;a<i.length;a+=1){var l=i[a];n[l]||(t[l]||o._topologicalSort(l,t,n,r,s))}n[e]=!1,t[e]=!0,s.push(e)},o.chain=function(){for(var e=[],t=0;t<arguments.length;t+=1){var n=arguments[t];n._chained?e.push.apply(e,n._chained):e.push(n)}var o=function(){for(var t,n=new Array(arguments.length),o=0,r=arguments.length;o<r;o++)n[o]=arguments[o];for(o=0;o<e.length;o+=1){var s=e[o].apply(t,n);"undefined"!==typeof s&&(t=s)}return t};return o._chained=e,o},o.chainPathBefore=function(e,t,n){return o.set(e,t,o.chain(n,o.get(e,t)))},o.chainPathAfter=function(e,t,n){return o.set(e,t,o.chain(o.get(e,t),n))},o.setDecomp=function(e){o._decomp=e},o.getDecomp=function(){var e=o._decomp;try{e||"undefined"===typeof window||(e=window.decomp),e||"undefined"===typeof n.g||(e=n.g.decomp)}catch(t){e=null}return e}}()},function(e,t){var n={};e.exports=n,function(){n.create=function(e){var t={min:{x:0,y:0},max:{x:0,y:0}};return e&&n.update(t,e),t},n.update=function(e,t,n){e.min.x=1/0,e.max.x=-1/0,e.min.y=1/0,e.max.y=-1/0;for(var o=0;o<t.length;o++){var r=t[o];r.x>e.max.x&&(e.max.x=r.x),r.x<e.min.x&&(e.min.x=r.x),r.y>e.max.y&&(e.max.y=r.y),r.y<e.min.y&&(e.min.y=r.y)}n&&(n.x>0?e.max.x+=n.x:e.min.x+=n.x,n.y>0?e.max.y+=n.y:e.min.y+=n.y)},n.contains=function(e,t){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y},n.overlaps=function(e,t){return e.min.x<=t.max.x&&e.max.x>=t.min.x&&e.max.y>=t.min.y&&e.min.y<=t.max.y},n.translate=function(e,t){e.min.x+=t.x,e.max.x+=t.x,e.min.y+=t.y,e.max.y+=t.y},n.shift=function(e,t){var n=e.max.x-e.min.x,o=e.max.y-e.min.y;e.min.x=t.x,e.max.x=t.x+n,e.min.y=t.y,e.max.y=t.y+o}}()},function(e,t){var n={};e.exports=n,function(){n.create=function(e,t){return{x:e||0,y:t||0}},n.clone=function(e){return{x:e.x,y:e.y}},n.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},n.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},n.rotate=function(e,t,n){var o=Math.cos(t),r=Math.sin(t);n||(n={});var s=e.x*o-e.y*r;return n.y=e.x*r+e.y*o,n.x=s,n},n.rotateAbout=function(e,t,n,o){var r=Math.cos(t),s=Math.sin(t);o||(o={});var i=n.x+((e.x-n.x)*r-(e.y-n.y)*s);return o.y=n.y+((e.x-n.x)*s+(e.y-n.y)*r),o.x=i,o},n.normalise=function(e){var t=n.magnitude(e);return 0===t?{x:0,y:0}:{x:e.x/t,y:e.y/t}},n.dot=function(e,t){return e.x*t.x+e.y*t.y},n.cross=function(e,t){return e.x*t.y-e.y*t.x},n.cross3=function(e,t,n){return(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)},n.add=function(e,t,n){return n||(n={}),n.x=e.x+t.x,n.y=e.y+t.y,n},n.sub=function(e,t,n){return n||(n={}),n.x=e.x-t.x,n.y=e.y-t.y,n},n.mult=function(e,t){return{x:e.x*t,y:e.y*t}},n.div=function(e,t){return{x:e.x/t,y:e.y/t}},n.perp=function(e,t){return t=!0===t?-1:1,{x:t*-e.y,y:t*e.x}},n.neg=function(e){return{x:-e.x,y:-e.y}},n.angle=function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},n._temp=[n.create(),n.create(),n.create(),n.create(),n.create(),n.create()]}()},function(e,t,n){var o={};e.exports=o;var r=n(2),s=n(0);(function(){o.create=function(e,t){for(var n=[],o=0;o<e.length;o++){var r=e[o],s={x:r.x,y:r.y,index:o,body:t,isInternal:!1};n.push(s)}return n},o.fromPath=function(e,t){var n=/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/gi,r=[];return e.replace(n,(function(e,t,n){r.push({x:parseFloat(t),y:parseFloat(n)})})),o.create(r,t)},o.centre=function(e){for(var t,n,s,i=o.area(e,!0),a={x:0,y:0},l=0;l<e.length;l++)s=(l+1)%e.length,t=r.cross(e[l],e[s]),n=r.mult(r.add(e[l],e[s]),t),a=r.add(a,n);return r.div(a,6*i)},o.mean=function(e){for(var t={x:0,y:0},n=0;n<e.length;n++)t.x+=e[n].x,t.y+=e[n].y;return r.div(t,e.length)},o.area=function(e,t){for(var n=0,o=e.length-1,r=0;r<e.length;r++)n+=(e[o].x-e[r].x)*(e[o].y+e[r].y),o=r;return t?n/2:Math.abs(n)/2},o.inertia=function(e,t){for(var n,o,s=0,i=0,a=e,l=0;l<a.length;l++)o=(l+1)%a.length,n=Math.abs(r.cross(a[o],a[l])),s+=n*(r.dot(a[o],a[o])+r.dot(a[o],a[l])+r.dot(a[l],a[l])),i+=n;return t/6*(s/i)},o.translate=function(e,t,n){var o;if(n)for(o=0;o<e.length;o++)e[o].x+=t.x*n,e[o].y+=t.y*n;else for(o=0;o<e.length;o++)e[o].x+=t.x,e[o].y+=t.y;return e},o.rotate=function(e,t,n){if(0!==t){for(var o=Math.cos(t),r=Math.sin(t),s=0;s<e.length;s++){var i=e[s],a=i.x-n.x,l=i.y-n.y;i.x=n.x+(a*o-l*r),i.y=n.y+(a*r+l*o)}return e}},o.contains=function(e,t){for(var n=0;n<e.length;n++){var o=e[n],r=e[(n+1)%e.length];if((t.x-o.x)*(r.y-o.y)+(t.y-o.y)*(o.x-r.x)>0)return!1}return!0},o.scale=function(e,t,n,s){if(1===t&&1===n)return e;var i,a;s=s||o.centre(e);for(var l=0;l<e.length;l++)i=e[l],a=r.sub(i,s),e[l].x=s.x+a.x*t,e[l].y=s.y+a.y*n;return e},o.chamfer=function(e,t,n,o,i){t="number"===typeof t?[t]:t||[8],n="undefined"!==typeof n?n:-1,o=o||2,i=i||14;for(var a=[],l=0;l<e.length;l++){var c=e[l-1>=0?l-1:e.length-1],u=e[l],h=e[(l+1)%e.length],d=t[l<t.length?l:t.length-1];if(0!==d){var p=r.normalise({x:u.y-c.y,y:c.x-u.x}),m=r.normalise({x:h.y-u.y,y:u.x-h.x}),f=Math.sqrt(2*Math.pow(d,2)),g=r.mult(s.clone(p),d),y=r.normalise(r.mult(r.add(p,m),.5)),v=r.sub(u,r.mult(y,f)),x=n;-1===n&&(x=1.75*Math.pow(d,.32)),x=s.clamp(x,o,i),x%2===1&&(x+=1);for(var b=Math.acos(r.dot(p,m)),w=b/x,A=0;A<x;A++)a.push(r.add(r.rotate(g,w*A),v))}else a.push(u)}return a},o.clockwiseSort=function(e){var t=o.mean(e);return e.sort((function(e,n){return r.angle(t,e)-r.angle(t,n)})),e},o.isConvex=function(e){var t,n,o,r,s=0,i=e.length;if(i<3)return null;for(t=0;t<i;t++)if(n=(t+1)%i,o=(t+2)%i,r=(e[n].x-e[t].x)*(e[o].y-e[n].y),r-=(e[n].y-e[t].y)*(e[o].x-e[n].x),r<0?s|=1:r>0&&(s|=2),3===s)return!1;return 0!==s||null},o.hull=function(e){var t,n,o=[],s=[];for(e=e.slice(0),e.sort((function(e,t){var n=e.x-t.x;return 0!==n?n:e.y-t.y})),n=0;n<e.length;n+=1){t=e[n];while(s.length>=2&&r.cross3(s[s.length-2],s[s.length-1],t)<=0)s.pop();s.push(t)}for(n=e.length-1;n>=0;n-=1){t=e[n];while(o.length>=2&&r.cross3(o[o.length-2],o[o.length-1],t)<=0)o.pop();o.push(t)}return o.pop(),s.pop(),o.concat(s)}})()},function(e,t,n){var o={};e.exports=o;var r=n(0);(function(){o.on=function(e,t,n){for(var o,r=t.split(" "),s=0;s<r.length;s++)o=r[s],e.events=e.events||{},e.events[o]=e.events[o]||[],e.events[o].push(n);return n},o.off=function(e,t,n){if(t){"function"===typeof t&&(n=t,t=r.keys(e.events).join(" "));for(var o=t.split(" "),s=0;s<o.length;s++){var i=e.events[o[s]],a=[];if(n&&i)for(var l=0;l<i.length;l++)i[l]!==n&&a.push(i[l]);e.events[o[s]]=a}}else e.events={}},o.trigger=function(e,t,n){var o,s,i,a,l=e.events;if(l&&r.keys(l).length>0){n||(n={}),o=t.split(" ");for(var c=0;c<o.length;c++)if(s=o[c],i=l[s],i){a=r.clone(n,!1),a.name=s,a.source=e;for(var u=0;u<i.length;u++)i[u].apply(e,[a])}}}})()},function(e,t,n){var o={};e.exports=o;var r=n(4),s=n(0),i=n(1),a=n(6);(function(){o.create=function(e){return s.extend({id:s.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{}},e)},o.setModified=function(e,t,n,r){if(e.isModified=t,n&&e.parent&&o.setModified(e.parent,t,n,r),r)for(var s=0;s<e.composites.length;s++){var i=e.composites[s];o.setModified(i,t,n,r)}},o.add=function(e,t){var n=[].concat(t);r.trigger(e,"beforeAdd",{object:t});for(var i=0;i<n.length;i++){var a=n[i];switch(a.type){case"body":if(a.parent!==a){s.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}o.addBody(e,a);break;case"constraint":o.addConstraint(e,a);break;case"composite":o.addComposite(e,a);break;case"mouseConstraint":o.addConstraint(e,a.constraint);break}}return r.trigger(e,"afterAdd",{object:t}),e},o.remove=function(e,t,n){var s=[].concat(t);r.trigger(e,"beforeRemove",{object:t});for(var i=0;i<s.length;i++){var a=s[i];switch(a.type){case"body":o.removeBody(e,a,n);break;case"constraint":o.removeConstraint(e,a,n);break;case"composite":o.removeComposite(e,a,n);break;case"mouseConstraint":o.removeConstraint(e,a.constraint);break}}return r.trigger(e,"afterRemove",{object:t}),e},o.addComposite=function(e,t){return e.composites.push(t),t.parent=e,o.setModified(e,!0,!0,!1),e},o.removeComposite=function(e,t,n){var r=s.indexOf(e.composites,t);if(-1!==r&&(o.removeCompositeAt(e,r),o.setModified(e,!0,!0,!1)),n)for(var i=0;i<e.composites.length;i++)o.removeComposite(e.composites[i],t,!0);return e},o.removeCompositeAt=function(e,t){return e.composites.splice(t,1),o.setModified(e,!0,!0,!1),e},o.addBody=function(e,t){return e.bodies.push(t),o.setModified(e,!0,!0,!1),e},o.removeBody=function(e,t,n){var r=s.indexOf(e.bodies,t);if(-1!==r&&(o.removeBodyAt(e,r),o.setModified(e,!0,!0,!1)),n)for(var i=0;i<e.composites.length;i++)o.removeBody(e.composites[i],t,!0);return e},o.removeBodyAt=function(e,t){return e.bodies.splice(t,1),o.setModified(e,!0,!0,!1),e},o.addConstraint=function(e,t){return e.constraints.push(t),o.setModified(e,!0,!0,!1),e},o.removeConstraint=function(e,t,n){var r=s.indexOf(e.constraints,t);if(-1!==r&&o.removeConstraintAt(e,r),n)for(var i=0;i<e.composites.length;i++)o.removeConstraint(e.composites[i],t,!0);return e},o.removeConstraintAt=function(e,t){return e.constraints.splice(t,1),o.setModified(e,!0,!0,!1),e},o.clear=function(e,t,n){if(n)for(var r=0;r<e.composites.length;r++)o.clear(e.composites[r],t,!0);return t?e.bodies=e.bodies.filter((function(e){return e.isStatic})):e.bodies.length=0,e.constraints.length=0,e.composites.length=0,o.setModified(e,!0,!0,!1),e},o.allBodies=function(e){for(var t=[].concat(e.bodies),n=0;n<e.composites.length;n++)t=t.concat(o.allBodies(e.composites[n]));return t},o.allConstraints=function(e){for(var t=[].concat(e.constraints),n=0;n<e.composites.length;n++)t=t.concat(o.allConstraints(e.composites[n]));return t},o.allComposites=function(e){for(var t=[].concat(e.composites),n=0;n<e.composites.length;n++)t=t.concat(o.allComposites(e.composites[n]));return t},o.get=function(e,t,n){var r,s;switch(n){case"body":r=o.allBodies(e);break;case"constraint":r=o.allConstraints(e);break;case"composite":r=o.allComposites(e).concat(e);break}return r?(s=r.filter((function(e){return e.id.toString()===t.toString()})),0===s.length?null:s[0]):null},o.move=function(e,t,n){return o.remove(e,t),o.add(n,t),e},o.rebase=function(e){for(var t=o.allBodies(e).concat(o.allConstraints(e)).concat(o.allComposites(e)),n=0;n<t.length;n++)t[n].id=s.nextId();return o.setModified(e,!0,!0,!1),e},o.translate=function(e,t,n){for(var r=n?o.allBodies(e):e.bodies,s=0;s<r.length;s++)a.translate(r[s],t);return o.setModified(e,!0,!0,!1),e},o.rotate=function(e,t,n,r){for(var s=Math.cos(t),i=Math.sin(t),l=r?o.allBodies(e):e.bodies,c=0;c<l.length;c++){var u=l[c],h=u.position.x-n.x,d=u.position.y-n.y;a.setPosition(u,{x:n.x+(h*s-d*i),y:n.y+(h*i+d*s)}),a.rotate(u,t)}return o.setModified(e,!0,!0,!1),e},o.scale=function(e,t,n,r,s){for(var i=s?o.allBodies(e):e.bodies,l=0;l<i.length;l++){var c=i[l],u=c.position.x-r.x,h=c.position.y-r.y;a.setPosition(c,{x:r.x+u*t,y:r.y+h*n}),a.scale(c,t,n)}return o.setModified(e,!0,!0,!1),e},o.bounds=function(e){for(var t=o.allBodies(e),n=[],r=0;r<t.length;r+=1){var s=t[r];n.push(s.bounds.min,s.bounds.max)}return i.create(n)}})()},function(e,t,n){var o={};e.exports=o;var r=n(3),s=n(2),i=n(7),a=(n(16),n(0)),l=n(1),c=n(10);(function(){o._inertiaScale=4,o._nextCollidingGroupId=1,o._nextNonCollidingGroupId=-1,o._nextCategory=1,o.create=function(t){var n={id:a.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:r.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,_original:null},o=a.extend(n,t);return e(o,t),o},o.nextGroup=function(e){return e?o._nextNonCollidingGroupId--:o._nextCollidingGroupId++},o.nextCategory=function(){return o._nextCategory=o._nextCategory<<1,o._nextCategory};var e=function(e,t){t=t||{},o.set(e,{bounds:e.bounds||l.create(e.vertices),positionPrev:e.positionPrev||s.clone(e.position),anglePrev:e.anglePrev||e.angle,vertices:e.vertices,parts:e.parts||[e],isStatic:e.isStatic,isSleeping:e.isSleeping,parent:e.parent||e}),r.rotate(e.vertices,e.angle,e.position),c.rotate(e.axes,e.angle),l.update(e.bounds,e.vertices,e.velocity),o.set(e,{axes:t.axes||e.axes,area:t.area||e.area,mass:t.mass||e.mass,inertia:t.inertia||e.inertia});var n=e.isStatic?"#14151f":a.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),i=e.isStatic?"#555":"#ccc",u=e.isStatic&&null===e.render.fillStyle?1:0;e.render.fillStyle=e.render.fillStyle||n,e.render.strokeStyle=e.render.strokeStyle||i,e.render.lineWidth=e.render.lineWidth||u,e.render.sprite.xOffset+=-(e.bounds.min.x-e.position.x)/(e.bounds.max.x-e.bounds.min.x),e.render.sprite.yOffset+=-(e.bounds.min.y-e.position.y)/(e.bounds.max.y-e.bounds.min.y)};o.set=function(e,t,n){var r;for(r in"string"===typeof t&&(r=t,t={},t[r]=n),t)if(Object.prototype.hasOwnProperty.call(t,r))switch(n=t[r],r){case"isStatic":o.setStatic(e,n);break;case"isSleeping":i.set(e,n);break;case"mass":o.setMass(e,n);break;case"density":o.setDensity(e,n);break;case"inertia":o.setInertia(e,n);break;case"vertices":o.setVertices(e,n);break;case"position":o.setPosition(e,n);break;case"angle":o.setAngle(e,n);break;case"velocity":o.setVelocity(e,n);break;case"angularVelocity":o.setAngularVelocity(e,n);break;case"parts":o.setParts(e,n);break;case"centre":o.setCentre(e,n);break;default:e[r]=n}},o.setStatic=function(e,t){for(var n=0;n<e.parts.length;n++){var o=e.parts[n];o.isStatic=t,t?(o._original={restitution:o.restitution,friction:o.friction,mass:o.mass,inertia:o.inertia,density:o.density,inverseMass:o.inverseMass,inverseInertia:o.inverseInertia},o.restitution=0,o.friction=1,o.mass=o.inertia=o.density=1/0,o.inverseMass=o.inverseInertia=0,o.positionPrev.x=o.position.x,o.positionPrev.y=o.position.y,o.anglePrev=o.angle,o.angularVelocity=0,o.speed=0,o.angularSpeed=0,o.motion=0):o._original&&(o.restitution=o._original.restitution,o.friction=o._original.friction,o.mass=o._original.mass,o.inertia=o._original.inertia,o.density=o._original.density,o.inverseMass=o._original.inverseMass,o.inverseInertia=o._original.inverseInertia,o._original=null)}},o.setMass=function(e,t){var n=e.inertia/(e.mass/6);e.inertia=n*(t/6),e.inverseInertia=1/e.inertia,e.mass=t,e.inverseMass=1/e.mass,e.density=e.mass/e.area},o.setDensity=function(e,t){o.setMass(e,t*e.area),e.density=t},o.setInertia=function(e,t){e.inertia=t,e.inverseInertia=1/e.inertia},o.setVertices=function(e,t){t[0].body===e?e.vertices=t:e.vertices=r.create(t,e),e.axes=c.fromVertices(e.vertices),e.area=r.area(e.vertices),o.setMass(e,e.density*e.area);var n=r.centre(e.vertices);r.translate(e.vertices,n,-1),o.setInertia(e,o._inertiaScale*r.inertia(e.vertices,e.mass)),r.translate(e.vertices,e.position),l.update(e.bounds,e.vertices,e.velocity)},o.setParts=function(e,t,n){var s;for(t=t.slice(0),e.parts.length=0,e.parts.push(e),e.parent=e,s=0;s<t.length;s++){var i=t[s];i!==e&&(i.parent=e,e.parts.push(i))}if(1!==e.parts.length){if(n="undefined"===typeof n||n,n){var a=[];for(s=0;s<t.length;s++)a=a.concat(t[s].vertices);r.clockwiseSort(a);var l=r.hull(a),c=r.centre(l);o.setVertices(e,l),r.translate(e.vertices,c)}var u=o._totalProperties(e);e.area=u.area,e.parent=e,e.position.x=u.centre.x,e.position.y=u.centre.y,e.positionPrev.x=u.centre.x,e.positionPrev.y=u.centre.y,o.setMass(e,u.mass),o.setInertia(e,u.inertia),o.setPosition(e,u.centre)}},o.setCentre=function(e,t,n){n?(e.positionPrev.x+=t.x,e.positionPrev.y+=t.y,e.position.x+=t.x,e.position.y+=t.y):(e.positionPrev.x=t.x-(e.position.x-e.positionPrev.x),e.positionPrev.y=t.y-(e.position.y-e.positionPrev.y),e.position.x=t.x,e.position.y=t.y)},o.setPosition=function(e,t){var n=s.sub(t,e.position);e.positionPrev.x+=n.x,e.positionPrev.y+=n.y;for(var o=0;o<e.parts.length;o++){var i=e.parts[o];i.position.x+=n.x,i.position.y+=n.y,r.translate(i.vertices,n),l.update(i.bounds,i.vertices,e.velocity)}},o.setAngle=function(e,t){var n=t-e.angle;e.anglePrev+=n;for(var o=0;o<e.parts.length;o++){var i=e.parts[o];i.angle+=n,r.rotate(i.vertices,n,e.position),c.rotate(i.axes,n),l.update(i.bounds,i.vertices,e.velocity),o>0&&s.rotateAbout(i.position,n,e.position,i.position)}},o.setVelocity=function(e,t){e.positionPrev.x=e.position.x-t.x,e.positionPrev.y=e.position.y-t.y,e.velocity.x=t.x,e.velocity.y=t.y,e.speed=s.magnitude(e.velocity)},o.setAngularVelocity=function(e,t){e.anglePrev=e.angle-t,e.angularVelocity=t,e.angularSpeed=Math.abs(e.angularVelocity)},o.translate=function(e,t){o.setPosition(e,s.add(e.position,t))},o.rotate=function(e,t,n){if(n){var r=Math.cos(t),s=Math.sin(t),i=e.position.x-n.x,a=e.position.y-n.y;o.setPosition(e,{x:n.x+(i*r-a*s),y:n.y+(i*s+a*r)}),o.setAngle(e,e.angle+t)}else o.setAngle(e,e.angle+t)},o.scale=function(e,t,n,s){var i=0,a=0;s=s||e.position;for(var u=0;u<e.parts.length;u++){var h=e.parts[u];r.scale(h.vertices,t,n,s),h.axes=c.fromVertices(h.vertices),h.area=r.area(h.vertices),o.setMass(h,e.density*h.area),r.translate(h.vertices,{x:-h.position.x,y:-h.position.y}),o.setInertia(h,o._inertiaScale*r.inertia(h.vertices,h.mass)),r.translate(h.vertices,{x:h.position.x,y:h.position.y}),u>0&&(i+=h.area,a+=h.inertia),h.position.x=s.x+(h.position.x-s.x)*t,h.position.y=s.y+(h.position.y-s.y)*n,l.update(h.bounds,h.vertices,e.velocity)}e.parts.length>1&&(e.area=i,e.isStatic||(o.setMass(e,e.density*i),o.setInertia(e,a))),e.circleRadius&&(t===n?e.circleRadius*=t:e.circleRadius=null)},o.update=function(e,t,n,o){var i=Math.pow(t*n*e.timeScale,2),a=1-e.frictionAir*n*e.timeScale,u=e.position.x-e.positionPrev.x,h=e.position.y-e.positionPrev.y;e.velocity.x=u*a*o+e.force.x/e.mass*i,e.velocity.y=h*a*o+e.force.y/e.mass*i,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.position.x+=e.velocity.x,e.position.y+=e.velocity.y,e.angularVelocity=(e.angle-e.anglePrev)*a*o+e.torque/e.inertia*i,e.anglePrev=e.angle,e.angle+=e.angularVelocity,e.speed=s.magnitude(e.velocity),e.angularSpeed=Math.abs(e.angularVelocity);for(var d=0;d<e.parts.length;d++){var p=e.parts[d];r.translate(p.vertices,e.velocity),d>0&&(p.position.x+=e.velocity.x,p.position.y+=e.velocity.y),0!==e.angularVelocity&&(r.rotate(p.vertices,e.angularVelocity,e.position),c.rotate(p.axes,e.angularVelocity),d>0&&s.rotateAbout(p.position,e.angularVelocity,e.position,p.position)),l.update(p.bounds,p.vertices,e.velocity)}},o.applyForce=function(e,t,n){e.force.x+=n.x,e.force.y+=n.y;var o={x:t.x-e.position.x,y:t.y-e.position.y};e.torque+=o.x*n.y-o.y*n.x},o._totalProperties=function(e){for(var t={mass:0,area:0,inertia:0,centre:{x:0,y:0}},n=1===e.parts.length?0:1;n<e.parts.length;n++){var o=e.parts[n],r=o.mass!==1/0?o.mass:1;t.mass+=r,t.area+=o.area,t.inertia+=o.inertia,t.centre=s.add(t.centre,s.mult(o.position,r))}return t.centre=s.div(t.centre,t.mass),t}})()},function(e,t,n){var o={};e.exports=o;var r=n(4);(function(){o._motionWakeThreshold=.18,o._motionSleepThreshold=.08,o._minBias=.9,o.update=function(e,t){for(var n=t*t*t,r=0;r<e.length;r++){var s=e[r],i=s.speed*s.speed+s.angularSpeed*s.angularSpeed;if(0===s.force.x&&0===s.force.y){var a=Math.min(s.motion,i),l=Math.max(s.motion,i);s.motion=o._minBias*a+(1-o._minBias)*l,s.sleepThreshold>0&&s.motion<o._motionSleepThreshold*n?(s.sleepCounter+=1,s.sleepCounter>=s.sleepThreshold&&o.set(s,!0)):s.sleepCounter>0&&(s.sleepCounter-=1)}else o.set(s,!1)}},o.afterCollisions=function(e,t){for(var n=t*t*t,r=0;r<e.length;r++){var s=e[r];if(s.isActive){var i=s.collision,a=i.bodyA.parent,l=i.bodyB.parent;if(!(a.isSleeping&&l.isSleeping||a.isStatic||l.isStatic)&&(a.isSleeping||l.isSleeping)){var c=a.isSleeping&&!a.isStatic?a:l,u=c===a?l:a;!c.isStatic&&u.motion>o._motionWakeThreshold*n&&o.set(c,!1)}}}},o.set=function(e,t){var n=e.isSleeping;t?(e.isSleeping=!0,e.sleepCounter=e.sleepThreshold,e.positionImpulse.x=0,e.positionImpulse.y=0,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.anglePrev=e.angle,e.speed=0,e.angularSpeed=0,e.motion=0,n||r.trigger(e,"sleepStart")):(e.isSleeping=!1,e.sleepCounter=0,n&&r.trigger(e,"sleepEnd"))}})()},function(e,t,n){var o={};e.exports=o;var r=n(3),s=n(2),i=n(7),a=n(1),l=n(10),c=n(0);(function(){o._warming=.4,o._torqueDampen=1,o._minLength=1e-6,o.create=function(e){var t=e;t.bodyA&&!t.pointA&&(t.pointA={x:0,y:0}),t.bodyB&&!t.pointB&&(t.pointB={x:0,y:0});var n=t.bodyA?s.add(t.bodyA.position,t.pointA):t.pointA,o=t.bodyB?s.add(t.bodyB.position,t.pointB):t.pointB,r=s.magnitude(s.sub(n,o));t.length="undefined"!==typeof t.length?t.length:r,t.id=t.id||c.nextId(),t.label=t.label||"Constraint",t.type="constraint",t.stiffness=t.stiffness||(t.length>0?1:.7),t.damping=t.damping||0,t.angularStiffness=t.angularStiffness||0,t.angleA=t.bodyA?t.bodyA.angle:t.angleA,t.angleB=t.bodyB?t.bodyB.angle:t.angleB,t.plugin={};var i={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return 0===t.length&&t.stiffness>.1?(i.type="pin",i.anchors=!1):t.stiffness<.9&&(i.type="spring"),t.render=c.extend(i,t.render),t},o.preSolveAll=function(e){for(var t=0;t<e.length;t+=1){var n=e[t],o=n.constraintImpulse;n.isStatic||0===o.x&&0===o.y&&0===o.angle||(n.position.x+=o.x,n.position.y+=o.y,n.angle+=o.angle)}},o.solveAll=function(e,t){for(var n=0;n<e.length;n+=1){var r=e[n],s=!r.bodyA||r.bodyA&&r.bodyA.isStatic,i=!r.bodyB||r.bodyB&&r.bodyB.isStatic;(s||i)&&o.solve(e[n],t)}for(n=0;n<e.length;n+=1)r=e[n],s=!r.bodyA||r.bodyA&&r.bodyA.isStatic,i=!r.bodyB||r.bodyB&&r.bodyB.isStatic,s||i||o.solve(e[n],t)},o.solve=function(e,t){var n=e.bodyA,r=e.bodyB,i=e.pointA,a=e.pointB;if(n||r){n&&!n.isStatic&&(s.rotate(i,n.angle-e.angleA,i),e.angleA=n.angle),r&&!r.isStatic&&(s.rotate(a,r.angle-e.angleB,a),e.angleB=r.angle);var l=i,c=a;if(n&&(l=s.add(n.position,i)),r&&(c=s.add(r.position,a)),l&&c){var u=s.sub(l,c),h=s.magnitude(u);h<o._minLength&&(h=o._minLength);var d,p,m,f,g,y=(h-e.length)/h,v=e.stiffness<1?e.stiffness*t:e.stiffness,x=s.mult(u,y*v),b=(n?n.inverseMass:0)+(r?r.inverseMass:0),w=(n?n.inverseInertia:0)+(r?r.inverseInertia:0),A=b+w;if(e.damping){var S=s.create();m=s.div(u,h),g=s.sub(r&&s.sub(r.position,r.positionPrev)||S,n&&s.sub(n.position,n.positionPrev)||S),f=s.dot(m,g)}n&&!n.isStatic&&(p=n.inverseMass/b,n.constraintImpulse.x-=x.x*p,n.constraintImpulse.y-=x.y*p,n.position.x-=x.x*p,n.position.y-=x.y*p,e.damping&&(n.positionPrev.x-=e.damping*m.x*f*p,n.positionPrev.y-=e.damping*m.y*f*p),d=s.cross(i,x)/A*o._torqueDampen*n.inverseInertia*(1-e.angularStiffness),n.constraintImpulse.angle-=d,n.angle-=d),r&&!r.isStatic&&(p=r.inverseMass/b,r.constraintImpulse.x+=x.x*p,r.constraintImpulse.y+=x.y*p,r.position.x+=x.x*p,r.position.y+=x.y*p,e.damping&&(r.positionPrev.x+=e.damping*m.x*f*p,r.positionPrev.y+=e.damping*m.y*f*p),d=s.cross(a,x)/A*o._torqueDampen*r.inverseInertia*(1-e.angularStiffness),r.constraintImpulse.angle+=d,r.angle+=d)}}},o.postSolveAll=function(e){for(var t=0;t<e.length;t++){var n=e[t],c=n.constraintImpulse;if(!(n.isStatic||0===c.x&&0===c.y&&0===c.angle)){i.set(n,!1);for(var u=0;u<n.parts.length;u++){var h=n.parts[u];r.translate(h.vertices,c),u>0&&(h.position.x+=c.x,h.position.y+=c.y),0!==c.angle&&(r.rotate(h.vertices,c.angle,n.position),l.rotate(h.axes,c.angle),u>0&&s.rotateAbout(h.position,c.angle,n.position,h.position)),a.update(h.bounds,h.vertices,n.velocity)}c.angle*=o._warming,c.x*=o._warming,c.y*=o._warming}}},o.pointAWorld=function(e){return{x:(e.bodyA?e.bodyA.position.x:0)+e.pointA.x,y:(e.bodyA?e.bodyA.position.y:0)+e.pointA.y}},o.pointBWorld=function(e){return{x:(e.bodyB?e.bodyB.position.x:0)+e.pointB.x,y:(e.bodyB?e.bodyB.position.y:0)+e.pointB.y}}})()},function(e,t,n){var o={};e.exports=o;var r=n(17);(function(){o.create=function(e,t){var n=e.bodyA,r=e.bodyB,s=e.parentA,i=e.parentB,a={id:o.id(n,r),bodyA:n,bodyB:r,contacts:{},activeContacts:[],separation:0,isActive:!0,confirmedActive:!0,isSensor:n.isSensor||r.isSensor,timeCreated:t,timeUpdated:t,inverseMass:s.inverseMass+i.inverseMass,friction:Math.min(s.friction,i.friction),frictionStatic:Math.max(s.frictionStatic,i.frictionStatic),restitution:Math.max(s.restitution,i.restitution),slop:Math.max(s.slop,i.slop)};return o.update(a,e,t),a},o.update=function(e,t,n){var s=e.contacts,i=t.supports,a=e.activeContacts,l=t.parentA,c=t.parentB;if(e.collision=t,e.inverseMass=l.inverseMass+c.inverseMass,e.friction=Math.min(l.friction,c.friction),e.frictionStatic=Math.max(l.frictionStatic,c.frictionStatic),e.restitution=Math.max(l.restitution,c.restitution),e.slop=Math.max(l.slop,c.slop),a.length=0,t.collided){for(var u=0;u<i.length;u++){var h=i[u],d=r.id(h),p=s[d];p?a.push(p):a.push(s[d]=r.create(h))}e.separation=t.depth,o.setActive(e,!0,n)}else!0===e.isActive&&o.setActive(e,!1,n)},o.setActive=function(e,t,n){t?(e.isActive=!0,e.timeUpdated=n):(e.isActive=!1,e.activeContacts.length=0)},o.id=function(e,t){return e.id<t.id?"A"+e.id+"B"+t.id:"A"+t.id+"B"+e.id}})()},function(e,t,n){var o={};e.exports=o;var r=n(2),s=n(0);(function(){o.fromVertices=function(e){for(var t={},n=0;n<e.length;n++){var o=(n+1)%e.length,i=r.normalise({x:e[o].y-e[n].y,y:e[n].x-e[o].x}),a=0===i.y?1/0:i.x/i.y;a=a.toFixed(3).toString(),t[a]=i}return s.values(t)},o.rotate=function(e,t){if(0!==t)for(var n=Math.cos(t),o=Math.sin(t),r=0;r<e.length;r++){var s,i=e[r];s=i.x*n-i.y*o,i.y=i.x*o+i.y*n,i.x=s}}})()},function(e,t,n){var o={};e.exports=o;var r=n(3),s=n(0),i=n(6),a=n(1),l=n(2);(function(){o.rectangle=function(e,t,n,o,a){a=a||{};var l={label:"Rectangle Body",position:{x:e,y:t},vertices:r.fromPath("L 0 0 L "+n+" 0 L "+n+" "+o+" L 0 "+o)};if(a.chamfer){var c=a.chamfer;l.vertices=r.chamfer(l.vertices,c.radius,c.quality,c.qualityMin,c.qualityMax),delete a.chamfer}return i.create(s.extend({},l,a))},o.trapezoid=function(e,t,n,o,a,l){l=l||{},a*=.5;var c,u=(1-2*a)*n,h=n*a,d=h+u,p=d+h;c=a<.5?"L 0 0 L "+h+" "+-o+" L "+d+" "+-o+" L "+p+" 0":"L 0 0 L "+d+" "+-o+" L "+p+" 0";var m={label:"Trapezoid Body",position:{x:e,y:t},vertices:r.fromPath(c)};if(l.chamfer){var f=l.chamfer;m.vertices=r.chamfer(m.vertices,f.radius,f.quality,f.qualityMin,f.qualityMax),delete l.chamfer}return i.create(s.extend({},m,l))},o.circle=function(e,t,n,r,i){r=r||{};var a={label:"Circle Body",circleRadius:n};i=i||25;var l=Math.ceil(Math.max(10,Math.min(i,n)));return l%2===1&&(l+=1),o.polygon(e,t,l,n,s.extend({},a,r))},o.polygon=function(e,t,n,a,l){if(l=l||{},n<3)return o.circle(e,t,a,l);for(var c=2*Math.PI/n,u="",h=.5*c,d=0;d<n;d+=1){var p=h+d*c,m=Math.cos(p)*a,f=Math.sin(p)*a;u+="L "+m.toFixed(3)+" "+f.toFixed(3)+" "}var g={label:"Polygon Body",position:{x:e,y:t},vertices:r.fromPath(u)};if(l.chamfer){var y=l.chamfer;g.vertices=r.chamfer(g.vertices,y.radius,y.quality,y.qualityMin,y.qualityMax),delete l.chamfer}return i.create(s.extend({},g,l))},o.fromVertices=function(e,t,n,o,c,u,h,d){var p,m,f,g,y,v,x,b,w,A,S,M=s.getDecomp();for(p=Boolean(M&&M.quickDecomp),o=o||{},f=[],c="undefined"!==typeof c&&c,u="undefined"!==typeof u?u:.01,h="undefined"!==typeof h?h:10,d="undefined"!==typeof d?d:.01,s.isArray(n[0])||(n=[n]),A=0;A<n.length;A+=1)if(v=n[A],g=r.isConvex(v),y=!g,y&&!p&&s.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),g||!p)v=g?r.clockwiseSort(v):r.hull(v),f.push({position:{x:e,y:t},vertices:v});else{var T=v.map((function(e){return[e.x,e.y]}));M.makeCCW(T),!1!==u&&M.removeCollinearPoints(T,u),!1!==d&&M.removeDuplicatePoints&&M.removeDuplicatePoints(T,d);var P=M.quickDecomp(T);for(x=0;x<P.length;x++){var C=P[x],E=C.map((function(e){return{x:e[0],y:e[1]}}));h>0&&r.area(E)<h||f.push({position:r.centre(E),vertices:E})}}for(x=0;x<f.length;x++)f[x]=i.create(s.extend(f[x],o));if(c){var k=5;for(x=0;x<f.length;x++){var _=f[x];for(b=x+1;b<f.length;b++){var I=f[b];if(a.overlaps(_.bounds,I.bounds)){var R=_.vertices,L=I.vertices;for(w=0;w<_.vertices.length;w++)for(S=0;S<I.vertices.length;S++){var N=l.magnitudeSquared(l.sub(R[(w+1)%R.length],L[S])),B=l.magnitudeSquared(l.sub(R[w],L[(S+1)%L.length]));N<k&&B<k&&(R[w].isInternal=!0,L[S].isInternal=!0)}}}}}return f.length>1?(m=i.create(s.extend({parts:f.slice(0)},o)),i.setPosition(m,{x:e,y:t}),m):f[0]}})()},function(e,t,n){var o={};e.exports=o;var r=n(0);(function(){o.create=function(e){var t={};return e||r.log("Mouse.create: element was undefined, defaulting to document.body","warn"),t.element=e||document.body,t.absolute={x:0,y:0},t.position={x:0,y:0},t.mousedownPosition={x:0,y:0},t.mouseupPosition={x:0,y:0},t.offset={x:0,y:0},t.scale={x:1,y:1},t.wheelDelta=0,t.button=-1,t.pixelRatio=parseInt(t.element.getAttribute("data-pixel-ratio"),10)||1,t.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},t.mousemove=function(e){var n=o._getRelativeMousePosition(e,t.element,t.pixelRatio),r=e.changedTouches;r&&(t.button=0,e.preventDefault()),t.absolute.x=n.x,t.absolute.y=n.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y,t.sourceEvents.mousemove=e},t.mousedown=function(e){var n=o._getRelativeMousePosition(e,t.element,t.pixelRatio),r=e.changedTouches;r?(t.button=0,e.preventDefault()):t.button=e.button,t.absolute.x=n.x,t.absolute.y=n.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y,t.mousedownPosition.x=t.position.x,t.mousedownPosition.y=t.position.y,t.sourceEvents.mousedown=e},t.mouseup=function(e){var n=o._getRelativeMousePosition(e,t.element,t.pixelRatio),r=e.changedTouches;r&&e.preventDefault(),t.button=-1,t.absolute.x=n.x,t.absolute.y=n.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y,t.mouseupPosition.x=t.position.x,t.mouseupPosition.y=t.position.y,t.sourceEvents.mouseup=e},t.mousewheel=function(e){t.wheelDelta=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail)),e.preventDefault()},o.setElement(t,t.element),t},o.setElement=function(e,t){e.element=t,t.addEventListener("mousemove",e.mousemove),t.addEventListener("mousedown",e.mousedown),t.addEventListener("mouseup",e.mouseup),t.addEventListener("mousewheel",e.mousewheel),t.addEventListener("DOMMouseScroll",e.mousewheel),t.addEventListener("touchmove",e.mousemove),t.addEventListener("touchstart",e.mousedown),t.addEventListener("touchend",e.mouseup)},o.clearSourceEvents=function(e){e.sourceEvents.mousemove=null,e.sourceEvents.mousedown=null,e.sourceEvents.mouseup=null,e.sourceEvents.mousewheel=null,e.wheelDelta=0},o.setOffset=function(e,t){e.offset.x=t.x,e.offset.y=t.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y},o.setScale=function(e,t){e.scale.x=t.x,e.scale.y=t.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y},o._getRelativeMousePosition=function(e,t,n){var o,r,s=t.getBoundingClientRect(),i=document.documentElement||document.body.parentNode||document.body,a=void 0!==window.pageXOffset?window.pageXOffset:i.scrollLeft,l=void 0!==window.pageYOffset?window.pageYOffset:i.scrollTop,c=e.changedTouches;return c?(o=c[0].pageX-s.left-a,r=c[0].pageY-s.top-l):(o=e.pageX-s.left-a,r=e.pageY-s.top-l),{x:o/(t.clientWidth/(t.width||t.clientWidth)*n),y:r/(t.clientHeight/(t.height||t.clientHeight)*n)}}})()},function(e,t,n){var o={};e.exports=o;var r=n(14),s=n(9),i=n(1);(function(){o.collisions=function(e,t){for(var n=[],a=t.pairs.table,l=0;l<e.length;l++){var c=e[l][0],u=e[l][1];if((!c.isStatic&&!c.isSleeping||!u.isStatic&&!u.isSleeping)&&(o.canCollide(c.collisionFilter,u.collisionFilter)&&i.overlaps(c.bounds,u.bounds)))for(var h=c.parts.length>1?1:0;h<c.parts.length;h++)for(var d=c.parts[h],p=u.parts.length>1?1:0;p<u.parts.length;p++){var m=u.parts[p];if(d===c&&m===u||i.overlaps(d.bounds,m.bounds)){var f,g=s.id(d,m),y=a[g];f=y&&y.isActive?y.collision:null;var v=r.collides(d,m,f);v.collided&&n.push(v)}}}return n},o.canCollide=function(e,t){return e.group===t.group&&0!==e.group?e.group>0:0!==(e.mask&t.category)&&0!==(t.mask&e.category)}})()},function(e,t,n){var o={};e.exports=o;var r=n(3),s=n(2);(function(){o.collides=function(e,t,n){var i,a,l,c,u=!1;if(n){var h=e.parent,d=t.parent,p=h.speed*h.speed+h.angularSpeed*h.angularSpeed+d.speed*d.speed+d.angularSpeed*d.angularSpeed;u=n&&n.collided&&p<.2,c=n}else c={collided:!1,bodyA:e,bodyB:t};if(n&&u){var m=c.axisBody,f=m===e?t:e,g=[m.axes[n.axisNumber]];if(l=o._overlapAxes(m.vertices,f.vertices,g),c.reused=!0,l.overlap<=0)return c.collided=!1,c}else{if(i=o._overlapAxes(e.vertices,t.vertices,e.axes),i.overlap<=0)return c.collided=!1,c;if(a=o._overlapAxes(t.vertices,e.vertices,t.axes),a.overlap<=0)return c.collided=!1,c;i.overlap<a.overlap?(l=i,c.axisBody=e):(l=a,c.axisBody=t),c.axisNumber=l.axisNumber}c.bodyA=e.id<t.id?e:t,c.bodyB=e.id<t.id?t:e,c.collided=!0,c.depth=l.overlap,c.parentA=c.bodyA.parent,c.parentB=c.bodyB.parent,e=c.bodyA,t=c.bodyB,s.dot(l.axis,s.sub(t.position,e.position))<0?c.normal={x:l.axis.x,y:l.axis.y}:c.normal={x:-l.axis.x,y:-l.axis.y},c.tangent=s.perp(c.normal),c.penetration=c.penetration||{},c.penetration.x=c.normal.x*c.depth,c.penetration.y=c.normal.y*c.depth;var y=o._findSupports(e,t,c.normal),v=[];if(r.contains(e.vertices,y[0])&&v.push(y[0]),r.contains(e.vertices,y[1])&&v.push(y[1]),v.length<2){var x=o._findSupports(t,e,s.neg(c.normal));r.contains(t.vertices,x[0])&&v.push(x[0]),v.length<2&&r.contains(t.vertices,x[1])&&v.push(x[1])}return v.length<1&&(v=[y[0]]),c.supports=v,c},o._overlapAxes=function(e,t,n){for(var r,i,a=s._temp[0],l=s._temp[1],c={overlap:Number.MAX_VALUE},u=0;u<n.length;u++){if(i=n[u],o._projectToAxis(a,e,i),o._projectToAxis(l,t,i),r=Math.min(a.max-l.min,l.max-a.min),r<=0)return c.overlap=r,c;r<c.overlap&&(c.overlap=r,c.axis=i,c.axisNumber=u)}return c},o._projectToAxis=function(e,t,n){for(var o=s.dot(t[0],n),r=o,i=1;i<t.length;i+=1){var a=s.dot(t[i],n);a>r?r=a:a<o&&(o=a)}e.min=o,e.max=r},o._findSupports=function(e,t,n){for(var o,r,i,a,l=Number.MAX_VALUE,c=s._temp[0],u=t.vertices,h=e.position,d=0;d<u.length;d++)r=u[d],c.x=r.x-h.x,c.y=r.y-h.y,o=-s.dot(n,c),o<l&&(l=o,i=r);var p=i.index-1>=0?i.index-1:u.length-1;r=u[p],c.x=r.x-h.x,c.y=r.y-h.y,l=-s.dot(n,c),a=r;var m=(i.index+1)%u.length;return r=u[m],c.x=r.x-h.x,c.y=r.y-h.y,o=-s.dot(n,c),o<l&&(a=r),[i,a]}})()},function(e,t,n){var o={};e.exports=o;var r=n(0);(function(){o._registry={},o.register=function(e){if(o.isPlugin(e)||r.warn("Plugin.register:",o.toString(e),"does not implement all required fields."),e.name in o._registry){var t=o._registry[e.name],n=o.versionParse(e.version).number,s=o.versionParse(t.version).number;n>s?(r.warn("Plugin.register:",o.toString(t),"was upgraded to",o.toString(e)),o._registry[e.name]=e):n<s?r.warn("Plugin.register:",o.toString(t),"can not be downgraded to",o.toString(e)):e!==t&&r.warn("Plugin.register:",o.toString(e),"is already registered to different plugin object")}else o._registry[e.name]=e;return e},o.resolve=function(e){return o._registry[o.dependencyParse(e).name]},o.toString=function(e){return"string"===typeof e?e:(e.name||"anonymous")+"@"+(e.version||e.range||"0.0.0")},o.isPlugin=function(e){return e&&e.name&&e.version&&e.install},o.isUsed=function(e,t){return e.used.indexOf(t)>-1},o.isFor=function(e,t){var n=e.for&&o.dependencyParse(e.for);return!e.for||t.name===n.name&&o.versionSatisfies(t.version,n.range)},o.use=function(e,t){if(e.uses=(e.uses||[]).concat(t||[]),0!==e.uses.length){for(var n=o.dependencies(e),s=r.topologicalSort(n),i=[],a=0;a<s.length;a+=1)if(s[a]!==e.name){var l=o.resolve(s[a]);l?o.isUsed(e,l.name)||(o.isFor(l,e)||(r.warn("Plugin.use:",o.toString(l),"is for",l.for,"but installed on",o.toString(e)+"."),l._warned=!0),l.install?l.install(e):(r.warn("Plugin.use:",o.toString(l),"does not specify an install function."),l._warned=!0),l._warned?(i.push("🔶 "+o.toString(l)),delete l._warned):i.push("✅ "+o.toString(l)),e.used.push(l.name)):i.push("❌ "+s[a])}i.length>0&&r.info(i.join("  "))}else r.warn("Plugin.use:",o.toString(e),"does not specify any dependencies to install.")},o.dependencies=function(e,t){var n=o.dependencyParse(e),s=n.name;if(t=t||{},!(s in t)){e=o.resolve(e)||e,t[s]=r.map(e.uses||[],(function(t){o.isPlugin(t)&&o.register(t);var s=o.dependencyParse(t),i=o.resolve(t);return i&&!o.versionSatisfies(i.version,s.range)?(r.warn("Plugin.dependencies:",o.toString(i),"does not satisfy",o.toString(s),"used by",o.toString(n)+"."),i._warned=!0,e._warned=!0):i||(r.warn("Plugin.dependencies:",o.toString(t),"used by",o.toString(n),"could not be resolved."),e._warned=!0),s.name}));for(var i=0;i<t[s].length;i+=1)o.dependencies(t[s][i],t);return t}},o.dependencyParse=function(e){if(r.isString(e)){var t=/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-]+)?))?$/;return t.test(e)||r.warn("Plugin.dependencyParse:",e,"is not a valid dependency string."),{name:e.split("@")[0],range:e.split("@")[1]||"*"}}return{name:e.name,range:e.range||e.version}},o.versionParse=function(e){var t=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-]+)?$/;t.test(e)||r.warn("Plugin.versionParse:",e,"is not a valid version or range.");var n=t.exec(e),o=Number(n[4]),s=Number(n[5]),i=Number(n[6]);return{isRange:Boolean(n[1]||n[2]),version:n[3],range:e,operator:n[1]||n[2]||"",major:o,minor:s,patch:i,parts:[o,s,i],prerelease:n[7],number:1e8*o+1e4*s+i}},o.versionSatisfies=function(e,t){t=t||"*";var n=o.versionParse(t),r=o.versionParse(e);if(n.isRange){if("*"===n.operator||"*"===e)return!0;if(">"===n.operator)return r.number>n.number;if(">="===n.operator)return r.number>=n.number;if("~"===n.operator)return r.major===n.major&&r.minor===n.minor&&r.patch>=n.patch;if("^"===n.operator)return n.major>0?r.major===n.major&&r.number>=n.number:n.minor>0?r.minor===n.minor&&r.patch>=n.patch:r.patch===n.patch}return e===t||"*"===e}})()},function(e,t,n){var o={};e.exports=o;var r=n(0),s=n(5),i=n(1),a=n(4),l=n(2),c=n(12);(function(){var e,t;"undefined"!==typeof window&&(e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout((function(){e(r.now())}),1e3/60)},t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),o._goodFps=30,o._goodDelta=1e3/60,o.create=function(e){var t={controller:o,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",hasBounds:!!e.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},n=r.extend(t,e);return n.canvas&&(n.canvas.width=n.options.width||n.canvas.width,n.canvas.height=n.options.height||n.canvas.height),n.mouse=e.mouse,n.engine=e.engine,n.canvas=n.canvas||h(n.options.width,n.options.height),n.context=n.canvas.getContext("2d"),n.textures={},n.bounds=n.bounds||{min:{x:0,y:0},max:{x:n.canvas.width,y:n.canvas.height}},1!==n.options.pixelRatio&&o.setPixelRatio(n,n.options.pixelRatio),r.isElement(n.element)?n.element.appendChild(n.canvas):n.canvas.parentNode||r.log("Render.create: options.element was undefined, render.canvas was created but not appended","warn"),n},o.run=function(t){(function r(s){t.frameRequestId=e(r),n(t,s),o.world(t,s),(t.options.showStats||t.options.showDebug)&&o.stats(t,t.context,s),(t.options.showPerformance||t.options.showDebug)&&o.performance(t,t.context,s)})()},o.stop=function(e){t(e.frameRequestId)},o.setPixelRatio=function(e,t){var n=e.options,o=e.canvas;"auto"===t&&(t=d(o)),n.pixelRatio=t,o.setAttribute("data-pixel-ratio",t),o.width=n.width*t,o.height=n.height*t,o.style.width=n.width+"px",o.style.height=n.height+"px"},o.lookAt=function(e,t,n,o){o="undefined"===typeof o||o,t=r.isArray(t)?t:[t],n=n||{x:0,y:0};for(var s={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},i=0;i<t.length;i+=1){var a=t[i],l=a.bounds?a.bounds.min:a.min||a.position||a,u=a.bounds?a.bounds.max:a.max||a.position||a;l&&u&&(l.x<s.min.x&&(s.min.x=l.x),u.x>s.max.x&&(s.max.x=u.x),l.y<s.min.y&&(s.min.y=l.y),u.y>s.max.y&&(s.max.y=u.y))}var h=s.max.x-s.min.x+2*n.x,d=s.max.y-s.min.y+2*n.y,p=e.canvas.height,m=e.canvas.width,f=m/p,g=h/d,y=1,v=1;g>f?v=g/f:y=f/g,e.options.hasBounds=!0,e.bounds.min.x=s.min.x,e.bounds.max.x=s.min.x+h*y,e.bounds.min.y=s.min.y,e.bounds.max.y=s.min.y+d*v,o&&(e.bounds.min.x+=.5*h-h*y*.5,e.bounds.max.x+=.5*h-h*y*.5,e.bounds.min.y+=.5*d-d*v*.5,e.bounds.max.y+=.5*d-d*v*.5),e.bounds.min.x-=n.x,e.bounds.max.x-=n.x,e.bounds.min.y-=n.y,e.bounds.max.y-=n.y,e.mouse&&(c.setScale(e.mouse,{x:(e.bounds.max.x-e.bounds.min.x)/e.canvas.width,y:(e.bounds.max.y-e.bounds.min.y)/e.canvas.height}),c.setOffset(e.mouse,e.bounds.min))},o.startViewTransform=function(e){var t=e.bounds.max.x-e.bounds.min.x,n=e.bounds.max.y-e.bounds.min.y,o=t/e.options.width,r=n/e.options.height;e.context.setTransform(e.options.pixelRatio/o,0,0,e.options.pixelRatio/r,0,0),e.context.translate(-e.bounds.min.x,-e.bounds.min.y)},o.endViewTransform=function(e){e.context.setTransform(e.options.pixelRatio,0,0,e.options.pixelRatio,0,0)},o.world=function(e,t){var n,u=r.now(),h=e.engine,d=h.world,p=e.canvas,f=e.context,g=e.options,y=e.timing,v=s.allBodies(d),x=s.allConstraints(d),b=g.wireframes?g.wireframeBackground:g.background,w=[],A=[],S={timestamp:h.timing.timestamp};if(a.trigger(e,"beforeRender",S),e.currentBackground!==b&&m(e,b),f.globalCompositeOperation="source-in",f.fillStyle="transparent",f.fillRect(0,0,p.width,p.height),f.globalCompositeOperation="source-over",g.hasBounds){for(n=0;n<v.length;n++){var M=v[n];i.overlaps(M.bounds,e.bounds)&&w.push(M)}for(n=0;n<x.length;n++){var T=x[n],P=T.bodyA,C=T.bodyB,E=T.pointA,k=T.pointB;P&&(E=l.add(P.position,T.pointA)),C&&(k=l.add(C.position,T.pointB)),E&&k&&((i.contains(e.bounds,E)||i.contains(e.bounds,k))&&A.push(T))}o.startViewTransform(e),e.mouse&&(c.setScale(e.mouse,{x:(e.bounds.max.x-e.bounds.min.x)/e.options.width,y:(e.bounds.max.y-e.bounds.min.y)/e.options.height}),c.setOffset(e.mouse,e.bounds.min))}else A=x,w=v,1!==e.options.pixelRatio&&e.context.setTransform(e.options.pixelRatio,0,0,e.options.pixelRatio,0,0);!g.wireframes||h.enableSleeping&&g.showSleeping?o.bodies(e,w,f):(g.showConvexHulls&&o.bodyConvexHulls(e,w,f),o.bodyWireframes(e,w,f)),g.showBounds&&o.bodyBounds(e,w,f),(g.showAxes||g.showAngleIndicator)&&o.bodyAxes(e,w,f),g.showPositions&&o.bodyPositions(e,w,f),g.showVelocity&&o.bodyVelocity(e,w,f),g.showIds&&o.bodyIds(e,w,f),g.showSeparations&&o.separations(e,h.pairs.list,f),g.showCollisions&&o.collisions(e,h.pairs.list,f),g.showVertexNumbers&&o.vertexNumbers(e,w,f),g.showMousePosition&&o.mousePosition(e,e.mouse,f),o.constraints(A,f),g.showBroadphase&&o.grid(e,h.grid,f),g.hasBounds&&o.endViewTransform(e),a.trigger(e,"afterRender",S),y.lastElapsed=r.now()-u},o.stats=function(e,t,n){for(var o=e.engine,r=o.world,i=s.allBodies(r),a=0,l=55,c=44,u=0,h=0,d=0;d<i.length;d+=1)a+=i[d].parts.length;var p={Part:a,Body:i.length,Cons:s.allConstraints(r).length,Comp:s.allComposites(r).length,Pair:o.pairs.list.length};for(var m in t.fillStyle="#0e0f19",t.fillRect(u,h,5.5*l,c),t.font="12px Arial",t.textBaseline="top",t.textAlign="right",p){var f=p[m];t.fillStyle="#aaa",t.fillText(m,u+l,h+8),t.fillStyle="#eee",t.fillText(f,u+l,h+26),u+=l}},o.performance=function(e,t){var n=e.engine,r=e.timing,s=r.deltaHistory,i=r.elapsedHistory,a=r.timestampElapsedHistory,l=r.engineDeltaHistory,c=r.engineElapsedHistory,h=n.timing.lastDelta,d=u(s),p=u(i),m=u(l),f=u(c),g=u(a),y=g/d||0,v=1e3/d||0,x=4,b=12,w=60,A=34,S=10,M=69;t.fillStyle="#0e0f19",t.fillRect(0,50,4*b+5*w+22,A),o.status(t,S,M,w,x,s.length,Math.round(v)+" fps",v/o._goodFps,(function(e){return s[e]/d-1})),o.status(t,S+b+w,M,w,x,l.length,h.toFixed(2)+" dt",o._goodDelta/h,(function(e){return l[e]/m-1})),o.status(t,S+2*(b+w),M,w,x,c.length,f.toFixed(2)+" ut",1-f/o._goodFps,(function(e){return c[e]/f-1})),o.status(t,S+3*(b+w),M,w,x,i.length,p.toFixed(2)+" rt",1-p/o._goodFps,(function(e){return i[e]/p-1})),o.status(t,S+4*(b+w),M,w,x,a.length,y.toFixed(2)+" x",y*y*y,(function(e){return(a[e]/s[e]/y||0)-1}))},o.status=function(e,t,n,o,s,i,a,l,c){e.strokeStyle="#888",e.fillStyle="#444",e.lineWidth=1,e.fillRect(t,n+7,o,1),e.beginPath(),e.moveTo(t,n+7-s*r.clamp(.4*c(0),-2,2));for(var u=0;u<o;u+=1)e.lineTo(t+u,n+7-(u<i?s*r.clamp(.4*c(u),-2,2):0));e.stroke(),e.fillStyle="hsl("+r.clamp(25+95*l,0,120)+",100%,60%)",e.fillRect(t,n-7,4,4),e.font="12px Arial",e.textBaseline="middle",e.textAlign="right",e.fillStyle="#eee",e.fillText(a,t+o,n-5)},o.constraints=function(e,t){for(var n=t,o=0;o<e.length;o++){var s=e[o];if(s.render.visible&&s.pointA&&s.pointB){var i,a,c=s.bodyA,u=s.bodyB;if(i=c?l.add(c.position,s.pointA):s.pointA,"pin"===s.render.type)n.beginPath(),n.arc(i.x,i.y,3,0,2*Math.PI),n.closePath();else{if(a=u?l.add(u.position,s.pointB):s.pointB,n.beginPath(),n.moveTo(i.x,i.y),"spring"===s.render.type)for(var h,d=l.sub(a,i),p=l.perp(l.normalise(d)),m=Math.ceil(r.clamp(s.length/5,12,20)),f=1;f<m;f+=1)h=f%2===0?1:-1,n.lineTo(i.x+d.x*(f/m)+p.x*h*4,i.y+d.y*(f/m)+p.y*h*4);n.lineTo(a.x,a.y)}s.render.lineWidth&&(n.lineWidth=s.render.lineWidth,n.strokeStyle=s.render.strokeStyle,n.stroke()),s.render.anchors&&(n.fillStyle=s.render.strokeStyle,n.beginPath(),n.arc(i.x,i.y,3,0,2*Math.PI),n.arc(a.x,a.y,3,0,2*Math.PI),n.closePath(),n.fill())}}},o.bodies=function(e,t,n){var o,r,s,i,a=n,l=(e.engine,e.options),c=l.showInternalEdges||!l.wireframes;for(s=0;s<t.length;s++)if(o=t[s],o.render.visible)for(i=o.parts.length>1?1:0;i<o.parts.length;i++)if(r=o.parts[i],r.render.visible){if(l.showSleeping&&o.isSleeping?a.globalAlpha=.5*r.render.opacity:1!==r.render.opacity&&(a.globalAlpha=r.render.opacity),r.render.sprite&&r.render.sprite.texture&&!l.wireframes){var u=r.render.sprite,h=p(e,u.texture);a.translate(r.position.x,r.position.y),a.rotate(r.angle),a.drawImage(h,h.width*-u.xOffset*u.xScale,h.height*-u.yOffset*u.yScale,h.width*u.xScale,h.height*u.yScale),a.rotate(-r.angle),a.translate(-r.position.x,-r.position.y)}else{if(r.circleRadius)a.beginPath(),a.arc(r.position.x,r.position.y,r.circleRadius,0,2*Math.PI);else{a.beginPath(),a.moveTo(r.vertices[0].x,r.vertices[0].y);for(var d=1;d<r.vertices.length;d++)!r.vertices[d-1].isInternal||c?a.lineTo(r.vertices[d].x,r.vertices[d].y):a.moveTo(r.vertices[d].x,r.vertices[d].y),r.vertices[d].isInternal&&!c&&a.moveTo(r.vertices[(d+1)%r.vertices.length].x,r.vertices[(d+1)%r.vertices.length].y);a.lineTo(r.vertices[0].x,r.vertices[0].y),a.closePath()}l.wireframes?(a.lineWidth=1,a.strokeStyle="#bbb",a.stroke()):(a.fillStyle=r.render.fillStyle,r.render.lineWidth&&(a.lineWidth=r.render.lineWidth,a.strokeStyle=r.render.strokeStyle,a.stroke()),a.fill())}a.globalAlpha=1}},o.bodyWireframes=function(e,t,n){var o,r,s,i,a,l=n,c=e.options.showInternalEdges;for(l.beginPath(),s=0;s<t.length;s++)if(o=t[s],o.render.visible)for(a=o.parts.length>1?1:0;a<o.parts.length;a++){for(r=o.parts[a],l.moveTo(r.vertices[0].x,r.vertices[0].y),i=1;i<r.vertices.length;i++)!r.vertices[i-1].isInternal||c?l.lineTo(r.vertices[i].x,r.vertices[i].y):l.moveTo(r.vertices[i].x,r.vertices[i].y),r.vertices[i].isInternal&&!c&&l.moveTo(r.vertices[(i+1)%r.vertices.length].x,r.vertices[(i+1)%r.vertices.length].y);l.lineTo(r.vertices[0].x,r.vertices[0].y)}l.lineWidth=1,l.strokeStyle="#bbb",l.stroke()},o.bodyConvexHulls=function(e,t,n){var o,r,s,i=n;for(i.beginPath(),r=0;r<t.length;r++)if(o=t[r],o.render.visible&&1!==o.parts.length){for(i.moveTo(o.vertices[0].x,o.vertices[0].y),s=1;s<o.vertices.length;s++)i.lineTo(o.vertices[s].x,o.vertices[s].y);i.lineTo(o.vertices[0].x,o.vertices[0].y)}i.lineWidth=1,i.strokeStyle="rgba(255,255,255,0.2)",i.stroke()},o.vertexNumbers=function(e,t,n){var o,r,s,i=n;for(o=0;o<t.length;o++){var a=t[o].parts;for(s=a.length>1?1:0;s<a.length;s++){var l=a[s];for(r=0;r<l.vertices.length;r++)i.fillStyle="rgba(255,255,255,0.2)",i.fillText(o+"_"+r,l.position.x+.8*(l.vertices[r].x-l.position.x),l.position.y+.8*(l.vertices[r].y-l.position.y))}}},o.mousePosition=function(e,t,n){var o=n;o.fillStyle="rgba(255,255,255,0.8)",o.fillText(t.position.x+"  "+t.position.y,t.position.x+5,t.position.y-5)},o.bodyBounds=function(e,t,n){var o=n,r=(e.engine,e.options);o.beginPath();for(var s=0;s<t.length;s++){var i=t[s];if(i.render.visible)for(var a=t[s].parts,l=a.length>1?1:0;l<a.length;l++){var c=a[l];o.rect(c.bounds.min.x,c.bounds.min.y,c.bounds.max.x-c.bounds.min.x,c.bounds.max.y-c.bounds.min.y)}}r.wireframes?o.strokeStyle="rgba(255,255,255,0.08)":o.strokeStyle="rgba(0,0,0,0.1)",o.lineWidth=1,o.stroke()},o.bodyAxes=function(e,t,n){var o,r,s,i,a=n,l=(e.engine,e.options);for(a.beginPath(),r=0;r<t.length;r++){var c=t[r],u=c.parts;if(c.render.visible)if(l.showAxes)for(s=u.length>1?1:0;s<u.length;s++)for(o=u[s],i=0;i<o.axes.length;i++){var h=o.axes[i];a.moveTo(o.position.x,o.position.y),a.lineTo(o.position.x+20*h.x,o.position.y+20*h.y)}else for(s=u.length>1?1:0;s<u.length;s++)for(o=u[s],i=0;i<o.axes.length;i++)a.moveTo(o.position.x,o.position.y),a.lineTo((o.vertices[0].x+o.vertices[o.vertices.length-1].x)/2,(o.vertices[0].y+o.vertices[o.vertices.length-1].y)/2)}l.wireframes?(a.strokeStyle="indianred",a.lineWidth=1):(a.strokeStyle="rgba(255, 255, 255, 0.4)",a.globalCompositeOperation="overlay",a.lineWidth=2),a.stroke(),a.globalCompositeOperation="source-over"},o.bodyPositions=function(e,t,n){var o,r,s,i,a=n,l=(e.engine,e.options);for(a.beginPath(),s=0;s<t.length;s++)if(o=t[s],o.render.visible)for(i=0;i<o.parts.length;i++)r=o.parts[i],a.arc(r.position.x,r.position.y,3,0,2*Math.PI,!1),a.closePath();for(l.wireframes?a.fillStyle="indianred":a.fillStyle="rgba(0,0,0,0.5)",a.fill(),a.beginPath(),s=0;s<t.length;s++)o=t[s],o.render.visible&&(a.arc(o.positionPrev.x,o.positionPrev.y,2,0,2*Math.PI,!1),a.closePath());a.fillStyle="rgba(255,165,0,0.8)",a.fill()},o.bodyVelocity=function(e,t,n){var o=n;o.beginPath();for(var r=0;r<t.length;r++){var s=t[r];s.render.visible&&(o.moveTo(s.position.x,s.position.y),o.lineTo(s.position.x+2*(s.position.x-s.positionPrev.x),s.position.y+2*(s.position.y-s.positionPrev.y)))}o.lineWidth=3,o.strokeStyle="cornflowerblue",o.stroke()},o.bodyIds=function(e,t,n){var o,r,s=n;for(o=0;o<t.length;o++)if(t[o].render.visible){var i=t[o].parts;for(r=i.length>1?1:0;r<i.length;r++){var a=i[r];s.font="12px Arial",s.fillStyle="rgba(255,255,255,0.5)",s.fillText(a.id,a.position.x+10,a.position.y-10)}}},o.collisions=function(e,t,n){var o,r,s,i,a=n,l=e.options;for(a.beginPath(),s=0;s<t.length;s++)if(o=t[s],o.isActive)for(r=o.collision,i=0;i<o.activeContacts.length;i++){var c=o.activeContacts[i],u=c.vertex;a.rect(u.x-1.5,u.y-1.5,3.5,3.5)}for(l.wireframes?a.fillStyle="rgba(255,255,255,0.7)":a.fillStyle="orange",a.fill(),a.beginPath(),s=0;s<t.length;s++)if(o=t[s],o.isActive&&(r=o.collision,o.activeContacts.length>0)){var h=o.activeContacts[0].vertex.x,d=o.activeContacts[0].vertex.y;2===o.activeContacts.length&&(h=(o.activeContacts[0].vertex.x+o.activeContacts[1].vertex.x)/2,d=(o.activeContacts[0].vertex.y+o.activeContacts[1].vertex.y)/2),r.bodyB===r.supports[0].body||!0===r.bodyA.isStatic?a.moveTo(h-8*r.normal.x,d-8*r.normal.y):a.moveTo(h+8*r.normal.x,d+8*r.normal.y),a.lineTo(h,d)}l.wireframes?a.strokeStyle="rgba(255,165,0,0.7)":a.strokeStyle="orange",a.lineWidth=1,a.stroke()},o.separations=function(e,t,n){var o,r,s,i,a,l=n,c=e.options;for(l.beginPath(),a=0;a<t.length;a++)if(o=t[a],o.isActive){r=o.collision,s=r.bodyA,i=r.bodyB;var u=1;i.isStatic||s.isStatic||(u=.5),i.isStatic&&(u=0),l.moveTo(i.position.x,i.position.y),l.lineTo(i.position.x-r.penetration.x*u,i.position.y-r.penetration.y*u),u=1,i.isStatic||s.isStatic||(u=.5),s.isStatic&&(u=0),l.moveTo(s.position.x,s.position.y),l.lineTo(s.position.x+r.penetration.x*u,s.position.y+r.penetration.y*u)}c.wireframes?l.strokeStyle="rgba(255,165,0,0.5)":l.strokeStyle="orange",l.stroke()},o.grid=function(e,t,n){var o=n,s=e.options;s.wireframes?o.strokeStyle="rgba(255,180,0,0.1)":o.strokeStyle="rgba(255,180,0,0.5)",o.beginPath();for(var i=r.keys(t.buckets),a=0;a<i.length;a++){var l=i[a];if(!(t.buckets[l].length<2)){var c=l.split(/C|R/);o.rect(.5+parseInt(c[1],10)*t.bucketWidth,.5+parseInt(c[2],10)*t.bucketHeight,t.bucketWidth,t.bucketHeight)}}o.lineWidth=1,o.stroke()},o.inspector=function(e,t){e.engine;var n,o=e.selected,r=e.render,s=r.options;if(s.hasBounds){var i=r.bounds.max.x-r.bounds.min.x,a=r.bounds.max.y-r.bounds.min.y,l=i/r.options.width,c=a/r.options.height;t.scale(1/l,1/c),t.translate(-r.bounds.min.x,-r.bounds.min.y)}for(var u=0;u<o.length;u++){var h=o[u].data;switch(t.translate(.5,.5),t.lineWidth=1,t.strokeStyle="rgba(255,165,0,0.9)",t.setLineDash([1,2]),h.type){case"body":n=h.bounds,t.beginPath(),t.rect(Math.floor(n.min.x-3),Math.floor(n.min.y-3),Math.floor(n.max.x-n.min.x+6),Math.floor(n.max.y-n.min.y+6)),t.closePath(),t.stroke();break;case"constraint":var d=h.pointA;h.bodyA&&(d=h.pointB),t.beginPath(),t.arc(d.x,d.y,10,0,2*Math.PI),t.closePath(),t.stroke();break}t.setLineDash([]),t.translate(-.5,-.5)}null!==e.selectStart&&(t.translate(.5,.5),t.lineWidth=1,t.strokeStyle="rgba(255,165,0,0.6)",t.fillStyle="rgba(255,165,0,0.1)",n=e.selectBounds,t.beginPath(),t.rect(Math.floor(n.min.x),Math.floor(n.min.y),Math.floor(n.max.x-n.min.x),Math.floor(n.max.y-n.min.y)),t.closePath(),t.stroke(),t.fill(),t.translate(-.5,-.5)),s.hasBounds&&t.setTransform(1,0,0,1,0,0)};var n=function(e,t){var n=e.engine,r=e.timing,s=r.historySize,i=n.timing.timestamp;r.delta=t-r.lastTime||o._goodDelta,r.lastTime=t,r.timestampElapsed=i-r.lastTimestamp||0,r.lastTimestamp=i,r.deltaHistory.unshift(r.delta),r.deltaHistory.length=Math.min(r.deltaHistory.length,s),r.engineDeltaHistory.unshift(n.timing.lastDelta),r.engineDeltaHistory.length=Math.min(r.engineDeltaHistory.length,s),r.timestampElapsedHistory.unshift(r.timestampElapsed),r.timestampElapsedHistory.length=Math.min(r.timestampElapsedHistory.length,s),r.engineElapsedHistory.unshift(n.timing.lastElapsed),r.engineElapsedHistory.length=Math.min(r.engineElapsedHistory.length,s),r.elapsedHistory.unshift(r.lastElapsed),r.elapsedHistory.length=Math.min(r.elapsedHistory.length,s)},u=function(e){for(var t=0,n=0;n<e.length;n+=1)t+=e[n];return t/e.length||0},h=function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n.oncontextmenu=function(){return!1},n.onselectstart=function(){return!1},n},d=function(e){var t=e.getContext("2d"),n=window.devicePixelRatio||1,o=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return n/o},p=function(e,t){var n=e.textures[t];return n||(n=e.textures[t]=new Image,n.src=t,n)},m=function(e,t){var n=t;/(jpg|gif|png)$/.test(t)&&(n="url("+t+")"),e.canvas.style.background=n,e.canvas.style.backgroundSize="contain",e.currentBackground=t}})()},function(e,t){var n={};e.exports=n,function(){n.create=function(e){return{id:n.id(e),vertex:e,normalImpulse:0,tangentImpulse:0}},n.id=function(e){return e.body.id+"_"+e.index}}()},function(e,t,n){var o={};e.exports=o;var r=n(7),s=n(19),i=n(13),a=n(20),l=n(21),c=n(4),u=n(5),h=n(8),d=n(0),p=n(6);(function(){o.create=function(e){e=e||{};var t={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},grid:null,gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0}},n=d.extend(t,e);return n.world=e.world||u.create({label:"World"}),n.grid=l.create(e.grid||e.broadphase),n.pairs=a.create(),n.world.gravity=n.gravity,n.broadphase=n.grid,n.metrics={},n},o.update=function(e,t,n){var p=d.now();t=t||1e3/60,n=n||1;var m,f=e.world,g=e.timing,y=e.grid,v=[];g.timestamp+=t*g.timeScale,g.lastDelta=t*g.timeScale;var x={timestamp:g.timestamp};c.trigger(e,"beforeUpdate",x);var b=u.allBodies(f),w=u.allConstraints(f);for(e.enableSleeping&&r.update(b,g.timeScale),o._bodiesApplyGravity(b,e.gravity),o._bodiesUpdate(b,t,g.timeScale,n,f.bounds),h.preSolveAll(b),m=0;m<e.constraintIterations;m++)h.solveAll(w,g.timeScale);h.postSolveAll(b),f.isModified&&l.clear(y),l.update(y,b,e,f.isModified),v=y.pairsList,f.isModified&&u.setModified(f,!1,!1,!0);var A=i.collisions(v,e),S=e.pairs,M=g.timestamp;for(a.update(S,A,M),a.removeOld(S,M),e.enableSleeping&&r.afterCollisions(S.list,g.timeScale),S.collisionStart.length>0&&c.trigger(e,"collisionStart",{pairs:S.collisionStart}),s.preSolvePosition(S.list),m=0;m<e.positionIterations;m++)s.solvePosition(S.list,g.timeScale);for(s.postSolvePosition(b),h.preSolveAll(b),m=0;m<e.constraintIterations;m++)h.solveAll(w,g.timeScale);for(h.postSolveAll(b),s.preSolveVelocity(S.list),m=0;m<e.velocityIterations;m++)s.solveVelocity(S.list,g.timeScale);return S.collisionActive.length>0&&c.trigger(e,"collisionActive",{pairs:S.collisionActive}),S.collisionEnd.length>0&&c.trigger(e,"collisionEnd",{pairs:S.collisionEnd}),o._bodiesClearForces(b),c.trigger(e,"afterUpdate",x),e.timing.lastElapsed=d.now()-p,e},o.merge=function(e,t){if(d.extend(e,t),t.world){e.world=t.world,o.clear(e);for(var n=u.allBodies(e.world),s=0;s<n.length;s++){var i=n[s];r.set(i,!1),i.id=d.nextId()}}},o.clear=function(e){var t=e.world,n=u.allBodies(t);a.clear(e.pairs),l.clear(e.grid),l.update(e.grid,n,e,!0)},o._bodiesClearForces=function(e){for(var t=0;t<e.length;t++){var n=e[t];n.force.x=0,n.force.y=0,n.torque=0}},o._bodiesApplyGravity=function(e,t){var n="undefined"!==typeof t.scale?t.scale:.001;if((0!==t.x||0!==t.y)&&0!==n)for(var o=0;o<e.length;o++){var r=e[o];r.isStatic||r.isSleeping||(r.force.y+=r.mass*t.y*n,r.force.x+=r.mass*t.x*n)}},o._bodiesUpdate=function(e,t,n,o,r){for(var s=0;s<e.length;s++){var i=e[s];i.isStatic||i.isSleeping||p.update(i,t,n,o)}}})()},function(e,t,n){var o={};e.exports=o;var r=n(3),s=n(2),i=n(0),a=n(1);(function(){o._restingThresh=4,o._restingThreshTangent=6,o._positionDampen=.9,o._positionWarming=.8,o._frictionNormalMultiplier=5,o.preSolvePosition=function(e){var t,n,o;for(t=0;t<e.length;t++)n=e[t],n.isActive&&(o=n.activeContacts.length,n.collision.parentA.totalContacts+=o,n.collision.parentB.totalContacts+=o)},o.solvePosition=function(e,t){var n,r,i,a,l,c,u,h,d,p=s._temp[0],m=s._temp[1],f=s._temp[2],g=s._temp[3];for(n=0;n<e.length;n++)r=e[n],r.isActive&&!r.isSensor&&(i=r.collision,a=i.parentA,l=i.parentB,c=i.normal,u=s.sub(s.add(l.positionImpulse,l.position,p),s.add(a.positionImpulse,s.sub(l.position,i.penetration,m),f),g),r.separation=s.dot(c,u));for(n=0;n<e.length;n++)r=e[n],r.isActive&&!r.isSensor&&(i=r.collision,a=i.parentA,l=i.parentB,c=i.normal,d=(r.separation-r.slop)*t,(a.isStatic||l.isStatic)&&(d*=2),a.isStatic||a.isSleeping||(h=o._positionDampen/a.totalContacts,a.positionImpulse.x+=c.x*d*h,a.positionImpulse.y+=c.y*d*h),l.isStatic||l.isSleeping||(h=o._positionDampen/l.totalContacts,l.positionImpulse.x-=c.x*d*h,l.positionImpulse.y-=c.y*d*h))},o.postSolvePosition=function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.totalContacts=0,0!==n.positionImpulse.x||0!==n.positionImpulse.y){for(var i=0;i<n.parts.length;i++){var l=n.parts[i];r.translate(l.vertices,n.positionImpulse),a.update(l.bounds,l.vertices,n.velocity),l.position.x+=n.positionImpulse.x,l.position.y+=n.positionImpulse.y}n.positionPrev.x+=n.positionImpulse.x,n.positionPrev.y+=n.positionImpulse.y,s.dot(n.positionImpulse,n.velocity)<0?(n.positionImpulse.x=0,n.positionImpulse.y=0):(n.positionImpulse.x*=o._positionWarming,n.positionImpulse.y*=o._positionWarming)}}},o.preSolveVelocity=function(e){var t,n,o,r,i,a,l,c,u,h,d,p,m,f,g=s._temp[0],y=s._temp[1];for(t=0;t<e.length;t++)if(o=e[t],o.isActive&&!o.isSensor)for(r=o.activeContacts,i=o.collision,a=i.parentA,l=i.parentB,c=i.normal,u=i.tangent,n=0;n<r.length;n++)h=r[n],d=h.vertex,p=h.normalImpulse,m=h.tangentImpulse,0===p&&0===m||(g.x=c.x*p+u.x*m,g.y=c.y*p+u.y*m,a.isStatic||a.isSleeping||(f=s.sub(d,a.position,y),a.positionPrev.x+=g.x*a.inverseMass,a.positionPrev.y+=g.y*a.inverseMass,a.anglePrev+=s.cross(f,g)*a.inverseInertia),l.isStatic||l.isSleeping||(f=s.sub(d,l.position,y),l.positionPrev.x-=g.x*l.inverseMass,l.positionPrev.y-=g.y*l.inverseMass,l.anglePrev-=s.cross(f,g)*l.inverseInertia))},o.solveVelocity=function(e,t){for(var n=t*t,r=s._temp[0],a=s._temp[1],l=s._temp[2],c=s._temp[3],u=s._temp[4],h=s._temp[5],d=0;d<e.length;d++){var p=e[d];if(p.isActive&&!p.isSensor){var m=p.collision,f=m.parentA,g=m.parentB,y=m.normal,v=m.tangent,x=p.activeContacts,b=1/x.length;f.velocity.x=f.position.x-f.positionPrev.x,f.velocity.y=f.position.y-f.positionPrev.y,g.velocity.x=g.position.x-g.positionPrev.x,g.velocity.y=g.position.y-g.positionPrev.y,f.angularVelocity=f.angle-f.anglePrev,g.angularVelocity=g.angle-g.anglePrev;for(var w=0;w<x.length;w++){var A=x[w],S=A.vertex,M=s.sub(S,f.position,a),T=s.sub(S,g.position,l),P=s.add(f.velocity,s.mult(s.perp(M),f.angularVelocity),c),C=s.add(g.velocity,s.mult(s.perp(T),g.angularVelocity),u),E=s.sub(P,C,h),k=s.dot(y,E),_=s.dot(v,E),I=Math.abs(_),R=i.sign(_),L=(1+p.restitution)*k,N=i.clamp(p.separation+k,0,1)*o._frictionNormalMultiplier,B=_,O=1/0;I>p.friction*p.frictionStatic*N*n&&(O=I,B=i.clamp(p.friction*R*n,-O,O));var V=s.cross(M,y),D=s.cross(T,y),F=b/(f.inverseMass+g.inverseMass+f.inverseInertia*V*V+g.inverseInertia*D*D);if(L*=F,B*=F,k<0&&k*k>o._restingThresh*n)A.normalImpulse=0;else{var U=A.normalImpulse;A.normalImpulse=Math.min(A.normalImpulse+L,0),L=A.normalImpulse-U}if(_*_>o._restingThreshTangent*n)A.tangentImpulse=0;else{var z=A.tangentImpulse;A.tangentImpulse=i.clamp(A.tangentImpulse+B,-O,O),B=A.tangentImpulse-z}r.x=y.x*L+v.x*B,r.y=y.y*L+v.y*B,f.isStatic||f.isSleeping||(f.positionPrev.x+=r.x*f.inverseMass,f.positionPrev.y+=r.y*f.inverseMass,f.anglePrev+=s.cross(M,r)*f.inverseInertia),g.isStatic||g.isSleeping||(g.positionPrev.x-=r.x*g.inverseMass,g.positionPrev.y-=r.y*g.inverseMass,g.anglePrev-=s.cross(T,r)*g.inverseInertia)}}}}})()},function(e,t,n){var o={};e.exports=o;var r=n(9),s=n(0);(function(){o._pairMaxIdleLife=1e3,o.create=function(e){return s.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},e)},o.update=function(e,t,n){var o,s,i,a,l=e.list,c=e.table,u=e.collisionStart,h=e.collisionEnd,d=e.collisionActive;for(u.length=0,h.length=0,d.length=0,a=0;a<l.length;a++)l[a].confirmedActive=!1;for(a=0;a<t.length;a++)o=t[a],o.collided&&(s=r.id(o.bodyA,o.bodyB),i=c[s],i?(i.isActive?d.push(i):u.push(i),r.update(i,o,n),i.confirmedActive=!0):(i=r.create(o,n),c[s]=i,u.push(i),l.push(i)));for(a=0;a<l.length;a++)i=l[a],i.isActive&&!i.confirmedActive&&(r.setActive(i,!1,n),h.push(i))},o.removeOld=function(e,t){var n,r,s,i,a=e.list,l=e.table,c=[];for(i=0;i<a.length;i++)n=a[i],r=n.collision,r.bodyA.isSleeping||r.bodyB.isSleeping?n.timeUpdated=t:t-n.timeUpdated>o._pairMaxIdleLife&&c.push(i);for(i=0;i<c.length;i++)s=c[i]-i,n=a[s],delete l[n.id],a.splice(s,1)},o.clear=function(e){return e.table={},e.list.length=0,e.collisionStart.length=0,e.collisionActive.length=0,e.collisionEnd.length=0,e}})()},function(e,t,n){var o={};e.exports=o;var r=n(9),s=n(0);(function(){o.create=function(e){var t={buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return s.extend(t,e)},o.update=function(e,t,n,r){var s,i,a,l,c,u=n.world,h=e.buckets,d=!1;for(s=0;s<t.length;s++){var p=t[s];if((!p.isSleeping||r)&&(!u.bounds||!(p.bounds.max.x<u.bounds.min.x||p.bounds.min.x>u.bounds.max.x||p.bounds.max.y<u.bounds.min.y||p.bounds.min.y>u.bounds.max.y))){var m=o._getRegion(e,p);if(!p.region||m.id!==p.region.id||r){p.region&&!r||(p.region=m);var f=o._regionUnion(m,p.region);for(i=f.startCol;i<=f.endCol;i++)for(a=f.startRow;a<=f.endRow;a++){c=o._getBucketId(i,a),l=h[c];var g=i>=m.startCol&&i<=m.endCol&&a>=m.startRow&&a<=m.endRow,y=i>=p.region.startCol&&i<=p.region.endCol&&a>=p.region.startRow&&a<=p.region.endRow;!g&&y&&y&&l&&o._bucketRemoveBody(e,l,p),(p.region===m||g&&!y||r)&&(l||(l=o._createBucket(h,c)),o._bucketAddBody(e,l,p))}p.region=m,d=!0}}}d&&(e.pairsList=o._createActivePairsList(e))},o.clear=function(e){e.buckets={},e.pairs={},e.pairsList=[]},o._regionUnion=function(e,t){var n=Math.min(e.startCol,t.startCol),r=Math.max(e.endCol,t.endCol),s=Math.min(e.startRow,t.startRow),i=Math.max(e.endRow,t.endRow);return o._createRegion(n,r,s,i)},o._getRegion=function(e,t){var n=t.bounds,r=Math.floor(n.min.x/e.bucketWidth),s=Math.floor(n.max.x/e.bucketWidth),i=Math.floor(n.min.y/e.bucketHeight),a=Math.floor(n.max.y/e.bucketHeight);return o._createRegion(r,s,i,a)},o._createRegion=function(e,t,n,o){return{id:e+","+t+","+n+","+o,startCol:e,endCol:t,startRow:n,endRow:o}},o._getBucketId=function(e,t){return"C"+e+"R"+t},o._createBucket=function(e,t){var n=e[t]=[];return n},o._bucketAddBody=function(e,t,n){for(var o=0;o<t.length;o++){var s=t[o];if(!(n.id===s.id||n.isStatic&&s.isStatic)){var i=r.id(n,s),a=e.pairs[i];a?a[2]+=1:e.pairs[i]=[n,s,1]}}t.push(n)},o._bucketRemoveBody=function(e,t,n){t.splice(s.indexOf(t,n),1);for(var o=0;o<t.length;o++){var i=t[o],a=r.id(n,i),l=e.pairs[a];l&&(l[2]-=1)}},o._createActivePairsList=function(e){var t,n,o=[];t=s.keys(e.pairs);for(var r=0;r<t.length;r++)n=e.pairs[t[r]],n[2]>0?o.push(n):delete e.pairs[t[r]];return o}})()},function(e,t,n){var o=e.exports=n(23);o.Axes=n(10),o.Bodies=n(11),o.Body=n(6),o.Bounds=n(1),o.Common=n(0),o.Composite=n(5),o.Composites=n(24),o.Constraint=n(8),o.Contact=n(17),o.Detector=n(13),o.Engine=n(18),o.Events=n(4),o.Grid=n(21),o.Mouse=n(12),o.MouseConstraint=n(25),o.Pair=n(9),o.Pairs=n(20),o.Plugin=n(15),o.Query=n(26),o.Render=n(16),o.Resolver=n(19),o.Runner=n(27),o.SAT=n(14),o.Sleeping=n(7),o.Svg=n(28),o.Vector=n(2),o.Vertices=n(3),o.World=n(29),o.Engine.run=o.Runner.run,o.Common.deprecated(o.Engine,"run","Engine.run ➤ use Matter.Runner.run(engine) instead")},function(e,t,n){var o={};e.exports=o;var r=n(15),s=n(0);(function(){o.name="matter-js",o.version="0.17.1",o.uses=[],o.used=[],o.use=function(){r.use(o,Array.prototype.slice.call(arguments))},o.before=function(e,t){return e=e.replace(/^Matter./,""),s.chainPathBefore(o,e,t)},o.after=function(e,t){return e=e.replace(/^Matter./,""),s.chainPathAfter(o,e,t)}})()},function(e,t,n){var o={};e.exports=o;var r=n(5),s=n(8),i=n(0),a=n(6),l=n(11),c=i.deprecated;(function(){o.stack=function(e,t,n,o,s,i,l){for(var c,u=r.create({label:"Stack"}),h=e,d=t,p=0,m=0;m<o;m++){for(var f=0,g=0;g<n;g++){var y=l(h,d,g,m,c,p);if(y){var v=y.bounds.max.y-y.bounds.min.y,x=y.bounds.max.x-y.bounds.min.x;v>f&&(f=v),a.translate(y,{x:.5*x,y:.5*v}),h=y.bounds.max.x+s,r.addBody(u,y),c=y,p+=1}else h+=s}d+=f+i,h=e}return u},o.chain=function(e,t,n,o,a,l){for(var c=e.bodies,u=1;u<c.length;u++){var h=c[u-1],d=c[u],p=h.bounds.max.y-h.bounds.min.y,m=h.bounds.max.x-h.bounds.min.x,f=d.bounds.max.y-d.bounds.min.y,g=d.bounds.max.x-d.bounds.min.x,y={bodyA:h,pointA:{x:m*t,y:p*n},bodyB:d,pointB:{x:g*o,y:f*a}},v=i.extend(y,l);r.addConstraint(e,s.create(v))}return e.label+=" Chain",e},o.mesh=function(e,t,n,o,a){var l,c,u,h,d,p=e.bodies;for(l=0;l<n;l++){for(c=1;c<t;c++)u=p[c-1+l*t],h=p[c+l*t],r.addConstraint(e,s.create(i.extend({bodyA:u,bodyB:h},a)));if(l>0)for(c=0;c<t;c++)u=p[c+(l-1)*t],h=p[c+l*t],r.addConstraint(e,s.create(i.extend({bodyA:u,bodyB:h},a))),o&&c>0&&(d=p[c-1+(l-1)*t],r.addConstraint(e,s.create(i.extend({bodyA:d,bodyB:h},a)))),o&&c<t-1&&(d=p[c+1+(l-1)*t],r.addConstraint(e,s.create(i.extend({bodyA:d,bodyB:h},a))))}return e.label+=" Mesh",e},o.pyramid=function(e,t,n,r,s,i,l){return o.stack(e,t,n,r,s,i,(function(t,o,i,c,u,h){var d=Math.min(r,Math.ceil(n/2)),p=u?u.bounds.max.x-u.bounds.min.x:0;if(!(c>d)){c=d-c;var m=c,f=n-1-c;if(!(i<m||i>f)){1===h&&a.translate(u,{x:(i+(n%2===1?1:-1))*p,y:0});var g=u?i*p:0;return l(e+g+i*s,o,i,c,u,h)}}}))},o.newtonsCradle=function(e,t,n,o,i){for(var a=r.create({label:"Newtons Cradle"}),c=0;c<n;c++){var u=1.9,h=l.circle(e+c*(o*u),t+i,o,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),d=s.create({pointA:{x:e+c*(o*u),y:t},bodyB:h});r.addBody(a,h),r.addConstraint(a,d)}return a},c(o,"newtonsCradle","Composites.newtonsCradle ➤ moved to newtonsCradle example"),o.car=function(e,t,n,o,i){var c=a.nextGroup(!0),u=20,h=.5*-n+u,d=.5*n-u,p=0,m=r.create({label:"Car"}),f=l.rectangle(e,t,n,o,{collisionFilter:{group:c},chamfer:{radius:.5*o},density:2e-4}),g=l.circle(e+h,t+p,i,{collisionFilter:{group:c},friction:.8}),y=l.circle(e+d,t+p,i,{collisionFilter:{group:c},friction:.8}),v=s.create({bodyB:f,pointB:{x:h,y:p},bodyA:g,stiffness:1,length:0}),x=s.create({bodyB:f,pointB:{x:d,y:p},bodyA:y,stiffness:1,length:0});return r.addBody(m,f),r.addBody(m,g),r.addBody(m,y),r.addConstraint(m,v),r.addConstraint(m,x),m},c(o,"car","Composites.car ➤ moved to car example"),o.softBody=function(e,t,n,r,s,a,c,u,h,d){h=i.extend({inertia:1/0},h),d=i.extend({stiffness:.2,render:{type:"line",anchors:!1}},d);var p=o.stack(e,t,n,r,s,a,(function(e,t){return l.circle(e,t,u,h)}));return o.mesh(p,n,r,c,d),p.label="Soft Body",p},c(o,"softBody","Composites.softBody ➤ moved to softBody and cloth examples")})()},function(e,t,n){var o={};e.exports=o;var r=n(3),s=n(7),i=n(12),a=n(4),l=n(13),c=n(8),u=n(5),h=n(0),d=n(1);(function(){o.create=function(e,t){var n=(e?e.mouse:null)||(t?t.mouse:null);n||(e&&e.render&&e.render.canvas?n=i.create(e.render.canvas):t&&t.element?n=i.create(t.element):(n=i.create(),h.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var r=c.create({label:"Mouse Constraint",pointA:n.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),s={type:"mouseConstraint",mouse:n,element:null,body:null,constraint:r,collisionFilter:{category:1,mask:4294967295,group:0}},l=h.extend(s,t);return a.on(e,"beforeUpdate",(function(){var t=u.allBodies(e.world);o.update(l,t),o._triggerEvents(l)})),l},o.update=function(e,t){var n=e.mouse,o=e.constraint,i=e.body;if(0===n.button){if(o.bodyB)s.set(o.bodyB,!1),o.pointA=n.position;else for(var c=0;c<t.length;c++)if(i=t[c],d.contains(i.bounds,n.position)&&l.canCollide(i.collisionFilter,e.collisionFilter))for(var u=i.parts.length>1?1:0;u<i.parts.length;u++){var h=i.parts[u];if(r.contains(h.vertices,n.position)){o.pointA=n.position,o.bodyB=e.body=i,o.pointB={x:n.position.x-i.position.x,y:n.position.y-i.position.y},o.angleB=i.angle,s.set(i,!1),a.trigger(e,"startdrag",{mouse:n,body:i});break}}}else o.bodyB=e.body=null,o.pointB=null,i&&a.trigger(e,"enddrag",{mouse:n,body:i})},o._triggerEvents=function(e){var t=e.mouse,n=t.sourceEvents;n.mousemove&&a.trigger(e,"mousemove",{mouse:t}),n.mousedown&&a.trigger(e,"mousedown",{mouse:t}),n.mouseup&&a.trigger(e,"mouseup",{mouse:t}),i.clearSourceEvents(t)}})()},function(e,t,n){var o={};e.exports=o;var r=n(2),s=n(14),i=n(1),a=n(11),l=n(3);(function(){o.collides=function(e,t){for(var n=[],o=0;o<t.length;o++){var r=t[o];if(i.overlaps(r.bounds,e.bounds))for(var a=1===r.parts.length?0:1;a<r.parts.length;a++){var l=r.parts[a];if(i.overlaps(l.bounds,e.bounds)){var c=s.collides(l,e);if(c.collided){n.push(c);break}}}}return n},o.ray=function(e,t,n,s){s=s||1e-100;for(var i=r.angle(t,n),l=r.magnitude(r.sub(t,n)),c=.5*(n.x+t.x),u=.5*(n.y+t.y),h=a.rectangle(c,u,l,s,{angle:i}),d=o.collides(h,e),p=0;p<d.length;p+=1){var m=d[p];m.body=m.bodyB=m.bodyA}return d},o.region=function(e,t,n){for(var o=[],r=0;r<e.length;r++){var s=e[r],a=i.overlaps(s.bounds,t);(a&&!n||!a&&n)&&o.push(s)}return o},o.point=function(e,t){for(var n=[],o=0;o<e.length;o++){var r=e[o];if(i.contains(r.bounds,t))for(var s=1===r.parts.length?0:1;s<r.parts.length;s++){var a=r.parts[s];if(i.contains(a.bounds,t)&&l.contains(a.vertices,t)){n.push(r);break}}}return n}})()},function(e,t,n){var o={};e.exports=o;var r=n(4),s=n(18),i=n(0);(function(){var e,t,n;("undefined"!==typeof window&&(e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),e)||(e=function(e){n=setTimeout((function(){e(i.now())}),1e3/60)},t=function(){clearTimeout(n)});o.create=function(e){var t={fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0},n=i.extend(t,e);return n.delta=n.delta||1e3/n.fps,n.deltaMin=n.deltaMin||1e3/n.fps,n.deltaMax=n.deltaMax||1e3/(.5*n.fps),n.fps=1e3/n.delta,n},o.run=function(t,n){return"undefined"!==typeof t.positionIterations&&(n=t,t=o.create()),function r(s){t.frameRequestId=e(r),s&&t.enabled&&o.tick(t,n,s)}(),t},o.tick=function(e,t,n){var o,i=t.timing,a=1,l={timestamp:i.timestamp};r.trigger(e,"beforeTick",l),e.isFixed?o=e.delta:(o=n-e.timePrev||e.delta,e.timePrev=n,e.deltaHistory.push(o),e.deltaHistory=e.deltaHistory.slice(-e.deltaSampleSize),o=Math.min.apply(null,e.deltaHistory),o=o<e.deltaMin?e.deltaMin:o,o=o>e.deltaMax?e.deltaMax:o,a=o/e.delta,e.delta=o),0!==e.timeScalePrev&&(a*=i.timeScale/e.timeScalePrev),0===i.timeScale&&(a=0),e.timeScalePrev=i.timeScale,e.correction=a,e.frameCounter+=1,n-e.counterTimestamp>=1e3&&(e.fps=e.frameCounter*((n-e.counterTimestamp)/1e3),e.counterTimestamp=n,e.frameCounter=0),r.trigger(e,"tick",l),r.trigger(e,"beforeUpdate",l),s.update(t,o,a),r.trigger(e,"afterUpdate",l),r.trigger(e,"afterTick",l)},o.stop=function(e){t(e.frameRequestId)},o.start=function(e,t){o.run(e,t)}})()},function(e,t,n){var o={};e.exports=o;n(1);var r=n(0);(function(){o.pathToVertices=function(e,t){"undefined"===typeof window||"SVGPathSeg"in window||r.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var n,s,i,a,l,c,u,h,d,p,m,f,g=[],y=0,v=0,x=0;t=t||15;var b=function(e,t,n){var o=n%2===1&&n>1;if(!d||e!=d.x||t!=d.y){d&&o?(m=d.x,f=d.y):(m=0,f=0);var r={x:m+e,y:f+t};!o&&d||(d=r),g.push(r),v=m+e,x=f+t}},w=function(e){var t=e.pathSegTypeAsLetter.toUpperCase();if("Z"!==t){switch(t){case"M":case"L":case"T":case"C":case"S":case"Q":v=e.x,x=e.y;break;case"H":v=e.x;break;case"V":x=e.y;break}b(v,x,e.pathSegType)}};for(o._svgPathToAbsolute(e),i=e.getTotalLength(),c=[],n=0;n<e.pathSegList.numberOfItems;n+=1)c.push(e.pathSegList.getItem(n));u=c.concat();while(y<i){if(p=e.getPathSegAtLength(y),l=c[p],l!=h){while(u.length&&u[0]!=l)w(u.shift());h=l}switch(l.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":a=e.getPointAtLength(y),b(a.x,a.y,0);break}y+=t}for(n=0,s=u.length;n<s;++n)w(u[n]);return g},o._svgPathToAbsolute=function(e){for(var t,n,o,r,s,i,a=e.pathSegList,l=0,c=0,u=a.numberOfItems,h=0;h<u;++h){var d=a.getItem(h),p=d.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(p))"x"in d&&(l=d.x),"y"in d&&(c=d.y);else switch("x1"in d&&(o=l+d.x1),"x2"in d&&(s=l+d.x2),"y1"in d&&(r=c+d.y1),"y2"in d&&(i=c+d.y2),"x"in d&&(l+=d.x),"y"in d&&(c+=d.y),p){case"m":a.replaceItem(e.createSVGPathSegMovetoAbs(l,c),h);break;case"l":a.replaceItem(e.createSVGPathSegLinetoAbs(l,c),h);break;case"h":a.replaceItem(e.createSVGPathSegLinetoHorizontalAbs(l),h);break;case"v":a.replaceItem(e.createSVGPathSegLinetoVerticalAbs(c),h);break;case"c":a.replaceItem(e.createSVGPathSegCurvetoCubicAbs(l,c,o,r,s,i),h);break;case"s":a.replaceItem(e.createSVGPathSegCurvetoCubicSmoothAbs(l,c,s,i),h);break;case"q":a.replaceItem(e.createSVGPathSegCurvetoQuadraticAbs(l,c,o,r),h);break;case"t":a.replaceItem(e.createSVGPathSegCurvetoQuadraticSmoothAbs(l,c),h);break;case"a":a.replaceItem(e.createSVGPathSegArcAbs(l,c,d.r1,d.r2,d.angle,d.largeArcFlag,d.sweepFlag),h);break;case"z":case"Z":l=t,c=n;break}"M"!=p&&"m"!=p||(t=l,n=c)}}})()},function(e,t,n){var o={};e.exports=o;var r=n(5);n(0);(function(){o.create=r.create,o.add=r.add,o.remove=r.remove,o.clear=r.clear,o.addComposite=r.addComposite,o.addBody=r.addBody,o.addConstraint=r.addConstraint})()}])}))},4893:function(e,t,n){"use strict";
/**
 * @package      npmjs.com/package/@yandeu/events (events.min.js)
 *
 * @author       Arnout Kazemier (https://github.com/3rd-Eden)
 * @copyright    Copyright (c) 2014 Arnout Kazemier
 * @license      {@link https://github.com/primus/eventemitter3/blob/master/LICENSE|MIT}
 *
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/yandeu/events
 * @license      {@link https://github.com/yandeu/events/blob/master/LICENSE|MIT}
 */n(1703);var o=this&&this.__spreadArray||function(e,t){for(var n=0,o=t.length,r=e.length;n<o;n++,r++)e[r]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.Events=void 0;var r=n(1730),s=function(){function e(e,t,n){void 0===n&&(n=!1),this.fn=e,this.context=t,this.once=n}return e}(),i=function(e,t,n,o,r){if("function"!==typeof n)throw new TypeError("The listener must be a function");var i=new s(n,o||e,r);return e._events.has(t)?e._events.get(t).fn?e._events.set(t,[e._events.get(t),i]):e._events.get(t).push(i):(e._events.set(t,i),e._eventsCount++),e},a=function(e,t){0===--e._eventsCount?e._events=new Map:e._events.delete(t)},l=function(){function e(){this._events=new Map,this._eventsCount=0}return Object.defineProperty(e,"VERSION",{get:function(){return r.VERSION},enumerable:!1,configurable:!0}),e.prototype.eventNames=function(){return Array.from(this._events.keys())},e.prototype.listeners=function(e){var t=this._events.get(e);if(!t)return[];if(t.fn)return[t.fn];for(var n=0,o=t.length,r=new Array(o);n<o;n++)r[n]=t[n].fn;return r},e.prototype.listenerCount=function(e){var t=this._events.get(e);return t?t.fn?1:t.length:0},e.prototype.emit=function(e){for(var t,n,r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];if(!this._events.has(e))return!1;var i,a=this._events.get(e);if(a.fn)return a.once&&this.removeListener(e,a.fn,void 0,!0),(t=a.fn).call.apply(t,o([a.context],r)),!0;var l=a.length;for(i=0;i<l;i++)a[i].once&&this.removeListener(e,a[i].fn,void 0,!0),(n=a[i].fn).call.apply(n,o([a[i].context],r));return!0},e.prototype.on=function(e,t,n){return i(this,e,t,n,!1)},e.prototype.once=function(e,t,n){return i(this,e,t,n,!0)},e.prototype.removeListener=function(e,t,n,o){if(!this._events.has(e))return this;if(!t)return a(this,e),this;var r=this._events.get(e);if(r.fn)r.fn!==t||o&&!r.once||n&&r.context!==n||a(this,e);else{for(var s=0,i=[],l=r.length;s<l;s++)(r[s].fn!==t||o&&!r[s].once||n&&r[s].context!==n)&&i.push(r[s]);i.length?this._events.set(e,1===i.length?i[0]:i):a(this,e)}return this},e.prototype.removeAllListeners=function(e){return e?this._events.delete(e)&&a(this,e):(this._events=new Map,this._eventsCount=0),this},Object.defineProperty(e.prototype,"off",{get:function(){return this.removeListener},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"addListener",{get:function(){return this.on},enumerable:!1,configurable:!0}),e}();t.Events=l},1730:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION=void 0,t.VERSION="0.0.5"}}]);
//# sourceMappingURL=942.765e7642.js.map